Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";const e={};return console.time("[bluejay] Ready"),console.time("[bluejay] DOM Loaded"),e.extend=(t,s)=>{if("function"!=typeof s)throw new TypeError("[bluejay] [app.js] - only extend with a function: "+t);if(s._bj||t in e)throw new TypeError("[bluejay] [app.js] - already extended with: "+t);e[t]=s,s._bj=!0},e.log=e=>{console.log("[bluejay] "+e)},e.ready=()=>{console.timeEnd("[bluejay] Ready")},e.log("OE JS UI layer [bluejay] ..."),e.log("DEBUG MODE"),e.log("Mustache version: "+Mustache.version),document.addEventListener("DOMContentLoaded",()=>{e.log("[Modules] - "+e.registeredModules()),console.timeEnd("[bluejay] DOM Loaded")},{once:!0}),e})();!(function(e){"use strict";const t=(function*(){let e=10;for(;;)yield++e})(),s=()=>t.next().value;function n(){this.map=new Map,this.dataAttr="data-oebjk"}e.extend("getKey",s),n.prototype.add=function(e,t){const n=s();return this.map.set(n,e),t.setAttribute(this.dataAttr,n),n},n.prototype.getKey=function(e){let t=e.getAttribute(this.dataAttr);return null!==t&&""!=t&&t},n.prototype.get=function(e){return"string"==typeof e&&(e=parseInt(e,10)),this.map.get(e)},n.prototype.getFirst=function(){return this.map.values().next().value},n.prototype.next=function(e){const t=this.map.keys();let s=t.next();for(;!s.done;){if(s.value===e)return t.next().value;s=t.next()}},n.prototype.prev=function(e){const t=this.map.keys();let s=!1;for(const n of t){if(n===e)return s;s=n}},n.prototype.has=function(e){return this.map.has(e)},e.extend("Collection",n)})(bluejay),(function(e){"use strict";bluejay.extend("customEvent",(e,t)=>{const s=new CustomEvent(e,{detail:t});document.dispatchEvent(s)})})(),(function(e){"use strict";new URL(window.location).hostname;const t=new Map,s=new Map,n=new Map,i=new Map,a=new Set,o=(e,t,s)=>{if(e.has(t))throw new TypeError("Event Delegation: selector already added : "+t);e.set(t,s)},l=(e,t)=>{const s=e.target;if(s===document)return!1;t.forEach((t,n)=>{s.matches(n)&&t(e)})},r=(()=>{let e=0;return{delay:()=>{clearTimeout(e),e=setTimeout(()=>{a.forEach(e=>{e()})},150)}}})();function c(e){l(e,s)}function d(e){l(e,t)}function u(e){l(e,n)}window.onresize=()=>r.delay();let p=e=>{document.removeEventListener("mouseenter",c,{capture:!0}),document.removeEventListener("mousedown",d,{capture:!0}),document.removeEventListener("mouseleave",u,{capture:!0}),l(e,t),p=e=>{l(e,t)}};document.addEventListener("mouseenter",c,{capture:!0}),document.addEventListener("mousedown",d,{capture:!0}),document.addEventListener("mouseleave",u,{capture:!0}),document.addEventListener("touchstart",e=>p(e),{capture:!0}),document.addEventListener("click",e=>l(e,i),{capture:!0}),e.extend("userEnter",(e,t)=>o(s,e,t)),e.extend("userDown",(e,s)=>o(t,e,s)),e.extend("userLeave",(e,t)=>o(n,e,t)),e.extend("userClick",(e,t)=>o(i,e,t)),e.extend("listenForResize",e=>a.add(e))})(bluejay),(function(e){"use strict";const t=e=>{e.parentNode.removeChild(e)};const s=(function*(){let e=1;for(;;)++e,yield"bj"+e})();e.extend("nodeArray",e=>Array.prototype.slice.call(e)),e.extend("find",(e,t)=>(t||document).querySelector(e)),e.extend("getParent",(e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1}),e.extend("wrap",(e,t="")=>{const s=document.createElement("div"),n=window.getComputedStyle(e);return s.style.width=n.getPropertyValue("width"),s.style.position="relative",s.style.display="inline-block",e.style.width="100%",e.parentNode.insertBefore(s,e),s.appendChild(e),s}),e.extend("unwrap",e=>{const s=e.parentNode,n=s.parentNode;e.style.width="",n.insertBefore(e,s),t(s)}),e.extend("div",e=>{const t=document.createElement("div");return t.className=e,t}),e.extend("remove",t),e.extend("show",(e,t="")=>{null!==e&&(e.style.display=t)}),e.extend("reshow",e=>{null!==e&&(e.style.display="")}),e.extend("hide",e=>{null!==e&&(e.style.display="none")}),e.extend("xhr",(t,s=!1)=>(e.log("[XHR] - "+t),new Promise((n,i)=>{let a=new XMLHttpRequest;a.open("GET",t),a.onreadystatechange=function(){4===a.readyState&&(a.status>=200&&a.status<300?(e.log("[XHR] - Success"),a.token=s,n({html:a.responseText,token:s})):(e.log("[XHR] - Failed"),i(this.status+" "+this.statusText)))},a.send()}))),e.extend("getToken",()=>s.next().value),e.extend("loadJS",(t,s=!1)=>(e.log("[JS script] - "+t),new Promise((n,i)=>{const a=document.createElement("script");a.src=t,s&&a.setAttribute("crossorigin",""),a.onload=()=>{setTimeout(()=>{e.log("[JS loaded] - "+t),n()},100)},a.onerror=()=>e.log("[JS ERROR ] - "+t),document.head.appendChild(a)}))),e.extend("getHiddenElemSize",e=>{e.style.visibility="hidden",e.style.display="";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="",e.style.display="none",t}),e.extend("idgReporter",e=>{let t="idg-js-ui-message-out",s=document.getElementById(t),n=document.createElement("li");null===s&&(s=document.createElement("ul"),s.id=t,s.style="position:fixed; bottom:10px; right:10px; z-index:9999; background:orange; padding:10px; list-style-position:inside; max-height:vh90; overflow-y: scroll; font-size:14px;",document.body.appendChild(s));let i=s.children.length;n.appendChild(document.createTextNode(i+" - "+e)),s.appendChild(n)}),e.extend("clock24",e=>e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0"))})(bluejay),(function(e){"use strict";const t=[],s=new Map;e.extend("addModule",e=>t.push(e)),e.extend("registeredModules",()=>(t.sort(),t.join(", "))),e.extend("namespace",e=>(s.has(e)||s.set(e,{}),s.get(e)))})(bluejay),(function(e){"use strict";const t=()=>({list:new Set,add(e){return this.list.add(e),this.list.has(e)},remove(e){this.list.remove(e)},size(){return this.list.size},notify(){let e=this.list.values();for(let t of e)t()}});bluejay.extend("ModelViews",()=>({views:Object.create(t())}))})(),(function(e){"use strict";let t=window.innerWidth,s=window.innerHeight;e.listenForResize(()=>{t=window.innerWidth,s=window.innerHeight});const n=(e=!1)=>"data-"+(e?"bluejay-"+e:"bluejay");e.extend("settings",t=>{switch(t){case"cssHeaderHeight":return 60;case"cssExtended":return 1440;case"cssHotlistFixed":return 1890;case"idgPHPLoadURL":return"/idg-php/v3/_load/";default:return e.log("Setting request not recognised: "+t),null}}),e.extend("getWinH",()=>s),e.extend("getWinW",()=>t),e.extend("getDataAttributeName",n),e.extend("setDataAttr",(e,t)=>{e.setAttribute(n(),t)}),e.extend("getDataAttr",e=>{const t=n();return!!e.hasAttribute(t)&&e.getAttribute(t)})})(bluejay);const oePlotly=(function(e){"use strict";e.log("Plot.ly version: "+Plotly.version),e.log("oePlotly - Plot.ly builder available");const t={blue:"#63d7d6",highlight:"#fff",green:"#65d235",red:"#ea2b34",greenSeries:["#65d235","#A5D712","#02B546"],redSeries:["#ea2b34","#F64A2D","#C92845"],yellowSeries:["#FAD94B","#E8B131","#F1F555"],standard:["#1451b3","#175ece","#1a69e5"],varied:["#0a83ea","#18949f","#781cea","#3f0aea"],dual:["#1472DE","#2E4259"]},s={blue:"#00f",highlight:"#000",green:"#418c20",red:"#da3e43",greenSeries:["#418c20","#598617","#139149"],redSeries:["#da3e43","#E64C02","#E64562"],yellowSeries:["#FCCE14","#E69812","#FCBB21"],standard:["#0a4198","#1451b3","#175ece"],varied:["#0a2aea","#ea0a8e","#00b827","#890aea"],dual:["#2126C2","#8FAEC2"]},n=(e,n)=>{switch(e){case"highlight":return n?t.highlight:s.highlight;case"rightEye":return n?t.green:s.green;case"leftEye":return n?t.red:s.red;default:return"pink"}};return{isDarkTheme:()=>"dark"===window.oeThemeMode,getBlue:e=>e?t.blue:s.blue,getColorSeries:(e,n)=>{let i=null;const a=t,o=s;switch(e){case"varied":i=n?a.varied:o.varied;break;case"posNeg":i=n?a.dual:o.dual;break;case"rightEyeSeries":i=n?a.greenSeries:o.greenSeries;break;case"leftEyeSeries":i=n?a.redSeries:o.redSeries;break;case"BEOSeries":i=n?a.yellowSeries:o.yellowSeries;break;default:i=n?a.standard:o.standard}return i},getColor:n,getColorFor:(e,t)=>n(e,t)}})(bluejay);!(function(e){"use strict";e.findRegression=function(e,t){let s=0,n=0,i=0,a=0,o=0,l=0,r=0,c=e.length;if(c!=t.length)throw new Error("The parameters values_x and values_y need to have same size!");if(0===c)return[[],[]];for(let d=0;d<c;d++)l=e[d],r=t[d],s+=l,n+=r,a+=l*l,i+=l*r,o++;const d=(o*i-s*n)/(o*a-s*s),u=n/o-d*s/o;let p=[],h=[];for(let t=0;t<c;t++)l=e[t],r=l*d+u,p.push(parseFloat(Number.parseFloat(l).toFixed(2))),h.push(parseFloat(Number.parseFloat(r).toFixed(2)));return{x:p,y:h}}})(oePlotly),(function(e){"use strict";e.getAxis=function(e,t){let s={linecolor:t?"#666":"#999",linewidth:1,showgrid:!0,gridcolor:t?"#292929":"#e6e6e6",tickmode:"auto",nticks:20,ticks:"outside",ticklen:3,tickcolor:t?"#666":"#ccc",automargin:!0,mirror:!0,connectgaps:!1};const n="y"==e.type;if(e.noMirrorLines&&(s.mirror=!1),e.domain&&n&&(s.domain=e.domain),e.title&&(s.title={text:e.title,standoff:n?10:20,font:{size:12}}),e.rightSide&&n&&(s.overlaying=e.rightSide,s.side="right",s.showgrid=!1,s.zeroline=!1,s.title.standoff=15),e.numTicks&&(s.nticks=e.numTicks),e.useDates&&(s.tickformat="%b %Y"),e.fixRange&&(s.fixedrange=!0),e.range&&(s.range=e.range),e.axisType&&(s.type=e.axisType),e.useCategories){let t=e.useCategories.categoryarray;s.type="category",s.categoryarray=[" "].concat(t),e.useCategories.showAll&&(s.range=[0,t.length+1])}return e.spikes&&(s.showspikes=!0,s.spikecolor=t?"#0ff":"#00f",s.spikethickness=t?.5:1,s.spikedash=t?"1px,3px":"2px,3px"),s}})(oePlotly),(function(e){"use strict";e.getLayout=function(t){const s=t.darkTheme;let n={isDark:s,hovermode:"closest",autosize:!0,margin:{l:50,r:50,t:30,b:40,pad:4,autoexpand:!0},paper_bgcolor:s?"rgba(30,46,66,0.5)":"rgba(255,255,255,0.5)",plot_bgcolor:s?"rgb(10,10,30)":"#fff",font:{family:"Roboto, 'Open Sans', verdana, arial, sans-serif",size:11,color:s?"#aaa":"#333"},hoverlabel:{bgcolor:s?"#003":"#fff",bordercolor:s?"#003":"#00f",font:{size:11,color:e.getBlue(s)}}};if(t.colors?n.colorway=e.getColorSeries(t.colors,s):n.colorway=e.getColorSeries("default",s),t.plotTitle&&(n.title={text:t.plotTitle,xref:"paper",yref:"container",x:0,y:1,yanchor:"top",pad:{t:20},font:{size:15}},n.margin.t=50),t.legend){n.showlegend=!0;const e={font:{size:9},itemclick:"toggleothers",orientation:"h",xanchor:"right",yanchor:"bottom",x:1,y:1};"boolean"==typeof t.legend?n.legend=e:n.legend=Object.assign(e,t.legend)}else n.showlegend=!1;if(t.subplot&&(n.grid={rows:t.subplot,columns:1,pattern:"independent"}),n.shapes=[],n.annotations=[],t.vLineLabel){const i=t.vLineLabel.x,a=t.vLineLabel.h,o=(t,n)=>({type:"line",layer:"above",yref:"paper",x0:t.x,y0:0,x1:t.x,y1:a,line:{color:e.getBlue(s),width:.5}}),l=(t,n)=>({showarrow:!1,text:t.name,textangle:90,align:"left",font:{color:e.getBlue(s)},borderpad:2,x:t.x,xshift:8,yref:"paper",y:a});n.shapes=n.shapes.concat(i.map(o)),n.annotations=n.annotations.concat(i.map(l))}if(t.hLineLabel){const i=t.hLineLabel.y,a=t.hLineLabel.axis,o=(t,n)=>({type:"line",layer:"below",xref:"paper",yref:a,x0:0,y0:t.y,x1:1,y1:t.y,line:{color:e.getBlue(s),width:2,dash:"3px,12px"}}),l=(t,n)=>({showarrow:!1,text:t.name,align:"left",font:{color:e.getBlue(s)},borderpad:2,xref:"paper",x:0,yshift:8,yref:a,y:t.y});n.shapes=n.shapes.concat(i.map(o)),n.annotations=n.annotations.concat(i.map(l))}if(t.xaxis&&(n.xaxis=t.xaxis,n.xaxis.title&&(n.margin.b=80)),t.yaxes&&t.yaxes.forEach((e,t)=>{t?n["yaxis"+(t+1)]=e:n.yaxis=e,e.title&&("right"==e.side?n.margin.r=80:n.margin.l=80)}),t.rangeSlider){const e={thickness:.08};s&&(e.bgcolor=n.paper_bgcolor,e.borderwidth=1,e.bordercolor=n.plot_bgcolor),"boolean"!=typeof t.rangeSlider&&(e.range=t.rangeSlider),n.xaxis.rangeslider=e,n.margin.b=15}return t.dateRangeButtons&&(n.xaxis.rangeselector=Object.assign({x:1,xanchor:"right",buttons:[{label:"Show all",step:"all"},{label:"2 Yr",step:"year",count:2},{label:"1 Yr",step:"year",count:1},{label:"6 Mth",step:"month",count:6}]},e.buttonStyling(s))),n}})(oePlotly),(function(e,t){"use strict";e.buildDiv=(e,t,s,n=!1)=>{const i=document.createElement("div");let a=e.toLowerCase();return a=a.trim(),a=a.replace(" ","-"),i.id="oePlotly-"+a,i.style.height=t,i.style.minHeight=s,n&&(i.style.width=n),i},e.fullDateRange=()=>({all:[],add(e){this.all=this.all.concat(e),this.all.sort()},firstLast(){let e=this.all.filter(e=>null!==e);return[e[0],e.pop()]}}),e.addClickEvent=(e,s)=>{e.on("plotly_click",(function(e){const n=e.points[0];let i={eye:s,name:n.data.name,index:n.pointIndex,x:n.x,y:n.y};t.customEvent("oePlotlyClick",i),t.log('"oePlotlyClick" Event data: '+JSON.stringify(i))}))},e.addHoverEvent=(e,s)=>{t.log('"oePlotlyHover" ('+s+") Event available (click point to see data structure)"),e.on("plotly_hover",(function(e){const n=e.points[0];let i={eye:s,name:n.data.name,index:n.pointIndex,x:n.x,y:n.y};t.customEvent("oePlotlyHover",i)}))},e.dataLine=t=>{let s={};return t.color&&(s.color=t.color),t.dashed&&(s=Object.assign(s,e.dashedLine())),s},e.dashedLine=()=>({dash:"2px,2px",width:2}),e.markerFor=e=>{const t={};switch(e){case"image":t.symbol="triangle-down",t.size=10;break;case"drug":t.symbol="diamond",t.size=8;break;case"injection":t.symbol="star-diamond",t.size=9}return t},e.eventStyle=(t,s=!1)=>{const n={marker:e.markerFor(t)};switch(t){case"image":n.mode="markers";break;case"drug":n.mode="lines+markers",n.line={width:3};break;case"injection":n.mode="markers"}return s&&(n.marker&&(n.marker.color=s),n.line&&(n.line.color=s)),n},e.buttonStyling=e=>({font:{color:e?"#ccc":"#666"},bgcolor:e?"rgb(30,46,66)":"rgb(255,255,255)",activecolor:e?"rgb(7,69,152)":"rgb(205,205,255)",bordercolor:e?"rgb(10,26,36))":"rgb(255,255,255)",borderwidth:2}),e.addDropDown=t=>{let s=[];s.push({method:"update",args:["visible",[!0,!1,!1,!1]],label:"Option 1"}),s.push({method:"update",args:[{},{title:"some new title",colorway:e.getColorSeries("default",!0)}],label:"Options Title"});let n=Object.assign({type:"dropdown",xanchor:"left",yanchor:"top",x:0,y:.35,buttons:s},e.buttonStyling());t.updatemenus=[n]}})(oePlotly,bluejay),(function(e){"use strict";e.highlighPoint=(t,s)=>(n,i)=>{let a=n.split(".");if(2!=a.length)return void bj.log('oePlotly - for highlightPoint to work it needs EyeSide & Date JSON name e.g. "leftEye.OCT" ');let o,l,r=a[0],c=a[1],d=0;t.get(r).get("data").forEach((e,t)=>{t===c&&(o=e,l=d),d++});let u=e.getColor(r,s),p=[];for(let e=0;e<o.x.length;e++)p.push(u);p[i]=e.getColor("highlight",s);let h=e.markerFor(o.oeEventType);h.color=p,Plotly.restyle(t.get(r).get("div"),{marker:h},[l])}})(oePlotly),(function(e){"use strict";e.selectableUnits=()=>{const t=new Map,s=[];let n,i=0;const a=e=>{i=e.target.selectedIndex;for(const e of t.keys())n(e)};return{init:t=>{n=t.plotlyUpdate;const o=t.darkTheme,l=t.axisDefaults,r=l.title,c=[];t.unitRanges.forEach((t,n)=>{let a;t.makeDefault&&(i=n),c.push(t.option),l.title=`${r} - ${t.option}`,a="number"==typeof t.range[0]?Object.assign({},l,{range:t.range.reverse(),axisType:"linear"}):Object.assign({},l,{useCategories:{showAll:!0,categoryarray:t.range.reverse()}}),s.push(e.getAxis(a,o))}),(e=>{const t=["VA Scale ","<select>","{{#options}}","<option>{{.}}</option>","{{/options}}","</select>"].join(""),s=document.createElement("div");s.className="oesplotly-options",s.innerHTML=Mustache.render(t,{options:e}),s.style.position="absolute",s.style.top="1px",s.style.left="50%",s.style.transform="translateX( -50% )",s.style.zIndex=1;const n=document.querySelector(".oes-v2");n.style.position="relative",n.appendChild(s);let o=s.querySelector("select");o.options[i].selected=!0,o.addEventListener("change",a,!1)})(c)},addTrace:(e,s)=>{t.has(e)?t.get(e).push(s):t.set(e,[s])},selectedTrace:e=>t.get(e)[i],selectedAxis:()=>s[i]}}})(oePlotly),(function(e){"use strict";const t=!0,s=new Map,n=(e,t,n)=>{const i=(()=>{let e=0;return()=>{let t=e++;return e>=n.length&&(e=0),n[t]}})();s.get(t).set("data",new Map);const a={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:i()})};s.get(t).get("data").set(e.VA.offScale.name,a);const o={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:i(),dashed:!0})};s.get(t).get("data").set(e.CRT.name,o);const l={x:e.VA.units.x,y:e.VA.units.y,name:e.VA.units.name,yaxis:"y3",hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:i()})};s.get(t).get("data").set("VA",l)},i=e=>{const n=oePlotly.getLayout({darkTheme:t,legend:{yanchor:"top",y:1},xaxis:e.x,yaxes:e.y,subplot:2}),i=oePlotly.buildDiv("Patient Popup","415px","415px","1020px");document.getElementById("patient-popup-oeplolty").appendChild(i),s.set("div",i),s.set("layout",n),(()=>{let e=[];["rightEye","leftEye"].forEach(t=>{if(s.has(t)){let n=s.get(t).get("data");e=e.concat(Array.from(n.values()))}}),Plotly.react(s.get("div"),e,s.get("layout"),{displayModeBar:!1,responsive:!0})})(),oePlotly.addClickEvent(i,"?"),oePlotly.addHoverEvent(i,"?"),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(i,n)})};e.extend("plotPatientPopup",(a=null)=>{if(null===a)return e.log("[oePlotly] - no JSON data provided for Plot.ly Patient Popup ??"),!1;e.log("[oePlotly] - building Plot.ly Patient Popup");const o=[[0,.15],[.2,1]];a.rightEye&&(s.set("rightEye",new Map),n(a.rightEye,"rightEye",oePlotly.getColorSeries("rightEyeSeries",t))),a.leftEye&&(s.set("leftEye",new Map),n(a.leftEye,"leftEye",oePlotly.getColorSeries("leftEyeSeries",t)));const l=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,noMirrorLines:!0},t),r=oePlotly.getAxis({type:"y",domain:o[0],useCategories:{showAll:!0,categoryarray:a.yaxis.offScale.reverse()},spikes:!0},t),c=oePlotly.getAxis({type:"y",domain:o[1],title:"CRT",range:[200,650],spikes:!0},t),d=oePlotly.getAxis({type:"y",domain:o[1],title:"VA",rightSide:"y2",useCategories:{showAll:!0,categoryarray:a.yaxis.unitRanges.snellenMetre.range.reverse()},spikes:!0},t);i({x:l,y:[r,c,d]})})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme();e.extend("plotBarChart",(s=null)=>{if(null===s)return e.log("[oePlotly] - no JSON data provided for Plot.ly Bar Chart ??"),!1;e.log("[oePlotly] - building Plot.ly Bar Chart");const n=(e=>{const t={y:e.data.y,name:e.data.name,type:"bar"};return e.data.x&&(t.x=e.data.x),e.data.hovertemplate&&(t.hovertemplate=e.data.hovertemplate),[t]})(s),i=oePlotly.getAxis({type:"x",numTicks:20},t),a=oePlotly.getAxis({type:"y",numTicks:20},t);s.title.xaxis&&(i.title=s.title.xaxis),s.title.yaxis&&(a.title=s.title.yaxis),console.log(s),(e=>{const s=oePlotly.getLayout({darkTheme:t,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes});s.barmode="stack",Plotly.react(e.div,e.data,s,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(s.dom),title:s.title.plot,data:n,xaxis:i,yaxes:[a]})})})(bluejay),(function(e){"use strict";const t="Bar Percent Complete",s=oePlotly.isDarkTheme();e.extend("plotBarPercentComplete",(n=null)=>{if(null===n)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const i=(e=>{let t=e.percentComplete.map(e=>100-e);return[{x:e.xAxis,y:e.percentComplete,name:"",hovertemplate:"Complete<br>%{y}%",type:"bar"},{x:e.xAxis,y:t,name:"",hovertemplate:"Incomplete<br>%{y}%",type:"bar"}]})(n),a=oePlotly.getAxis({type:"x",numTicks:20},s),o=oePlotly.getAxis({type:"y",range:[0,100],numTicks:20},s);(e=>{const t=oePlotly.getLayout({darkTheme:s,colors:"posNeg",xaxis:e.xaxis,yaxes:e.yaxes});t.barmode="stack",Plotly.react(e.div,e.data,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(n.dom),data:i,xaxis:a,yaxes:[o]})})})(bluejay),(function(e){"use strict";const t="Combined Medical Retina",s=oePlotly.isDarkTheme(),n=new Map,i=oePlotly.fullDateRange(),a=oePlotly.selectableUnits(),o=(e,t,s)=>{const o=(()=>{let e=0;return()=>{let t=e++;return e>=s.length&&(e=0),s[t]}})();n.get(t).set("data",new Map);const l={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:o()})};n.get(t).get("data").set(e.VA.offScale.name,l),i.add(e.VA.offScale.x);const r={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:o(),dashed:!0})};n.get(t).get("data").set(e.CRT.name,r),i.add(e.CRT.x);const c=o();Object.values(e.VA.units).forEach((e,s)=>{a.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y3",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:c})}),s||i.add(e.x)}),n.get(t).get("data").set("VA",a.selectedTrace(t))},l=()=>{let e=[];["rightEye","leftEye","BEO"].forEach(t=>{if(n.has(t)){let s=n.get(t).get("data");s.set("VA",a.selectedTrace(t)),e=e.concat(Array.from(s.values()))}}),n.get("layout").yaxis3=Object.assign({},a.selectedAxis()),Plotly.react(n.get("div"),e,n.get("layout"),{displayModeBar:!1,responsive:!0})};e.extend("plotCombinedMedRet",(r=null)=>{if(null===r)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const c=[[0,.15],[.2,1]];a.init({darkTheme:s,plotlyUpdate:l,axisDefaults:{type:"y",rightSide:"y2",domain:c[1],title:"VA",spikes:!0},unitRanges:Object.values(r.yaxis.unitRanges)}),r.rightEye&&(n.set("rightEye",new Map),o(r.rightEye,"rightEye",oePlotly.getColorSeries("rightEyeSeries",s))),r.leftEye&&(n.set("leftEye",new Map),o(r.leftEye,"leftEye",oePlotly.getColorSeries("leftEyeSeries",s))),r.BEO&&(n.set("BEO",new Map),o(r.BEO,"BEO",oePlotly.getColorSeries("BEOSeries",s)));(e=>{const a=oePlotly.getLayout({darkTheme:s,legend:{yanchor:"top",y:1},plotTitle:"Right, Left and BEO",xaxis:e.x,yaxes:e.y,subplot:2,rangeSlider:i.firstLast(),dateRangeButtons:!0}),o=oePlotly.buildDiv(""+t,"80vh","650px");document.querySelector(".oes-left-side").appendChild(o),n.set("div",o),n.set("layout",a),l(),oePlotly.addClickEvent(o,"?"),oePlotly.addHoverEvent(o,"?"),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(o,a)})})({x:oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,range:i.firstLast(),spikes:!0,noMirrorLines:!0},s),y:[oePlotly.getAxis({type:"y",domain:c[0],useCategories:{showAll:!0,categoryarray:r.yaxis.offScale.reverse()},spikes:!0},s),oePlotly.getAxis({type:"y",domain:c[1],title:"CRT",range:[200,650],spikes:!0},s),a.selectedAxis()]})})})(bluejay),(function(e){"use strict";const t="Combined Medical Retina",s=oePlotly.isDarkTheme(),n=new Map,i=(e,t,s)=>{const i=(()=>{let e=0;return()=>{let t=e++;return e>=s.length&&(e=0),s[t]}})();n.get(t).set("data",new Map);const a={x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",mode:"lines+markers",yaxis:"y2",line:oePlotly.dataLine({color:i()}),error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}};n.get(t).get("data").set("VA",a);const o={x:e.CRT.x,y:e.CRT.y,name:"CRT",hovertemplate:"Mean ± SD<br>CRT: %{y}<br>(N: %{x})",type:"scatter",line:oePlotly.dataLine({color:i(),dashed:!0}),error_y:{type:"data",array:e.CRT.error_y,visible:!0,thickness:.5}};n.get(t).get("data").set(e.CRT.name,o)};e.extend("plotCombinedOutcomesWithErrors",(a=null)=>{if(null===a)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);a.rightEye&&(n.set("rightEye",new Map),i(a.rightEye,"rightEye",oePlotly.getColorSeries("rightEyeSeries",s))),a.leftEye&&(n.set("leftEye",new Map),i(a.leftEye,"leftEye",oePlotly.getColorSeries("leftEyeSeries",s)));const o=oePlotly.getAxis({type:"x",numTicks:10,spikes:!0,noMirrorLines:!0},s),l=oePlotly.getAxis({type:"y",title:"CRT",range:a.yaxis.CRT,spikes:!0},s),r=oePlotly.getAxis({type:"y",title:"VA",range:a.yaxis.VA,rightSide:"y1",spikes:!0},s);(e=>{const t=oePlotly.getLayout({darkTheme:s,legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});let i=[];["rightEye","leftEye"].forEach(e=>{if(n.has(e)){let t=n.get(e).get("data");i=i.concat(Array.from(t.values()))}}),Plotly.react(e.div,i,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(a.dom),xaxis:o,yaxes:[l,r]})})})(bluejay),(function(e){"use strict";const t="Outcomes with Error bars",s=oePlotly.isDarkTheme();e.extend("plotOutcomesWithErrors",(n=null)=>{if(null===n)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const i=(e=>[{x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y1",error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}},{x:e.IOP.x,y:e.IOP.y,name:"IOP",hovertemplate:"Mean ± SD<br>IOP: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y2",error_y:{type:"data",array:e.IOP.error_y,visible:!0,thickness:.5}}])(n),a=oePlotly.getAxis({type:"x",title:"Weeks",numTicks:20,range:[-20,220]},s),o=oePlotly.getAxis({type:"y",title:"VA (change) from baseline (LogMAR)",range:[70,110],numTicks:20},s),l=oePlotly.getAxis({type:"y",title:"IOP (mm Hg))",rightSide:"y1",numTicks:20},s);(e=>{const t=oePlotly.getLayout({darkTheme:s,colors:"varied",legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});Plotly.react(e.div,e.data,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(n.dom),data:i,xaxis:a,yaxes:[o,l]})})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme(),s=new Map,n=oePlotly.fullDateRange(),i=oePlotly.selectableUnits(),a=oePlotly.highlighPoint(s,t),o=(e,t)=>{s.get(t).set("data",new Map);const a={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers"};s.get(t).get("data").set(e.VA.offScale.name,a),n.add(e.VA.offScale.x);const o={x:e.VFI.x,y:e.VFI.y,name:e.VFI.name,yaxis:"y5",hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dashedLine()};s.get(t).get("data").set(e.VFI.name,o),n.add(e.VFI.x);const l={x:e.IOP.x,y:e.IOP.y,name:e.IOP.name,yaxis:"y3",hovertemplate:"IOP: %{y}<br>%{x}",type:"scatter",mode:"lines+markers"};s.get(t).get("data").set(e.IOP.name,l),n.add(e.IOP.x),Object.values(e.VA.units).forEach((e,s)=>{i.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y2",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers"}),s||n.add(e.x)}),s.get(t).get("data").set("VA",i.selectedTrace(t)),Object.values(e.events).forEach(e=>{let i=e.customdata?"%{y}<br>%{customdata}<br>%{x}":"%{y}<br>%{x}",a=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:i,type:"scatter",showlegend:!1},oePlotly.eventStyle(e.event));s.get(t).get("data").set(e.name,a),n.add(e.x)})},l=e=>{let t=s.get(e);t.get("data").set("VA",i.selectedTrace(e)),t.get("layout").yaxis2=Object.assign({},i.selectedAxis());const n=Array.from(t.get("data").values());Plotly.react(t.get("div"),n,t.get("layout"),{displayModeBar:!1,responsive:!0})},r=e=>{const i=e.eyeSide,a=oePlotly.getLayout({darkTheme:t,legend:{traceorder:"reversed",yanchor:"bottom",y:.82},colors:e.colors,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes,subplot:4,rangeSlider:n.firstLast(),dateRangeButtons:!0,vLineLabel:{x:Object.values(e.procedures),h:.82},hLineLabel:{y:Object.values(e.targetIOP),axis:"y3"}}),o=oePlotly.buildDiv("Glaucoma-"+i,"80vh","850px");document.querySelector(e.parentDOM).appendChild(o),s.get(i).set("div",o),s.get(i).set("layout",a),l(i),oePlotly.addClickEvent(o,i),oePlotly.addHoverEvent(o,i),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(o,a)})};e.extend("plotSummaryGlaucoma",(c=null)=>{if(null===c)return e.log("[oePlotly] - no JSON data provided for Plot.ly Glaucoma ??"),!1;e.log("[oePlotly] - building Plot.ly Glaucoma");const d=[[0,.08],[.1,.45],[.47,.82],[.88,1]];i.init({darkTheme:t,plotlyUpdate:l,axisDefaults:{type:"y",domain:d[1],title:"VA",spikes:!0},unitRanges:Object.values(c.yaxis.unitRanges)}),c.rightEye&&(s.set("rightEye",new Map),o(c.rightEye,"rightEye")),c.leftEye&&(s.set("leftEye",new Map),o(c.leftEye,"leftEye"));const u=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,range:n.firstLast(),noMirrorLines:!0},t),p=oePlotly.getAxis({type:"y",domain:d[0],useCategories:{showAll:!0,categoryarray:c.yaxis.offScale.reverse()},spikes:!0},t),h=oePlotly.getAxis({type:"y",domain:d[2],title:"IOP",range:[0,75],spikes:!0},t),m=oePlotly.getAxis({type:"y",domain:d[3],useCategories:{showAll:!0,categoryarray:c.eventTypes.reverse()},spikes:!0},t),g=oePlotly.getAxis({type:"y",domain:d[1],title:"VFI",range:[-30,5],rightSide:"y2",spikes:!0},t),y=i.selectedAxis();return s.has("rightEye")&&r({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:u,yaxes:[p,y,h,m,g],procedures:c.rightEye.procedures,targetIOP:c.rightEye.targetIOP,parentDOM:c.rightEye.dom}),s.has("leftEye")&&r({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:u,yaxes:[p,y,h,m,g],procedures:c.leftEye.procedures,targetIOP:c.leftEye.targetIOP,parentDOM:c.leftEye.dom}),e.log("[oePlotly] - method: highlightPoint()"),{highlightPoint:a}})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme(),s=new Map,n=oePlotly.fullDateRange(),i=oePlotly.selectableUnits(),a=(e,t)=>{s.get(t).set("data",new Map);const a={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers"};s.get(t).get("data").set(e.VA.offScale.name,a),n.add(e.VA.offScale.x);const o={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dashedLine()};s.get(t).get("data").set(e.CRT.name,o),n.add(e.CRT.x),Object.values(e.VA.units).forEach((e,s)=>{i.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y3",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers"}),s||n.add(e.x)}),s.get(t).get("data").set("VA",i.selectedTrace(t)),Object.values(e.events).forEach(e=>{let i=e.customdata?"%{y}<br>%{customdata}<br>%{x}":"%{y}<br>%{x}",a=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:i,type:"scatter",showlegend:!1},oePlotly.eventStyle(e.event));s.get(t).get("data").set(e.name,a),n.add(e.x)})},o=e=>{let t=s.get(e);t.get("data").set("VA",i.selectedTrace(e)),t.get("layout").yaxis3=Object.assign({},i.selectedAxis());const n=Array.from(t.get("data").values());Plotly.react(t.get("div"),n,t.get("layout"),{displayModeBar:!1,responsive:!0})},l=e=>{const i=e.eyeSide,a=oePlotly.getLayout({darkTheme:t,legend:{yanchor:"bottom",y:.82},colors:e.colors,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes,subplot:3,rangeSlider:n.firstLast(),dateRangeButtons:!0}),l=oePlotly.buildDiv("Medical Retina-"+i,"80vh","650px");document.querySelector(e.parentDOM).appendChild(l),s.get(i).set("div",l),s.get(i).set("layout",a),o(i),oePlotly.addClickEvent(l,e.eye),oePlotly.addHoverEvent(l,i),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(l,a)})};e.extend("plotSummaryMedicalRetina",(r=null)=>{if(null===r)return e.log("[oePlotly] - no JSON data provided for Plot.ly Medical Retina ??"),!1;e.log("[oePlotly] - building Plot.ly Medical Retina");const c=[[0,.15],[.2,.82],[.88,1]];i.init({darkTheme:t,plotlyUpdate:o,axisDefaults:{type:"y",rightSide:"y2",domain:c[1],title:"VA",spikes:!0},unitRanges:Object.values(r.yaxis.unitRanges)}),r.rightEye&&(s.set("rightEye",new Map),a(r.rightEye,"rightEye")),r.leftEye&&(s.set("leftEye",new Map),a(r.leftEye,"leftEye"));const d=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,range:n.firstLast(),spikes:!0,noMirrorLines:!0},t),u=oePlotly.getAxis({type:"y",domain:c[0],useCategories:{showAll:!0,categoryarray:r.yaxis.offScale.reverse()},spikes:!0},t),p=oePlotly.getAxis({type:"y",domain:c[1],title:"CRT",range:[200,650],spikes:!0},t),h=oePlotly.getAxis({type:"y",domain:c[2],useCategories:{showAll:!0,categoryarray:r.eventTypes.reverse()},spikes:!0},t),m=i.selectedAxis();s.has("rightEye")&&l({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:d,yaxes:[u,p,m,h],parentDOM:".oes-left-side"}),s.has("leftEye")&&l({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:d,yaxes:[u,p,m,h],parentDOM:".oes-right-side"})})})(bluejay),(function(e){"use strict";e.addModule("attachmentThumbnail");const t="oe-attachment-thumbnail";let s,n=!1;const i={};if(e.nodeArray(document.querySelectorAll("."+t)).length<1)return;const a=()=>{i.close.removeEventListener("mousedown",a),i.save&&(i.save.removeEventListener("mousedown",a),i.cancel.removeEventListener("mousedown",a)),e.remove(s),n=!1},o=t=>{n||(t=>{n=!0,s=document.createElement("div"),s.className="oe-popup-wrap";let o='<div class="oe-popup-attachment">';o+='<div class="title">'+t.title+"</div>",o+='<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>',o+='<div class="file-attachment-content"></div>',o+='<div class="file-size-controls"></div>',o+="</div>",s.innerHTML=o;const l=s.querySelector(".file-attachment-content"),r=s.querySelector(".file-size-controls"),c=new DocumentFragment,d=(e,t,s=!1)=>{let n=document.createElement("button");return n.className=t,s&&(n.id=s),n.textContent=e,c.appendChild(n),n};if("pdf"!==t.type){let e="url('"+t.file+"')";l.style.backgroundImage=e,l.innerHTML='<img src="'+t.file+'" style="display:none"/>';const n=s.querySelector("img"),i=d("Fit to screen","pro-theme selected","oe-att-fit"),a=d("Actual size","pro-theme","oe-att-actual"),o=(e,t,s,i)=>{l.style.backgroundImage=e,n.style.display=t,s.classList.add("selected"),i.classList.remove("selected")};a.addEventListener("mousedown",e=>{e.stopPropagation(),o("none","block",a,i)}),i.addEventListener("mousedown",t=>{t.stopPropagation(),o(e,"none",i,a)})}else l.innerHTML='<embed src="'+t.file+'" width="100%" height="100%"></embed>',d("PDF","pro-theme selected");if(t.annotate){l.classList.add("annotation");let n=document.createElement("div");n.className="attachment-annotation",e.find(".oe-popup-attachment",s).appendChild(n),e.xhr(t.idgPHP).then(e=>{n.innerHTML=e.html,"L"==t.eyelat&&(n.querySelector("#annotation-right").style.visibility="hidden"),"R"==t.eyelat&&(n.querySelector("#annotation-left").style.visibility="hidden")}).catch(e=>console.log("XHR failed: ",e)),i.save=d("Save annotations","green hint"),i.cancel=d("Cancel","red hint"),i.save.addEventListener("mousedown",a,{once:!0}),i.cancel.addEventListener("mousedown",a,{once:!0})}if(t.stack){let n=t.title.split(" - "),i="<option>"+t.title+"</option>";for(let e=t.stack;e;e--)i+="<option>"+n[0]+" - ("+e+" Jan 1975 09:30)</option>";let a=document.createElement("div");a.className="attachment-stack",a.innerHTML='Choose report: <select class="pro-theme">'+i+"</select>",e.find(".oe-popup-attachment",s).appendChild(a)}i.close=s.querySelector(".close-icon-btn"),i.close.addEventListener("mousedown",a,{once:!0}),r.appendChild(c),document.body.appendChild(s)})(JSON.parse(t.target.dataset.attachment))};e.userDown("."+t,o),document.querySelectorAll(".js-annotate-attachment")&&e.userDown(".js-annotate-attachment",o)})(bluejay),(function(e){"use strict";e.addModule("collapseExpand");const t=new e.Collection,s=()=>({show:function(){e.show(this.content,"block"),this.btn.classList.replace("expand","collapse"),this.open=!0}}),n=()=>({hide:function(){e.hide(this.content),this.btn.classList.replace("collapse","expand"),this.open=!1}}),i=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),n()),a=(s,n)=>{let a,o=s.target,l=t.getKey(o);l?a=t.get(l):(a=i({btn:o,content:e.find(".collapse-"+n+"-content",o.parentNode),open:o.classList.contains("collapse")}),t.add(a,o)),a.change()};e.userDown(".collapse-data-header-icon",e=>a(e,"data")),e.userDown(".collapse-group > .header-icon",e=>a(e,"group")),e.userDown(".collapse-hotlist > .header-icon",e=>a(e,"hotlist"))})(bluejay),(function(e){"use strict";e.addModule("comments");e.userDown(".js-add-comments",t=>{const s=t.target,n=JSON.parse(s.dataset.idgdemo);if(e.hide(s),n.bilateral){const t=document.querySelector("#"+n.id+"-right"),i=document.querySelector("#"+n.id+"-left");e.show(t,"block"),e.show(i,"block"),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(s),e.hide(t),e.hide(i)},{once:!0}),i.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(s),e.hide(t),e.hide(i)},{once:!0})}else{const t=document.querySelector("#"+n.id);e.show(t,"block"),t.querySelector("textarea").focus(),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(s),e.hide(t)},{once:!0})}})})(bluejay),(function(e){"use strict";e.addModule("commentHotlist");const t=new e.Collection,s=()=>({reset(){this.editMode=!1,this.icon("comment"),e.hide(this.elem.textarea),e.hide(this.elem.userComment)}}),n=()=>({show(){this.editMode=!1,this.icon("edit");let t=e.wrapQtags(this.comment);this.elem.userComment.innerHTML=t.DOMString,this.comment=t.text,e.hide(this.elem.textarea),e.show(this.elem.userComment,"block")}}),i=()=>({edit(){this.editMode=!0,this.icon("save"),e.show(this.elem.textarea,"block"),e.hide(this.elem.userComment),this.elem.textarea.value=this.comment,e.resizeTextArea(this.elem.textarea),setTimeout(()=>this.elem.textarea.focus(),20);const t=e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),this.update(),this.elem.textarea.removeEventListener("keydown",t,!1))};this.elem.textarea.addEventListener("keydown",t,!1)}}),a=()=>({icon(t){switch(this.elem.icon.classList.remove("comments","comments-added","save","active"),t){case"comment":this.elem.icon.classList.add("comments");break;case"edit":this.elem.icon.classList.add("comments-added");break;case"save":this.elem.icon.classList.add("save","active");break;default:e.log("commentHotlist - unknown icon: "+t)}}}),o=()=>({userClick(){this.editMode?this.update():this.edit()}}),l=()=>({update(){let e=this.elem.textarea.value.trim();e.length?(this.comment=e,this.show()):(this.comment="",this.reset())}}),r=(e,t,r="")=>{const c=['<textarea placeholder="Comments" rows="1" class="cols-full js-allow-qtags" style="display:none"></textarea>','<div class="user-comment" style="display:none">{{comment}}</div>'].join("");let d=document.createElement("div");d.className="patient-comments",d.innerHTML=Mustache.render(c,{comment:r}),t.appendChild(d);let u=d.querySelector("textarea"),p=d.querySelector(".user-comment");return Object.assign({editMode:!1,comment:r,elem:{icon:e,textarea:u,userComment:p}},s(),n(),i(),a(),o(),l())};e.userDown(".oe-hotlist-panel .js-comment-icon",s=>{const n=s.target;let i=t.getKey(n);if(i){t.get(i).userClick()}else{let s=e.getParent(n,"tr").querySelector(".js-patient-comment"),i=r(n,s);i.edit(),t.add(i,n)}}),document.addEventListener("DOMContentLoaded",()=>{e.nodeArray(document.querySelectorAll(".oe-hotlist-panel .activity-list tr")).forEach(e=>{if(e.hasAttribute("data-comment")){let s=JSON.parse(e.dataset.comment);if(s.comment){let n=e.querySelector(".oe-i.comments"),i=e.querySelector(".js-patient-comment"),a=r(n,i,s.comment);a.show(),t.add(a,n)}}})},{once:!0})})(bluejay),(function(e){"use strict";e.addModule("copyToClipboard");const t=".js-clipboard-copy";if(null===document.querySelector(t))return;e.nodeArray(document.querySelectorAll(t)).forEach(e=>{e.style.cursor="pointer"});const s=t=>{let s=t.getBoundingClientRect(),n=s.right-s.width/2,i=s.top-5;const a=document.createElement("div");a.className="oe-tooltip fade-out",a.innerHTML="Copied",a.style.width="80px",a.style.top=i-30+"px",a.style.left=n-40+"px",document.body.appendChild(a),setTimeout(()=>e.remove(a),2500)};e.userDown(t,t=>(t=>{if(navigator.clipboard)navigator.clipboard.writeText(t.textContent).then(()=>{e.log("[ASYNC] copied text to clipboard"),s(t)}).catch(t=>{e.log("failed to copy text to clipboard")});else{const n=document.createElement("input");n.value=t.textContent,n.style.position="absolute",n.style.top="-200px",document.body.appendChild(n),n.select(),document.execCommand("copy"),s(t),e.remove(n)}})(t.target))})(bluejay),(function(e){"use strict";e.addModule("ed3");let t=!1;e.userDown(".js-idg-ed3-app-btn",s=>{let n=s.target;t=t||(()=>{let e=document.createElement("div");return e.className="oe-eyedraw-app spinner-loader",document.body.appendChild(e),e})();let i=n.getBoundingClientRect().bottom-532;t.style.top=i<60?"60px":i+"px",e.show(t,"block");let a=JSON.parse(n.dataset.idgDemo);var o=Object.keys(a).map(e=>e+"="+a[e]).join("&");e.xhr("/idg-php/v3/_load/ed3/ed3-app.php?"+o).then(e=>{t.innerHTML=e.html,t.querySelector(".close-icon-btn").addEventListener("mousedown",()=>{t.style.display="none"},{once:!0})}).catch(e=>console.log("ed3app php failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("elementSelector");const t=()=>({loadPHP:function(t){e.xhr(t).then(e=>{!1!==this.open&&(this.nav=document.createElement("nav"),this.nav.className=this.wrapClass,this.nav.innerHTML=e.html,this.btn.classList.add("selected"),document.body.appendChild(this.nav))}).catch(e=>console.log("PHP failed to load",e))}}),s=()=>({close:function(){this.open=!1,this.btn.classList.remove("selected"),e.remove(this.nav)}}),n=()=>({change:function(e){if(null===this.btn&&(this.btn=e.target),this.open)this.close();else{this.open=!0;let e=JSON.parse(this.btn.dataset.demophp);!1!==e?this.loadPHP(e):this.elementSideNav()}}}),i=()=>({elementSideNav:function(){this.nav=document.createElement("nav"),this.nav.className=this.wrapClass;const t=e.nodeArray(document.querySelectorAll(".element .element-title")).map(e=>'<li class="element" id="side-element-contacts"><a href="#" class="selected">'+e.textContent+"</a></li>");this.nav.innerHTML=['<div class="element-structure">','<ul class="oe-element-list">',t.join(""),"</ul>","</div>"].join(""),document.body.appendChild(this.nav)}}),a=e=>Object.assign({btn:null,open:!1,wrapClass:e},n(),t(),i(),s());if(null!==document.querySelector("#js-manage-elements-btn")){const t=a("oe-element-selector");e.userDown("#js-manage-elements-btn",e=>t.change(e)),e.userDown(".oe-element-selector .close-icon-btn button",()=>t.close())}if(null!==document.querySelector("#js-element-structure-btn")){const t=a("sidebar element-overlay");e.userDown("#js-element-structure-btn",e=>t.change(e))}})(bluejay),(function(e){"use strict";e.addModule("elementTiles");const t=[],s=()=>({show:function(){this.h3.textContent=this.title,e.show(this.content,"block")}}),n=()=>({hide:function(){this.h3.innerHTML=this.title+" <small>["+this.count+"]</small>",e.hide(this.content)}}),i=e=>Object.assign({tiles:[],btn:e,collapsed:!1},{addTile:function(e){this.tiles.push(e)}},{change:function(){this.tiles.forEach(e=>{this.collapsed?(this.btn.classList.replace("increase-height","reduce-height"),e.show()):(this.btn.classList.replace("reduce-height","increase-height"),e.hide())}),this.collapsed=!this.collapsed}});e.userDown(".collapse-tile-group .oe-i",a=>{let o=e.getParent(a.target,".element-tile-group"),l=e.getDataAttr(o);if(l)t[parseFloat(l)].change();else{let l=i(a.target);e.nodeArray(o.querySelectorAll(".element.tile")).forEach(e=>{l.addTile((e=>{const t=e.querySelector(".element-title"),i=t.textContent,a=e.querySelector(".element-data"),o=a.querySelectorAll("tbody tr").length;return Object.assign({h3:t,title:i,content:a,count:o.toString()},s(),n())})(e))}),l.change(),e.setDataAttr(o,t.length),t.push(l)}})})(bluejay),(function(e){"use strict";e.addModule("eventAuditTrial");const t="#js-event-audit-trail-btn",s=document.querySelector(t);if(null===s)return;const n=document.querySelector("#js-event-audit-trail");null===n&&e.log("Audit Trail content not available in DOM?");let i=!1;const a=t=>{e.show(n,"block"),s.classList.add("active"),i=!0},o=t=>{e.hide(n),s.classList.remove("active"),i=!1};e.userDown(t,e=>i?o(e):a(e)),e.userEnter(t,a),e.userLeave(t,o)})(bluejay),(function(e){"use strict";e.addModule("eventsUserTrail");if(null===document.querySelector("#js-events-user-trail"))return;let t=null;e.userDown("#js-events-user-trail",()=>{t=document.createElement("div"),t.className="oe-popup-wrap";let s=document.createElement("div");s.className="oe-popup oe-events-user-trail",t.appendChild(s),document.body.appendChild(t);let n=setTimeout(()=>s.innerHTML='<i class="spinner"></i>',400);e.xhr("/idg-php/v3/_load/sidebar/events-user-trail-v2.php").then(e=>{clearTimeout(n),s.innerHTML=e.html}).catch(e=>console.log("ed3app php failed to load",e))}),e.userDown(".js-idg-toggle-event-audit-trail",e=>{let s=e.target,n=t.querySelector("#"+s.dataset.auditid);"block"===n.style.display?n.style.display="none":n.style.display="block"}),e.userDown(".oe-events-user-trail .close-icon-btn .oe-i",()=>{e.remove(t)})})(bluejay),(function(e){"use strict";if(e.addModule("examElementSearch"),null===document.querySelector("#js-search-in-event-popup"))return;e.userDown("#js-search-in-event",t=>{const s=t.target,n=document.querySelector("#js-search-in-event-popup"),i=document.querySelector(".main-event"),a=n.querySelector(".close-icon-btn");s.classList.add("selected"),e.show(n,"block"),i.classList.add("examination-search-active"),a.addEventListener("mousedown",t=>{t.stopPropagation(),i.classList.remove("examination-search-active"),e.hide(n),s.classList.remove("selected")},{once:!0})})})(bluejay),(function(e){"use strict";e.addModule("fastDatePicker");const t=Date.now(),s=new Date(t),n=Object.assign({pickDate:null,inputDate:null,get date(){return this.pickDate},set date(e){this.pickDate=e,this.views.notify()},get userDate(){return null!=this.inputDate&&this.inputDate},set userDate(e){this.inputDate=e},changeMonth(e){this.pickDate.setMonth(e),this.views.notify()},changeFullYear(e){this.pickDate.setFullYear(e),this.views.notify()}},e.ModelViews()),i=(()=>{let t;const i=(e,s)=>{if(e.getMonth()==n.date.getMonth()&&e.getFullYear()==n.date.getFullYear()){t.querySelector("#js-fast-date-"+e.getDate()).classList.add(s)}};return n.views.add(()=>{const e=n.date.getFullYear(),a=n.date.getMonth(),o=new Date(e,a,1).getDay(),l=new Date(e,a+1,0).getDate(),r=[],c=[],d=[];for(let t=(o||7)-1,s=new Date(e,a,0).getDate();t>0;t--,s--)r.push(s);for(let e=1;e<=l;e++)c.push(e);const u=42-(r.length+c.length);for(let e=1;e<=u;e++)d.push(e);r.reverse();const p=Mustache.render('{{#prev}}<div class="prev">{{.}}</div>{{/prev}}',{prev:r}),h=Mustache.render('{{#current}}<div id="js-fast-date-{{.}}">{{.}}</div>{{/current}}',{current:c}),m=Mustache.render('{{#next}}<div class="next">{{.}}</div>{{/next}}',{next:d});t.innerHTML=p+h+m,i(s,"today"),0!=n.userDate&&i(n.userDate,"selected")}),{reset:()=>{t=null},build:s=>{t=e.div("date-grid"),t.innerHTML=Mustache.render('{{#divs}}<div class="prev">{{.}}</div>{{/divs}}',{divs:new Array(42).fill("")}),s.appendChild(t)}}})(),a=(()=>{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let s,i;return n.views.add(()=>{const e=s.children[n.date.getMonth()];i&&i.classList.remove("selected"),e.classList.add("selected"),i=e}),{reset:()=>{s=null,i=null},build:n=>{s=e.div("month"),s.innerHTML=Mustache.render("{{#months}}<div>{{.}}</div>{{/months}}",{months:t}),n.appendChild(s)},getMonthNum:e=>t.indexOf(e),getMonthName:e=>t[e]}})(),o=(()=>{let t,s;const i=()=>{const e=n.date.getFullYear();return{c:Math.floor(e/100),d:parseFloat(e.toString().charAt(2)),y:parseFloat(e.toString().charAt(3))}};return n.views.add(()=>{const e=i();e.c=20==e.c?1:0,s.c.forEach(e=>e.classList.remove("selected")),s.d.forEach(e=>e.classList.remove("selected")),s.y.forEach(e=>e.classList.remove("selected")),s.c[e.c].classList.add("selected"),s.d[e.d].classList.add("selected"),s.y[e.y].classList.add("selected")}),{reset:()=>{t=null,s=null},build:n=>{const i=['<div class="century">{{#century}}<div>{{.}}</div>{{/century}}</div>','<ul class="decade">{{#ten}}<li>{{.}}</li>{{/ten}}</ul>','<ul class="single">{{#ten}}<li>{{.}}</li>{{/ten}}</ul>'].join(""),a=Array.from(Array(10).keys());t=e.div("year"),t.innerHTML=Mustache.render(i,{century:["19","20"],ten:a}),s={c:t.querySelector(".century").childNodes,d:t.querySelector(".decade").childNodes,y:t.querySelector(".single").childNodes},n.appendChild(t)},getYearUnits:i}})(),l=(()=>{let s,r,c=!1;const d=()=>{if(c)return c=!1,void s.focus();i.reset(),a.reset(),o.reset(),document.removeEventListener("blur",l.remove,{capture:!0}),window.removeEventListener("scroll",l.remove,{capture:!0,once:!0}),e.remove(r),r=null,s=null};return{show:c=>{if(c.isSameNode(s))return;s=c;const d=s.getBoundingClientRect();r=e.div("fast-date-picker"),r.style.left=d.right-430+"px",r.style.top=d.bottom+"px",d.left<430&&(r.style.left=d.left+"px"),d.bottom+240>e.getWinH()&&(r.style.top=d.top-240+"px"),o.build(r),a.build(r),i.build(r),document.body.appendChild(r),(()=>{let e,i=!1;if(s.value&&/^\d{1,2} [a-z]{3} \d{4}/i.test(s.value)&&(e=Date.parse(s.value),!isNaN(e))){const t=new Date(e),s=t.getFullYear();s>1900&&s<2099&&(i=t)}i?(n.userDate=i,n.date=new Date(e)):n.date=new Date(t)})(),document.addEventListener("blur",l.remove,{capture:!0}),window.addEventListener("scroll",l.remove,{capture:!0,once:!0})},remove:d,changeDate:(e,t)=>{c=!0;const s=parseFloat(e.textContent),i=o.getYearUnits();switch(t){case"month":n.changeMonth(a.getMonthNum(e.textContent));break;case"century":if(s==i.c)return;19==s?n.changeFullYear(1999):n.changeFullYear(2e3);break;case"decade":let t=10*(s-i.d);n.changeFullYear(n.date.getFullYear()+t);break;case"year":let o=s-i.y;n.changeFullYear(n.date.getFullYear()+o)}},selectDate:e=>{const t=parseFloat(e.textContent);let i=n.date.getMonth();e.classList.contains("prev")&&n.changeMonth(i-1),e.classList.contains("next")&&n.changeMonth(i+1),n.date.setDate(t),s.value=(e=>e.getDate()+" "+a.getMonthName(e.getMonth())+" "+e.getFullYear())(n.date),d()}}})();document.addEventListener("focus",e=>{e.target.matches("input.date")&&l.show(e.target)},{capture:!0}),e.userDown(".fast-date-picker .month > div",e=>l.changeDate(e.target,"month")),e.userDown(".fast-date-picker .century > div",e=>l.changeDate(e.target,"century")),e.userDown(".fast-date-picker .decade li",e=>l.changeDate(e.target,"decade")),e.userDown(".fast-date-picker .single li",e=>l.changeDate(e.target,"year")),e.userDown(".fast-date-picker .date-grid > div",e=>l.selectDate(e.target))})(bluejay),(function(e){"use strict";e.addModule("fastDateRange");if(null==document.querySelector(".fast-date-range"))return;const t=document.querySelector(".js-filter-date-to"),s=document.querySelector(".js-filter-date-from"),n=document.getElementsByName("show-all-date-range")[0],i=Date.now(),a=new Date(i),o=864e5,l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=e=>e.getDate()+" "+l[e.getMonth()]+" "+e.getFullYear(),c=(e,i)=>{t.value=r(e),s.value=r(i),n.checked=!1},d=e=>c(e,e),u=e=>{let t=a.getDay(),s=i+o*(1-t)+o*e;c(new Date(s),new Date(s+4*o))},p=e=>{let t=a.getFullYear(),s=a.getMonth()+e;s>11&&(s=0,t+=1),s<0&&(s=11,t-=1),c(new Date(t,s,1),new Date(t,s+1,0))};e.userDown(".fast-date-range .range",t=>{const s=t.target;if(!s.hasAttribute("data-range"))return;const n=s.getAttribute("data-range");switch(n){case"yesterday":d(new Date(i-o));break;case"today":d(a);break;case"tomorrow":d(new Date(i+o));break;case"last-week":u(-7);break;case"this-week":u(0);break;case"next-week":u(7);break;case"last-month":p(-1);break;case"this-month":p(0);break;case"next-month":p(1);break;default:e.log("[fastDateRange] unknown range request: "+n)}})})(bluejay),(function(e){"use strict";e.addModule("filterOptions");const t=[],s="active",n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(s),this.positionContent(),e.show(this.content,"block"),this.mouseOutHide(),this.closeIconBtn())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(s),e.hide(this.content))}}),a=()=>({positionContent:function(){this.defaultCSS=this.defaultCSS||this.content.className;let t,s,n,i=this.btn.getBoundingClientRect(),a=e.getHiddenElemSize(this.content);i.top<400?(t="top",s=i.top):(t="bottom",s=i.bottom-a.h),i.left<500?(t+="-left",n=i.left):(t+="-right",n=i.right-a.w),this.content.className=this.defaultCSS+" "+t,this.content.style.top=s+"px",this.content.style.left=n+"px"}}),o=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},n(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}},{closeIconBtn:function(){this.wrapper.querySelector(".close-icon-btn").addEventListener("mousedown",e=>{e.stopPropagation(),this.hide()},{once:!0})}},a());e.userDown(".oe-filter-options .oe-filter-btn",s=>(s=>{let n=s.target,i=e.getDataAttr(n);if(i)t[parseFloat(i)].change();else{let s=e.getParent(n,".oe-filter-options"),i=o({btn:n,wrapper:s,content:s.querySelector(".filter-options-popup")});i.show(),e.setDataAttr(n,t.length),t.push(i)}})(s))})(bluejay),(function(e){"use strict";const t=e.nodeArray(document.querySelectorAll(".hidden"));t.length&&t.forEach(t=>{e.hide(t),t.classList.remove("hidden")});const s=e.nodeArray(document.querySelectorAll(".tr-collapse"));s.length&&s.forEach(e=>{e.style.visibility="collapse",e.classList.remove("tr-collapse")})})(bluejay),(function(e){"use strict";e.addModule("lightning");if(null===document.querySelector(".oe-lightning-viewer"))return;const t=()=>({updateView:function(e){this.updateStack(e),this.updateMeta(document.querySelector(this.iconPrefix+e).dataset.meta)}}),s=()=>({updateStack:function(t){e.hide(document.querySelector(this.stackPrefix+this.currentStack)),e.show(document.querySelector(this.stackPrefix+t),"block"),this.currentStack=t,this.updateCounter(),this.timelineIcon()}}),n=()=>({updateCounter:function(){document.querySelector(".lightning-ui .stack-position").textContent=this.currentStack+1+"/"+this.totalStackNum}}),i=()=>({timelineIcon:function(){document.querySelector(".icon-event").classList.remove("js-hover"),document.querySelector(this.iconPrefix+this.currentStack).classList.add("js-hover")}}),a=()=>({xscroll:function(e,t){var s=Math.floor(e/(this.xscrollWidth/this.totalStackNum));0==this.locked&&this.updateView(s)}}),o=()=>({swipeLock:function(){this.locked=!this.locked;let e=document.querySelector(".lightning-ui .user-help");this.locked?e.textContent="Swipe is LOCKED | Click to unlock":e.textContent="Swipe to scan or use key RIGHT / LEFT | Click to LOCK swipe"}}),l=Object.assign({currentStack:0,iconPrefix:"#lqv_",stackPrefix:"#lsg_",totalStackNum:document.querySelectorAll(".stack-group").length,xscrollWidth:document.querySelector(".lightning-view").clientWidth,locked:!0},t(),{updateMeta:function(e){let t=document.querySelector(".lightning-meta"),s=e.split(",");[".type",".date",".who"].forEach((e,n)=>{t.querySelector(e).textContent=s[n]})}},s(),n(),i(),a(),o(),{stepThrough:function(e){var t=this.currentStack+e;t>=0&&t<this.totalStackNum&&this.updateView(t)}});l.updateCounter(),l.swipeLock(),e.userDown("#lightning-left-btn",()=>l.stepThrough(-1)),e.userDown("#lightning-right-btn",()=>l.stepThrough(1)),e.userDown(".lightning-view",()=>l.swipeLock()),e.userDown(".icon-event",()=>l.swipeLock()),e.userEnter(".icon-event",e=>{let t=e.target;l.updateStack(t.dataset.id),l.updateMeta(t.dataset.meta)});const r=document.querySelector(".lightning-view");r.addEventListener("mousemove",e=>{}),e.listenForResize(()=>l.xscrollWidth=r.clientWidth),document.addEventListener("keydown",e=>{37==(e.keyCode||e.which)&&l.stepThrough(-1),39==(e.keyCode||e.which)&&l.stepThrough(1)})})(bluejay),(function(e){"use strict";e.addModule("lightningIconGroups");const t=e.nodeArray(document.querySelectorAll(".icon-group"));if(t.length<1)return;t.forEach(t=>{let s=t.childElementCount,n=document.createElement("div");n.textContent="("+s+")",e.hide(n),t.parentNode.appendChild(n)});e.userDown(".js-timeline-date",t=>{let s=t.target,n=document.querySelector("#js-icon-"+s.dataset.icons);s.classList.contains("collapse")?(e.hide(n),e.show(n.nextElementSibling,"block"),s.classList.replace("collapse","expand")):(e.show(n,"block"),e.hide(n.nextElementSibling),s.classList.replace("expand","collapse"))})})(bluejay),(function(e){"use strict";if(e.addModule("messagePreview"),null===document.querySelector(".home-messages"))return;e.nodeArray(document.querySelectorAll(".js-message .message")).forEach(e=>{e.scrollWidth<=e.clientWidth&&(e.parentNode.nextSibling.querySelector(".js-expand-message").style.display="none")});e.userDown(".js-expand-message",t=>{let s=t.target,n=e.getParent(s,"tr").querySelector(".message");s.classList.contains("expand")?(n.classList.add("expand"),s.classList.replace("expand","collapse")):(n.classList.remove("expand"),s.classList.replace("collapse","expand"))})})(bluejay),(function(e){"use strict";e.addModule("multiPageScroll");let t=e.nodeArray(document.querySelectorAll(".lightning-multipage-scroll"));if(0===t.length)return;const s=()=>({animateScrollTo:function(e){let t=1,s=0,n=this.stack.scrollTop,i=this.pageH*e-n;clearInterval(this.animateID),this.animateID=setInterval(()=>{var e;s=Math.min(1,t/80),this.stack.scrollTop=Math.ceil(((e=s)<.5?2*e*e:(4-2*e)*e-1)*i)+n,t+=1,1==s&&clearInterval(this.animateID)},2)}}),n=()=>({pageBtn:function(e){e.matches(".page-num-btn")&&this.animateScrollTo(parseFloat(e.dataset.page))}});t.forEach(e=>{(e=>{e.numOfImgs=e.stack.querySelectorAll("img").length,e.pageH=parseFloat(e.stack.querySelector("img").height+10),e.animateID=null;let t=new DocumentFragment;for(let s=0;s<e.numOfImgs;s++){let n=document.createElement("div");n.className="page-num-btn",n.setAttribute("data-page",s),n.textContent=s+1+"/"+e.numOfImgs,t.appendChild(n)}e.nav.appendChild(t),e.nav.addEventListener("mouseenter",t=>e.pageBtn(t.target),{capture:!0}),e.nav.addEventListener("mousedown",t=>e.pageBtn(t.target),{capture:!0}),Object.assign(e,n(),s())})({nav:e.querySelector(".multipage-nav"),stack:e.querySelector(".multipage-stack")})})})(bluejay),(function(e){"use strict";e.addModule("navHotlist");const t="active",s="open",n="#js-nav-hotlist-btn",i=document.querySelector(n);if(null===i)return;const a=()=>({over:function(){this.isFixed||(this.btn.classList.add(t),this.show())}}),o=()=>({show:function(){this.open||(this.open=!0,e.show(this.content,"block"))}}),l=()=>({hide:function(){!this.open||this.isLocked||this.isFixed||(this.open=!1,this.btn.classList.remove(t,s),e.hide(this.content))}}),r=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(s)}}),c=()=>({fixedOpen:function(e){this.isFixed=e,e?(this.isLocked=!1,this.btn.classList.add(s),this.btn.classList.remove(t),this.show()):this.hide()}}),d=Object.assign({btn:i,content:document.getElementById("js-hotlist-panel"),open:!1,isLocked:!1,isFixed:!1},{changeState:function(){this.isFixed||(this.open?this.isLocked?(this.isLocked=!1,this.hide()):this.makeLocked():(this.makeLocked(),this.over()))}},a(),r(),o(),l(),c()),u=()=>{"true"===i.dataset.fixable&&d.fixedOpen(window.innerWidth>e.settings("cssHotlistFixed"))};e.userDown(n,()=>d.changeState()),e.userEnter(n,()=>d.over()),e.userLeave("#js-hotlist-panel-wrapper",()=>d.hide()),e.listenForResize(u),u()})(bluejay),(function(e){"use strict";e.addModule("navLogo");const t="active",s="open",n="#js-openeyes-btn";null!==document.querySelector(".oe-login")&&document.querySelector(n).classList.add(t);const i=()=>({over:function(){this.btn.classList.add(t)}}),a=()=>({out:function(){this.btn.classList.remove(t)}}),o=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(s),e.show(this.content,"block"))}}),l=()=>({hide:function(){this.open&&(this.open=!1,this.btn.classList.remove(s,t),e.hide(this.content))}}),r=Object.assign({btn:document.querySelector(n),content:document.querySelector("#js-openeyes-info"),open:!1},i(),a(),{change:function(){this.open?this.hide():this.show()}},o(),l());e.userDown(n,()=>r.change()),e.userEnter(n,()=>r.over()),e.userLeave(n,()=>r.out()),e.userLeave(".openeyes-brand",()=>r.hide())})(bluejay),(function(e){"use strict";if(e.addModule("notificationBanner"),null===document.querySelector("#oe-admin-notifcation"))return;const t="#oe-admin-notifcation .oe-i",s=document.querySelector("#notification-short"),n=document.querySelector("#notification-full");if(null!==document.querySelector(".oe-login"))return e.hide(s),e.show(n,"block"),void(document.querySelector(t).style.display="none");let i=s,a=n,o=!0;const l=(e,t)=>{e.style.display="block",t.style.display="none"};e.userEnter(t,()=>l(a,i)),e.userLeave(t,()=>l(i,a)),e.userDown(t,()=>{i=o?n:s,a=o?s:n,o=!o,l(i,a)})})(bluejay),(function(e){"use strict";e.addModule("oesLayoutOptions");const t=document.querySelector(".oes-hd-data-layout");if(null==t)return;const s=Object.assign({selector:{rootElem:".oes-hd-data-layout",btn:".oes-hd-data-layout .layout-select-btn",optionBtn:".oes-hd-data-layout .option-btn",options:".layout-options"},current:{eye:JSON.parse(t.dataset.oes).eyeIcons,layout:JSON.parse(t.dataset.oes).layout},get eye(){return this.current.eye},set eye(e){if(e===this.current.eye)return!1;this.current.eye=e,this.views.notify()},get layout(){return this.current.layout},set layout(e){if(this.current.layout===e)return!1;this.current.layout=e,this.views.notify()}},e.ModelViews()),n=((()=>{const n=["{{#sides}}",'<div class="option-btn" data-oes=\'{"opt":"eye.{{eyelat.r}}-{{eyelat.l}}"}\'><span class="oe-eye-lat-icons"><i class="oe-i laterality {{eyelat.r}} small"></i><i class="oe-i laterality {{eyelat.l}} small"></i></span></div>',"{{/sides}}","{{#layouts}}",'<div class="option-btn" data-oes=\'{"opt":"layout.{{.}}"}\'><i class="oes-layout-icon i-{{.}}"></i></div>',"{{/layouts}}"].join(""),i=document.createElement("div");i.className=s.selector.options.replace(".",""),i.innerHTML=Mustache.render(n,{sides:[{eyelat:{r:"R",l:"NA"}},{eyelat:{r:"R",l:"L"}},{eyelat:{r:"NA",l:"L"}}],layouts:["1-0","2-1","1-1","1-2","0-1"]}),e.hide(i),t.appendChild(i)})(),(()=>{const t="oes-layout-icon",n=document.querySelector(s.selector.btn),i=n.querySelector("."+t),a=n.querySelector(".oe-eye-lat-icons");s.views.add(()=>{i.className=t+"  i-"+s.layout;let n=s.eye.split("-");a.innerHTML=Mustache.render('{{#eyes}}<i class="oe-i laterality {{.}} small pad"></i>{{/eyes}}',{eyes:n}),e.customEvent("oesLayoutEyeSide",n)})})(),(()=>{let t=null;const n=document.querySelector(".oes-v2 .oes-right-side"),i=document.querySelector(".oes-v2 .oes-left-side"),a=()=>{if(s.layout!==t){switch(t=s.layout,t){case"1-0":i.style.width="",e.show(i),e.hide(n);break;case"0-1":n.style.width="",e.hide(i),e.show(n);break;case"2-1":i.style.width="66%",n.style.width="33%",e.show(i),e.show(n);break;case"1-2":i.style.width="33%",n.style.width="66%",e.show(i),e.show(n);break;case"1-1":i.style.width="50%",n.style.width="50%",e.show(i),e.show(n);break;default:throw new TypeError("[bluejay] [oesLayoutOptions] - unknown layout: "+t)}e.customEvent("oesLayoutChange",t)}};a(),s.views.add(a)})(),(()=>{let n=!1;const i=t.querySelector(s.selector.btn),a=t.querySelector(s.selector.options),o=t=>{n=!0,e.show(a),i.classList.add("active")},l=t=>{n=!1,e.hide(a),i.classList.remove("active")};return{show:o,hide:l,change:e=>{n?l():o()}}})());e.userDown(s.selector.btn,n.change),e.userEnter(s.selector.btn,n.show),e.userLeave(s.selector.rootElem,n.hide),e.userDown(s.selector.optionBtn,e=>(e=>{let t=JSON.parse(e).opt.split(".");"eye"==t[0]&&(s.eye=t[1]),"layout"==t[0]&&(s.layout=t[1])})(e.target.dataset.oes))})(bluejay),(function(e){"use strict";e.addModule("overlayPopup");const t=[{id:"#js-idg-popup-content-template",php:"_popup-content-template.php"},{id:"#js-change-context-btn",php:"change-context.php"},{id:"#copy-edit-history-btn",php:"previous-history-elements.php"},{id:"#copy-edit-anterior-segment-btn",php:"previous-ed-anterior.php"},{id:"#js-virtual-clinic-btn",php:"virtual-clinic.php"},{id:"#js-delete-event-btn",php:"delete-event.php"},{id:"#js-close-element-btn",php:"close-element.php"},{id:"#js-add-new-event",php:"add-new-event.php"},{id:"#js-idg-preview-correspondence",php:"letter-preview.php"},{id:"#js-idg-exam-complog",php:"exam-va-COMPlog.php"},{id:"#js-duplicate-event-btn",php:"duplicate-event-warning.php"},{id:"#js-idg-worklist-ps-add",php:"worklist-PS.php"},{id:"#analytics-change-filters",php:"analytics-filters.php"},{id:"#js-idg-add-new-contact-popup",php:"add-new-contact.php"},{id:"#js-idg-admin-queset-demo",php:"admin-add-queue.php"},{id:"#js-idg-search-query-save",php:"query-save.php"},{id:"#js-idg-search-all-searches",php:"query-all-searches.php"}],s=(t,s)=>{e.userDown(t,()=>{e.xhr("/idg-php/v3/_load/"+s).then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t.html,s.querySelector(".close-icon-btn").addEventListener("mousedown",t=>{t.stopPropagation(),e.remove(s)},{once:!0}),document.body.appendChild(s)}).catch(e=>console.log("OverlayPopup failed to load: Err msg -",e))})};for(let e=0,n=t.length;e<n;e++){let n=t[e];null!==document.querySelector(n.id)&&s(n.id,n.php)}})(bluejay),(function(e){"use strict";e.addModule("overlayPopupJSON");e.userDown(".js-idg-demo-popup-json",t=>{let s;if(void 0===t.target.dataset.idgDemo)throw new Error("overlayPopupJSON: No php file info? Needs data-idg-demo=json");s=JSON.parse(t.target.dataset.idgDemo).php,e.xhr("/idg-php/v3/_load/"+s).then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t.html,document.body.appendChild(s);let n=s.querySelector(".close-icon-btn");n&&n.addEventListener("mousedown",t=>{t.stopPropagation(),e.remove(s)},{once:!0})}).catch(e=>console.log("overlayPopupJSON: Failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("pathStepsPopup");const t=".oe-pathstep-btn:not(.no-popup)";let s=!1;const n=document.createElement("div");n.style.display="none",n.className="oe-pathstep-popup",n.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<h3 class="title"></h3>','<div class="popup-overflow"><div class="data-group">','<table class="data-table"><tbody>',"</tbody></table>","</div></div>",'<div class="step-actions">','<button class="green hint">Administer</button><button class="red hint">Remove PSD</button>',"</div>",'<div class="step-status"></div>'].join(""),document.body.appendChild(n);const i={title:n.querySelector(".title"),closeBtn:n.querySelector(".close-icon-btn .oe-i"),status:n.querySelector(".step-status"),tbody:n.querySelector(".data-table tbody"),actions:n.querySelector(".step-actions"),detailRows:null,locked:!1},a=e=>{let t,s="NA";return"R"!=e&&"B"!=e||(t="R"),"L"!=e&&"B"!=e||(s="L"),`<span class="oe-eye-lat-icons"><i class="oe-i laterality ${t} small"></i><i class="oe-i laterality ${s} small"></i></span>`},o=(e,t,s=!1)=>{let n=document.createElement("tr");s&&(n.className=s),e.forEach(e=>{let t=document.createElement("td");t.innerHTML=e,n.appendChild(t)}),t.appendChild(n)},l=t=>{let s=document.createDocumentFragment();t.forEach(e=>{var t;o((t=e.directive,[a(t[0]),t[1],t[2]]),s),e.steps.forEach(e=>{o((e=>{return 1==e.length&&(e=e.concat(['<em class="fade">to do</em>',""])),[(t=e[0],`<i class="oe-i ${t} small"></i>`),e[1],e[2]];var t})(e),s,"administer-details")})}),i.tbody.innerHTML="",i.tbody.appendChild(s),i.detailRows=e.nodeArray(n.querySelectorAll(".administer-details"))},r=()=>{let e=JSON.parse(s.dataset.step);i.title.textContent=e.title,l(e.psd),(e=>{let t="No status set",s="default";switch(e){case"done":t="PSD: Completed at 11:40",s="green";break;case"todo":t="PSD: Waiting to start",s="default";break;case"progress":t="PSD: In progress",s="orange";break;case"problem":t="Issue with PSD",s="red"}i.status.textContent=t,i.status.className=["step-status",s].join(" ")})(e.status)},c=e=>{let t=e?"block":"none",s=e?"table-row":"none";i.title.style.display=t,i.closeBtn.style.display=t,i.actions.style.display="",i.detailRows.forEach(e=>e.style.display=s)},d=()=>{i.locked=!1,n.style.display="none"},u=(e,t,s=0)=>{n.style.top=e+s+"px",n.style.left=t-360+"px",n.style.display="block"};e.userDown(t,e=>{e.target!==s&&(s=e.target,r()),c(!0),i.locked=!0;let t=s.getBoundingClientRect();u(t.top,t.right,-5),window.addEventListener("scroll",d,{capture:!0,once:!0})}),e.userEnter(t,e=>{if(i.locked)return;s=e.target,r(),c(!1);let t=s.getBoundingClientRect();u(t.bottom,t.right)}),e.userLeave(t,e=>{i.locked||d()}),e.userDown(".oe-pathstep-popup .close-icon-btn .oe-i",d)})(bluejay),(function(e){"use strict";e.addModule("patientPopups");const t="active",s="open",n=[{btn:"#js-quicklook-btn",content:"#patient-summary-quicklook"},{btn:"#js-demographics-btn",content:"#patient-popup-demographics"},{btn:"#js-management-btn",content:"#patient-popup-management"},{btn:"#js-allergies-risks-btn",content:"#patient-popup-allergies-risks"},{btn:"#js-charts-btn",content:"#patient-popup-charts"},{btn:"#js-patient-extra-btn",content:"#patient-popup-trials"}],i=()=>({over:function(){this.btn.classList.add(t),this.show()}}),a=()=>({out:function(e){e.relatedTarget!==this.content&&(this.hide(),this.btn.classList.remove(t))}}),o=()=>({show:function(){this.open||(this.open=!0,d(this),this.btn.classList.add(s),e.show(this.content,"block"))}}),l=()=>({hide:function(){!1===this.open||this.isLocked||(this.open=!1,this.btn.classList.remove(t,s),e.hide(this.content))}}),r=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(s)}}),c=e=>(e.open=!1,e.isLocked=!1,Object.assign(e,{change:function(){this.open?this.hide():this.show()}},i(),a(),r(),o(),l(),{makeHidden:function(){this.open&&(this.isLocked=!1,this.hide())}})),d=e=>{n.forEach(t=>{t.popup!=e&&t.popup.makeHidden()})};n.forEach(t=>{let s=document.querySelector(t.btn);if(null!==s){let n=c({btn:s,content:document.querySelector(t.content)});e.userDown(t.btn,()=>n.change()),e.userEnter(t.btn,()=>n.over()),e.userLeave(t.btn,e=>n.out(e)),e.userLeave(t.content,e=>n.out(e)),t.popup=n}})})(bluejay),(function(e){"use strict";e.addModule("patientQuickMeta");let t=!1,s=!1,n=null,i=null,a=null,o=window.innerHeight;const l={},r=()=>{i.style.display="none",t=s=!1,n=null},c=(r,c)=>{if(n===r&&t)return s=!0,void e.show(a,"block");i=i||(()=>{const e=document.createElement("div");return e.className="oe-patient-quick-overview",e.style.display="none",e.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<div class="oe-patient-meta">','<div class="patient-name">','<a href="/v3-SEM/patient-overview"><span class="patient-surname">SURNAME</span>, <span class="patient-firstname">First (M.)</span></a>','</div><div class="patient-details">','<div class="hospital-number"><span>ID</span>0000000</div>','<div class="nhs-number"><span>NHS</span>111 222 3333</div>','<div class="patient-gender"><em>Gen</em>Male</div>','<div class="patient-age"><em>Age</em>00y</div>',"</div></div>",'<div class="quick-overview-content"></div>'].join(""),document.body.appendChild(e),a=e.querySelector(".close-icon-btn"),l.surname=e.querySelector(".patient-surname"),l.first=e.querySelector(".patient-firstname"),l.hospital=e.querySelector(".hospital-number"),l.nhs=e.querySelector(".nhs-number"),l.gender=e.querySelector(".patient-gender"),l.age=e.querySelector(".patient-age"),e})(),t=!0,s=c,n=r;let d=r.dataset,u=r.getBoundingClientRect(),p=d.mode,h=d.php,m=JSON.parse(d.patient);l.surname.textContent=m.surname,l.first.textContent=m.first,l.hospital.innerHTML="<span>ID</span> "+m.id,l.nhs.innerHTML="<span>NHS</span> "+m.nhs,l.gender.innerHTML="<em>Gen</em> "+m.gender,l.age.innerHTML="<em>Age</em> "+m.age,i.style.cssText=" ","float"==p?(i.classList.remove("side-panel"),o-u.y>300?i.style.top=u.y+u.height+5+"px":i.style.bottom=o-u.top+10+"px",i.style.left=u.x-250+u.width/2+"px"):i.classList.add("side-panel");let g=i.querySelector(".quick-overview-content");g.innerHTML="";let y=setTimeout(()=>g.innerHTML='<i class="spinner"></i>',400);c?e.show(a,"block"):e.hide(a),e.xhr("/idg-php/v3/_load/"+h).then(e=>{clearTimeout(y),t&&(g.innerHTML=e.html,i.style.display="block")}).catch(e=>console.log("ed3app php failed to load",e))};e.userDown(".js-patient-quick-overview",e=>{let i=e.target;t&&s&&n===i?r():c(i,!0)}),e.userEnter(".js-patient-quick-overview",e=>{s||c(e.target,!1)}),e.userLeave(".js-patient-quick-overview",e=>{s||r()}),e.userDown(".oe-patient-quick-overview .close-icon-btn .oe-i",r),e.listenForResize(()=>o=window.inneHeight)})(bluejay),(function(e){"use strict";e.addModule("proView");const t=[],s=e=>({options:function(e){e.lock&&(this.pro=null),0!=e.linkID&&(this.linked=!0,this.linkedProView=i(document.querySelector("#"+e.linkID)),e.lock&&(this.linkedProView.pro=null))}}),n=e=>{let t=e.querySelector(".pro-view-btn"),n=e.querySelector(".data-pro-view"),i=e.querySelector(".data-standard-view"),a={btn:t,oei:t.querySelector(".oe-i"),pro:n,standard:i,inPro:!0,linked:!1};return Object.assign(a,{change:function(){this.inPro?(this.hideShow(this.pro,this.standard),this.icon("expand","collapse")):(this.hideShow(this.standard,this.pro),this.icon("collapse","expand")),this.linked&&this.linkedProView.change(),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}},{icon:function(e,t){this.oei.classList.replace(e,t)}},s())},i=e=>{let t={pro:e.querySelector(".data-pro-view"),standard:e.querySelector(".data-standard-view"),inPro:!0};return Object.assign(t,{change:function(){this.inPro?this.hideShow(this.pro,this.standard):this.hideShow(this.standard,this.pro),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}})};e.userDown(".pro-view-btn",s=>{const i=s.target;let a=e.getDataAttr(i);if(a)t[parseFloat(a)].change();else{e.setDataAttr(i,t.length);let s=n(e.getParent(i,".pro-data-view"));s.options(JSON.parse(i.dataset.proview)),s.change(),t.push(s)}})})(bluejay),(function(e){"use strict";e.addModule("problemsPlans");const t=e.nodeArray(document.querySelectorAll(".problems-plans-sortable"));if(t.length<1)return;const s=[],n=(e,t,s)=>({id:e,text:t,info:s});e.nodeArray(t[0].querySelectorAll("li")).forEach(e=>{s.push(n(s.length,e.textContent,e.querySelector(".info").getAttribute("data-tooltip-content")))}),t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach((t,s)=>{e.setDataAttr(t,s)})});let i=s.length+1;const a=(e,t)=>['<span class="drag-handle"><i class="oe-i menu medium pro-theme"></i></span>',e,'<div class="metadata">','<i class="oe-i info small pro-theme js-has-tooltip" data-tooltip-content="',t,'"></i></div>','<div class="remove"><i class="oe-i remove-circle small pro-theme pad"></i></div>'].join(""),o=(n,i)=>{let o=s.findIndex(e=>e.id==n),l=s.findIndex(e=>e.id==i);s[o]=s.splice(l,1,s[o])[0],t.length>1&&t.forEach(t=>{let n=t.querySelectorAll("li");for(let t=0,i=s.length;t<i;t++){let i=s[t],o=n[t];i.id!=e.getDataAttr(o)&&(e.setDataAttr(o,i.id),o.innerHTML=a(i.text,i.info))}})};e.userDown(".create-new-problem-plan button",o=>{o.preventDefault();let l=e.getParent(o.target,".create-new-problem-plan").querySelector("input");if(!l||l.value.length<2)return;let r=n(i++,l.value,"Added now!");var c;s.push(r),c=(t=>{const s=new DocumentFragment,n=document.createElement("li");return n.innerHTML=a(t.text,t.info),e.setDataAttr(n,t.id),s.appendChild(n),s})(r),t.forEach(e=>{e.appendChild(c.cloneNode(!0)),h(e.lastChild)})}),e.userDown(".problems-plans-sortable .remove-circle",n=>{let i=e.getParent(n.target,"li"),a=0;for(;null!==(i=i.previousSibling);)a++;t.forEach(t=>{e.remove(t.childNodes[a])}),s.splice(a,1)}),document.addEventListener("DOMContentLoaded",()=>{t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach(e=>{h(e)})})});let l=null,r="js-sorting-list";const c=e=>{l=e.target,e.target.parentNode.classList.add(r),e.dataTransfer.setData("source",l.innerHTML)},d=e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"},u=e=>(e.preventDefault&&e.preventDefault(),!1),p=t=>{if(t.stopPropagation&&t.stopPropagation(),!1!==t.target.parentNode.classList.contains(r))return t.target.parentNode.classList.remove(r),l!=t.target&&(l.innerHTML=t.target.innerHTML,t.target.innerHTML=t.dataTransfer.getData("source"),o(e.getDataAttr(l),e.getDataAttr(t.target))),!1},h=e=>{e.setAttribute("draggable","true"),e.addEventListener("dragstart",c,!1),e.addEventListener("dragenter",d,!1),e.addEventListener("dragover",u,!1),e.addEventListener("drop",p,!1)}})(bluejay),(function(e){"use strict";e.addModule("quicktag");const t={qtags:["Adverse_Event","Serious_Adverse_Event","Note","My_research","my_teaching","Research","Teaching","Referred","Results","My_Results_pending"].map(e=>e.toLowerCase())};e.extend("wrapQtags",e=>{let s=e.split(" "),n=[],i=[];if(s.forEach((e,s)=>{e.startsWith("#")&&t.qtags.indexOf(e.substring(1))>=0?i.push(e):n.push(e)}),i.sort(),i.length){let e=i.map(e=>`<span class="qtag">${e}</span>`);return{text:i.join(" ")+" "+n.join(" "),DOMString:e.join(" ")+'<span class="dot-list-divider"></span>'+n.join(" ")}}return{text:e,DOMString:e}});const s=(()=>{let s=!1,n="";const i={input:null,tags:null,flag:null},a=e=>{e.length?(n=e[0],i.tags.innerHTML=Mustache.render('{{#qtags}}<span class="qtag">#{{.}}</span> {{/qtags}}',{qtags:e}),i.tags.querySelector(".qtag:first-child").classList.add("selected")):(n="",i.tags.innerHTML='<div class="no-matching-tags">No matching Patient Tags</div>')};return{init:n=>{if(s)return;s=!0;const o=e.wrap(n,"js-qtag-wrapper");n.focus();let l=document.createElement("div");l.className="oe-qtags",l.style.display="none";let r=document.createElement("div");r.className="oe-qtags-flag",r.textContent="#",n.getBoundingClientRect().top<e.getWinH()-170?(l.style.top="100%",r.style.top="100%"):(l.style.bottom="100%",r.style.bottom="100%"),o.appendChild(r),o.appendChild(l),i.input=n,i.tags=l,i.flag=r,a(t.qtags)},showTags:()=>{i.tags.style.display="block",i.flag.style.display="none",a(t.qtags)},hideTags:()=>{i.tags.style.display="none",i.flag.style.display="block"},userTyping:e=>{const s=(e=e.toLowerCase()).match(/[a-z-_]*/)[0],n=s.length,i=t.qtags.filter(e=>e.substring(0,n)==s);a(i)},selectedTag:()=>n,reset:()=>{s&&(e.remove(i.tags),e.remove(i.flag),e.unwrap(i.input),i.tags=null,i.flag=null,i.input=null,s=!1)}}})(),n=e=>{e.isComposing||229===e.keyCode||("Enter"!=e.key&&"Tab"!=e.key||(e.preventDefault(),e.stopPropagation(),i.insertTag(s.selectedTag()))," "==e.key&&i.stopTagging())},i=(()=>{let t=!1,a=null,o=0,l="",r=!1;const c=()=>{document.removeEventListener("input",m,{capture:!0}),document.removeEventListener("blur",h,{capture:!0}),a=null,t=!1,o=0,s.reset()},d=()=>{t=!1,o=0,s.hideTags(),e.log("[qTags] - Keys: Enter, Tab and Spacebar - normal"),document.removeEventListener("keydown",n,!0)},u=i=>{t=!0,o=i,l=a.value,s.showTags(),e.log("[qTags] - Keys: Enter, Tab & Spacebar - suspended (keydown)"),document.addEventListener("keydown",n,!0)},p=()=>{r=!0,setTimeout(()=>{a.focus(),r=!1},20)},h=()=>{r||c()},m=e=>{t?s.userTyping(a.value.substring(o)):"#"===e.data&&u(e.target.selectionStart)};return{init:e=>{e.isSameNode(a)||(null!==a&&c(),e.classList.contains("js-allow-qtags")&&(a=e,s.init(a),document.addEventListener("input",m,{capture:!0}),document.addEventListener("blur",h,{capture:!0})))},stopTagging:d,insertTag:e=>{let t=e+" ";o===l.length?a.value=l+t:a.value=l.substring(0,o)+t+l.substring(o+1),d()},userClicksFlag:()=>{a.value=a.value+" #",u(a.value.length),p()},userClicksTag:e=>{i.insertTag(e),p()},reset:c,focusOut:h}})();document.addEventListener("focus",e=>i.init(e.target),{capture:!0}),e.userDown(".oe-qtags",i.stopTagging),e.userDown(".oe-qtags-flag",i.userClicksFlag),e.userDown(".oe-qtags .qtag",e=>{const t=e.target.textContent;i.userClicksTag(t.substring(1))})})(bluejay),(function(e){"use strict";e.addModule("reduceElementHeight");const t=[],s=e=>(e.reduced=!1,Object.assign(e,{change:function(){this.reduced?(this.elem.classList.remove("reduced-height"),this.icon.classList.replace("increase-height-orange","reduce-height")):(this.elem.classList.add("reduced-height"),this.icon.classList.replace("reduce-height","increase-height-orange")),this.reduced=!this.reduced}}));e.userDown(".element .js-elem-reduce .oe-i",(n,i)=>{let a=n.target,o=e.getDataAttr(a);if(o)t[parseFloat(o)].change();else{let n=s({elem:e.getParent(a,".element"),icon:a});n.change(),e.setDataAttr(a,t.length),t.push(n)}})})(bluejay),(function(e){"use strict";e.addModule("restrictDataHeightFlag");const t="restrict-data-shown-flag",s=e.getDataAttributeName(),n=[];function i(e,t,s){this.hasScrolled=!1,this.flag=e,this.content=t,this.scrollEndPos=s,this.content.addEventListener("scroll",()=>this.scroll(),{once:!0})}i.prototype.scroll=function(t){this.hasScrolled=!0,this.flag.className+=" fade-out",setTimeout(()=>e.remove(this.flag),400)},i.prototype.userClick=function(){this.hasScrolled||a(this.content,this.scrollEndPos)};const a=(e,t)=>{let s=1,n=0,i=setInterval(()=>{var a;n=Math.min(1,s/200),e.scrollTop=Math.ceil((a=n)*(2-a)*t),s+=1,1==n&&clearInterval(i)},2)};(()=>{let a=e.nodeArray(document.querySelectorAll(".restrict-data-shown"));if(a.length<1)return;const o=document.createDocumentFragment(),l=document.createElement("div");l.className=t,o.appendChild(l),a.forEach(e=>{let t=e.querySelector(".restrict-data-content"),a=e.clientHeight,l=t.scrollHeight;if(l>a&&0===t.scrollTop){let r=o.cloneNode(!0),c=r.firstChild;c.setAttribute(s,n.length),e.appendChild(r),n.push(new i(c,t,l-a))}})})(),e.userDown("."+t,e=>{n[e.target.getAttribute(s)].userClick()})})(bluejay),(function(e){"use strict";e.addModule("sideNavSelectList");const t=e.nodeArray(document.querySelectorAll(".js-list-filter"));if(0==t.length)return;const s=e.nodeArray(document.querySelectorAll(".js-filter-group"));let n=document.querySelector(".js-list-filter.selected");const i=e=>{s.forEach(t=>{t.style.display=e})};t.forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let s=t.target;var a;s.classList.add("selected"),"all"==(a=s.dataset.list)?i("block"):(i("none"),e.show(document.querySelector("#"+a),"block")),n.classList.remove("selected"),n=s})})})(bluejay),(function(e){"use strict";bluejay.addModule("sidebarElementList");let t=document.querySelector(".sidebar-eventlist .oe-element-list");if(null===t)return;let s=document.querySelectorAll(".element-title");if(s.length<1)return;let n=document.createDocumentFragment();s.forEach((function(e){let t=document.createElement("li");t.innerHTML='<a href="#">'+e.textContent+"</a>",n.appendChild(t)})),t.appendChild(n)})(),(function(e){"use strict";if(e.addModule("sidebarQuicklookView"),null===document.querySelector(".sidebar-eventlist"))return;const t={el:null,show(e){this.el=e.parentNode.previousSibling,this.el.classList.add("fade-in")},hide(){this.el.classList.remove("fade-in")}},s={id:null,div:null,locked:!1,iCloseBtn:"i-btn-close",click(e){e.id==this.id?this.locked?this.unlock():this.lock():(this.show(e),this.lock())},over(e){this.locked||this.show(e)},out(){this.locked||this.remove()},lock(){this.locked=!0,this.div.appendChild(e.div(""+this.iCloseBtn))},unlock(){this.locked=!1,this.div.querySelector("."+this.iCloseBtn).remove()},close(){this.remove(),this.locked=!1},remove(){this.div.remove(),this.div=null,this.id=null},show(t){null!==this.div&&this.remove(),this.id=t.id;const s=['<div class="event-icon"><i class="oe-i-e large {{icon}}"></i></div>','<div class="title">{{event}} - {{date}}</div>','<div class="quick-view-content {{type}}"></div>'].join("");this.div=e.div("oe-event-quickview fade-in"),this.div.innerHTML=Mustache.render(s,t),this.load(t.type,t.content),document.body.appendChild(this.div)},load(t,s){const n=this.div.querySelector(".quick-view-content");switch(t){case"img":n.innerHTML=`<img src="${s}" />`;break;case"pdf":n.innerHTML=`<embed src="${s}#toolbar=0" width="100%" height="100%"></embed>`;break;case"php":e.xhr(s,this.id).then(e=>{this.id==e.token&&(n.innerHTML=e.html)}).catch(e=>console.log("PHP failed to load",e));break;case"none":n.innerHTML=`<div class="not-available">${s}</div>`;break;default:e.log("QuickView Error - load content type unknown:"+t)}}};e.userEnter(".event .event-type",n=>{t.show(n.target);const i=e.getParent(n.target,"li.event");s.over(JSON.parse(i.dataset.quick))}),e.userLeave(".event .event-type",e=>{t.hide(),s.out()}),e.userDown(".oe-event-quickview ."+s.iCloseBtn,()=>{s.close()}),document.addEventListener("click",t=>{if(t.target.matches(".event .event-type")){t.preventDefault(),t.stopImmediatePropagation();const n=e.getParent(t.target,"li.event");s.click(JSON.parse(n.dataset.quick))}},{capture:!0})})(bluejay),(function(e){"use strict";if(e.addModule("signatureCapture"),null===document.querySelector(".js-idg-capture-signature"))return;const t=()=>{e.xhr("/idg-php/v3/_load/signature-pad.php").then(t=>{const s=e.div("oe-popup-wrap");s.innerHTML=t.html,document.body.appendChild(s);let n=s.querySelector(".close-icon-btn");n&&n.addEventListener("mousedown",t=>{e.remove(s)},{once:!0}),(()=>{var e=document.getElementById("signature-pad").querySelector("canvas"),t=document.getElementById("signature-pad-clear"),s=new SignaturePad(e,{backgroundColor:"rgb(255, 255, 255)"});function n(){var t=Math.max(window.devicePixelRatio||1,1);e.width=e.offsetWidth*t,e.height=e.offsetHeight*t,e.getContext("2d").scale(t,t),s.clear()}window.onresize=n,n(),t.addEventListener("click",(function(e){s.clear()}))})()}).catch(e=>console.log("signature pad: failed to load",e))};e.loadJS("https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js",!0).then(()=>{e.userDown(".js-idg-capture-signature",t)})})(bluejay),(function(e){"use strict";e.addModule("textAreaResize");const t=e=>{let t=e.scrollHeight;t-e.clientHeight>15&&(e.style.height="auto",e.style.height=t+5+"px")};e.extend("resizeTextArea",t),document.addEventListener("input",e=>{"TEXTAREA"==e.target.tagName&&t(e.target)},!1),document.addEventListener("DOMContentLoaded",()=>{e.nodeArray(document.querySelectorAll("textarea")).forEach(e=>{t(e)})})})(bluejay),(function(e){"use strict";e.addModule("tooltip");const t=Object.assign({selector:".js-has-tooltip",showing:!1,target:null,type:null,clickThrough:!1,tip:null,eyeIcons:null,reset(){this.showing=!1,this.type=null,this.target=null,this.views.notify()},update(e){if(this.showing=!0,this.target=e,e.hasAttribute("data-tooltip-content"))this.type="basic",this.tip=e.dataset.tooltipContent;else{const t=JSON.parse(e.dataset.tt);this.type=t.type,this.clickThrough=t.clickPopup,"bilateral"==this.type?(this.tip={r:t.tipR,l:t.tipL},this.eyeIcons=t.eyeIcons):this.tip=t.tip}this.views.notify()}},e.ModelViews()),s=(()=>{const s=document.createElement("div");let n=window.innerWidth;e.listenForResize(()=>n=window.innerWidth);const i=()=>{s.innerHTML="",s.className="oe-tooltip",s.style.cssText="display:none"};return t.views.add(()=>{t.showing||i()}),i(),document.body.appendChild(s),{div:s,reset:i,show:(i,a)=>{let o=a/2,l=e.getHiddenElemSize(s).h,r=t.target.getBoundingClientRect(),c=r.right-r.width/2,d=r.top-l-8,u=n>e.settings("cssHotlistFixed")?e.settings("cssExtended"):n;c<=o&&(o=20,s.classList.add("offset-right")),c>u-o&&(o=a-20,s.classList.add("offset-left")),r.top<l&&(d=r.bottom+8,s.classList.add("inverted")),s.style.top=d+"px",s.style.left=c-o+"px",s.style.display=i}}})();t.views.add(()=>{"basic"===t.type&&(s.reset(),s.div.innerHTML=t.tip,s.show("block",200))});t.views.add(()=>{"bilateral"===t.type&&(s.reset(),s.div.classList.add("bilateral"),s.div.innerHTML=Mustache.render('<div class="right">{{&r}}</div><div class="left">{{&l}}</div>',t.tip),t.eyeIcons||s.div.classList.add("no-icons"),s.show("flex",400))});const n=e=>{!1!==t.showing&&(t.reset(),window.removeEventListener("scroll",n,{capture:!0,once:!0}))},i=e=>{t.update(e.target),window.addEventListener("scroll",n,{capture:!0,once:!0})};e.userDown(t.selector,e=>{e.target.isSameNode(t.target)&&t.showing?n():i(e)}),e.userEnter(t.selector,i),e.userLeave(t.selector,n)})(bluejay),(function(e){"use strict";bluejay.addModule("userPIN");document.addEventListener("input",e=>{e.target.matches(".user-pin-entry")&&(e=>{let t=e.value,s=e.parentNode;s.classList.remove("accepted-pin","wrong-pin"),4===t.length&&("1234"==t?s.classList.add("accepted-pin"):s.classList.add("wrong-pin"))})(e.target)},{capture:!0})})(),(function(e){"use strict";e.addModule("vcScratchPad");const t=document.querySelector("#oe-vc-scratchpad");if(null===t)return;let s,n,i=!1;t.addEventListener("dragstart",e=>{e.dataTransfer.dropEffect="move";let t=e.target.getBoundingClientRect();s=e.clientX-t.left,n=e.clientY-t.top},!1),t.addEventListener("dragend",e=>{let i=Math.round(e.clientY-n),a=Math.round(e.clientX-s);i=i<1?1:i,a=a<1?1:a,t.style.top=i+"px",t.style.left=a+"px"},!1);e.userDown("#js-vc-scratchpad",s=>{let n=s.target;i?(e.hide(t),n.textContent="ScratchPad"):(e.show(t,"block"),n.textContent="Hide ScratchPad"),i=!i})})(bluejay),(function(e){"use strict";if(e.addModule("whiteboard"),null===document.querySelector("main.oe-whiteboard"))return;e.hide(document.querySelector("#oe-admin-notifcation"));const t=document.querySelector(".wb3-actions"),s=document.querySelector("#js-wb3-openclose-actions");if(e.userDown("#js-wb3-openclose-actions",e=>{s.classList.contains("up")?(s.classList.replace("up","close"),t.classList.replace("down","up")):(s.classList.replace("close","up"),t.classList.replace("up","down"))}),e.userDown(".wb-idg-demo-btn",e=>{window.location="/v3-whiteboard/"+e.target.dataset.url}),e.userDown(".edit-widget-btn .oe-i",t=>{let s=t.target,n=e.getParent(s,".oe-wb-widget"),i=n.querySelector(".wb-data ul"),a=n.querySelector(".wb-data .edit-widget");s.classList.contains("pencil")?(s.classList.replace("pencil","tick"),e.hide(i),e.show(a,"block")):(s.classList.replace("tick","pencil"),e.hide(a),e.show(i,"block"))}),null===document.querySelector(".multipage-nav"))return;let n=document.querySelector(".multipage-stack"),i=e.nodeArray(n.querySelectorAll("img")),a=i[0].height+20;e.listenForResize(()=>a=i[0].height+20);let o=0;const l=e=>{o+=e,o<0&&(o=0),o>i.length*a&&(o=i.length*a),n.scrollTop=o};e.userDown("#js-scroll-btn-down",()=>l(200)),e.userDown("#js-scroll-btn-up",()=>l(-200));let r=document.querySelector(".page-jump");i.forEach((e,t)=>{let s=document.createElement("div");s.className="page-num-btn",s.setAttribute("data-page",t),s.textContent=t+1,r.appendChild(s)}),e.userDown(".page-num-btn",e=>{o=0;let t=parseInt(e.target.dataset.page*a);l(t)})})(bluejay),(function(e){"use strict";if(null===document.querySelector("#tinymce-letterheader-editor"))return;let t=null;const s={user_name:{label:"User Name",value:"<span>Admin Admin</span>"},firm_name:{label:"Firm Name",value:"<span>Glaucoma Clinic</span>"},site_name:{label:"Site Name",value:"<span>Kings Hospital</span>"},site_phone:{label:"Site Phone",value:"<span>0123456789</span>"},site_fax:{label:"Site Fax",value:null},site_email:{label:"Site Email",value:null},site_address:{label:"Site Address",value:"<span>100 Main Road</span>"},site_city:{label:"Site City",value:"<span>London</span>"},site_postcode:{label:"Site Postcode",value:"<span>W1 1AA</span>"},primary_logo:{label:"Primary Logo",value:'<img src="/idg-php/imgDemo/correspondence/letterhead-logo.png">'},secondary_logo:{label:"Secondary Logo",value:null},current_date:{label:"Today's Date",value:"<span>"+document.documentElement.dataset.today+"</span>"}};tinymce.init({selector:"#tinymce-letterheader-editor",schema:"html5-strict",branding:!1,min_height:400,menubar:!1,plugins:["lists table paste code"],contextmenu:"table",toolbar:"undo redo | bold italic underline | alignleft aligncenter alignright | table | code",custom_undo_redo_levels:10,hidden_input:!1,block_formats:"Paragraph=p; Header 2=h2; Header 3=h3",content_css:"/newblue/css/style_oe3_print.min.css",setup:function(e){e.on("init",(function(n){t=e,(()=>{var e=new DocumentFragment;for(const n in s){let i=s[n].label,a=s[n].value;if(null!==a){var t=document.createElement("button");t.className="idg-quick-insert",t.textContent=i,t.setAttribute("data-insert",JSON.stringify({key:n,value:a})),e.appendChild(t)}}document.querySelector(".editor-quick-insert-btns").appendChild(e)})()}))}}),e.userDown(".idg-quick-insert",e=>{let s=JSON.parse(e.target.dataset.insert);var n,i;n=s.key,i=s.value,t.insertContent('<span contenteditable="false" data-substitution="'+n+'">'+i+"</span>")})})(bluejay),(function(e){"use strict";null!==document.querySelector(".js-idg-demo-ed2")&&(e.userDown(".js-idg-demo-doodle-drawer",t=>{let s=t.target;e.getParent(s,"li").classList.toggle("ed2-drawer-open")}),e.userDown(".ed-canvas-edit",t=>{let s=t.target;e.getParent(s,".ed2-editor").querySelector(".ed2-doodle-popup").classList.toggle("closed")}),e.userDown("#js-idg-demo-ed2-search-input",e=>{let t=e.target.nextElementSibling;console.log("hi"),"none"==t.style.display?t.style.display="block":t.style.display="none"}))})(bluejay),(function(e){"use strict";if(null===document.querySelector(".oe-worklists.eferral-manager"))return;const t=new e.Collection,s=["DRSS","Cataract","Glaucoma","Uveitis","Lucentis","Glaucoma ODTC","Laser/YAG","General","Ocular Motility","Oculoplastic","Neuro","Botox","Corneal","VR","Paediatric Ophthalmology","Paediatric Neuro-Ophthalmology"],n={accepted:null,tr:null,iEdit:null,iState:null,iRisk:null,fullName:"JONES, David (Mr)",nhs:"000",age:"42",gender:"Male",riskNum:0,pathElem:null,pathNum:99,active(){this.iEdit.classList.replace("pencil","direction-right"),this.iEdit.classList.replace("small-icon","large"),this.iEdit.classList.add("selected"),this.tr.classList.add("active")},inactive(){this.iEdit.classList.replace("direction-right","pencil"),this.iEdit.classList.replace("large","small-icon"),this.iEdit.classList.remove("selected"),this.tr.classList.remove("active")},accept(){this.accepted=!0,this.iState.classList.replace("status-query","tick-green"),this.iState.classList.replace("cross-red","tick-green")},reject(){this.accepted=!1,this.iState.classList.replace("status-query","cross-red"),this.iState.classList.replace("tick-green","cross-red")},name(){return this.fullName},details(){return`${this.gender}, ${this.age}y`},setRisk(e){var t;this.iRisk=e,this.riskNum=(t=e.className).includes("green")?3:t.includes("amber")?2:t.includes("red")?1:0},get risk(){return this.riskNum},set risk(e){var t,s;this.riskNum=parseInt(e,10),t=this.iRisk,s=e,t.className=`oe-i triangle-${["grey","red","amber","green"][s]} selected`,null===this.accepted&&this.accept()},setPathway(e){this.pathElem=e,this.pathNum=(e=>{let t=99;return s.forEach((s,n)=>{e==s&&(t=n)}),t})(e.textContent)},set pathway(e){this.pathNum=parseInt(e,10),this.pathElem.textContent=s[this.pathNum]},get pathway(){return this.pathNum}};e.nodeArray(document.querySelectorAll("table.eferrals")).forEach(s=>{Array.from(s.tBodies[0].rows).forEach(s=>{let i=Object.create(n);i.tr=s,i.iEdit=s.querySelector(".oe-i.pencil"),i.iState=s.querySelector(".oe-i.js-referral-status-icon"),i.fullName=s.querySelector(".patient-name").textContent,i.age=s.querySelector(".patient-age").textContent.substring(3),i.gender=s.querySelector(".patient-gender").textContent.substring(3),i.nhs=s.querySelector(".nhs-number").textContent.substring(3),i.setRisk(s.querySelector('[class*="triangle-"]')),i.setPathway(s.querySelector(".js-pathway")),i.hasImage=Math.random()>=.5;let a=e.getParent(s,".worklist-group");i.group=a.querySelector(".worklist-summary h2").textContent,i.myKey=t.add(i,i.iEdit)})});const i=(()=>{let s=null;const n=e.nodeArray(document.querySelectorAll("#sidebar-patient-risk-settings input")),a=e.nodeArray(document.querySelectorAll("#sidebar-pathway-settings input")),o={view:{overview:document.getElementById("sidebar-eferral-overview"),patient:document.getElementById("sidebar-manage-patient"),reject:document.getElementById("sidebar-reject-accept")},btn:{overview:document.getElementById("idg-js-sidebar-viewmode-1"),patient:document.getElementById("idg-js-sidebar-viewmode-2")},patient:{fullName:document.getElementById("js-sidebar-patient-fullname"),details:document.getElementById("js-sidebar-patient-details"),group:document.getElementById("js-sidebar-referral-group"),attachment:document.getElementById("js-demo-attachment-image")}},l=t=>{t||null===t?(e.show(o.view.reject.querySelector(".js-reject")),e.hide(o.view.reject.querySelector(".js-accept"))):(e.hide(o.view.reject.querySelector(".js-reject")),e.show(o.view.reject.querySelector(".js-accept")))},r=(e,t)=>{e.forEach(e=>{e.checked=t==e.value})};return document.addEventListener("change",e=>{let t=e.target;"idg-radio-g-patient-risk"===t.name&&(s.risk=t.value),"idg-radio-g-patient-pathway"===t.name&&(s.pathway=t.value)}),{change:t=>{"overview"==t?(e.show(o.view.overview),e.hide(o.view.patient),o.btn.overview.classList.add("selected"),o.btn.patient.classList.remove("selected")):(e.hide(o.view.overview),e.show(o.view.patient),o.btn.overview.classList.remove("selected"),o.btn.patient.classList.add("selected"))},managePatient:e=>{null!==s&&s.inactive(),o.patient.fullName.textContent=e.fullName,o.patient.details.innerHTML=`<small class="fade">NHS</small> ${e.nhs}  \n\t\t\t\t&nbsp;<small class="fade">Gen</small> ${e.gender} \n\t\t\t\t&nbsp;<small class="fade">Age</small> ${e.age}`,o.patient.group.textContent=e.group,o.patient.attachment.style.display=e.hasImage?"block":"none",r(n,e.riskNum),r(a,e.pathNum),l(e.accepted),e.active(),s=e},nextPatient:e=>{let n;n="next"==e?t.next(s.myKey):t.prev(s.myKey),n&&i.managePatient(t.get(n))},rejectPatient:e=>{e.classList.contains("red")?(l(!1),s.reject()):(l(!0),s.accept())}}})();document.addEventListener("DOMContentLoaded",()=>{i.managePatient(t.getFirst())},{once:!0});e.userDown(".js-edit-patient-icon",e=>{let s=e.target,n=t.getKey(s);i.managePatient(t.get(n)),i.change("patient")}),e.userDown("#idg-js-sidebar-viewmode-1",()=>i.change("overview")),e.userDown("#idg-js-sidebar-viewmode-2",()=>i.change("patient")),e.userDown("#side-patient-next-btn",()=>i.nextPatient("next")),e.userDown("#side-patient-previous-btn",()=>i.nextPatient("prev")),e.userDown("#sidebar-reject-accept button",e=>i.rejectPatient(e.target)),document.addEventListener("keydown",e=>{e.stopPropagation(),"z"===e.key&&i.nextPatient("next"),"a"===e.key&&i.nextPatient("prev")},!1)})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-event-date-change"))return;e.userDown(".js-event-date-change > .rewind",t=>{let s=t.target,n=t.target.parentNode.querySelector("input"),i=t.target.parentNode.querySelector(".js-event-date");s.classList.add("disabled"),e.hide(i),e.show(n),setTimeout(()=>n.focus(),20)})})(bluejay),(function(e){"use strict";const t=document.getElementById("js-idg-demo-orders-pathway");if(null===t)return;e.userDown("button#js-idg-demo-orders-btn-adder",t=>{const s=t.target.getBoundingClientRect(),n=['<div class="close-icon-btn"></div>',"{{#pathSteps}}",'<span class="oe-pathstep-btn no-popup process" data-idg-demo="{{.}}">','<span class="step">{{.}}</span><span class="time invisible">Todo</span>',"</span>","{{/pathSteps}}"].join(""),i=e.div("oe-pathstep-adder");i.innerHTML=Mustache.render(n,{pathSteps:["Dilate","VisAcu","Orth","Ref","Img","Fields"].sort()}),i.style.bottom=e.getWinH()-s.bottom+"px",i.style.right=e.getWinW()-s.right+"px",document.body.appendChild(i),i.querySelector(".close-icon-btn").addEventListener("mousedown",()=>i.remove(),{once:!0})}),e.userDown(".oe-pathstep-adder > .oe-pathstep-btn",e=>{const s=e.target.dataset.idgDemo,n=document.createElement("span");n.className="oe-pathstep-btn process",n.innerHTML=`<span class="step">${s}</span><span class="time invisible">Todo</span>`,t.appendChild(n)})})(bluejay),(function(e){"use strict";bluejay.demoLoginTimeOut=()=>{const e=document.createElement("div");e.className="oe-popup-wrap dark",document.body.appendChild(e);const t=['<div class="oe-login timeout">','<div class="login">',"<h1>Timed out</h1>",'<div class="user">','<input type="text" placeholder="Username">','<input type="password" placeholder="Password">','<button class="green hint" id="js-login">Login</button>',"</div>",'<div class="info">',"For security reasons you have been logged out. Please login again","</div>","</div>","</div>"].join("");e.innerHTML=Mustache.render(t,{})}})(),(function(e){"use strict";if(null===document.querySelector(".js-idg-demo-13420"))return;document.addEventListener("input",t=>{let s=t.target;if(s.matches(".js-idg-demo-13420 .toggle-switch input")){let t=e.getParent(s,"tr"),n=t.querySelector(".js-idg-ongoing-text"),i=t.querySelector(".js-idg-date-stop"),a=t.querySelector(".js-idg-duration-dispense"),o=t.querySelector(".js-idg-taper-btn"),l=t.querySelector(".js-idg-stopped-reasons");s.checked?(e.hide(i),e.hide(l),e.show(n,"block"),e.show(a,"block"),e.show(o,"block")):(e.show(i,"block"),e.hide(n),e.hide(a),e.hide(o))}});const t=(t,s)=>{let n=t.querySelector(".js-idg-stop-btn"),i=t.querySelector(".js-idg-stop-date"),a=t.querySelector(".js-idg-stopped-reasons"),o=t.querySelector(".js-idg-cancel-stop");s?(e.hide(n),e.show(i,"block"),e.show(a,"block"),e.show(o,"block")):(e.show(n,"block"),e.hide(i),e.hide(a),e.hide(o))};document.addEventListener("click",s=>{s.target.matches(".js-idg-stop-btn")&&t(e.getParent(s.target,"td"),!0)}),document.addEventListener("mousedown",s=>{s.target.matches(".js-idg-cancel-stop")&&t(e.getParent(s.target,"td"),!1)}),document.addEventListener("mousedown",e=>{let t=e.target;if(t.matches(".js-show-medication-history")){document.querySelectorAll(".js-idg-medication-history-"+t.dataset.idgdemo).forEach(e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"})}})})(bluejay),(function(e){"use strict";if(null===document.querySelector(".home-messages"))return;const t={messages:document.getElementById("idg-js-sidebar-viewmode-1"),tags:document.getElementById("idg-js-sidebar-viewmode-2")},s={messages:document.querySelector(".sidebar-messages"),tags:document.querySelector(".sidebar-tags")},n={messages:document.querySelector(".messages-all"),tags:document.querySelector(".tags-all")};e.userDown("#idg-js-sidebar-viewmode-1",()=>{t.messages.classList.contains("selected")||(t.messages.classList.add("selected"),t.tags.classList.remove("selected"),e.show(s.messages),e.hide(s.tags),e.show(n.messages),e.hide(n.tags))}),e.userDown("#idg-js-sidebar-viewmode-2",()=>{t.tags.classList.contains("selected")||(t.messages.classList.remove("selected"),t.tags.classList.add("selected"),e.hide(s.messages),e.show(s.tags),e.hide(n.messages),e.show(n.tags))})})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-idg-diagnosis-active-switcher"))return;const t=(t,n)=>{let i=t.querySelector(".js-idg-diagnosis-text"),a=t.querySelector(".toggle-switch"),o=t.querySelector(".remove-circle"),l=t.querySelector(".js-idg-diagnosis-add-btn"),r=t.querySelector(".js-idg-diagnosis-doubt"),c=t.querySelector(".js-idg-diagnosis-doubt-input"),d=t.dataset.idgside,u=t.parentNode.previousElementSibling.querySelector(".oe-eye-lat-icons .oe-i"),p=t.parentNode.nextElementSibling.querySelector(".js-idg-diagnosis-date");switch(n){case"active":e.reshow(i),e.reshow(a),e.reshow(r),e.hide(o),e.hide(l),e.reshow(p),i.textContent="Active (confirmed)",i.classList.remove("fade"),r.querySelector("input").checked=!1,a.querySelector("input").checked=!0,s(u,d,"active");break;case"confirmed":e.hide(c),e.reshow(i);break;case"doubt":e.reshow(c),e.hide(i);break;case"inactive":e.reshow(i),e.reshow(a),e.reshow(o),e.hide(l),e.hide(r),e.hide(c),e.reshow(p),i.textContent="Inactive from",i.classList.add("fade"),s(u,d,"inactive");break;case"removed":e.hide(a),e.hide(o),e.reshow(l),e.hide(p),i.textContent="Not present",s(u,d,"none")}},s=(e,t,s)=>{if(null===e)return;let n=["oe-i"],i="left"==t?"L":"R";switch(s){case"active":n.push("laterality",i);break;case"inactive":n.push("laterality",i+"i");break;case"none":n.push("laterality","NA")}n.push("small","pad"),e.className=n.join(" ")};let n=null;const i=(t,s)=>{let i=t.querySelector(".js-idg-diagnosis-state-options"),a=t.querySelector(".js-idg-right-icon .oe-systemic-icons"),o=t.querySelector(".js-idg-right-icon .oe-eye-lat-icons .oe-i");if(s){i.innerHTML='<span class="oe-eye-lat-icons"><i class="oe-i laterality NA small pad"></i></span>',i.colSpan=0;let s=t.insertCell(2),n=t.insertCell(3);if(s.innerHTML='<div class="flex-layout cols-11 js-idg-diagnosis-active-switcher" data-idgdemo="-r-nSysEx2" data-idgside="right"><div class="js-idg-diagnosis-actions"><label class="toggle-switch" style="display: none;"><input type="checkbox"><div class="toggle-btn"></div></label><label class="inline highlight js-idg-diagnosis-doubt" style="display: none;"><input value="diagnosis-doubt" name="idg-4131" type="checkbox"> <i class="oe-i doubt small-icon js-has-tooltip" data-tt-type="basic" data-tooltip-content="? = doubts; suspected, etc"></i></label><i class="oe-i remove-circle small-icon pad-left" style="display: none;"></i><button class="js-idg-diagnosis-add-btn ">Add right side</button></div><div class="js-idg-diagnosis-state"><input class="js-idg-diagnosis-doubt-input" value="Suspected" placeholder="Suspected" maxlength="32" style="display: none;"><span class="js-idg-diagnosis-text js-active-state fade ">Not present</span></div></div>',n.innerHTML='<div class="js-idg-diagnosis-date"><input type="text" class="date" value="30 Apr 2020"></div>',e.hide(t.cells[5].querySelector(".toggle-switch")),e.hide(t.cells[5].querySelector(".highlight")),null===t.cells[5].querySelector(".js-idg-diagnosis-actions .js-idg-diagnosis-add-btn")){let e=document.createElement("button");e.className="js-idg-diagnosis-add-btn",e.textContent="Add left side",t.cells[5].querySelector(".js-idg-diagnosis-actions").appendChild(e)}else e.reshow(t.cells[5].querySelector(".js-idg-diagnosis-add-btn"));let l=t.cells[5].querySelector(".js-idg-diagnosis-text");l.textContent="Inactive from",l.classList.add("fade"),a.style.display="none",o.style.display="inline-block"}else t.deleteCell(2),t.deleteCell(2),i.innerHTML=n,i.colSpan=3,e.hide(t.cells[3].querySelector(".js-idg-diagnosis-add-btn")),e.reshow(t.cells[3].querySelector(".toggle-switch")),t.cells[3].querySelector(".toggle-switch").checked=!0,e.reshow(t.cells[3].querySelector(".highlight")),i.querySelector("input").checked=!0,a.style.display="inline-block",o.style.display="none"};document.addEventListener("input",s=>{let i=s.target;if(i.matches(".js-idg-diagnosis-active-switcher .toggle-switch input")){let s=e.getParent(i,".js-idg-diagnosis-active-switcher");t(s,i.checked?"active":"inactive")}if(i.matches(".js-idg-diagnosis-doubt input")){let s=e.getParent(i,".js-idg-diagnosis-active-switcher");t(s,i.checked?"doubt":"confirmed")}if(i.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-diagnosis-state-options input")){((t,s)=>{let i=t.querySelector(".js-idg-sides"),a=t.querySelector(".js-idg-diagnosis-text"),o=t.querySelector(".js-idg-diagnosis-active-switcher"),l=o.querySelector(".toggle-switch"),r=o.querySelector(".js-idg-diagnosis-doubt"),c=o.querySelector(".js-idg-diagnosis-doubt-input"),d=t.querySelector(".js-idg-right-icon .oe-systemic-icons");switch(null==n&&(n=t.querySelector(".js-idg-diagnosis-state-options").innerHTML,e.reshow(a)),s){case"0":e.reshow(i),e.reshow(a),a.textContent="Active (confirmed)",a.classList.remove("fade"),e.reshow(l),l.querySelector("input").checked=!0,e.reshow(r),r.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i person-green small pad";break;case"1":e.hide(i),e.reshow(a),a.textContent="Not present",a.classList.add("fade"),e.hide(l),e.reshow(r),r.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad";break;case"2":e.hide(i),e.reshow(a),a.textContent="Not checked",a.classList.add("fade"),e.hide(l),e.hide(r),e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad"}})(e.getParent(i,".js-idg-demo-sys-diag-side-switcher"),i.value)}}),document.addEventListener("click",t=>{let s=t.target;if(s.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-sides")){let t=e.getParent(s,".js-idg-demo-sys-diag-side-switcher"),n=s.querySelector(".oe-i");"no-sides"==s.dataset.state?(i(t,!0),s.dataset.state="sides",n.classList.replace("person","person-split")):(i(t,!1),s.dataset.state="no-sides",n.classList.replace("person-split","person"))}}),document.addEventListener("mousedown",s=>{let n=s.target;var i;if(n.matches(".js-show-diagnosis-history")&&(i=n.dataset.idgdemo,document.querySelectorAll(".js-idg-diagnosis-history-"+i).forEach(e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"})),n.matches(".js-idg-diagnosis-active-switcher .remove-circle")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,"removed")}if(n.matches(".js-idg-diagnosis-add-btn")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,"active")}});e.userDown(".js-idg-demo-remove-oph-diag",t=>{e.xhr("/idg-php/v3/_load/specific/exam-oph-diag-delete.php").then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t.html,s.querySelector(".close-icon-btn").addEventListener("mousedown",t=>{t.stopPropagation(),e.remove(s)},{once:!0}),document.body.appendChild(s)}).catch(e=>console.log("failed to copy",e))})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.dom=document.getElementById("js-clinic-filter");this.btn=this.btn.bind(this),this.filterBtns=this.filterBtns.bind(this)}btn(e,n,i,a){return t(s.FilterBtn,{btn:e,filter:n,isStep:i,count:a,key:s.getKey(),onClick:this.props.onFilterChange,selected:this.props.clinicFilter==n})}filterBtns(){const e=e=>this.props.allAssigned.reduce((t,s)=>s===e?t+1:t,0);let n=[];return n.push(this.btn()),n.push(this.btn()),n=n.concat(s.assignList.map(t=>this.btn(t,t,!0,e(t)))),n.push(this.btn("Unassigned","nobody",!1,e(!1))),n.push(t("li",{className:"update-clinic-btn",key:s.getKey()},t("button",{className:this.props.showAdder?"adder close":"adder open",onClick:this.props.onAdderBtn},null))),n}render(){return ReactDOM.createPortal(this.filterBtns(),this.dom)}}s.Filters=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.setTitle=this.setTitle.bind(this),this.content=this.content.bind(this),this.stepPIN=this.stepPIN.bind(this),this.stepActions=this.stepActions.bind(this),this.stepStatus=this.stepStatus.bind(this)}setTitle(n){const i=s.fullShortCode(n.shortcode),a="next"==n.status?"Next":e.clock24(new Date(n.timestamp));return t("h3",null,`${a} - ${i}`)}content(){return t("div",{className:"popup-overflow"},t("div",{className:"data-group",dangerouslySetInnerHTML:{__html:'<table class="data-table"><tbody><tr><td><span class="oe-eye-lat-icons"><i class="oe-i laterality R small"></i><i class="oe-i laterality L small"></i></span></td><td>No step data being shown for this demo...</td><td>UX Demo</td></tr></tbody></table>'}}))}stepPIN(e){if("active"==e.status)return t("div",{className:"step-pin cols-6 flex"},t("div",{className:"oe-user-pin pin-right-eye"},t("input",{className:"user-pin-entry",type:"text",maxlength:4,inputmode:"numeric",placeholder:"****"})),t("div",{className:"oe-user-pin pin-left-eye"},t("input",{className:"user-pin-entry",type:"text",maxlength:4,inputmode:"numeric",placeholder:"****"})))}stepActions(e){if("active"!=e.status&&"next"!=e.status)return null;const s=(s,n,i)=>t("button",{className:s,onClick:()=>this.props.onChangeStepStatus(e.patientArrRef,e.arrRef,i)},n);return"active"==e.status?t("div",{className:"step-actions"},s("green hint","Complete","done"),s("red hint","Remove","remove")):"next"==e.status?t("div",{className:"step-actions"},s("blue hint","Make active","active"),s("red hint","Remove","remove")):void 0}stepStatus(e){let s="step-status";return"done"==e.status&&(s+=" green"),"active"==e.status&&(s+=" orange"),t("div",{className:s},e.status)}render(){const e=this.props.step;return"~Fields"==e.shortcode?t(s.PopupFields,{step:e,onActions:this.props.onClosePopup}):"~Img"==e.shortcode?t(s.PopupImage,{step:e,onActions:this.props.onClosePopup}):t("div",{className:"oe-pathstep-popup a-t-l",style:{top:e.rect.bottom,left:e.rect.left}},t("div",{className:"close-icon-btn",onClick:this.props.onClosePopup,dangerouslySetInnerHTML:{__html:'<i class="oe-i remove-circle medium"></i>'}}),this.setTitle(e),this.content(e),this.stepPIN(e),this.stepActions(e),this.stepStatus(e))}}s.PathStepPopup=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.state={list:this.props.list,onAdderRequest:this.props.onAdderRequest},this.handleUpdates=this.handleUpdates.bind(this),this.listPatients=this.listPatients.bind(this),this.listAssign=this.listAssign.bind(this),this.listSteps=this.listSteps.bind(this),this.singlePatient=this.singlePatient.bind(this)}shouldComponentUpdate(){return!1}handleUpdates(t){const s=t.target,n=s.dataset.add,i=s.dataset.shortcode,a=s.dataset.step,o=new Set;if(null===this.props.singlePatient){e.nodeArray(document.querySelectorAll(".oe-clinic-adder .patients input")).forEach(e=>{e.checked&&o.add(parseInt(e.dataset.ref,10))})}else o.add(this.props.singlePatient.arrRef);this.state.onAdderRequest({selectedPatients:o,type:n,shortcode:i,stepType:a})}singlePatient(){if(null===this.props.singlePatient)return null;const e=this.props.singlePatient;return t("div",{className:"specific-patient"},`${e.lastname}, ${e.firstname}`)}listPatients(){if(null!==this.props.singlePatient)return null;const n=[],i=[];this.state.list.forEach(a=>{const o=t("li",{key:s.getKey()},t("label",{className:"highlight"},t("input",{type:"checkbox","data-ref":a.arrRef}),t("span",null,e.clock24(new Date(a.booked))+" - "+a.lastname)));"active"===a.status?n.push(o):i.push(o)});const a=(e,s)=>t("div",{className:"row"},t("h4",null,e),t("ul",{className:"row-list"},s));return t("div",{className:"patients"},a("Arrived",n),a("Later",i))}listAssign(){const e=["nobody"].concat(s.assignList).map(e=>t("li",{key:s.getKey(),onClick:this.handleUpdates,"data-shortcode":e,"data-add":"assign"},s.fullShortCode(e)));return t("div",{className:"row"},t("h4",null,"Assign to"),t("ul",{className:"btn-list"},e))}listSteps(){const e=(e,n)=>t("span",{className:"oe-pathstep-btn no-popup "+n,key:s.getKey(),onClick:this.handleUpdates,"data-shortcode":e,"data-add":"step","data-step":n},t("span",{className:"step"},e),t("span",{className:"time invisible"},"00:00")),n=s.assignList.concat(s.clinicPersonList).map(t=>e(t,"person")),i=s.clinicProcessList.map(t=>e(t,"process"));return t("div",{className:"row"},t("h4",null,"Add to pathway"),t("div",{className:"steps"},i),t("div",{className:"steps"},n))}render(){const e=null===this.props.singlePatient?"all-patients":"single-patient";return t("div",{className:"oe-clinic-adder "+e},this.listPatients(),t("div",{className:"update-actions"},this.singlePatient(),this.listAssign(),this.listSteps()),t("div",{className:"big-close-btn",onClick:this.props.onCloseBtn},null))}}s.AdderPopup=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.setTitle=this.setTitle.bind(this),this.content=this.content.bind(this),this.stepActions=this.stepActions.bind(this),this.stepStatus=this.stepStatus.bind(this)}setTitle(n){s.fullShortCode(n.shortcode),"next"==n.status||e.clock24(new Date(n.timestamp));return t("h3",null,"Configure - Visual Fields")}content(){return t("div",{className:"popup-overflow"},t("div",{className:"data-group"},t("table",null,t("tbody",null,t("tr",null,t("th",null,"Eye:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"checkbox",name:"eye"},null),t("i",{className:"oe-i laterality R medium"},null)),t("label",{className:"highlight inline"},t("input",{type:"checkbox",name:"eye"},null),t("i",{className:"oe-i laterality L medium"},null))))),t("tr",null,t("th",null,"Test type:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"radio",name:"fieldtest"},null),t("span",null,"10-2")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"fieldtest"},null),t("span",null,"24-2")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"fieldtest"},null),t("span",null,"30-2"))))),t("tr",null,t("th",null,"Esterman:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"checkbox",name:"fieldtest"},null),t("span",null,"Esterman"))))),t("tr",null,t("th",null,"STA:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"radio",name:"sta"},null),t("span",null,"Standard")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"sta"},null),t("span",null,"Fast")))))))))}stepActions(e){if("active"!=e.status&&"next"!=e.status)return null;const s=(e,s,n)=>t("button",{className:e,onClick:this.props.onActions},s);return"active"==e.status?t("div",{className:"step-actions"},s("green hint","Complete"),s("red hint","Remove")):"next"==e.status?t("div",{className:"step-actions"},s("blue hint","Request Test"),s("red hint","Cancel Test")):void 0}stepStatus(e){let s="step-status";return"done"==e.status&&(s+=" green"),"active"==e.status&&(s+=" orange"),t("div",{className:s},e.status)}render(){const e=this.props.step;return t("div",{className:"oe-pathstep-popup a-t-l",style:{top:e.rect.bottom,left:e.rect.left}},t("div",{className:"close-icon-btn",onClick:this.props.onActions,dangerouslySetInnerHTML:{__html:'<i class="oe-i remove-circle medium"></i>'}}),this.setTitle(e),this.content(e),this.stepActions(e),this.stepStatus(e))}}s.PopupFields=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.setTitle=this.setTitle.bind(this),this.content=this.content.bind(this),this.stepActions=this.stepActions.bind(this),this.stepStatus=this.stepStatus.bind(this)}setTitle(n){s.fullShortCode(n.shortcode),"next"==n.status||e.clock24(new Date(n.timestamp));return t("h3",null,"Configure - Imaging")}content(){return t("div",{className:"popup-overflow"},t("div",{className:"data-group"},t("table",null,t("tbody",null,t("tr",null,t("th",null,"Eye:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"checkbox",name:"eye"},null),t("i",{className:"oe-i laterality R medium"},null)),t("label",{className:"highlight inline"},t("input",{type:"checkbox",name:"eye"},null),t("i",{className:"oe-i laterality L medium"},null))))),t("tr",null,t("th",null,"OCT:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"radio",name:"fieldtest"},null),t("span",null,"Disc")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"fieldtest"},null),t("span",null,"Mac")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"fieldtest"},null),t("span",null,"Mac-Disc"))))),t("tr",null,t("th",null,"Type:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"radio",name:"type"},null),t("span",null,"Zeiss")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"type"},null),t("span",null,"Topcon")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"type"},null),t("span",null,"Spectralis"))))),t("tr",null,t("th",null,"KOWA-Disc:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"checkbox",name:"kowa"},null),t("span",null,"KOWA-Dis"))))),t("tr",null,t("th",null,"Optos:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"radio",name:"sta"},null),t("span",null,"Daytona")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"sta"},null),t("span",null,"Silverstone")))))))))}stepActions(e){if("active"!=e.status&&"next"!=e.status)return null;const s=(e,s,n)=>t("button",{className:e,onClick:this.props.onActions},s);return"active"==e.status?t("div",{className:"step-actions"},s("green hint","Complete"),s("red hint","Remove")):"next"==e.status?t("div",{className:"step-actions"},s("blue hint","Request Test"),s("red hint","Cancel Test")):void 0}stepStatus(e){let s="step-status";return"done"==e.status&&(s+=" green"),"active"==e.status&&(s+=" orange"),t("div",{className:s},e.status)}render(){const e=this.props.step;return t("div",{className:"oe-pathstep-popup a-t-l",style:{top:e.rect.bottom,left:e.rect.left}},t("div",{className:"close-icon-btn",onClick:this.props.onActions,dangerouslySetInnerHTML:{__html:'<i class="oe-i remove-circle medium"></i>'}}),this.setTitle(e),this.content(e),this.stepActions(e),this.stepStatus(e))}}s.PopupImage=n},{once:!0})})(bluejay),(function(e,t){"use strict";bluejay.namespace("clinic").waitDuration=t=>{const s=document.createElement("td");let n=null,i=0,a=null;const o=(e=!1)=>{const t=0==e?Date.now():e;i=Math.floor((t-n)/6e4)},l=()=>{const t=e.div("mins"),s=i>1?"mins":"min";return t.innerHTML=`<span>${i}</span><small>${s}</small>`,t},r=n=>{const a=e.div();return"complete"==n&&(a.className="wait-duration",a.appendChild(l())),"active"==n&&(a.className="wait-duration",a.appendChild((()=>{let e="green";i>14&&(e="yellow"),i>29&&(e="orange"),i>59&&(e="red");const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class","duration-graphic "+e),t.setAttribute("viewBox","0 0 48 12"),t.setAttribute("height",12),t.setAttribute("width",48);for(let e=0;e<4;e++){const s=12*(e+1)-6,n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("class","c"+e),n.setAttribute("cx",""+s),n.setAttribute("cy","6"),n.setAttribute("r","6"),t.appendChild(n)}return t})()),a.appendChild(l())),"todo"==n&&(a.className="flex",a.innerHTML=[`<button class="cols-7 blue hint js-idg-clinic-btn-arrived" data-patient="${t}">Arrived</button>`,`<button class="cols-4 js-idg-clinic-btn-DNA" data-patient="${t}">DNA</button>`].join("")),s.innerHTML="",s.appendChild(a),s};return{arrived:(e,s)=>{null===n&&(n=e,o(),a=setInterval(()=>{o(),r("active"),console.log("waitDuration setInterval running!",t)},15e3))},finished:e=>{clearInterval(a),o(e)},render:r}}})(bluejay),(function(e){"use strict";if(e.addModule("clinicManager"),null===document.getElementById("js-clinic-manager"))return;const t=e.div("oe-popup-wrap");t.innerHTML='<div class="spinner"></div><div class="spinner-message">Loading...</div>',document.body.appendChild(t),setTimeout(()=>n(),500);const s=e.namespace("clinic");s.assignList=["MM","AB","AG","RB","CW"].sort(),s.clinicPersonList=["Nurse"],s.clinicProcessList=["Dilate","VisAcu","Orth","Ref","~Img","~Fields"].sort(),s.fullShortCode=e=>{let t=e;switch(e){case"Arr":t="Arrived";break;case"Fin":t="Finish";break;case"DNA":t="Did Not Attend";break;case"unassigned":t="Not assigned";break;case"MM":t="Mr Michael Morgan";break;case"AB":t="Dr Amit Baum";break;case"AG":t="Dr Angela Glasby";break;case"RB":t="Dr Robin Baum";break;case"CW":t="Dr Coral Woodhouse";break;case"Img":t="Imaging";break;case"VisAcu":t="Visual Acuity";break;case"Orth":t="Orthoptics";break;case"Fields":t="Visual Fields";break;case"Ref":t="Refraction"}return t};const n=()=>{e.log("[Clinic Manager] - intialising");const n=JSON.parse(phpClinicDemoJSON);n.forEach((t,s)=>{t.uid=e.getToken();const n=new Date(Date.now()+6e4*t.booked),i=n.getMinutes()%5;n.setMinutes(n.getMinutes()-i),t.booked=n.getTime(),t.pathway.forEach((e,t,s)=>{const n={shortcode:e[0],timestamp:Date.now()+6e4*e[1],status:e[2],type:e[3]};s[t]=n})}),t.remove();const i=document.createElement("table");i.className="oe-clinic-list",i.innerHTML=Mustache.render(["<thead><tr>{{#th}}<th>{{.}}</th>{{/th}}</tr></thead>","<tbody></tbody>"].join(""),{th:["Appt.","Hospital No.","Speciality","","Name","Pathway","Assigned","","Mins",""]}),document.getElementById("js-clinic-manager").appendChild(i),s.app(document.querySelector("table.oe-clinic-list tbody"),n)}})(bluejay),(function(e,t){"use strict";t.app=(s,n)=>{const i=new Map,a=new Set,o=Object.assign({_filter:"all",get filter(){return this._filter},set filter(e){this._filter=e,this.views.notify()}},e.ModelViews());o.views.add(()=>{const e=new DocumentFragment;i.forEach(t=>{const s=t.render(o.filter);null!=s&&e.appendChild(s)}),s.innerHTML="",s.appendChild(e)}),o.views.add(()=>{const e=[];i.forEach(t=>e.push(t.getAssignment())),a.forEach(t=>t.update(e,o.filter))}),e.userClick(".js-idg-clinic-btn-arrived",e=>{i.get(e.target.dataset.patient).onArrived()}),e.userClick(".js-idg-clinic-btn-DNA",e=>{i.get(e.target.dataset.patient).onDNA()}),e.userDown(".js-idg-clinic-icon-complete",e=>{i.get(e.target.dataset.patient).onComplete()}),e.userDown(".js-idg-clinic-btn-filter",e=>{o.filter=e.target.dataset.filter}),(()=>{n.forEach(e=>i.set(e.uid,t.patient(e)));const e=document.getElementById("js-clinic-filter");[["Show all","all"],["Hide completed","completed"],["MM","MM"],["Not assigned","unassigned"]].forEach(s=>{a.add(t.filterBtn({name:s[0],filter:s[1]},e))});const s=document.createElement("li");s.className="update-clinic-btn",s.innerHTML='<button class="adder open"></button>',e.appendChild(s),o.filter="all",t.clock()})()}})(bluejay,bluejay.namespace("clinic")),(function(e,t){"use strict";bluejay.namespace("clinic").clock=()=>{const t=e.div("oe-clinic-clock");t.textContent="",t.style.top="100%",document.body.appendChild(t);setInterval(()=>{const s=e.nodeArray(document.querySelectorAll("table.oe-clinic-list tbody tr"));if(!s.length)return void(t.style.top="100%");const n=Date.now();let i="100%";s.every(e=>!(e.dataset.timestamp>n)||(i=e.getBoundingClientRect().top-4+"px",!1)),t.style.top=i,t.textContent=e.clock24(new Date(n))},1e3)}})(bluejay),(function(e,t){"use strict";t.filterBtn=(s,n)=>{const i=s.filter,a=document.createElement("li"),o=e.div("count");a.className="filter-btn js-idg-clinic-btn-filter",a.setAttribute("data-filter",i),(()=>{const l=s.name,r=t.fullShortCode(l)!=l&&t.fullShortCode(l),c=e.div("filter");let d=`<div class="name">${l}</div>`;r&&(d+=`<div class="fullname">${r}</div>`),c.innerHTML=d,"all"!==i&&"completed"!==i&&c.appendChild(o),a.appendChild(c),n.appendChild(a)})();return{update:(e,t)=>{const s=e.reduce((e,t)=>t==i?e+1:e,0);o.textContent=s,t===i?a.classList.add("selected"):a.classList.remove("selected")}}}})(bluejay,bluejay.namespace("clinic")),(function(e,t,s){"use strict";t.patient=n=>{const i=Object.assign({_uid:n.uid,_status:null,_assigned:!1,get status(){return this._status},set status(e){this._status=e,this.views.notify()},get assigned(){return this._assigned},set assigned(e){this._assigned=e,this.views.notify()}},e.ModelViews()),a=document.createElement("tr"),o={pathway:e.div("pathway"),assigned:document.createElement("td"),addIcon:document.createElement("td"),complete:document.createElement("td")},l=t.waitDuration(n.uid);i.views.add(()=>{a.className=i.status,o.pathway.className="pathway "+i.status,o.addIcon.innerHTML="complete"==i.status?"":`<i class="oe-i plus-circle small pad js-idg-clinic-icon-add" data-patient="${i._uid}"></i>`,l.render(i.status)}),i.views.add(()=>{const e=t.fullShortCode(i.assigned);"unassigned"==i.assigned?o.assigned.innerHTML=`<small class="fade">${e}</small>`:o.assigned.innerHTML=`<div>${e}</div>`}),i.views.add(()=>{o.complete.innerHTML="","complete"==i.status&&(o.complete.innerHTML='<span class="fade">Done</span>'),"active"==i.status&&(o.complete.innerHTML=`<i class="oe-i save medium-icon pad js-has-tooltip js-idg-clinic-icon-complete" data-tt-type="basic" data-tooltip-content="Patient pathway finished" data-patient="${i._uid}"></i>`)});const r=e=>{"arrive"==e.type&&l.arrived(e.timestamp,i.status),"finish"==e.type&&l.finished(e.timestamp),s.pathStep(e,o.pathway,"arrive"==e.type)};(()=>{i.status=n.status,i.assigned=n.assigned,n.pathway.forEach(e=>r(e)),n.time=e.clock24(new Date(n.booked)),a.setAttribute("data-timestamp",n.booked),a.innerHTML=Mustache.render(["<td>{{time}}</td>","<td>{{num}}</td>",'<td><div class="speciality">{{speciality}}</div><small class="type">{{specialityState}}</small></td>'].join(""),n);const s=document.createElement("td");a.appendChild(t.patientQuickView(n)),a.appendChild(t.patientMeta(n)),a.appendChild(s.appendChild(o.pathway)),a.appendChild(o.assigned),a.appendChild(o.addIcon),a.appendChild(l.render(n.status)),a.appendChild(o.complete)})();return{onArrived:()=>{r({shortcode:"Arr",timestamp:Date.now(),status:"done",type:"arrive"}),i.status="active"},onDNA:()=>{r({shortcode:"DNA",timestamp:Date.now(),status:"done",type:"DNA"}),i.status="complete"},onComplete:()=>{r({shortcode:"Fin",timestamp:Date.now(),status:"done",type:"finish"}),i.status="complete"},render:e=>"completed"==e&&"complete"==i.status||"all"!==e&&"completed"!==e&&i.assigned!==e?null:a,getAssignment:()=>i.assigned}}})(bluejay,bluejay.namespace("clinic"),bluejay.namespace("gui")),(function(e,t){"use strict";bluejay.namespace("clinic").patientMeta=e=>{const t=['<div class="oe-patient-meta">','<div class="patient-name">','<span class="patient-surname">{{lastname}}</span>, ','<span class="patient-firstname">{{firstname}}</span>',"</div>",'<div class="patient-details">','<div class="nhs-number"><span>NHS</span>{{nhs}}</div>','<div class="patient-gender"><span>Gen</span>{{gender}}</div>','<div class="patient-age"><span>Age</span>{{age}}</div>',"</div>","</div>"].join(""),s=document.createElement("td");return s.innerHTML=Mustache.render(t,e),s}})(),(function(e,t){"use strict";bluejay.namespace("clinic").patientQuickView=e=>{const t=document.createElement("i");t.className="oe-i eye-circle medium pad js-patient-quick-overview",t.setAttribute("data-mode","side"),t.setAttribute("data-php","patient/quick/overview.php"),t.setAttribute("data-patient",JSON.stringify({surname:e.lastname,first:e.firstname,id:!1,nhs:e.nhs,gender:e.gender,age:e.age}));const s=document.createElement("td");return s.appendChild(t),s}})(),(function(e){"use strict";e.addModule("GUI-btnShowContent");const t="active",s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),e.show(this.content,"block"))}}),n=()=>({hide:function(){this.open&&(this.open=!1,this.btn.classList.remove(t),e.hide(this.content))}}),i=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),n());[{btn:"#js-nav-shortcuts-btn",wrapper:"#js-nav-shortcuts",contentID:"js-nav-shortcuts-subnav"},{btn:"#js-nav-patientgroups-btn",wrapper:"#js-patientgroups-panel-wrapper",contentID:"js-patientgroups-panel"},{btn:"#js-header-print-dropdown-btn",wrapper:"#js-header-print-dropdown",contentID:"js-header-print-subnav"},{btn:"#js-sidebar-filter-btn",wrapper:"#js-sidebar-filter",contentID:"js-sidebar-filter-options"}].forEach(t=>{const s=document.querySelector(t.btn);if(null!==s){const n=i({btn:s,content:document.getElementById(t.contentID),open:!1});e.userDown(t.btn,()=>n.change()),e.userEnter(t.btn,()=>n.show()),e.userLeave(t.wrapper,()=>n.hide())}})})(bluejay),(function(e,t){"use strict";e.addModule("gui.pathStep");t.pathStep=(t,s,n=!1)=>{const i=["oe-pathstep-btn","no-popup"];"done"===t.status&&i.push("green"),"active"===t.status&&i.push("orange");const a="next"==t.status?"time invisible":"time",o=e.clock24(new Date(t.timestamp)),l=document.createElement("span");l.className=i.join(" "),l.innerHTML=`<span class="step">${t.shortcode}</span><span class="${a}">${o}</span>`,n?s.prepend(l):s.appendChild(l)}})(bluejay,bluejay.namespace("gui")),(function(e){"use strict";e.addModule("addSelect");const t=e.namespace("addSelect");t.all=[],t.closeAll=function(){this.all.forEach(e=>e.close())},t.init=function(){const s=e.nodeArray(document.querySelectorAll(".js-add-select-btn"));s.length<1||s.forEach(e=>{let s=new t.Popup(e);this.all.push(s)})},document.addEventListener("DOMContentLoaded",()=>t.init(),{once:!0})})(bluejay),(function(e){"use strict";const t=bluejay.namespace("addSelect");t.ListOption=function(e,s){let n=e.classList.contains("selected"),i=!1,a=JSON.parse(e.dataset.insert);void 0!==a.dependents&&(i=new t.OptionDependents(a.dependents,s.uniqueId)),this.click=function(){this.toggleState(),s.optionClicked(n,this),0!=i&&i.show(n)},this.toggleState=function(){e.classList.toggle("selected"),n=!n},this.deselect=function(){n&&this.toggleState()},Object.defineProperty(this,"selected",{get:()=>n,set:t=>{n=t,t||e.classList.remove("selected")}}),Object.defineProperty(this,"dependents",{get:()=>!1!==i}),Object.defineProperty(this,"value",{get:()=>a.value}),e.addEventListener("mousedown",this.click.bind(this))}})(),(function(e){"use strict";e.namespace("addSelect").OptionDependents=function(t,s){if(void 0===t)return!1;const n="#add-to-"+s+"-";let i=[];t.split(",").forEach(e=>{let t=e.split("."),s={};if(0===t[0]&&console.log("Error: OptionDependents, listGroup = 0 !!",n+"listgroup"+t[0]),s.div=document.querySelector(n+"listgroup"+t[0]),null===s.div&&console.log("obj.div = null!",n+"listgroup"+t[0]),s.holder=s.div.querySelector(".optional-placeholder"),null===s.holder&&console.log("Adder: no placeholder text for optional group"),0==t[1])s.showDefaultText=!0;else{s.showDefaultText=!1,s.lists=[];for(let e=1;e<t.length;e++){let i=document.querySelector(n+"list"+t[e]);null===i?console.log("Err: OptionDependents, list? ",n+"list"+t[e]):s.lists.push(i)}}i.push(s)}),this.show=function(e){e?this.myLists():this.reset()},this.hideAllOptionalLists=function(t){e.nodeArray(t.querySelectorAll(".optional-list")).forEach(t=>{e.hide(t)})},this.myLists=function(){i.forEach(t=>{this.hideAllOptionalLists(t.div),t.showDefaultText?t.holder&&e.show(t.holder,"block"):(t.holder&&e.hide(t.holder),t.lists.forEach(t=>{e.show(t,"block")}))})},this.reset=function(){i.forEach(t=>{this.hideAllOptionalLists(t.div),t.holder&&e.show(t.holder,"block")})}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.OptionsList=function(s){let n=JSON.parse(s.dataset.options);const i="inputTemplate"==n.type,a="single"==n.type,o=(n.hasExtraOptions,"true"===n.isOptionalList);this.uniqueId=s.dataset.id,o&&e.hide(s.parentNode);let l=[],r=[];e.nodeArray(s.querySelectorAll("li")).forEach(e=>{let s=new t.ListOption(e,this);l.push(s),s.selected&&s.dependents&&r.push(s)}),this.optionClicked=function(e,t){if(i){let e=s.previousElementSibling,n=t.value,i=n.indexOf("{"),a=n.indexOf("}")+1;return e.value=n,t.deselect(),void setTimeout(()=>{e.focus(),e.select(),e.setSelectionRange(i,a)},50)}e&&a&&l.forEach(e=>{e!==t&&e.deselect()})},this.checkForDefaultSelections=()=>{r.length&&r.forEach(e=>{e.selected=!1,e.click()})}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.Popup=function(s){let n=document.querySelector("#"+s.dataset.popup);if(null==n)return;let i=[];this.anchorLeft=!!n.dataset.anchorLeft,this.btn=s,this.popup=n,this.closeBtn=n.querySelector(".close-icon-btn"),this.open=function(){this.position(),t.closeAll(),e.show(n,"block"),this.closeBtn.addEventListener("mousedown",this.close.bind(this))},this.close=function(){n.style.display="none"},this.reset=function(){},e.nodeArray(n.querySelectorAll(".add-options")).forEach(e=>{let s=new t.OptionsList(e);s.checkForDefaultSelections(),i.push(s)}),this.btn.addEventListener("mousedown",this.open.bind(this))},t.Popup.prototype.position=function(){let e=this.btn.getBoundingClientRect(),t=window.innerWidth,s=window.innerHeight,n=s-e.bottom;if(s-n<325&&(n=s-325),this.anchorLeft)this.popup.style.left=e.left+"px";else{let s=e.right-this.popup.getBoundingClientRect().width,n=s<0?s-25:0;this.popup.style.right=t-e.right+n+"px"}this.popup.style.bottom=n+"px"}})(bluejay),(function(e){"use strict";Object.preventExtensions(e),e.ready()})(bluejay);