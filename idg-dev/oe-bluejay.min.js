Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";const e={};return console.time("[bluejay] Ready"),console.time("[bluejay] DOM Loaded"),e.extend=(t,s)=>{if("function"!=typeof s)throw new TypeError("[bluejay] [app.js] - only extend with a function: "+t);if(s._bj||t in e)throw new TypeError("[bluejay] [app.js] - already extended with: "+t);e[t]=s,s._bj=!0},e.log=e=>{console.log("[bluejay] "+e)},e.ready=()=>{console.timeEnd("[bluejay] Ready")},e.log("OE JS UI layer [bluejay] ..."),e.log("DEBUG MODE"),e.log("Mustache version: "+Mustache.version),document.addEventListener("DOMContentLoaded",()=>{e.log("[Modules] - "+e.registeredModules()),console.timeEnd("[bluejay] DOM Loaded")},{once:!0}),e})();!(function(e){"use strict";const t=(function*(){let e=10;for(;;)yield++e})(),s=()=>t.next().value;function n(){this.map=new Map,this.dataAttr="data-oebjk"}e.extend("getKey",s),n.prototype.add=function(e,t){const n=s();return this.map.set(n,e),t.setAttribute(this.dataAttr,n),n},n.prototype.getKey=function(e){let t=e.getAttribute(this.dataAttr);return null!==t&&""!=t&&t},n.prototype.get=function(e){return"string"==typeof e&&(e=parseInt(e,10)),this.map.get(e)},n.prototype.getFirst=function(){return this.map.values().next().value},n.prototype.next=function(e){const t=this.map.keys();let s=t.next();for(;!s.done;){if(s.value===e)return t.next().value;s=t.next()}},n.prototype.prev=function(e){const t=this.map.keys();let s=!1;for(const n of t){if(n===e)return s;s=n}},n.prototype.has=function(e){return this.map.has(e)},e.extend("Collection",n)})(bluejay),(function(e){"use strict";bluejay.extend("customEvent",(e,t)=>{const s=new CustomEvent(e,{detail:t});document.dispatchEvent(s)})})(),(function(e){"use strict";new URL(window.location).hostname;const t=new Map,s=new Map,n=new Map,a=new Set,i=(e,t,s)=>{if(e.has(t))throw new TypeError("Event Delegation: selector already added : "+t);e.set(t,s)},o=(e,t)=>{const s=e.target;if(s===document)return!1;t.forEach((t,n)=>{s.matches(n)&&t(e)})},l=(()=>{let e=0;return{delay:()=>{clearTimeout(e),e=setTimeout(()=>{a.forEach(e=>{e()})},150)}}})();function r(e){o(e,s)}function c(e){o(e,t)}function d(e){o(e,n)}window.onresize=()=>l.delay();let u=e=>{document.removeEventListener("mouseenter",r,{capture:!0}),document.removeEventListener("mousedown",c,{capture:!0}),document.removeEventListener("mouseleave",d,{capture:!0}),o(e,t),u=e=>{o(e,t)}};document.addEventListener("mouseenter",r,{capture:!0}),document.addEventListener("mousedown",c,{capture:!0}),document.addEventListener("mouseleave",d,{capture:!0}),document.addEventListener("touchstart",e=>u(e),{capture:!0}),e.extend("userEnter",(e,t)=>i(s,e,t)),e.extend("userDown",(e,s)=>i(t,e,s)),e.extend("userLeave",(e,t)=>i(n,e,t)),e.extend("listenForResize",e=>a.add(e))})(bluejay),(function(e){"use strict";const t=e=>{e.parentNode.removeChild(e)};e.extend("nodeArray",e=>Array.prototype.slice.call(e)),e.extend("find",(e,t)=>(t||document).querySelector(e)),e.extend("getParent",(e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1}),e.extend("wrap",(e,t="")=>{const s=document.createElement("div"),n=window.getComputedStyle(e);return s.style.width=n.getPropertyValue("width"),s.style.position="relative",s.style.display="inline-block",e.style.width="100%",e.parentNode.insertBefore(s,e),s.appendChild(e),s}),e.extend("unwrap",e=>{const s=e.parentNode,n=s.parentNode;e.style.width="",n.insertBefore(e,s),t(s)}),e.extend("div",e=>{const t=document.createElement("div");return t.className=e,t}),e.extend("remove",t),e.extend("show",(e,t="")=>{null!==e&&(e.style.display=t)}),e.extend("reshow",e=>{null!==e&&(e.style.display="")}),e.extend("hide",e=>{null!==e&&(e.style.display="none")}),e.extend("xhr",t=>(e.log("[XHR] - "+t),new Promise((s,n)=>{let a=new XMLHttpRequest;a.open("GET",t),a.onreadystatechange=function(){4===a.readyState&&(a.status>=200&&a.status<300?(e.log("[XHR] - Success"),s(a.responseText)):(e.log("[XHR] - Failed"),n(this.status+" "+this.statusText)))},a.send()}))),e.extend("loadJS",(t,s=!1)=>(e.log("[JS script] - "+t),new Promise((n,a)=>{const i=document.createElement("script");i.src=t,s&&i.setAttribute("crossorigin",""),i.onload=()=>{setTimeout(()=>{e.log("[JS loaded] - "+t),n()},100)},i.onerror=()=>e.log("[JS ERROR ] - "+t),document.head.appendChild(i)}))),e.extend("getHiddenElemSize",e=>{e.style.visibility="hidden",e.style.display="";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="",e.style.display="none",t}),e.extend("idgReporter",e=>{let t="idg-js-ui-message-out",s=document.getElementById(t),n=document.createElement("li");null===s&&(s=document.createElement("ul"),s.id=t,s.style="position:fixed; bottom:10px; right:10px; z-index:9999; background:orange; padding:10px; list-style-position:inside; max-height:vh90; overflow-y: scroll; font-size:14px;",document.body.appendChild(s));let a=s.children.length;n.appendChild(document.createTextNode(a+" - "+e)),s.appendChild(n)}),e.extend("clock24",e=>e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0"))})(bluejay),(function(e){"use strict";const t=[],s=new Map;e.extend("addModule",e=>t.push(e)),e.extend("registeredModules",()=>(t.sort(),t.join(", "))),e.extend("namespace",e=>(s.has(e)||s.set(e,{}),s.get(e)))})(bluejay),(function(e){"use strict";const t=()=>({list:new Set,add(e){return this.list.add(e),this.list.has(e)},remove(e){this.list.remove(e)},size(){return this.list.size},notify(){let e=this.list.values();for(let t of e)t()}});bluejay.extend("ModelViews",()=>({views:Object.create(t())}))})(),(function(e){"use strict";let t=window.innerWidth,s=window.innerHeight;e.listenForResize(()=>{t=window.innerWidth,s=window.innerHeight});const n=(e=!1)=>"data-"+(e?"bluejay-"+e:"bluejay");e.extend("settings",t=>{switch(t){case"cssHeaderHeight":return 60;case"cssExtended":return 1440;case"cssHotlistFixed":return 1890;case"idgPHPLoadURL":return"/idg-php/v3/_load/";default:return e.log("Setting request not recognised: "+t),null}}),e.extend("getWinH",()=>s),e.extend("getWinW",()=>t),e.extend("getDataAttributeName",n),e.extend("setDataAttr",(e,t)=>{e.setAttribute(n(),t)}),e.extend("getDataAttr",e=>{const t=n();return!!e.hasAttribute(t)&&e.getAttribute(t)})})(bluejay);const oePlotly=(function(e){"use strict";e.log("Plot.ly version: "+Plotly.version),e.log("oePlotly - Plot.ly builder available");const t={blue:"#63d7d6",highlight:"#fff",green:"#65d235",red:"#ea2b34",greenSeries:["#65d235","#A5D712","#02B546"],redSeries:["#ea2b34","#F64A2D","#C92845"],yellowSeries:["#FAD94B","#E8B131","#F1F555"],standard:["#1451b3","#175ece","#1a69e5"],varied:["#0a83ea","#18949f","#781cea","#3f0aea"],dual:["#1472DE","#2E4259"]},s={blue:"#00f",highlight:"#000",green:"#418c20",red:"#da3e43",greenSeries:["#418c20","#598617","#139149"],redSeries:["#da3e43","#E64C02","#E64562"],yellowSeries:["#FCCE14","#E69812","#FCBB21"],standard:["#0a4198","#1451b3","#175ece"],varied:["#0a2aea","#ea0a8e","#00b827","#890aea"],dual:["#2126C2","#8FAEC2"]},n=(e,n)=>{switch(e){case"highlight":return n?t.highlight:s.highlight;case"rightEye":return n?t.green:s.green;case"leftEye":return n?t.red:s.red;default:return"pink"}};return{isDarkTheme:()=>"dark"===window.oeThemeMode,getBlue:e=>e?t.blue:s.blue,getColorSeries:(e,n)=>{let a=null;const i=t,o=s;switch(e){case"varied":a=n?i.varied:o.varied;break;case"posNeg":a=n?i.dual:o.dual;break;case"rightEyeSeries":a=n?i.greenSeries:o.greenSeries;break;case"leftEyeSeries":a=n?i.redSeries:o.redSeries;break;case"BEOSeries":a=n?i.yellowSeries:o.yellowSeries;break;default:a=n?i.standard:o.standard}return a},getColor:n,getColorFor:(e,t)=>n(e,t)}})(bluejay);!(function(e){"use strict";e.findRegression=function(e,t){let s=0,n=0,a=0,i=0,o=0,l=0,r=0,c=e.length;if(c!=t.length)throw new Error("The parameters values_x and values_y need to have same size!");if(0===c)return[[],[]];for(let d=0;d<c;d++)l=e[d],r=t[d],s+=l,n+=r,i+=l*l,a+=l*r,o++;const d=(o*a-s*n)/(o*i-s*s),u=n/o-d*s/o;let p=[],h=[];for(let t=0;t<c;t++)l=e[t],r=l*d+u,p.push(parseFloat(Number.parseFloat(l).toFixed(2))),h.push(parseFloat(Number.parseFloat(r).toFixed(2)));return{x:p,y:h}}})(oePlotly),(function(e){"use strict";e.getAxis=function(e,t){let s={linecolor:t?"#666":"#999",linewidth:1,showgrid:!0,gridcolor:t?"#292929":"#e6e6e6",tickmode:"auto",nticks:20,ticks:"outside",ticklen:3,tickcolor:t?"#666":"#ccc",automargin:!0,mirror:!0,connectgaps:!1};const n="y"==e.type;if(e.noMirrorLines&&(s.mirror=!1),e.domain&&n&&(s.domain=e.domain),e.title&&(s.title={text:e.title,standoff:n?10:20,font:{size:12}}),e.rightSide&&n&&(s.overlaying=e.rightSide,s.side="right",s.showgrid=!1,s.zeroline=!1,s.title.standoff=15),e.numTicks&&(s.nticks=e.numTicks),e.useDates&&(s.tickformat="%b %Y"),e.fixRange&&(s.fixedrange=!0),e.range&&(s.range=e.range),e.axisType&&(s.type=e.axisType),e.useCategories){let t=e.useCategories.categoryarray;s.type="category",s.categoryarray=[" "].concat(t),e.useCategories.showAll&&(s.range=[0,t.length+1])}return e.spikes&&(s.showspikes=!0,s.spikecolor=t?"#0ff":"#00f",s.spikethickness=t?.5:1,s.spikedash=t?"1px,3px":"2px,3px"),s}})(oePlotly),(function(e){"use strict";e.getLayout=function(t){const s=t.darkTheme;let n={isDark:s,hovermode:"closest",autosize:!0,margin:{l:50,r:50,t:30,b:40,pad:4,autoexpand:!0},paper_bgcolor:s?"rgba(30,46,66,0.5)":"rgba(255,255,255,0.5)",plot_bgcolor:s?"rgb(10,10,30)":"#fff",font:{family:"Roboto, 'Open Sans', verdana, arial, sans-serif",size:11,color:s?"#aaa":"#333"},hoverlabel:{bgcolor:s?"#003":"#fff",bordercolor:s?"#003":"#00f",font:{size:11,color:e.getBlue(s)}}};if(t.colors?n.colorway=e.getColorSeries(t.colors,s):n.colorway=e.getColorSeries("default",s),t.plotTitle&&(n.title={text:t.plotTitle,xref:"paper",yref:"container",x:0,y:1,yanchor:"top",pad:{t:20},font:{size:15}},n.margin.t=50),t.legend){n.showlegend=!0;const e={font:{size:9},itemclick:"toggleothers",orientation:"h",xanchor:"right",yanchor:"bottom",x:1,y:1};"boolean"==typeof t.legend?n.legend=e:n.legend=Object.assign(e,t.legend)}else n.showlegend=!1;if(t.subplot&&(n.grid={rows:t.subplot,columns:1,pattern:"independent"}),n.shapes=[],n.annotations=[],t.vLineLabel){const a=t.vLineLabel.x,i=t.vLineLabel.h,o=(t,n)=>({type:"line",layer:"above",yref:"paper",x0:t.x,y0:0,x1:t.x,y1:i,line:{color:e.getBlue(s),width:.5}}),l=(t,n)=>({showarrow:!1,text:t.name,textangle:90,align:"left",font:{color:e.getBlue(s)},borderpad:2,x:t.x,xshift:8,yref:"paper",y:i});n.shapes=n.shapes.concat(a.map(o)),n.annotations=n.annotations.concat(a.map(l))}if(t.hLineLabel){const a=t.hLineLabel.y,i=t.hLineLabel.axis,o=(t,n)=>({type:"line",layer:"below",xref:"paper",yref:i,x0:0,y0:t.y,x1:1,y1:t.y,line:{color:e.getBlue(s),width:2,dash:"3px,12px"}}),l=(t,n)=>({showarrow:!1,text:t.name,align:"left",font:{color:e.getBlue(s)},borderpad:2,xref:"paper",x:0,yshift:8,yref:i,y:t.y});n.shapes=n.shapes.concat(a.map(o)),n.annotations=n.annotations.concat(a.map(l))}if(t.xaxis&&(n.xaxis=t.xaxis,n.xaxis.title&&(n.margin.b=80)),t.yaxes&&t.yaxes.forEach((e,t)=>{t?n["yaxis"+(t+1)]=e:n.yaxis=e,e.title&&("right"==e.side?n.margin.r=80:n.margin.l=80)}),t.rangeSlider){const e={thickness:.08};s&&(e.bgcolor=n.paper_bgcolor,e.borderwidth=1,e.bordercolor=n.plot_bgcolor),"boolean"!=typeof t.rangeSlider&&(e.range=t.rangeSlider),n.xaxis.rangeslider=e,n.margin.b=15}return t.dateRangeButtons&&(n.xaxis.rangeselector=Object.assign({x:1,xanchor:"right",buttons:[{label:"Show all",step:"all"},{label:"2 Yr",step:"year",count:2},{label:"1 Yr",step:"year",count:1},{label:"6 Mth",step:"month",count:6}]},e.buttonStyling(s))),n}})(oePlotly),(function(e,t){"use strict";e.buildDiv=(e,t,s,n=!1)=>{const a=document.createElement("div");let i=e.toLowerCase();return i=i.trim(),i=i.replace(" ","-"),a.id="oePlotly-"+i,a.style.height=t,a.style.minHeight=s,n&&(a.style.width=n),a},e.fullDateRange=()=>({all:[],add(e){this.all=this.all.concat(e),this.all.sort()},firstLast(){let e=this.all.filter(e=>null!==e);return[e[0],e.pop()]}}),e.addClickEvent=(e,s)=>{e.on("plotly_click",(function(e){const n=e.points[0];let a={eye:s,name:n.data.name,index:n.pointIndex,x:n.x,y:n.y};t.customEvent("oePlotlyClick",a),t.log('"oePlotlyClick" Event data: '+JSON.stringify(a))}))},e.addHoverEvent=(e,s)=>{t.log('"oePlotlyHover" ('+s+") Event available (click point to see data structure)"),e.on("plotly_hover",(function(e){const n=e.points[0];let a={eye:s,name:n.data.name,index:n.pointIndex,x:n.x,y:n.y};t.customEvent("oePlotlyHover",a)}))},e.dataLine=t=>{let s={};return t.color&&(s.color=t.color),t.dashed&&(s=Object.assign(s,e.dashedLine())),s},e.dashedLine=()=>({dash:"2px,2px",width:2}),e.markerFor=e=>{const t={};switch(e){case"image":t.symbol="triangle-down",t.size=10;break;case"drug":t.symbol="diamond",t.size=8;break;case"injection":t.symbol="star-diamond",t.size=9}return t},e.eventStyle=(t,s=!1)=>{const n={marker:e.markerFor(t)};switch(t){case"image":n.mode="markers";break;case"drug":n.mode="lines+markers",n.line={width:3};break;case"injection":n.mode="markers"}return s&&(n.marker&&(n.marker.color=s),n.line&&(n.line.color=s)),n},e.buttonStyling=e=>({font:{color:e?"#ccc":"#666"},bgcolor:e?"rgb(30,46,66)":"rgb(255,255,255)",activecolor:e?"rgb(7,69,152)":"rgb(205,205,255)",bordercolor:e?"rgb(10,26,36))":"rgb(255,255,255)",borderwidth:2}),e.addDropDown=t=>{let s=[];s.push({method:"update",args:["visible",[!0,!1,!1,!1]],label:"Option 1"}),s.push({method:"update",args:[{},{title:"some new title",colorway:e.getColorSeries("default",!0)}],label:"Options Title"});let n=Object.assign({type:"dropdown",xanchor:"left",yanchor:"top",x:0,y:.35,buttons:s},e.buttonStyling());t.updatemenus=[n]}})(oePlotly,bluejay),(function(e){"use strict";e.highlighPoint=(t,s)=>(n,a)=>{let i=n.split(".");if(2!=i.length)return void bj.log('oePlotly - for highlightPoint to work it needs EyeSide & Date JSON name e.g. "leftEye.OCT" ');let o,l,r=i[0],c=i[1],d=0;t.get(r).get("data").forEach((e,t)=>{t===c&&(o=e,l=d),d++});let u=e.getColor(r,s),p=[];for(let e=0;e<o.x.length;e++)p.push(u);p[a]=e.getColor("highlight",s);let h=e.markerFor(o.oeEventType);h.color=p,Plotly.restyle(t.get(r).get("div"),{marker:h},[l])}})(oePlotly),(function(e){"use strict";e.selectableUnits=()=>{const t=new Map,s=[];let n,a=0;const i=e=>{a=e.target.selectedIndex;for(const e of t.keys())n(e)};return{init:t=>{n=t.plotlyUpdate;const o=t.darkTheme,l=t.axisDefaults,r=l.title,c=[];t.unitRanges.forEach((t,n)=>{let i;t.makeDefault&&(a=n),c.push(t.option),l.title=`${r} - ${t.option}`,i="number"==typeof t.range[0]?Object.assign({},l,{range:t.range.reverse(),axisType:"linear"}):Object.assign({},l,{useCategories:{showAll:!0,categoryarray:t.range.reverse()}}),s.push(e.getAxis(i,o))}),(e=>{const t=["VA Scale ","<select>","{{#options}}","<option>{{.}}</option>","{{/options}}","</select>"].join(""),s=document.createElement("div");s.className="oesplotly-options",s.innerHTML=Mustache.render(t,{options:e}),s.style.position="absolute",s.style.top="1px",s.style.left="50%",s.style.transform="translateX( -50% )",s.style.zIndex=1;const n=document.querySelector(".oes-v2");n.style.position="relative",n.appendChild(s);let o=s.querySelector("select");o.options[a].selected=!0,o.addEventListener("change",i,!1)})(c)},addTrace:(e,s)=>{t.has(e)?t.get(e).push(s):t.set(e,[s])},selectedTrace:e=>t.get(e)[a],selectedAxis:()=>s[a]}}})(oePlotly),(function(e){"use strict";const t=!0,s=new Map,n=(e,t,n)=>{const a=(()=>{let e=0;return()=>{let t=e++;return e>=n.length&&(e=0),n[t]}})();s.get(t).set("data",new Map);const i={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:a()})};s.get(t).get("data").set(e.VA.offScale.name,i);const o={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:a(),dashed:!0})};s.get(t).get("data").set(e.CRT.name,o);const l={x:e.VA.units.x,y:e.VA.units.y,name:e.VA.units.name,yaxis:"y3",hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:a()})};s.get(t).get("data").set("VA",l)},a=e=>{const n=oePlotly.getLayout({darkTheme:t,legend:{yanchor:"top",y:1},xaxis:e.x,yaxes:e.y,subplot:2}),a=oePlotly.buildDiv("Patient Popup","415px","415px","1020px");document.getElementById("patient-popup-oeplolty").appendChild(a),s.set("div",a),s.set("layout",n),(()=>{let e=[];["rightEye","leftEye"].forEach(t=>{if(s.has(t)){let n=s.get(t).get("data");e=e.concat(Array.from(n.values()))}}),Plotly.react(s.get("div"),e,s.get("layout"),{displayModeBar:!1,responsive:!0})})(),oePlotly.addClickEvent(a,"?"),oePlotly.addHoverEvent(a,"?"),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(a,n)})};e.extend("plotPatientPopup",(i=null)=>{if(null===i)return e.log("[oePlotly] - no JSON data provided for Plot.ly Patient Popup ??"),!1;e.log("[oePlotly] - building Plot.ly Patient Popup");const o=[[0,.15],[.2,1]];i.rightEye&&(s.set("rightEye",new Map),n(i.rightEye,"rightEye",oePlotly.getColorSeries("rightEyeSeries",t))),i.leftEye&&(s.set("leftEye",new Map),n(i.leftEye,"leftEye",oePlotly.getColorSeries("leftEyeSeries",t)));const l=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,noMirrorLines:!0},t),r=oePlotly.getAxis({type:"y",domain:o[0],useCategories:{showAll:!0,categoryarray:i.yaxis.offScale.reverse()},spikes:!0},t),c=oePlotly.getAxis({type:"y",domain:o[1],title:"CRT",range:[200,650],spikes:!0},t),d=oePlotly.getAxis({type:"y",domain:o[1],title:"VA",rightSide:"y2",useCategories:{showAll:!0,categoryarray:i.yaxis.unitRanges.snellenMetre.range.reverse()},spikes:!0},t);a({x:l,y:[r,c,d]})})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme();e.extend("plotBarChart",(s=null)=>{if(null===s)return e.log("[oePlotly] - no JSON data provided for Plot.ly Bar Chart ??"),!1;e.log("[oePlotly] - building Plot.ly Bar Chart");const n=(e=>{const t={y:e.data.y,name:e.data.name,type:"bar"};return e.data.x&&(t.x=e.data.x),e.data.hovertemplate&&(t.hovertemplate=e.data.hovertemplate),[t]})(s),a=oePlotly.getAxis({type:"x",numTicks:20},t),i=oePlotly.getAxis({type:"y",numTicks:20},t);s.title.xaxis&&(a.title=s.title.xaxis),s.title.yaxis&&(i.title=s.title.yaxis),console.log(s),(e=>{const s=oePlotly.getLayout({darkTheme:t,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes});s.barmode="stack",Plotly.react(e.div,e.data,s,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(s.dom),title:s.title.plot,data:n,xaxis:a,yaxes:[i]})})})(bluejay),(function(e){"use strict";const t="Bar Percent Complete",s=oePlotly.isDarkTheme();e.extend("plotBarPercentComplete",(n=null)=>{if(null===n)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const a=(e=>{let t=e.percentComplete.map(e=>100-e);return[{x:e.xAxis,y:e.percentComplete,name:"",hovertemplate:"Complete<br>%{y}%",type:"bar"},{x:e.xAxis,y:t,name:"",hovertemplate:"Incomplete<br>%{y}%",type:"bar"}]})(n),i=oePlotly.getAxis({type:"x",numTicks:20},s),o=oePlotly.getAxis({type:"y",range:[0,100],numTicks:20},s);(e=>{const t=oePlotly.getLayout({darkTheme:s,colors:"posNeg",xaxis:e.xaxis,yaxes:e.yaxes});t.barmode="stack",Plotly.react(e.div,e.data,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(n.dom),data:a,xaxis:i,yaxes:[o]})})})(bluejay),(function(e){"use strict";const t="Combined Medical Retina",s=oePlotly.isDarkTheme(),n=new Map,a=oePlotly.fullDateRange(),i=oePlotly.selectableUnits(),o=(e,t,s)=>{const o=(()=>{let e=0;return()=>{let t=e++;return e>=s.length&&(e=0),s[t]}})();n.get(t).set("data",new Map);const l={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:o()})};n.get(t).get("data").set(e.VA.offScale.name,l),a.add(e.VA.offScale.x);const r={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:o(),dashed:!0})};n.get(t).get("data").set(e.CRT.name,r),a.add(e.CRT.x);const c=o();Object.values(e.VA.units).forEach((e,s)=>{i.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y3",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:c})}),s||a.add(e.x)}),n.get(t).get("data").set("VA",i.selectedTrace(t))},l=()=>{let e=[];["rightEye","leftEye","BEO"].forEach(t=>{if(n.has(t)){let s=n.get(t).get("data");s.set("VA",i.selectedTrace(t)),e=e.concat(Array.from(s.values()))}}),n.get("layout").yaxis3=Object.assign({},i.selectedAxis()),Plotly.react(n.get("div"),e,n.get("layout"),{displayModeBar:!1,responsive:!0})};e.extend("plotCombinedMedRet",(r=null)=>{if(null===r)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const c=[[0,.15],[.2,1]];i.init({darkTheme:s,plotlyUpdate:l,axisDefaults:{type:"y",rightSide:"y2",domain:c[1],title:"VA",spikes:!0},unitRanges:Object.values(r.yaxis.unitRanges)}),r.rightEye&&(n.set("rightEye",new Map),o(r.rightEye,"rightEye",oePlotly.getColorSeries("rightEyeSeries",s))),r.leftEye&&(n.set("leftEye",new Map),o(r.leftEye,"leftEye",oePlotly.getColorSeries("leftEyeSeries",s))),r.BEO&&(n.set("BEO",new Map),o(r.BEO,"BEO",oePlotly.getColorSeries("BEOSeries",s)));(e=>{const i=oePlotly.getLayout({darkTheme:s,legend:{yanchor:"top",y:1},plotTitle:"Right, Left and BEO",xaxis:e.x,yaxes:e.y,subplot:2,rangeSlider:a.firstLast(),dateRangeButtons:!0}),o=oePlotly.buildDiv(""+t,"80vh","650px");document.querySelector(".oes-left-side").appendChild(o),n.set("div",o),n.set("layout",i),l(),oePlotly.addClickEvent(o,"?"),oePlotly.addHoverEvent(o,"?"),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(o,i)})})({x:oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,range:a.firstLast(),spikes:!0,noMirrorLines:!0},s),y:[oePlotly.getAxis({type:"y",domain:c[0],useCategories:{showAll:!0,categoryarray:r.yaxis.offScale.reverse()},spikes:!0},s),oePlotly.getAxis({type:"y",domain:c[1],title:"CRT",range:[200,650],spikes:!0},s),i.selectedAxis()]})})})(bluejay),(function(e){"use strict";const t="Combined Medical Retina",s=oePlotly.isDarkTheme(),n=new Map,a=(e,t,s)=>{const a=(()=>{let e=0;return()=>{let t=e++;return e>=s.length&&(e=0),s[t]}})();n.get(t).set("data",new Map);const i={x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",mode:"lines+markers",yaxis:"y2",line:oePlotly.dataLine({color:a()}),error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}};n.get(t).get("data").set("VA",i);const o={x:e.CRT.x,y:e.CRT.y,name:"CRT",hovertemplate:"Mean ± SD<br>CRT: %{y}<br>(N: %{x})",type:"scatter",line:oePlotly.dataLine({color:a(),dashed:!0}),error_y:{type:"data",array:e.CRT.error_y,visible:!0,thickness:.5}};n.get(t).get("data").set(e.CRT.name,o)};e.extend("plotCombinedOutcomesWithErrors",(i=null)=>{if(null===i)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);i.rightEye&&(n.set("rightEye",new Map),a(i.rightEye,"rightEye",oePlotly.getColorSeries("rightEyeSeries",s))),i.leftEye&&(n.set("leftEye",new Map),a(i.leftEye,"leftEye",oePlotly.getColorSeries("leftEyeSeries",s)));const o=oePlotly.getAxis({type:"x",numTicks:10,spikes:!0,noMirrorLines:!0},s),l=oePlotly.getAxis({type:"y",title:"CRT",range:i.yaxis.CRT,spikes:!0},s),r=oePlotly.getAxis({type:"y",title:"VA",range:i.yaxis.VA,rightSide:"y1",spikes:!0},s);(e=>{const t=oePlotly.getLayout({darkTheme:s,legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});let a=[];["rightEye","leftEye"].forEach(e=>{if(n.has(e)){let t=n.get(e).get("data");a=a.concat(Array.from(t.values()))}}),Plotly.react(e.div,a,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(i.dom),xaxis:o,yaxes:[l,r]})})})(bluejay),(function(e){"use strict";const t="Outcomes with Error bars",s=oePlotly.isDarkTheme();e.extend("plotOutcomesWithErrors",(n=null)=>{if(null===n)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const a=(e=>[{x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y1",error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}},{x:e.IOP.x,y:e.IOP.y,name:"IOP",hovertemplate:"Mean ± SD<br>IOP: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y2",error_y:{type:"data",array:e.IOP.error_y,visible:!0,thickness:.5}}])(n),i=oePlotly.getAxis({type:"x",title:"Weeks",numTicks:20,range:[-20,220]},s),o=oePlotly.getAxis({type:"y",title:"VA (change) from baseline (LogMAR)",range:[70,110],numTicks:20},s),l=oePlotly.getAxis({type:"y",title:"IOP (mm Hg))",rightSide:"y1",numTicks:20},s);(e=>{const t=oePlotly.getLayout({darkTheme:s,colors:"varied",legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});Plotly.react(e.div,e.data,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(n.dom),data:a,xaxis:i,yaxes:[o,l]})})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme(),s=new Map,n=oePlotly.fullDateRange(),a=oePlotly.selectableUnits(),i=oePlotly.highlighPoint(s,t),o=(e,t)=>{s.get(t).set("data",new Map);const i={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers"};s.get(t).get("data").set(e.VA.offScale.name,i),n.add(e.VA.offScale.x);const o={x:e.VFI.x,y:e.VFI.y,name:e.VFI.name,yaxis:"y5",hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dashedLine()};s.get(t).get("data").set(e.VFI.name,o),n.add(e.VFI.x);const l={x:e.IOP.x,y:e.IOP.y,name:e.IOP.name,yaxis:"y3",hovertemplate:"IOP: %{y}<br>%{x}",type:"scatter",mode:"lines+markers"};s.get(t).get("data").set(e.IOP.name,l),n.add(e.IOP.x),Object.values(e.VA.units).forEach((e,s)=>{a.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y2",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers"}),s||n.add(e.x)}),s.get(t).get("data").set("VA",a.selectedTrace(t)),Object.values(e.events).forEach(e=>{let a=e.customdata?"%{y}<br>%{customdata}<br>%{x}":"%{y}<br>%{x}",i=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:a,type:"scatter",showlegend:!1},oePlotly.eventStyle(e.event));s.get(t).get("data").set(e.name,i),n.add(e.x)})},l=e=>{let t=s.get(e);t.get("data").set("VA",a.selectedTrace(e)),t.get("layout").yaxis2=Object.assign({},a.selectedAxis());const n=Array.from(t.get("data").values());Plotly.react(t.get("div"),n,t.get("layout"),{displayModeBar:!1,responsive:!0})},r=e=>{const a=e.eyeSide,i=oePlotly.getLayout({darkTheme:t,legend:{traceorder:"reversed",yanchor:"bottom",y:.82},colors:e.colors,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes,subplot:4,rangeSlider:n.firstLast(),dateRangeButtons:!0,vLineLabel:{x:Object.values(e.procedures),h:.82},hLineLabel:{y:Object.values(e.targetIOP),axis:"y3"}}),o=oePlotly.buildDiv("Glaucoma-"+a,"80vh","850px");document.querySelector(e.parentDOM).appendChild(o),s.get(a).set("div",o),s.get(a).set("layout",i),l(a),oePlotly.addClickEvent(o,a),oePlotly.addHoverEvent(o,a),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(o,i)})};e.extend("plotSummaryGlaucoma",(c=null)=>{if(null===c)return e.log("[oePlotly] - no JSON data provided for Plot.ly Glaucoma ??"),!1;e.log("[oePlotly] - building Plot.ly Glaucoma");const d=[[0,.08],[.1,.45],[.47,.82],[.88,1]];a.init({darkTheme:t,plotlyUpdate:l,axisDefaults:{type:"y",domain:d[1],title:"VA",spikes:!0},unitRanges:Object.values(c.yaxis.unitRanges)}),c.rightEye&&(s.set("rightEye",new Map),o(c.rightEye,"rightEye")),c.leftEye&&(s.set("leftEye",new Map),o(c.leftEye,"leftEye"));const u=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,range:n.firstLast(),noMirrorLines:!0},t),p=oePlotly.getAxis({type:"y",domain:d[0],useCategories:{showAll:!0,categoryarray:c.yaxis.offScale.reverse()},spikes:!0},t),h=oePlotly.getAxis({type:"y",domain:d[2],title:"IOP",range:[0,75],spikes:!0},t),y=oePlotly.getAxis({type:"y",domain:d[3],useCategories:{showAll:!0,categoryarray:c.eventTypes.reverse()},spikes:!0},t),g=oePlotly.getAxis({type:"y",domain:d[1],title:"VFI",range:[-30,5],rightSide:"y2",spikes:!0},t),m=a.selectedAxis();return s.has("rightEye")&&r({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:u,yaxes:[p,m,h,y,g],procedures:c.rightEye.procedures,targetIOP:c.rightEye.targetIOP,parentDOM:c.rightEye.dom}),s.has("leftEye")&&r({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:u,yaxes:[p,m,h,y,g],procedures:c.leftEye.procedures,targetIOP:c.leftEye.targetIOP,parentDOM:c.leftEye.dom}),e.log("[oePlotly] - method: highlightPoint()"),{highlightPoint:i}})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme(),s=new Map,n=oePlotly.fullDateRange(),a=oePlotly.selectableUnits(),i=(e,t)=>{s.get(t).set("data",new Map);const i={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers"};s.get(t).get("data").set(e.VA.offScale.name,i),n.add(e.VA.offScale.x);const o={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dashedLine()};s.get(t).get("data").set(e.CRT.name,o),n.add(e.CRT.x),Object.values(e.VA.units).forEach((e,s)=>{a.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y3",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers"}),s||n.add(e.x)}),s.get(t).get("data").set("VA",a.selectedTrace(t)),Object.values(e.events).forEach(e=>{let a=e.customdata?"%{y}<br>%{customdata}<br>%{x}":"%{y}<br>%{x}",i=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:a,type:"scatter",showlegend:!1},oePlotly.eventStyle(e.event));s.get(t).get("data").set(e.name,i),n.add(e.x)})},o=e=>{let t=s.get(e);t.get("data").set("VA",a.selectedTrace(e)),t.get("layout").yaxis3=Object.assign({},a.selectedAxis());const n=Array.from(t.get("data").values());Plotly.react(t.get("div"),n,t.get("layout"),{displayModeBar:!1,responsive:!0})},l=e=>{const a=e.eyeSide,i=oePlotly.getLayout({darkTheme:t,legend:{yanchor:"bottom",y:.82},colors:e.colors,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes,subplot:3,rangeSlider:n.firstLast(),dateRangeButtons:!0}),l=oePlotly.buildDiv("Medical Retina-"+a,"80vh","650px");document.querySelector(e.parentDOM).appendChild(l),s.get(a).set("div",l),s.get(a).set("layout",i),o(a),oePlotly.addClickEvent(l,e.eye),oePlotly.addHoverEvent(l,a),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(l,i)})};e.extend("plotSummaryMedicalRetina",(r=null)=>{if(null===r)return e.log("[oePlotly] - no JSON data provided for Plot.ly Medical Retina ??"),!1;e.log("[oePlotly] - building Plot.ly Medical Retina");const c=[[0,.15],[.2,.82],[.88,1]];a.init({darkTheme:t,plotlyUpdate:o,axisDefaults:{type:"y",rightSide:"y2",domain:c[1],title:"VA",spikes:!0},unitRanges:Object.values(r.yaxis.unitRanges)}),r.rightEye&&(s.set("rightEye",new Map),i(r.rightEye,"rightEye")),r.leftEye&&(s.set("leftEye",new Map),i(r.leftEye,"leftEye"));const d=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,range:n.firstLast(),spikes:!0,noMirrorLines:!0},t),u=oePlotly.getAxis({type:"y",domain:c[0],useCategories:{showAll:!0,categoryarray:r.yaxis.offScale.reverse()},spikes:!0},t),p=oePlotly.getAxis({type:"y",domain:c[1],title:"CRT",range:[200,650],spikes:!0},t),h=oePlotly.getAxis({type:"y",domain:c[2],useCategories:{showAll:!0,categoryarray:r.eventTypes.reverse()},spikes:!0},t),y=a.selectedAxis();s.has("rightEye")&&l({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:d,yaxes:[u,p,y,h],parentDOM:".oes-left-side"}),s.has("leftEye")&&l({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:d,yaxes:[u,p,y,h],parentDOM:".oes-right-side"})})})(bluejay),(function(e){"use strict";e.addModule("copyToClipboard");const t=".js-clipboard-copy";if(null===document.querySelector(t))return;e.nodeArray(document.querySelectorAll(t)).forEach(e=>{e.style.cursor="pointer"});const s=t=>{let s=t.getBoundingClientRect(),n=s.right-s.width/2,a=s.top-5;const i=document.createElement("div");i.className="oe-tooltip fade-out",i.innerHTML="Copied",i.style.width="80px",i.style.top=a-30+"px",i.style.left=n-40+"px",document.body.appendChild(i),setTimeout(()=>e.remove(i),2500)};e.userDown(t,t=>(t=>{if(navigator.clipboard)navigator.clipboard.writeText(t.textContent).then(()=>{e.log("[ASYNC] copied text to clipboard"),s(t)}).catch(t=>{e.log("failed to copy text to clipboard")});else{const n=document.createElement("input");n.value=t.textContent,n.style.position="absolute",n.style.top="-200px",document.body.appendChild(n),n.select(),document.execCommand("copy"),s(t),e.remove(n)}})(t.target))})(bluejay),(function(e){"use strict";e.addModule("oesLayoutOptions");const t=document.querySelector(".oes-hd-data-layout");if(null==t)return;const s=Object.assign({selector:{rootElem:".oes-hd-data-layout",btn:".oes-hd-data-layout .layout-select-btn",optionBtn:".oes-hd-data-layout .option-btn",options:".layout-options"},current:{eye:JSON.parse(t.dataset.oes).eyeIcons,layout:JSON.parse(t.dataset.oes).layout},get eye(){return this.current.eye},set eye(e){if(e===this.current.eye)return!1;this.current.eye=e,this.views.notify()},get layout(){return this.current.layout},set layout(e){if(this.current.layout===e)return!1;this.current.layout=e,this.views.notify()}},e.ModelViews()),n=((()=>{const n=["{{#sides}}",'<div class="option-btn" data-oes=\'{"opt":"eye.{{eyelat.r}}-{{eyelat.l}}"}\'><span class="oe-eye-lat-icons"><i class="oe-i laterality {{eyelat.r}} small"></i><i class="oe-i laterality {{eyelat.l}} small"></i></span></div>',"{{/sides}}","{{#layouts}}",'<div class="option-btn" data-oes=\'{"opt":"layout.{{.}}"}\'><i class="oes-layout-icon i-{{.}}"></i></div>',"{{/layouts}}"].join(""),a=document.createElement("div");a.className=s.selector.options.replace(".",""),a.innerHTML=Mustache.render(n,{sides:[{eyelat:{r:"R",l:"NA"}},{eyelat:{r:"R",l:"L"}},{eyelat:{r:"NA",l:"L"}}],layouts:["1-0","2-1","1-1","1-2","0-1"]}),e.hide(a),t.appendChild(a)})(),(()=>{const t="oes-layout-icon",n=document.querySelector(s.selector.btn),a=n.querySelector("."+t),i=n.querySelector(".oe-eye-lat-icons");s.views.add(()=>{a.className=t+"  i-"+s.layout;let n=s.eye.split("-");i.innerHTML=Mustache.render('{{#eyes}}<i class="oe-i laterality {{.}} small pad"></i>{{/eyes}}',{eyes:n}),e.customEvent("oesLayoutEyeSide",n)})})(),(()=>{let t=null;const n=document.querySelector(".oes-v2 .oes-right-side"),a=document.querySelector(".oes-v2 .oes-left-side"),i=()=>{if(s.layout!==t){switch(t=s.layout,t){case"1-0":a.style.width="",e.show(a),e.hide(n);break;case"0-1":n.style.width="",e.hide(a),e.show(n);break;case"2-1":a.style.width="66%",n.style.width="33%",e.show(a),e.show(n);break;case"1-2":a.style.width="33%",n.style.width="66%",e.show(a),e.show(n);break;case"1-1":a.style.width="50%",n.style.width="50%",e.show(a),e.show(n);break;default:throw new TypeError("[bluejay] [oesLayoutOptions] - unknown layout: "+t)}e.customEvent("oesLayoutChange",t)}};i(),s.views.add(i)})(),(()=>{let n=!1;const a=t.querySelector(s.selector.btn),i=t.querySelector(s.selector.options),o=t=>{n=!0,e.show(i),a.classList.add("active")},l=t=>{n=!1,e.hide(i),a.classList.remove("active")};return{show:o,hide:l,change:e=>{n?l():o()}}})());e.userDown(s.selector.btn,n.change),e.userEnter(s.selector.btn,n.show),e.userLeave(s.selector.rootElem,n.hide),e.userDown(s.selector.optionBtn,e=>(e=>{let t=JSON.parse(e).opt.split(".");"eye"==t[0]&&(s.eye=t[1]),"layout"==t[0]&&(s.layout=t[1])})(e.target.dataset.oes))})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.state={tableHead:["Appt.","Hospital No.","Speciality","","Name","Pathway","Assigned","Mins",""],patients:this.props.patientsJSON,popupStepKey:null,popupStep:null,showAdder:!1,filter:"showAll"},this.buildPathStep=this.buildPathStep.bind(this),this.updatePatientState=this.updatePatientState.bind(this),this.handlePatientArrived=this.handlePatientArrived.bind(this),this.handlePatientDNA=this.handlePatientDNA.bind(this),this.handlePathwayCompleted=this.handlePathwayCompleted.bind(this),this.handleChangeStepStatus=this.handleChangeStepStatus.bind(this),this.handleShowStepPopup=this.handleShowStepPopup.bind(this),this.handleCloseStepPopup=this.handleCloseStepPopup.bind(this),this.handleAdderBtn=this.handleAdderBtn.bind(this),this.handleAdderRequest=this.handleAdderRequest.bind(this),this.handleFilterChange=this.handleFilterChange.bind(this),this.tablePatientRows=this.tablePatientRows.bind(this),this.filters=this.filters.bind(this),this.adderPopup=this.adderPopup.bind(this),this.pathStepPopup=this.pathStepPopup.bind(this)}buildPathStep(e,t,n,a){return{arrRef:e,key:s.getKey(),shortcode:t,timestamp:Date.now(),status:n,type:a}}updatePatientState(e,t){const n="string"==typeof t?t:t.action,a=s.deepCopy(this.state.patients)[e],i=a.pathway;"assign"==n&&(a.assigned=t.assign),"arrived"==n&&(a.status="active",i.push(this.buildPathStep(0,"Arr","done","arrive"))),"DNA"==n&&(a.status="complete",i.push(this.buildPathStep(0,"DNA","done","DNA"))),"addStep"==n&&i.push(this.buildPathStep(i.length,t.stepCode,"next",t.stepType)),"removeStep"==n&&i.splice(t.stepRef,1),"changeStepStatus"==n&&(i[t.stepRef].status=t.newStatus,i[t.stepRef].timestamp=Date.now()),"finished"==n&&(a.status="complete",i.push(this.buildPathStep(i.length,"Fin","done","finish"))),this.setState(t=>(t.patients[e]=a,t))}handlePatientArrived(e){this.updatePatientState(e,"arrived")}handlePatientDNA(e){this.updatePatientState(e,"DNA")}handlePathwayCompleted(e){this.updatePatientState(e,"finished")}handleChangeStepStatus(e,t,s){this.handleCloseStepPopup(),"done"!=s&&"active"!=s||this.updatePatientState(e,{action:"changeStepStatus",stepRef:t,newStatus:s}),"remove"==s&&this.updatePatientState(e,{action:"removeStep",stepRef:t})}handleShowStepPopup(e){e.key==this.state.popupStepKey?this.handleCloseStepPopup():this.setState({popupStepKey:e.key,popupStep:e})}handleCloseStepPopup(){this.setState({popupStepKey:null,popupStep:null})}handleAdderBtn(){this.setState(e=>({showAdder:!e.showAdder}))}handleAdderRequest(e){const t=e.type,s=e.shortcode,n=e.stepType;e.selectedPatients.forEach(e=>{"assign"===t&&this.updatePatientState(e,{action:"assign",assign:"nobody"!=s&&s}),"step"===t&&this.updatePatientState(e,{action:"addStep",stepCode:s,stepType:n})})}handleFilterChange(e){e="nobody"!=e&&e,console.log(e),this.setState({filter:e})}pathStepPopup(){return null===this.state.popupStep?null:t(s.PathStepPopup,{step:this.state.popupStep,onClosePopup:this.handleCloseStepPopup,onChangeStepStatus:this.handleChangeStepStatus})}tablePatientRows(){const e=this.state.patients.map((e,n)=>(e.onPathStepClick=this.handleShowStepPopup,e.onPathwayCompleted=this.handlePathwayCompleted,e.onArrived=this.handlePatientArrived,e.onDNA=this.handlePatientDNA,e.clinicFilterState=this.state.filter,t(s.Patient,e)));return t("tbody",null,e)}adderPopup(){if(0==this.state.showAdder)return null;const e=[];return this.state.patients.forEach(t=>{"complete"!==t.status&&e.push({booked:t.booked,lastname:t.lastname,arrRef:t.arrRef,status:t.status})}),t(s.AdderPopup,{list:e,onAdderRequest:this.handleAdderRequest})}filters(){return t(s.Filters,{allAssigned:this.state.patients.map(e=>e.assigned),clinicFilter:this.state.filter,showAdder:this.state.showAdder,onAdderBtn:this.handleAdderBtn,onFilterChange:this.handleFilterChange})}render(){return t("div",{className:"app"},t("table",{className:"oe-clinic-list"},t(s.TableHead,{th:this.state.tableHead}),this.tablePatientRows()),this.pathStepPopup(),this.adderPopup(),this.filters())}}s.Clinic=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.PureComponent{constructor(e){super(e),this.btn=this.btn.bind(this)}btn(){const e=this.props.isStep?t("div",{className:"fullname"},s.fullShortCode(this.props.btn)):null,n=this.props.count?t("div",{className:"count"},this.props.count):null;return t("div",{className:"filter"},t("div",{className:"name"},this.props.btn),e,n)}render(){const e=this.props.selected?"filter-btn selected":"filter-btn";return t("li",{className:e,onClick:()=>this.props.onClick(this.props.filter)},this.btn())}}s.FilterBtn=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.dom=document.getElementById("js-clinic-filter");this.btn=this.btn.bind(this),this.filterBtns=this.filterBtns.bind(this)}btn(e,n,a,i){return t(s.FilterBtn,{btn:e,filter:n,isStep:a,count:i,key:s.getKey(),onClick:this.props.onFilterChange,selected:this.props.clinicFilter==n})}filterBtns(){const e=e=>this.props.allAssigned.reduce((t,s)=>s===e?t+1:t,0);let n=[];return n.push(this.btn("Show all","showAll",!1,0)),n.push(this.btn("Hide completed","hideComplete",!1,0)),n=n.concat(s.assignList.map(t=>this.btn(t,t,!0,e(t)))),n.push(this.btn("Unassigned","nobody",!1,e(!1))),n.push(t("li",{className:"update-clinic-btn",key:s.getKey()},t("button",{className:this.props.showAdder?"adder close":"adder open",onClick:this.props.onAdderBtn},null))),n}render(){return ReactDOM.createPortal(this.filterBtns(),this.dom)}}s.Filters=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement;e.namespace("react").PathStep=({key:s,step:n,onClick:a})=>{const i=["oe-pathstep-btn"];"done"===n.status&&i.push("green"),"active"===n.status&&i.push("orange"),i.push(n.type);const o="next"==n.status?"time invisible":"time";return t("span",{key:n.key,className:i.join(" "),onClick:e=>a(n,e.target.getBoundingClientRect())},t("span",{className:"step"},n.shortcode),t("span",{className:o},e.clock24(new Date(n.timestamp))))}},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.setTitle=this.setTitle.bind(this),this.content=this.content.bind(this),this.stepActions=this.stepActions.bind(this),this.stepStatus=this.stepStatus.bind(this)}setTitle(n){const a=s.fullShortCode(n.shortcode),i="next"==n.status?"Next":e.clock24(new Date(n.timestamp));return t("h3",null,`${i} - ${a}`)}content(){return t("div",{className:"popup-overflow"},t("div",{className:"data-group",dangerouslySetInnerHTML:{__html:'<table class="data-table"><tbody><tr><td><span class="oe-eye-lat-icons"><i class="oe-i laterality R small"></i><i class="oe-i laterality L small"></i></span></td><td>No step data being shown for this demo...</td><td>UX Demo</td></tr></tbody></table>'}}))}stepActions(e){if("active"!=e.status&&"next"!=e.status)return null;const s=(s,n,a)=>t("button",{className:s,onClick:()=>this.props.onChangeStepStatus(e.patientArrRef,e.arrRef,a)},n);return"active"==e.status?t("div",{className:"step-actions"},s("green hint","Complete","done"),s("red hint","Remove","remove")):"next"==e.status?t("div",{className:"step-actions"},s("blue hint","Make active","active"),s("red hint","Remove","remove")):void 0}stepStatus(e){let s="step-status";return"done"==e.status&&(s+=" green"),"active"==e.status&&(s+=" orange"),t("div",{className:s},e.status)}render(){console.log("Render: PathStepPopup");const e=this.props.step;return t("div",{className:"oe-pathstep-popup a-t-l",style:{top:e.rect.bottom,left:e.rect.left}},t("div",{className:"close-icon-btn",onClick:this.props.onClosePopup,dangerouslySetInnerHTML:{__html:'<i class="oe-i remove-circle medium"></i>'}}),this.setTitle(e),this.content(e),this.stepActions(e),this.stepStatus(e))}}s.PathStepPopup=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.state={patientMeta:{firstname:e.firstname,lastname:e.lastname,age:e.age,gender:e.gender,nhs:e.nhs}},this.handleStepClick=this.handleStepClick.bind(this),this.pathwaySteps=this.pathwaySteps.bind(this),this.assigned=this.assigned.bind(this),this.complete=this.complete.bind(this),this.waitMins=this.waitMins.bind(this)}handleStepClick(e,t){e.patientArrRef=this.props.arrRef,e.rect=t,this.props.onPathStepClick(e)}pathwaySteps(){const e=this.props.pathway;let n=null;return e.length&&(n=e.map(e=>s.PathStep({key:e.key,step:e,onClick:this.handleStepClick}))),t("div",{className:"pathway "+this.props.status},n)}assigned(){const e=this.props.assigned;return e?t("div",null,s.fullShortCode(e)):t("small",{className:"fade"},"Not assigned")}waitMins(){if("todo"===this.props.status)return t("div",{className:"flex"},t("button",{className:"cols-7 blue hint",onClick:()=>this.props.onArrived(this.props.arrRef)},"Arrived"),t("button",{className:"cols-4",onClick:()=>this.props.onDNA(this.props.arrRef)},"DNA"));let e=0,n=0;return this.props.pathway.forEach(t=>{"Arr"==t.shortcode&&(e=t.timestamp),"Fin"===t.shortcode&&(n=Math.floor((t.timestamp-e)/6e4))}),t(s.WaitDuration,{status:this.props.status,arriveTime:e,pathwayTotalMins:n})}complete(){let e=null;return"complete"===this.props.status&&(e=t("i",{className:"oe-i tick small-icon pad disabled"},null)),"active"===this.props.status&&(e=t("i",{className:"oe-i save medium-icon pad js-has-tooltip","data-tt-type":"basic","data-tooltip-content":"Patient pathway finished",onClick:()=>this.props.onPathwayCompleted(this.props.arrRef)},null)),e}render(){return"hideComplete"==this.props.clinicFilterState&&"complete"==this.props.status||"showAll"!==this.props.clinicFilterState&&"hideComplete"!==this.props.clinicFilterState&&this.props.assigned!==this.props.clinicFilterState?null:t("tr",{"data-timestamp":this.props.booked,className:this.props.status},t("td",null,e.clock24(new Date(this.props.booked))),t("td",null,this.props.num),t("td",null,t("div",{className:"speciality"},this.props.speciality),t("small",{className:"type"},this.props.specialityState)),t("td",null,t(s.PatientQuickView,this.state.patientMeta)),t("td",null,t(s.PatientMeta,this.state.patientMeta)),t("td",null,this.pathwaySteps()),t("td",null,this.assigned()),t("td",null,this.waitMins()),t("td",null,this.complete()))}}s.Patient=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement;class s extends React.PureComponent{render(){return t("div",{className:"oe-patient-meta"},t("div",{className:"patient-name"},t("a",{href:"/v3-SEM/patient-overview"},t("span",{className:"patient-surname"},this.props.lastname),t("span",{className:"patient-firstname"},", "+this.props.firstname))),t("div",{className:"patient-details"},t("div",{className:"nhs-number",dangerouslySetInnerHTML:{__html:"<span>NHS</span>"+this.props.nhs}}),t("div",{className:"patient-gender",dangerouslySetInnerHTML:{__html:"<em>Gen</em>"+this.props.gender}}),t("div",{className:"patient-age",dangerouslySetInnerHTML:{__html:"<em>Age</em>"+this.props.age}})))}}e.namespace("react").PatientMeta=s},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement;class s extends React.PureComponent{render(){const e={surname:this.props.lastname,first:this.props.firstname,id:!1,nhs:this.props.nhs,gender:this.props.gender,age:this.props.age};return t("i",{className:"oe-i eye-circle medium pad js-patient-quick-overview","data-patient":JSON.stringify(e),"data-mode":"side","data-php":"patient/quick/overview.php"},null)}}e.namespace("react").PatientQuickView=s},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.state={list:this.props.list,onAdderRequest:this.props.onAdderRequest},this.listPatients=this.listPatients.bind(this),this.handleUpdates=this.handleUpdates.bind(this)}shouldComponentUpdate(){return!1}handleUpdates(t){const s=t.target,n=s.dataset.add,a=s.dataset.shortcode,i=s.dataset.step,o=e.nodeArray(document.querySelectorAll(".oe-clinic-adder .patients input")),l=new Set;o.forEach(e=>{e.checked&&l.add(parseInt(e.dataset.ref,10))}),this.state.onAdderRequest({selectedPatients:l,type:n,shortcode:a,stepType:i})}listPatients(){const n=[],a=[];this.state.list.forEach(i=>{const o=t("li",{key:s.getKey()},t("label",{className:"highlight"},t("input",{type:"checkbox","data-ref":i.arrRef}),t("span",null,e.clock24(new Date(i.booked))+" - "+i.lastname)));"active"===i.status?n.push(o):a.push(o)});const i=(e,s)=>t("div",{className:"row"},t("h4",null,e),t("ul",{className:"row-list"},s));return t("div",{className:"patients"},t("h3",null,"Select Patients"),i("Arrived",n),i("Later",a))}listAssign(){const e=["nobody"].concat(s.assignList).map(e=>t("li",{key:s.getKey(),onClick:this.handleUpdates,"data-shortcode":e,"data-add":"assign"},s.fullShortCode(e)));return t("div",{className:"row"},t("h4",null,"Assign to"),t("ul",{className:"btn-list"},e))}listSteps(){const e=(e,n)=>t("span",{className:"oe-pathstep-btn "+n,key:s.getKey(),onClick:this.handleUpdates,"data-shortcode":e,"data-add":"step","data-step":n},t("span",{className:"step"},e),t("span",{className:"time invisible"},"00:00")),n=s.assignList.concat(s.clinicPersonList).map(t=>e(t,"person")),a=s.clinicProcessList.map(t=>e(t,"process"));return t("div",{className:"row"},t("h4",null,"Add to pathway"),t("div",{className:"steps"},a),t("div",{className:"steps"},n))}render(){return t("div",{className:"oe-clinic-adder"},this.listPatients(),t("div",{className:"update-actions"},t("h3",null,"Update"),this.listAssign(),this.listSteps()))}}s.AdderPopup=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.PureComponent{render(){const e=this.props.th.map(e=>t("th",{key:s.getKey()},e));return t("thead",null,t("tr",null,e))}}s.TableHead=n},{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=React.createElement,s=e.namespace("react");class n extends React.Component{constructor(e){super(e),this.state={arrive:e.arriveTime,waitMins:0},this.updateWaitMins=this.updateWaitMins.bind(this),this.state.waitMins=this.updateWaitMins()}componentDidMount(){"active"==this.props.status&&(this.state.waitMins=this.updateWaitMins(),this.interval=setInterval(()=>{this.setState({waitMins:this.updateWaitMins()})},15e3))}componentWillUnmount(){clearInterval(this.interval)}updateWaitMins(){return Math.floor((Date.now()-this.state.arrive)/6e4)}svgCircles(e=""){const n=["green","yellow","orange","red"].map((e,n)=>{const a=12*(n+1)-6;return t("circle",{key:s.getKey(),className:"c"+n,cx:a,cy:6,r:6})});return t("svg",{className:"duration-graphic "+e,viewBox:"0 0 48 12",height:12,width:48},n)}waitTime(e){return t("div",{className:"mins"},t("span",null,e),t("small",null,e>1?"mins":"min"))}render(){if("complete"==this.props.status)return t("div",{className:"wait-duration"},this.waitTime(this.props.pathwayTotalMins));if("todo"==this.props.status)return t("div",{className:"wait-duration"},this.svgCircles());const e=this.state.waitMins;let s="green";return e>14&&(s="yellow"),e>29&&(s="orange"),e>59&&(s="red"),t("div",{className:"wait-duration"},this.svgCircles(s),this.waitTime(e))}}s.WaitDuration=n},{once:!0})})(bluejay),(function(e){"use strict";if(e.addModule("clinicManager"),null===document.getElementById("js-clinic-manager"))return;const t=e.div("oe-popup-wrap");t.innerHTML='<div class="spinner"></div><div class="spinner-message">Loading...</div>',document.body.appendChild(t);const s=e.namespace("react");const n=(function*(){let e=0;for(;;)++e,yield"uid"+e})();s.getKey=()=>n.next().value,s.assignList=["MM","AB","AG","RB","CW"].sort(),s.clinicPersonList=["Nurse"],s.clinicProcessList=["Dilate","VisAcu","Orth","Ref"].sort(),s.fullShortCode=e=>{let t=e;switch(e){case"Arr":t="Arrived";break;case"Fin":t="Finish";break;case"nobody":t="Not assigned";break;case"MM":t="Mr Michael Morgan";break;case"AB":t="Dr Amit Baum";break;case"AG":t="Dr Angela Glasby";break;case"RB":t="Dr Robin Baum";break;case"CW":t="Dr Coral Woodhouse";break;case"DNA":t="Did Not Attend";break;case"VisAcu":t="Visual Acuity"}return t},s.deepCopy=e=>{const t=Object.prototype.toString.call(e).slice(8,-1).toLowerCase();return"object"===t?(()=>{const t={};for(let n in e)e.hasOwnProperty(n)&&(t[n]=s.deepCopy(e[n]));return t})():"array"===t?e.map(e=>s.deepCopy(e)):e};e.loadJS("https://unpkg.com/react@17/umd/react.production.min.js",!0).then(()=>{e.loadJS("https://unpkg.com/react-dom@17/umd/react-dom.production.min.js",!0).then(()=>(()=>{e.log("[Clinic Manager] - intialising"),e.customEvent("reactJSloaded");const n=JSON.parse(phpClinicDemoJSON);n.forEach((e,t)=>{e.arrRef=t;const n=new Date(Date.now()+6e4*e.booked),a=n.getMinutes()%5;n.setMinutes(n.getMinutes()-a),e.booked=n.getTime(),e.pathway.forEach((e,t,n)=>{const a={arrRef:t,key:s.getKey(),shortcode:e[0],timestamp:Date.now()+6e4*e[1],status:e[2],type:e[3]};n[t]=a})}),t.remove(),ReactDOM.render(React.createElement(s.Clinic,{patientsJSON:n}),document.getElementById("js-clinic-manager"))})())})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",()=>{const t=e.div("oe-clinic-clock");t.textContent="",t.style.top="100%",document.body.appendChild(t);setInterval(()=>{const s=e.nodeArray(document.querySelectorAll("table.oe-clinic-list tbody tr"));if(!s.length)return void(t.style.top="100%");const n=Date.now();let a="100%";s.every(e=>!(e.dataset.timestamp>n)||(a=e.getBoundingClientRect().top-4+"px",!1)),t.style.top=a,t.textContent=e.clock24(new Date(n))},1e3)},{once:!0})})(bluejay),(function(e){"use strict";if(null===document.querySelector("#tinymce-letterheader-editor"))return;let t=null;const s={user_name:{label:"User Name",value:"<span>Admin Admin</span>"},firm_name:{label:"Firm Name",value:"<span>Glaucoma Clinic</span>"},site_name:{label:"Site Name",value:"<span>Kings Hospital</span>"},site_phone:{label:"Site Phone",value:"<span>0123456789</span>"},site_fax:{label:"Site Fax",value:null},site_email:{label:"Site Email",value:null},site_address:{label:"Site Address",value:"<span>100 Main Road</span>"},site_city:{label:"Site City",value:"<span>London</span>"},site_postcode:{label:"Site Postcode",value:"<span>W1 1AA</span>"},primary_logo:{label:"Primary Logo",value:'<img src="/idg-php/imgDemo/correspondence/letterhead-logo.png">'},secondary_logo:{label:"Secondary Logo",value:null},current_date:{label:"Today's Date",value:"<span>"+document.documentElement.dataset.today+"</span>"}};tinymce.init({selector:"#tinymce-letterheader-editor",schema:"html5-strict",branding:!1,min_height:400,menubar:!1,plugins:["lists table paste code"],contextmenu:"table",toolbar:"undo redo | bold italic underline | alignleft aligncenter alignright | table | code",custom_undo_redo_levels:10,hidden_input:!1,block_formats:"Paragraph=p; Header 2=h2; Header 3=h3",content_css:"/newblue/css/style_oe3_print.min.css",setup:function(e){e.on("init",(function(n){t=e,(()=>{var e=new DocumentFragment;for(const n in s){let a=s[n].label,i=s[n].value;if(null!==i){var t=document.createElement("button");t.className="idg-quick-insert",t.textContent=a,t.setAttribute("data-insert",JSON.stringify({key:n,value:i})),e.appendChild(t)}}document.querySelector(".editor-quick-insert-btns").appendChild(e)})()}))}}),e.userDown(".idg-quick-insert",e=>{let s=JSON.parse(e.target.dataset.insert);var n,a;n=s.key,a=s.value,t.insertContent('<span contenteditable="false" data-substitution="'+n+'">'+a+"</span>")})})(bluejay),(function(e){"use strict";null!==document.querySelector(".js-idg-demo-ed2")&&(e.userDown(".js-idg-demo-doodle-drawer",t=>{let s=t.target;e.getParent(s,"li").classList.toggle("ed2-drawer-open")}),e.userDown(".ed-canvas-edit",t=>{let s=t.target;e.getParent(s,".ed2-editor").querySelector(".ed2-doodle-popup").classList.toggle("closed")}),e.userDown("#js-idg-demo-ed2-search-input",e=>{let t=e.target.nextElementSibling;console.log("hi"),"none"==t.style.display?t.style.display="block":t.style.display="none"}))})(bluejay),(function(e){"use strict";if(null===document.querySelector(".oe-worklists.eferral-manager"))return;const t=new e.Collection,s=["DRSS","Cataract","Glaucoma","Uveitis","Lucentis","Glaucoma ODTC","Laser/YAG","General","Ocular Motility","Oculoplastic","Neuro","Botox","Corneal","VR","Paediatric Ophthalmology","Paediatric Neuro-Ophthalmology"],n={accepted:null,tr:null,iEdit:null,iState:null,iRisk:null,fullName:"JONES, David (Mr)",nhs:"000",age:"42",gender:"Male",riskNum:0,pathElem:null,pathNum:99,active(){this.iEdit.classList.replace("pencil","direction-right"),this.iEdit.classList.replace("small-icon","large"),this.iEdit.classList.add("selected"),this.tr.classList.add("active")},inactive(){this.iEdit.classList.replace("direction-right","pencil"),this.iEdit.classList.replace("large","small-icon"),this.iEdit.classList.remove("selected"),this.tr.classList.remove("active")},accept(){this.accepted=!0,this.iState.classList.replace("status-query","tick-green"),this.iState.classList.replace("cross-red","tick-green")},reject(){this.accepted=!1,this.iState.classList.replace("status-query","cross-red"),this.iState.classList.replace("tick-green","cross-red")},name(){return this.fullName},details(){return`${this.gender}, ${this.age}y`},setRisk(e){var t;this.iRisk=e,this.riskNum=(t=e.className).includes("green")?3:t.includes("amber")?2:t.includes("red")?1:0},get risk(){return this.riskNum},set risk(e){var t,s;this.riskNum=parseInt(e,10),t=this.iRisk,s=e,t.className=`oe-i triangle-${["grey","red","amber","green"][s]} selected`,null===this.accepted&&this.accept()},setPathway(e){this.pathElem=e,this.pathNum=(e=>{let t=99;return s.forEach((s,n)=>{e==s&&(t=n)}),t})(e.textContent)},set pathway(e){this.pathNum=parseInt(e,10),this.pathElem.textContent=s[this.pathNum]},get pathway(){return this.pathNum}};e.nodeArray(document.querySelectorAll("table.eferrals")).forEach(s=>{Array.from(s.tBodies[0].rows).forEach(s=>{let a=Object.create(n);a.tr=s,a.iEdit=s.querySelector(".oe-i.pencil"),a.iState=s.querySelector(".oe-i.js-referral-status-icon"),a.fullName=s.querySelector(".patient-name").textContent,a.age=s.querySelector(".patient-age").textContent.substring(3),a.gender=s.querySelector(".patient-gender").textContent.substring(3),a.nhs=s.querySelector(".nhs-number").textContent.substring(3),a.setRisk(s.querySelector('[class*="triangle-"]')),a.setPathway(s.querySelector(".js-pathway")),a.hasImage=Math.random()>=.5;let i=e.getParent(s,".worklist-group");a.group=i.querySelector(".worklist-summary h2").textContent,a.myKey=t.add(a,a.iEdit)})});const a=(()=>{let s=null;const n=e.nodeArray(document.querySelectorAll("#sidebar-patient-risk-settings input")),i=e.nodeArray(document.querySelectorAll("#sidebar-pathway-settings input")),o={view:{overview:document.getElementById("sidebar-eferral-overview"),patient:document.getElementById("sidebar-manage-patient"),reject:document.getElementById("sidebar-reject-accept")},btn:{overview:document.getElementById("idg-js-sidebar-viewmode-1"),patient:document.getElementById("idg-js-sidebar-viewmode-2")},patient:{fullName:document.getElementById("js-sidebar-patient-fullname"),details:document.getElementById("js-sidebar-patient-details"),group:document.getElementById("js-sidebar-referral-group"),attachment:document.getElementById("js-demo-attachment-image")}},l=t=>{t||null===t?(e.show(o.view.reject.querySelector(".js-reject")),e.hide(o.view.reject.querySelector(".js-accept"))):(e.hide(o.view.reject.querySelector(".js-reject")),e.show(o.view.reject.querySelector(".js-accept")))},r=(e,t)=>{e.forEach(e=>{e.checked=t==e.value})};return document.addEventListener("change",e=>{let t=e.target;"idg-radio-g-patient-risk"===t.name&&(s.risk=t.value),"idg-radio-g-patient-pathway"===t.name&&(s.pathway=t.value)}),{change:t=>{"overview"==t?(e.show(o.view.overview),e.hide(o.view.patient),o.btn.overview.classList.add("selected"),o.btn.patient.classList.remove("selected")):(e.hide(o.view.overview),e.show(o.view.patient),o.btn.overview.classList.remove("selected"),o.btn.patient.classList.add("selected"))},managePatient:e=>{null!==s&&s.inactive(),o.patient.fullName.textContent=e.fullName,o.patient.details.innerHTML=`<small class="fade">NHS</small> ${e.nhs}  \n\t\t\t\t&nbsp;<small class="fade">Gen</small> ${e.gender} \n\t\t\t\t&nbsp;<small class="fade">Age</small> ${e.age}`,o.patient.group.textContent=e.group,o.patient.attachment.style.display=e.hasImage?"block":"none",r(n,e.riskNum),r(i,e.pathNum),l(e.accepted),e.active(),s=e},nextPatient:e=>{let n;n="next"==e?t.next(s.myKey):t.prev(s.myKey),n&&a.managePatient(t.get(n))},rejectPatient:e=>{e.classList.contains("red")?(l(!1),s.reject()):(l(!0),s.accept())}}})();document.addEventListener("DOMContentLoaded",()=>{a.managePatient(t.getFirst())},{once:!0});e.userDown(".js-edit-patient-icon",e=>{let s=e.target,n=t.getKey(s);a.managePatient(t.get(n)),a.change("patient")}),e.userDown("#idg-js-sidebar-viewmode-1",()=>a.change("overview")),e.userDown("#idg-js-sidebar-viewmode-2",()=>a.change("patient")),e.userDown("#side-patient-next-btn",()=>a.nextPatient("next")),e.userDown("#side-patient-previous-btn",()=>a.nextPatient("prev")),e.userDown("#sidebar-reject-accept button",e=>a.rejectPatient(e.target)),document.addEventListener("keydown",e=>{e.stopPropagation(),"z"===e.key&&a.nextPatient("next"),"a"===e.key&&a.nextPatient("prev")},!1)})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-event-date-change"))return;e.userDown(".js-event-date-change > .rewind",t=>{let s=t.target,n=t.target.parentNode.querySelector("input"),a=t.target.parentNode.querySelector(".js-event-date");s.classList.add("disabled"),e.hide(a),e.show(n),setTimeout(()=>n.focus(),20)})})(bluejay),(function(e){"use strict";bluejay.demoLoginTimeOut=()=>{const e=document.createElement("div");e.className="oe-popup-wrap dark",document.body.appendChild(e);const t=['<div class="oe-login timeout">','<div class="login">',"<h1>Timed out</h1>",'<div class="user">','<input type="text" placeholder="Username">','<input type="password" placeholder="Password">','<button class="green hint" id="js-login">Login</button>',"</div>",'<div class="info">',"For security reasons you have been logged out. Please login again","</div>","</div>","</div>"].join("");e.innerHTML=Mustache.render(t,{})}})(),(function(e){"use strict";if(null===document.querySelector(".js-idg-demo-13420"))return;document.addEventListener("input",t=>{let s=t.target;if(s.matches(".js-idg-demo-13420 .toggle-switch input")){let t=e.getParent(s,"tr"),n=t.querySelector(".js-idg-ongoing-text"),a=t.querySelector(".js-idg-date-stop"),i=t.querySelector(".js-idg-duration-dispense"),o=t.querySelector(".js-idg-taper-btn"),l=t.querySelector(".js-idg-stopped-reasons");s.checked?(e.hide(a),e.hide(l),e.show(n,"block"),e.show(i,"block"),e.show(o,"block")):(e.show(a,"block"),e.hide(n),e.hide(i),e.hide(o))}});const t=(t,s)=>{let n=t.querySelector(".js-idg-stop-btn"),a=t.querySelector(".js-idg-stop-date"),i=t.querySelector(".js-idg-stopped-reasons"),o=t.querySelector(".js-idg-cancel-stop");s?(e.hide(n),e.show(a,"block"),e.show(i,"block"),e.show(o,"block")):(e.show(n,"block"),e.hide(a),e.hide(i),e.hide(o))};document.addEventListener("click",s=>{s.target.matches(".js-idg-stop-btn")&&t(e.getParent(s.target,"td"),!0)}),document.addEventListener("mousedown",s=>{s.target.matches(".js-idg-cancel-stop")&&t(e.getParent(s.target,"td"),!1)}),document.addEventListener("mousedown",e=>{let t=e.target;if(t.matches(".js-show-medication-history")){document.querySelectorAll(".js-idg-medication-history-"+t.dataset.idgdemo).forEach(e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"})}})})(bluejay),(function(e){"use strict";if(null===document.querySelector(".home-messages"))return;const t={messages:document.getElementById("idg-js-sidebar-viewmode-1"),tags:document.getElementById("idg-js-sidebar-viewmode-2")},s={messages:document.querySelector(".sidebar-messages"),tags:document.querySelector(".sidebar-tags")},n={messages:document.querySelector(".messages-all"),tags:document.querySelector(".tags-all")};e.userDown("#idg-js-sidebar-viewmode-1",()=>{t.messages.classList.contains("selected")||(t.messages.classList.add("selected"),t.tags.classList.remove("selected"),e.show(s.messages),e.hide(s.tags),e.show(n.messages),e.hide(n.tags))}),e.userDown("#idg-js-sidebar-viewmode-2",()=>{t.tags.classList.contains("selected")||(t.messages.classList.remove("selected"),t.tags.classList.add("selected"),e.hide(s.messages),e.show(s.tags),e.hide(n.messages),e.show(n.tags))})})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-idg-diagnosis-active-switcher"))return;const t=(t,n)=>{let a=t.querySelector(".js-idg-diagnosis-text"),i=t.querySelector(".toggle-switch"),o=t.querySelector(".remove-circle"),l=t.querySelector(".js-idg-diagnosis-add-btn"),r=t.querySelector(".js-idg-diagnosis-doubt"),c=t.querySelector(".js-idg-diagnosis-doubt-input"),d=t.dataset.idgside,u=t.parentNode.previousElementSibling.querySelector(".oe-eye-lat-icons .oe-i"),p=t.parentNode.nextElementSibling.querySelector(".js-idg-diagnosis-date");switch(n){case"active":e.reshow(a),e.reshow(i),e.reshow(r),e.hide(o),e.hide(l),e.reshow(p),a.textContent="Active (confirmed)",a.classList.remove("fade"),r.querySelector("input").checked=!1,i.querySelector("input").checked=!0,s(u,d,"active");break;case"confirmed":e.hide(c),e.reshow(a);break;case"doubt":e.reshow(c),e.hide(a);break;case"inactive":e.reshow(a),e.reshow(i),e.reshow(o),e.hide(l),e.hide(r),e.hide(c),e.reshow(p),a.textContent="Inactive from",a.classList.add("fade"),s(u,d,"inactive");break;case"removed":e.hide(i),e.hide(o),e.reshow(l),e.hide(p),a.textContent="Not present",s(u,d,"none")}},s=(e,t,s)=>{if(null===e)return;let n=["oe-i"],a="left"==t?"L":"R";switch(s){case"active":n.push("laterality",a);break;case"inactive":n.push("laterality",a+"i");break;case"none":n.push("laterality","NA")}n.push("small","pad"),e.className=n.join(" ")};let n=null;const a=(t,s)=>{let a=t.querySelector(".js-idg-diagnosis-state-options"),i=t.querySelector(".js-idg-right-icon .oe-systemic-icons"),o=t.querySelector(".js-idg-right-icon .oe-eye-lat-icons .oe-i");if(s){a.innerHTML='<span class="oe-eye-lat-icons"><i class="oe-i laterality NA small pad"></i></span>',a.colSpan=0;let s=t.insertCell(2),n=t.insertCell(3);if(s.innerHTML='<div class="flex-layout cols-11 js-idg-diagnosis-active-switcher" data-idgdemo="-r-nSysEx2" data-idgside="right"><div class="js-idg-diagnosis-actions"><label class="toggle-switch" style="display: none;"><input type="checkbox"><div class="toggle-btn"></div></label><label class="inline highlight js-idg-diagnosis-doubt" style="display: none;"><input value="diagnosis-doubt" name="idg-4131" type="checkbox"> <i class="oe-i doubt small-icon js-has-tooltip" data-tt-type="basic" data-tooltip-content="? = doubts; suspected, etc"></i></label><i class="oe-i remove-circle small-icon pad-left" style="display: none;"></i><button class="js-idg-diagnosis-add-btn ">Add right side</button></div><div class="js-idg-diagnosis-state"><input class="js-idg-diagnosis-doubt-input" value="Suspected" placeholder="Suspected" maxlength="32" style="display: none;"><span class="js-idg-diagnosis-text js-active-state fade ">Not present</span></div></div>',n.innerHTML='<div class="js-idg-diagnosis-date"><input type="text" class="date" value="30 Apr 2020"></div>',e.hide(t.cells[5].querySelector(".toggle-switch")),e.hide(t.cells[5].querySelector(".highlight")),null===t.cells[5].querySelector(".js-idg-diagnosis-actions .js-idg-diagnosis-add-btn")){let e=document.createElement("button");e.className="js-idg-diagnosis-add-btn",e.textContent="Add left side",t.cells[5].querySelector(".js-idg-diagnosis-actions").appendChild(e)}else e.reshow(t.cells[5].querySelector(".js-idg-diagnosis-add-btn"));let l=t.cells[5].querySelector(".js-idg-diagnosis-text");l.textContent="Inactive from",l.classList.add("fade"),i.style.display="none",o.style.display="inline-block"}else t.deleteCell(2),t.deleteCell(2),a.innerHTML=n,a.colSpan=3,e.hide(t.cells[3].querySelector(".js-idg-diagnosis-add-btn")),e.reshow(t.cells[3].querySelector(".toggle-switch")),t.cells[3].querySelector(".toggle-switch").checked=!0,e.reshow(t.cells[3].querySelector(".highlight")),a.querySelector("input").checked=!0,i.style.display="inline-block",o.style.display="none"};document.addEventListener("input",s=>{let a=s.target;if(a.matches(".js-idg-diagnosis-active-switcher .toggle-switch input")){let s=e.getParent(a,".js-idg-diagnosis-active-switcher");t(s,a.checked?"active":"inactive")}if(a.matches(".js-idg-diagnosis-doubt input")){let s=e.getParent(a,".js-idg-diagnosis-active-switcher");t(s,a.checked?"doubt":"confirmed")}if(a.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-diagnosis-state-options input")){((t,s)=>{let a=t.querySelector(".js-idg-sides"),i=t.querySelector(".js-idg-diagnosis-text"),o=t.querySelector(".js-idg-diagnosis-active-switcher"),l=o.querySelector(".toggle-switch"),r=o.querySelector(".js-idg-diagnosis-doubt"),c=o.querySelector(".js-idg-diagnosis-doubt-input"),d=t.querySelector(".js-idg-right-icon .oe-systemic-icons");switch(null==n&&(n=t.querySelector(".js-idg-diagnosis-state-options").innerHTML,e.reshow(i)),s){case"0":e.reshow(a),e.reshow(i),i.textContent="Active (confirmed)",i.classList.remove("fade"),e.reshow(l),l.querySelector("input").checked=!0,e.reshow(r),r.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i person-green small pad";break;case"1":e.hide(a),e.reshow(i),i.textContent="Not present",i.classList.add("fade"),e.hide(l),e.reshow(r),r.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad";break;case"2":e.hide(a),e.reshow(i),i.textContent="Not checked",i.classList.add("fade"),e.hide(l),e.hide(r),e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad"}})(e.getParent(a,".js-idg-demo-sys-diag-side-switcher"),a.value)}}),document.addEventListener("click",t=>{let s=t.target;if(s.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-sides")){let t=e.getParent(s,".js-idg-demo-sys-diag-side-switcher"),n=s.querySelector(".oe-i");"no-sides"==s.dataset.state?(a(t,!0),s.dataset.state="sides",n.classList.replace("person","person-split")):(a(t,!1),s.dataset.state="no-sides",n.classList.replace("person-split","person"))}}),document.addEventListener("mousedown",s=>{let n=s.target;var a;if(n.matches(".js-show-diagnosis-history")&&(a=n.dataset.idgdemo,document.querySelectorAll(".js-idg-diagnosis-history-"+a).forEach(e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"})),n.matches(".js-idg-diagnosis-active-switcher .remove-circle")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,"removed")}if(n.matches(".js-idg-diagnosis-add-btn")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,"active")}});e.userDown(".js-idg-demo-remove-oph-diag",t=>{e.xhr("/idg-php/v3/_load/specific/exam-oph-diag-delete.php").then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t,s.querySelector(".close-icon-btn").addEventListener("mousedown",t=>{t.stopPropagation(),e.remove(s)},{once:!0}),document.body.appendChild(s)}).catch(e=>console.log("failed to copy",e))})})(bluejay),(function(e){"use strict";e.addModule("GUI-btnShowContent");const t="active",s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),e.show(this.content,"block"))}}),n=()=>({hide:function(){this.open&&(this.open=!1,this.btn.classList.remove(t),e.hide(this.content))}}),a=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),n());[{btn:"#js-nav-shortcuts-btn",wrapper:"#js-nav-shortcuts",contentID:"js-nav-shortcuts-subnav"},{btn:"#js-nav-patientgroups-btn",wrapper:"#js-patientgroups-panel-wrapper",contentID:"js-patientgroups-panel"},{btn:"#js-header-print-dropdown-btn",wrapper:"#js-header-print-dropdown",contentID:"js-header-print-subnav"},{btn:"#js-sidebar-filter-btn",wrapper:"#js-sidebar-filter",contentID:"js-sidebar-filter-options"}].forEach(t=>{const s=document.querySelector(t.btn);if(null!==s){const n=a({btn:s,content:document.getElementById(t.contentID),open:!1});e.userDown(t.btn,()=>n.change()),e.userEnter(t.btn,()=>n.show()),e.userLeave(t.wrapper,()=>n.hide())}})})(bluejay),(function(e){"use strict";e.addModule("attachmentThumbnail");const t="oe-attachment-thumbnail";let s,n=!1;const a={};if(e.nodeArray(document.querySelectorAll("."+t)).length<1)return;const i=()=>{a.close.removeEventListener("mousedown",i),a.save&&(a.save.removeEventListener("mousedown",i),a.cancel.removeEventListener("mousedown",i)),e.remove(s),n=!1},o=t=>{n||(t=>{n=!0,s=document.createElement("div"),s.className="oe-popup-wrap";let o='<div class="oe-popup-attachment">';o+='<div class="title">'+t.title+"</div>",o+='<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>',o+='<div class="file-attachment-content"></div>',o+='<div class="file-size-controls"></div>',o+="</div>",s.innerHTML=o;const l=s.querySelector(".file-attachment-content"),r=s.querySelector(".file-size-controls"),c=new DocumentFragment,d=(e,t,s=!1)=>{let n=document.createElement("button");return n.className=t,s&&(n.id=s),n.textContent=e,c.appendChild(n),n};if("pdf"!==t.type){let e="url('"+t.file+"')";l.style.backgroundImage=e,l.innerHTML='<img src="'+t.file+'" style="display:none"/>';const n=s.querySelector("img"),a=d("Fit to screen","pro-theme selected","oe-att-fit"),i=d("Actual size","pro-theme","oe-att-actual"),o=(e,t,s,a)=>{l.style.backgroundImage=e,n.style.display=t,s.classList.add("selected"),a.classList.remove("selected")};i.addEventListener("mousedown",e=>{e.stopPropagation(),o("none","block",i,a)}),a.addEventListener("mousedown",t=>{t.stopPropagation(),o(e,"none",a,i)})}else l.innerHTML='<embed src="'+t.file+'" width="100%" height="100%"></embed>',d("PDF","pro-theme selected");if(t.annotate){l.classList.add("annotation");let n=document.createElement("div");n.className="attachment-annotation",e.find(".oe-popup-attachment",s).appendChild(n),e.xhr(t.idgPHP).then(e=>{n.innerHTML=e,"L"==t.eyelat&&(n.querySelector("#annotation-right").style.visibility="hidden"),"R"==t.eyelat&&(n.querySelector("#annotation-left").style.visibility="hidden")}).catch(e=>console.log("XHR failed: ",e)),a.save=d("Save annotations","green hint"),a.cancel=d("Cancel","red hint"),a.save.addEventListener("mousedown",i,{once:!0}),a.cancel.addEventListener("mousedown",i,{once:!0})}if(t.stack){let n=t.title.split(" - "),a="<option>"+t.title+"</option>";for(let e=t.stack;e;e--)a+="<option>"+n[0]+" - ("+e+" Jan 1975 09:30)</option>";let i=document.createElement("div");i.className="attachment-stack",i.innerHTML='Choose report: <select class="pro-theme">'+a+"</select>",e.find(".oe-popup-attachment",s).appendChild(i)}a.close=s.querySelector(".close-icon-btn"),a.close.addEventListener("mousedown",i,{once:!0}),r.appendChild(c),document.body.appendChild(s)})(JSON.parse(t.target.dataset.attachment))};e.userDown("."+t,o),document.querySelectorAll(".js-annotate-attachment")&&e.userDown(".js-annotate-attachment",o)})(bluejay),(function(e){"use strict";e.addModule("collapseExpand");const t=new e.Collection,s=()=>({show:function(){e.show(this.content,"block"),this.btn.classList.replace("expand","collapse"),this.open=!0}}),n=()=>({hide:function(){e.hide(this.content),this.btn.classList.replace("collapse","expand"),this.open=!1}}),a=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),n()),i=(s,n)=>{let i,o=s.target,l=t.getKey(o);l?i=t.get(l):(i=a({btn:o,content:e.find(".collapse-"+n+"-content",o.parentNode),open:o.classList.contains("collapse")}),t.add(i,o)),i.change()};e.userDown(".collapse-data-header-icon",e=>i(e,"data")),e.userDown(".collapse-group > .header-icon",e=>i(e,"group")),e.userDown(".collapse-hotlist > .header-icon",e=>i(e,"hotlist"))})(bluejay),(function(e){"use strict";e.addModule("comments");e.userDown(".js-add-comments",t=>{const s=t.target,n=JSON.parse(s.dataset.idgdemo);if(e.hide(s),n.bilateral){const t=document.querySelector("#"+n.id+"-right"),a=document.querySelector("#"+n.id+"-left");e.show(t,"block"),e.show(a,"block"),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(s),e.hide(t),e.hide(a)},{once:!0}),a.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(s),e.hide(t),e.hide(a)},{once:!0})}else{const t=document.querySelector("#"+n.id);e.show(t,"block"),t.querySelector("textarea").focus(),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(s),e.hide(t)},{once:!0})}})})(bluejay),(function(e){"use strict";e.addModule("commentHotlist");const t=new e.Collection,s=()=>({reset(){this.editMode=!1,this.icon("comment"),e.hide(this.elem.textarea),e.hide(this.elem.userComment)}}),n=()=>({show(){this.editMode=!1,this.icon("edit");let t=e.wrapQtags(this.comment);this.elem.userComment.innerHTML=t.DOMString,this.comment=t.text,e.hide(this.elem.textarea),e.show(this.elem.userComment,"block")}}),a=()=>({edit(){this.editMode=!0,this.icon("save"),e.show(this.elem.textarea,"block"),e.hide(this.elem.userComment),this.elem.textarea.value=this.comment,e.resizeTextArea(this.elem.textarea),setTimeout(()=>this.elem.textarea.focus(),20);const t=e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),this.update(),this.elem.textarea.removeEventListener("keydown",t,!1))};this.elem.textarea.addEventListener("keydown",t,!1)}}),i=()=>({icon(t){switch(this.elem.icon.classList.remove("comments","comments-added","save","active"),t){case"comment":this.elem.icon.classList.add("comments");break;case"edit":this.elem.icon.classList.add("comments-added");break;case"save":this.elem.icon.classList.add("save","active");break;default:e.log("commentHotlist - unknown icon: "+t)}}}),o=()=>({userClick(){this.editMode?this.update():this.edit()}}),l=()=>({update(){let e=this.elem.textarea.value.trim();e.length?(this.comment=e,this.show()):(this.comment="",this.reset())}}),r=(e,t,r="")=>{const c=['<textarea placeholder="Comments" rows="1" class="cols-full js-allow-qtags" style="display:none"></textarea>','<div class="user-comment" style="display:none">{{comment}}</div>'].join("");let d=document.createElement("div");d.className="patient-comments",d.innerHTML=Mustache.render(c,{comment:r}),t.appendChild(d);let u=d.querySelector("textarea"),p=d.querySelector(".user-comment");return Object.assign({editMode:!1,comment:r,elem:{icon:e,textarea:u,userComment:p}},s(),n(),a(),i(),o(),l())};e.userDown(".oe-hotlist-panel .js-comment-icon",s=>{const n=s.target;let a=t.getKey(n);if(a){t.get(a).userClick()}else{let s=e.getParent(n,"tr").querySelector(".js-patient-comment"),a=r(n,s);a.edit(),t.add(a,n)}}),document.addEventListener("DOMContentLoaded",()=>{e.nodeArray(document.querySelectorAll(".oe-hotlist-panel .activity-list tr")).forEach(e=>{if(e.hasAttribute("data-comment")){let s=JSON.parse(e.dataset.comment);if(s.comment){let n=e.querySelector(".oe-i.comments"),a=e.querySelector(".js-patient-comment"),i=r(n,a,s.comment);i.show(),t.add(i,n)}}})},{once:!0})})(bluejay),(function(e){"use strict";e.addModule("ed3");let t=!1;e.userDown(".js-idg-ed3-app-btn",s=>{let n=s.target;t=t||(()=>{let e=document.createElement("div");return e.className="oe-eyedraw-app spinner-loader",document.body.appendChild(e),e})();let a=n.getBoundingClientRect().bottom-532;t.style.top=a<60?"60px":a+"px",e.show(t,"block");let i=JSON.parse(n.dataset.idgDemo);var o=Object.keys(i).map(e=>e+"="+i[e]).join("&");e.xhr("/idg-php/v3/_load/ed3/ed3-app.php?"+o).then(e=>{t.innerHTML=e,t.querySelector(".close-icon-btn").addEventListener("mousedown",()=>{t.style.display="none"},{once:!0})}).catch(e=>console.log("ed3app php failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("elementSelector");const t=()=>({loadPHP:function(t){e.xhr(t).then(e=>{!1!==this.open&&(this.nav=document.createElement("nav"),this.nav.className=this.wrapClass,this.nav.innerHTML=e,this.btn.classList.add("selected"),document.body.appendChild(this.nav))}).catch(e=>console.log("PHP failed to load",e))}}),s=()=>({close:function(){this.open=!1,this.btn.classList.remove("selected"),e.remove(this.nav)}}),n=()=>({change:function(e){if(null===this.btn&&(this.btn=e.target),this.open)this.close();else{this.open=!0;let e=JSON.parse(this.btn.dataset.demophp);!1!==e?this.loadPHP(e):this.elementSideNav()}}}),a=()=>({elementSideNav:function(){this.nav=document.createElement("nav"),this.nav.className=this.wrapClass;const t=e.nodeArray(document.querySelectorAll(".element .element-title")).map(e=>'<li class="element" id="side-element-contacts"><a href="#" class="selected">'+e.textContent+"</a></li>");this.nav.innerHTML=['<div class="element-structure">','<ul class="oe-element-list">',t.join(""),"</ul>","</div>"].join(""),document.body.appendChild(this.nav)}}),i=e=>Object.assign({btn:null,open:!1,wrapClass:e},n(),t(),a(),s());if(null!==document.querySelector("#js-manage-elements-btn")){const t=i("oe-element-selector");e.userDown("#js-manage-elements-btn",e=>t.change(e)),e.userDown(".oe-element-selector .close-icon-btn button",()=>t.close())}if(null!==document.querySelector("#js-element-structure-btn")){const t=i("sidebar element-overlay");e.userDown("#js-element-structure-btn",e=>t.change(e))}})(bluejay),(function(e){"use strict";e.addModule("elementTiles");const t=[],s=()=>({show:function(){this.h3.textContent=this.title,e.show(this.content,"block")}}),n=()=>({hide:function(){this.h3.innerHTML=this.title+" <small>["+this.count+"]</small>",e.hide(this.content)}}),a=e=>Object.assign({tiles:[],btn:e,collapsed:!1},{addTile:function(e){this.tiles.push(e)}},{change:function(){this.tiles.forEach(e=>{this.collapsed?(this.btn.classList.replace("increase-height","reduce-height"),e.show()):(this.btn.classList.replace("reduce-height","increase-height"),e.hide())}),this.collapsed=!this.collapsed}});e.userDown(".collapse-tile-group .oe-i",i=>{let o=e.getParent(i.target,".element-tile-group"),l=e.getDataAttr(o);if(l)t[parseFloat(l)].change();else{let l=a(i.target);e.nodeArray(o.querySelectorAll(".element.tile")).forEach(e=>{l.addTile((e=>{const t=e.querySelector(".element-title"),a=t.textContent,i=e.querySelector(".element-data"),o=i.querySelectorAll("tbody tr").length;return Object.assign({h3:t,title:a,content:i,count:o.toString()},s(),n())})(e))}),l.change(),e.setDataAttr(o,t.length),t.push(l)}})})(bluejay),(function(e){"use strict";e.addModule("eventAuditTrial");const t="#js-event-audit-trail-btn",s=document.querySelector(t);if(null===s)return;const n=document.querySelector("#js-event-audit-trail");null===n&&e.log("Audit Trail content not available in DOM?");let a=!1;const i=t=>{e.show(n,"block"),s.classList.add("active"),a=!0},o=t=>{e.hide(n),s.classList.remove("active"),a=!1};e.userDown(t,e=>a?o(e):i(e)),e.userEnter(t,i),e.userLeave(t,o)})(bluejay),(function(e){"use strict";e.addModule("eventsUserTrail");if(null===document.querySelector("#js-events-user-trail"))return;let t=null;e.userDown("#js-events-user-trail",()=>{t=document.createElement("div"),t.className="oe-popup-wrap";let s=document.createElement("div");s.className="oe-popup oe-events-user-trail",t.appendChild(s),document.body.appendChild(t);let n=setTimeout(()=>s.innerHTML='<i class="spinner"></i>',400);e.xhr("/idg-php/v3/_load/sidebar/events-user-trail-v2.php").then(e=>{clearTimeout(n),s.innerHTML=e}).catch(e=>console.log("ed3app php failed to load",e))}),e.userDown(".js-idg-toggle-event-audit-trail",e=>{let s=e.target,n=t.querySelector("#"+s.dataset.auditid);"block"===n.style.display?n.style.display="none":n.style.display="block"}),e.userDown(".oe-events-user-trail .close-icon-btn .oe-i",()=>{e.remove(t)})})(bluejay),(function(e){"use strict";if(e.addModule("examElementSearch"),null===document.querySelector("#js-search-in-event-popup"))return;e.userDown("#js-search-in-event",t=>{const s=t.target,n=document.querySelector("#js-search-in-event-popup"),a=document.querySelector(".main-event"),i=n.querySelector(".close-icon-btn");s.classList.add("selected"),e.show(n,"block"),a.classList.add("examination-search-active"),i.addEventListener("mousedown",t=>{t.stopPropagation(),a.classList.remove("examination-search-active"),e.hide(n),s.classList.remove("selected")},{once:!0})})})(bluejay),(function(e){"use strict";e.addModule("fastDatePicker");const t=Date.now(),s=new Date(t),n=Object.assign({pickDate:null,inputDate:null,get date(){return this.pickDate},set date(e){this.pickDate=e,this.views.notify()},get userDate(){return null!=this.inputDate&&this.inputDate},set userDate(e){this.inputDate=e},changeMonth(e){this.pickDate.setMonth(e),this.views.notify()},changeFullYear(e){this.pickDate.setFullYear(e),this.views.notify()}},e.ModelViews()),a=(()=>{let t;const a=(e,s)=>{if(e.getMonth()==n.date.getMonth()&&e.getFullYear()==n.date.getFullYear()){t.querySelector("#js-fast-date-"+e.getDate()).classList.add(s)}};return n.views.add(()=>{const e=n.date.getFullYear(),i=n.date.getMonth(),o=new Date(e,i,1).getDay(),l=new Date(e,i+1,0).getDate(),r=[],c=[],d=[];for(let t=(o||7)-1,s=new Date(e,i,0).getDate();t>0;t--,s--)r.push(s);for(let e=1;e<=l;e++)c.push(e);const u=42-(r.length+c.length);for(let e=1;e<=u;e++)d.push(e);r.reverse();const p=Mustache.render('{{#prev}}<div class="prev">{{.}}</div>{{/prev}}',{prev:r}),h=Mustache.render('{{#current}}<div id="js-fast-date-{{.}}">{{.}}</div>{{/current}}',{current:c}),y=Mustache.render('{{#next}}<div class="next">{{.}}</div>{{/next}}',{next:d});t.innerHTML=p+h+y,a(s,"today"),0!=n.userDate&&a(n.userDate,"selected")}),{reset:()=>{t=null},build:s=>{t=e.div("date-grid"),t.innerHTML=Mustache.render('{{#divs}}<div class="prev">{{.}}</div>{{/divs}}',{divs:new Array(42).fill("")}),s.appendChild(t)}}})(),i=(()=>{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let s,a;return n.views.add(()=>{const e=s.children[n.date.getMonth()];a&&a.classList.remove("selected"),e.classList.add("selected"),a=e}),{reset:()=>{s=null,a=null},build:n=>{s=e.div("month"),s.innerHTML=Mustache.render("{{#months}}<div>{{.}}</div>{{/months}}",{months:t}),n.appendChild(s)},getMonthNum:e=>t.indexOf(e),getMonthName:e=>t[e]}})(),o=(()=>{let t,s;const a=()=>{const e=n.date.getFullYear();return{c:Math.floor(e/100),d:parseFloat(e.toString().charAt(2)),y:parseFloat(e.toString().charAt(3))}};return n.views.add(()=>{const e=a();e.c=20==e.c?1:0,s.c.forEach(e=>e.classList.remove("selected")),s.d.forEach(e=>e.classList.remove("selected")),s.y.forEach(e=>e.classList.remove("selected")),s.c[e.c].classList.add("selected"),s.d[e.d].classList.add("selected"),s.y[e.y].classList.add("selected")}),{reset:()=>{t=null,s=null},build:n=>{const a=['<div class="century">{{#century}}<div>{{.}}</div>{{/century}}</div>','<ul class="decade">{{#ten}}<li>{{.}}</li>{{/ten}}</ul>','<ul class="single">{{#ten}}<li>{{.}}</li>{{/ten}}</ul>'].join(""),i=Array.from(Array(10).keys());t=e.div("year"),t.innerHTML=Mustache.render(a,{century:["19","20"],ten:i}),s={c:t.querySelector(".century").childNodes,d:t.querySelector(".decade").childNodes,y:t.querySelector(".single").childNodes},n.appendChild(t)},getYearUnits:a}})(),l=(()=>{let s,r,c=!1;const d=()=>{if(c)return c=!1,void s.focus();a.reset(),i.reset(),o.reset(),document.removeEventListener("blur",l.remove,{capture:!0}),window.removeEventListener("scroll",l.remove,{capture:!0,once:!0}),e.remove(r),r=null,s=null};return{show:c=>{if(c.isSameNode(s))return;s=c;const d=s.getBoundingClientRect();r=e.div("fast-date-picker"),r.style.left=d.right-430+"px",r.style.top=d.bottom+"px",d.left<430&&(r.style.left=d.left+"px"),d.bottom+240>e.getWinH()&&(r.style.top=d.top-240+"px"),o.build(r),i.build(r),a.build(r),document.body.appendChild(r),(()=>{let e,a=!1;if(s.value&&/^\d{1,2} [a-z]{3} \d{4}/i.test(s.value)&&(e=Date.parse(s.value),!isNaN(e))){const t=new Date(e),s=t.getFullYear();s>1900&&s<2099&&(a=t)}a?(n.userDate=a,n.date=new Date(e)):n.date=new Date(t)})(),document.addEventListener("blur",l.remove,{capture:!0}),window.addEventListener("scroll",l.remove,{capture:!0,once:!0})},remove:d,changeDate:(e,t)=>{c=!0;const s=parseFloat(e.textContent),a=o.getYearUnits();switch(t){case"month":n.changeMonth(i.getMonthNum(e.textContent));break;case"century":if(s==a.c)return;19==s?n.changeFullYear(1999):n.changeFullYear(2e3);break;case"decade":let t=10*(s-a.d);n.changeFullYear(n.date.getFullYear()+t);break;case"year":let o=s-a.y;n.changeFullYear(n.date.getFullYear()+o)}},selectDate:e=>{const t=parseFloat(e.textContent);let a=n.date.getMonth();e.classList.contains("prev")&&n.changeMonth(a-1),e.classList.contains("next")&&n.changeMonth(a+1),n.date.setDate(t),s.value=(e=>e.getDate()+" "+i.getMonthName(e.getMonth())+" "+e.getFullYear())(n.date),d()}}})();document.addEventListener("focus",e=>{e.target.matches("input.date")&&l.show(e.target)},{capture:!0}),e.userDown(".fast-date-picker .month > div",e=>l.changeDate(e.target,"month")),e.userDown(".fast-date-picker .century > div",e=>l.changeDate(e.target,"century")),e.userDown(".fast-date-picker .decade li",e=>l.changeDate(e.target,"decade")),e.userDown(".fast-date-picker .single li",e=>l.changeDate(e.target,"year")),e.userDown(".fast-date-picker .date-grid > div",e=>l.selectDate(e.target))})(bluejay),(function(e){"use strict";e.addModule("fastDateRange");if(null==document.querySelector(".fast-date-range"))return;const t=document.querySelector(".js-filter-date-to"),s=document.querySelector(".js-filter-date-from"),n=document.getElementsByName("show-all-date-range")[0],a=Date.now(),i=new Date(a),o=864e5,l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=e=>e.getDate()+" "+l[e.getMonth()]+" "+e.getFullYear(),c=(e,a)=>{t.value=r(e),s.value=r(a),n.checked=!1},d=e=>c(e,e),u=e=>{let t=i.getDay(),s=a+o*(1-t)+o*e;c(new Date(s),new Date(s+4*o))},p=e=>{let t=i.getFullYear(),s=i.getMonth()+e;s>11&&(s=0,t+=1),s<0&&(s=11,t-=1),c(new Date(t,s,1),new Date(t,s+1,0))};e.userDown(".fast-date-range .range",t=>{const s=t.target;if(!s.hasAttribute("data-range"))return;const n=s.getAttribute("data-range");switch(n){case"yesterday":d(new Date(a-o));break;case"today":d(i);break;case"tomorrow":d(new Date(a+o));break;case"last-week":u(-7);break;case"this-week":u(0);break;case"next-week":u(7);break;case"last-month":p(-1);break;case"this-month":p(0);break;case"next-month":p(1);break;default:e.log("[fastDateRange] unknown range request: "+n)}})})(bluejay),(function(e){"use strict";e.addModule("filterOptions");const t=[],s="active",n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(s),this.positionContent(),e.show(this.content,"block"),this.mouseOutHide(),this.closeIconBtn())}}),a=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(s),e.hide(this.content))}}),i=()=>({positionContent:function(){this.defaultCSS=this.defaultCSS||this.content.className;let t,s,n,a=this.btn.getBoundingClientRect(),i=e.getHiddenElemSize(this.content);a.top<400?(t="top",s=a.top):(t="bottom",s=a.bottom-i.h),a.left<500?(t+="-left",n=a.left):(t+="-right",n=a.right-i.w),this.content.className=this.defaultCSS+" "+t,this.content.style.top=s+"px",this.content.style.left=n+"px"}}),o=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},n(),a(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}},{closeIconBtn:function(){this.wrapper.querySelector(".close-icon-btn").addEventListener("mousedown",e=>{e.stopPropagation(),this.hide()},{once:!0})}},i());e.userDown(".oe-filter-options .oe-filter-btn",s=>(s=>{let n=s.target,a=e.getDataAttr(n);if(a)t[parseFloat(a)].change();else{let s=e.getParent(n,".oe-filter-options"),a=o({btn:n,wrapper:s,content:s.querySelector(".filter-options-popup")});a.show(),e.setDataAttr(n,t.length),t.push(a)}})(s))})(bluejay),(function(e){"use strict";const t=e.nodeArray(document.querySelectorAll(".hidden"));t.length&&t.forEach(t=>{e.hide(t),t.classList.remove("hidden")});const s=e.nodeArray(document.querySelectorAll(".tr-collapse"));s.length&&s.forEach(e=>{e.style.visibility="collapse",e.classList.remove("tr-collapse")})})(bluejay),(function(e){"use strict";e.addModule("lightning");if(null===document.querySelector(".oe-lightning-viewer"))return;const t=()=>({updateView:function(e){this.updateStack(e),this.updateMeta(document.querySelector(this.iconPrefix+e).dataset.meta)}}),s=()=>({updateStack:function(t){e.hide(document.querySelector(this.stackPrefix+this.currentStack)),e.show(document.querySelector(this.stackPrefix+t),"block"),this.currentStack=t,this.updateCounter(),this.timelineIcon()}}),n=()=>({updateCounter:function(){document.querySelector(".lightning-ui .stack-position").textContent=this.currentStack+1+"/"+this.totalStackNum}}),a=()=>({timelineIcon:function(){document.querySelector(".icon-event").classList.remove("js-hover"),document.querySelector(this.iconPrefix+this.currentStack).classList.add("js-hover")}}),i=()=>({xscroll:function(e,t){var s=Math.floor(e/(this.xscrollWidth/this.totalStackNum));0==this.locked&&this.updateView(s)}}),o=()=>({swipeLock:function(){this.locked=!this.locked;let e=document.querySelector(".lightning-ui .user-help");this.locked?e.textContent="Swipe is LOCKED | Click to unlock":e.textContent="Swipe to scan or use key RIGHT / LEFT | Click to LOCK swipe"}}),l=Object.assign({currentStack:0,iconPrefix:"#lqv_",stackPrefix:"#lsg_",totalStackNum:document.querySelectorAll(".stack-group").length,xscrollWidth:document.querySelector(".lightning-view").clientWidth,locked:!0},t(),{updateMeta:function(e){let t=document.querySelector(".lightning-meta"),s=e.split(",");[".type",".date",".who"].forEach((e,n)=>{t.querySelector(e).textContent=s[n]})}},s(),n(),a(),i(),o(),{stepThrough:function(e){var t=this.currentStack+e;t>=0&&t<this.totalStackNum&&this.updateView(t)}});l.updateCounter(),l.swipeLock(),e.userDown("#lightning-left-btn",()=>l.stepThrough(-1)),e.userDown("#lightning-right-btn",()=>l.stepThrough(1)),e.userDown(".lightning-view",()=>l.swipeLock()),e.userDown(".icon-event",()=>l.swipeLock()),e.userEnter(".icon-event",e=>{let t=e.target;l.updateStack(t.dataset.id),l.updateMeta(t.dataset.meta)});const r=document.querySelector(".lightning-view");r.addEventListener("mousemove",e=>{}),e.listenForResize(()=>l.xscrollWidth=r.clientWidth),document.addEventListener("keydown",e=>{37==(e.keyCode||e.which)&&l.stepThrough(-1),39==(e.keyCode||e.which)&&l.stepThrough(1)})})(bluejay),(function(e){"use strict";e.addModule("lightningIconGroups");const t=e.nodeArray(document.querySelectorAll(".icon-group"));if(t.length<1)return;t.forEach(t=>{let s=t.childElementCount,n=document.createElement("div");n.textContent="("+s+")",e.hide(n),t.parentNode.appendChild(n)});e.userDown(".js-timeline-date",t=>{let s=t.target,n=document.querySelector("#js-icon-"+s.dataset.icons);s.classList.contains("collapse")?(e.hide(n),e.show(n.nextElementSibling,"block"),s.classList.replace("collapse","expand")):(e.show(n,"block"),e.hide(n.nextElementSibling),s.classList.replace("expand","collapse"))})})(bluejay),(function(e){"use strict";if(e.addModule("messagePreview"),null===document.querySelector(".home-messages"))return;e.nodeArray(document.querySelectorAll(".js-message .message")).forEach(e=>{e.scrollWidth<=e.clientWidth&&(e.parentNode.nextSibling.querySelector(".js-expand-message").style.display="none")});e.userDown(".js-expand-message",t=>{let s=t.target,n=e.getParent(s,"tr").querySelector(".message");s.classList.contains("expand")?(n.classList.add("expand"),s.classList.replace("expand","collapse")):(n.classList.remove("expand"),s.classList.replace("collapse","expand"))})})(bluejay),(function(e){"use strict";e.addModule("multiPageScroll");let t=e.nodeArray(document.querySelectorAll(".lightning-multipage-scroll"));if(0===t.length)return;const s=()=>({animateScrollTo:function(e){let t=1,s=0,n=this.stack.scrollTop,a=this.pageH*e-n;clearInterval(this.animateID),this.animateID=setInterval(()=>{var e;s=Math.min(1,t/80),this.stack.scrollTop=Math.ceil(((e=s)<.5?2*e*e:(4-2*e)*e-1)*a)+n,t+=1,1==s&&clearInterval(this.animateID)},2)}}),n=()=>({pageBtn:function(e){e.matches(".page-num-btn")&&this.animateScrollTo(parseFloat(e.dataset.page))}});t.forEach(e=>{(e=>{e.numOfImgs=e.stack.querySelectorAll("img").length,e.pageH=parseFloat(e.stack.querySelector("img").height+10),e.animateID=null;let t=new DocumentFragment;for(let s=0;s<e.numOfImgs;s++){let n=document.createElement("div");n.className="page-num-btn",n.setAttribute("data-page",s),n.textContent=s+1+"/"+e.numOfImgs,t.appendChild(n)}e.nav.appendChild(t),e.nav.addEventListener("mouseenter",t=>e.pageBtn(t.target),{capture:!0}),e.nav.addEventListener("mousedown",t=>e.pageBtn(t.target),{capture:!0}),Object.assign(e,n(),s())})({nav:e.querySelector(".multipage-nav"),stack:e.querySelector(".multipage-stack")})})})(bluejay),(function(e){"use strict";e.addModule("navHotlist");const t="active",s="open",n="#js-nav-hotlist-btn",a=document.querySelector(n);if(null===a)return;const i=()=>({over:function(){this.isFixed||(this.btn.classList.add(t),this.show())}}),o=()=>({show:function(){this.open||(this.open=!0,e.show(this.content,"block"))}}),l=()=>({hide:function(){!this.open||this.isLocked||this.isFixed||(this.open=!1,this.btn.classList.remove(t,s),e.hide(this.content))}}),r=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(s)}}),c=()=>({fixedOpen:function(e){this.isFixed=e,e?(this.isLocked=!1,this.btn.classList.add(s),this.btn.classList.remove(t),this.show()):this.hide()}}),d=Object.assign({btn:a,content:document.getElementById("js-hotlist-panel"),open:!1,isLocked:!1,isFixed:!1},{changeState:function(){this.isFixed||(this.open?this.isLocked?(this.isLocked=!1,this.hide()):this.makeLocked():(this.makeLocked(),this.over()))}},i(),r(),o(),l(),c()),u=()=>{"true"===a.dataset.fixable&&d.fixedOpen(window.innerWidth>e.settings("cssHotlistFixed"))};e.userDown(n,()=>d.changeState()),e.userEnter(n,()=>d.over()),e.userLeave("#js-hotlist-panel-wrapper",()=>d.hide()),e.listenForResize(u),u()})(bluejay),(function(e){"use strict";e.addModule("navLogo");const t="active",s="open",n="#js-openeyes-btn";null!==document.querySelector(".oe-login")&&document.querySelector(n).classList.add(t);const a=()=>({over:function(){this.btn.classList.add(t)}}),i=()=>({out:function(){this.btn.classList.remove(t)}}),o=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(s),e.show(this.content,"block"))}}),l=()=>({hide:function(){this.open&&(this.open=!1,this.btn.classList.remove(s,t),e.hide(this.content))}}),r=Object.assign({btn:document.querySelector(n),content:document.querySelector("#js-openeyes-info"),open:!1},a(),i(),{change:function(){this.open?this.hide():this.show()}},o(),l());e.userDown(n,()=>r.change()),e.userEnter(n,()=>r.over()),e.userLeave(n,()=>r.out()),e.userLeave(".openeyes-brand",()=>r.hide())})(bluejay),(function(e){"use strict";if(e.addModule("notificationBanner"),null===document.querySelector("#oe-admin-notifcation"))return;const t="#oe-admin-notifcation .oe-i",s=document.querySelector("#notification-short"),n=document.querySelector("#notification-full");if(null!==document.querySelector(".oe-login"))return e.hide(s),e.show(n,"block"),void(document.querySelector(t).style.display="none");let a=s,i=n,o=!0;const l=(e,t)=>{e.style.display="block",t.style.display="none"};e.userEnter(t,()=>l(i,a)),e.userLeave(t,()=>l(a,i)),e.userDown(t,()=>{a=o?n:s,i=o?s:n,o=!o,l(a,i)})})(bluejay),(function(e){"use strict";e.addModule("overlayPopup");const t=[{id:"#js-idg-popup-content-template",php:"_popup-content-template.php"},{id:"#js-change-context-btn",php:"change-context.php"},{id:"#copy-edit-history-btn",php:"previous-history-elements.php"},{id:"#copy-edit-anterior-segment-btn",php:"previous-ed-anterior.php"},{id:"#js-virtual-clinic-btn",php:"virtual-clinic.php"},{id:"#js-delete-event-btn",php:"delete-event.php"},{id:"#js-close-element-btn",php:"close-element.php"},{id:"#js-add-new-event",php:"add-new-event.php"},{id:"#js-idg-preview-correspondence",php:"letter-preview.php"},{id:"#js-idg-exam-complog",php:"exam-va-COMPlog.php"},{id:"#js-duplicate-event-btn",php:"duplicate-event-warning.php"},{id:"#js-idg-worklist-ps-add",php:"worklist-PS.php"},{id:"#analytics-change-filters",php:"analytics-filters.php"},{id:"#js-idg-add-new-contact-popup",php:"add-new-contact.php"},{id:"#js-idg-admin-queset-demo",php:"admin-add-queue.php"},{id:"#js-idg-search-query-save",php:"query-save.php"},{id:"#js-idg-search-all-searches",php:"query-all-searches.php"}],s=(t,s)=>{e.userDown(t,()=>{e.xhr("/idg-php/v3/_load/"+s).then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t,s.querySelector(".close-icon-btn").addEventListener("mousedown",t=>{t.stopPropagation(),e.remove(s)},{once:!0}),document.body.appendChild(s)}).catch(e=>console.log("OverlayPopup failed to load: Err msg -",e))})};for(let e=0,n=t.length;e<n;e++){let n=t[e];null!==document.querySelector(n.id)&&s(n.id,n.php)}})(bluejay),(function(e){"use strict";e.addModule("overlayPopupJSON");e.userDown(".js-idg-demo-popup-json",t=>{let s;if(void 0===t.target.dataset.idgDemo)throw new Error("overlayPopupJSON: No php file info? Needs data-idg-demo=json");s=JSON.parse(t.target.dataset.idgDemo).php,e.xhr("/idg-php/v3/_load/"+s).then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t,document.body.appendChild(s);let n=s.querySelector(".close-icon-btn");n&&n.addEventListener("mousedown",t=>{t.stopPropagation(),e.remove(s)},{once:!0})}).catch(e=>console.log("overlayPopupJSON: Failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("pathSteps");const t=".oe-pathstep-btn";if(null===document.querySelector(t))return;let s=!1;const n=document.createElement("div");n.style.display="none",n.className="oe-pathstep-popup",n.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<h3 class="title"></h3>','<div class="popup-overflow"><div class="data-group">','<table class="data-table"><tbody>',"</tbody></table>","</div></div>",'<div class="step-actions">','<button class="green hint">Administer</button><button class="red hint">Remove PSD</button>',"</div>",'<div class="step-status"></div>'].join(""),document.body.appendChild(n);const a={title:n.querySelector(".title"),closeBtn:n.querySelector(".close-icon-btn .oe-i"),status:n.querySelector(".step-status"),tbody:n.querySelector(".data-table tbody"),actions:n.querySelector(".step-actions"),detailRows:null,locked:!1},i=e=>{let t,s="NA";return"R"!=e&&"B"!=e||(t="R"),"L"!=e&&"B"!=e||(s="L"),`<span class="oe-eye-lat-icons"><i class="oe-i laterality ${t} small"></i><i class="oe-i laterality ${s} small"></i></span>`},o=(e,t,s=!1)=>{let n=document.createElement("tr");s&&(n.className=s),e.forEach(e=>{let t=document.createElement("td");t.innerHTML=e,n.appendChild(t)}),t.appendChild(n)},l=t=>{let s=document.createDocumentFragment();t.forEach(e=>{var t;o((t=e.directive,[i(t[0]),t[1],t[2]]),s),e.steps.forEach(e=>{o((e=>{return 1==e.length&&(e=e.concat(['<em class="fade">to do</em>',""])),[(t=e[0],`<i class="oe-i ${t} small"></i>`),e[1],e[2]];var t})(e),s,"administer-details")})}),a.tbody.innerHTML="",a.tbody.appendChild(s),a.detailRows=e.nodeArray(n.querySelectorAll(".administer-details"))},r=()=>{let e=JSON.parse(s.dataset.step);a.title.textContent=e.title,l(e.psd),(e=>{let t="No status set",s="default";switch(e){case"done":t="PSD: Completed at 11:40",s="green";break;case"todo":t="PSD: Waiting to start",s="default";break;case"progress":t="PSD: In progress",s="orange";break;case"problem":t="Issue with PSD",s="red"}a.status.textContent=t,a.status.className=["step-status",s].join(" ")})(e.status)},c=e=>{let t=e?"block":"none",s=e?"table-row":"none";a.title.style.display=t,a.closeBtn.style.display=t,a.actions.style.display="",a.detailRows.forEach(e=>e.style.display=s)},d=()=>{a.locked=!1,n.style.display="none"},u=(e,t,s=0)=>{n.style.top=e+s+"px",n.style.left=t-360+"px",n.style.display="block"};e.userDown(t,e=>{e.target!==s&&(s=e.target,r()),c(!0),a.locked=!0;let t=s.getBoundingClientRect();u(t.top,t.right,-5),window.addEventListener("scroll",d,{capture:!0,once:!0})}),e.userEnter(t,e=>{if(a.locked)return;s=e.target,r(),c(!1);let t=s.getBoundingClientRect();u(t.bottom,t.right)}),e.userLeave(t,e=>{a.locked||d()}),e.userDown(".oe-pathstep-popup .close-icon-btn .oe-i",d)})(bluejay),(function(e){"use strict";e.addModule("patientPopups");const t="active",s="open",n=[{btn:"#js-quicklook-btn",content:"#patient-summary-quicklook"},{btn:"#js-demographics-btn",content:"#patient-popup-demographics"},{btn:"#js-management-btn",content:"#patient-popup-management"},{btn:"#js-allergies-risks-btn",content:"#patient-popup-allergies-risks"},{btn:"#js-charts-btn",content:"#patient-popup-charts"},{btn:"#js-patient-extra-btn",content:"#patient-popup-trials"}],a=()=>({over:function(){this.btn.classList.add(t),this.show()}}),i=()=>({out:function(e){e.relatedTarget!==this.content&&(this.hide(),this.btn.classList.remove(t))}}),o=()=>({show:function(){this.open||(this.open=!0,d(this),this.btn.classList.add(s),e.show(this.content,"block"))}}),l=()=>({hide:function(){!1===this.open||this.isLocked||(this.open=!1,this.btn.classList.remove(t,s),e.hide(this.content))}}),r=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(s)}}),c=e=>(e.open=!1,e.isLocked=!1,Object.assign(e,{change:function(){this.open?this.hide():this.show()}},a(),i(),r(),o(),l(),{makeHidden:function(){this.open&&(this.isLocked=!1,this.hide())}})),d=e=>{n.forEach(t=>{t.popup!=e&&t.popup.makeHidden()})};n.forEach(t=>{let s=document.querySelector(t.btn);if(null!==s){let n=c({btn:s,content:document.querySelector(t.content)});e.userDown(t.btn,()=>n.change()),e.userEnter(t.btn,()=>n.over()),e.userLeave(t.btn,e=>n.out(e)),e.userLeave(t.content,e=>n.out(e)),t.popup=n}})})(bluejay),(function(e){"use strict";e.addModule("patientQuickMeta");let t=!1,s=!1,n=null,a=null,i=null,o=window.innerHeight;const l={},r=()=>{a.style.display="none",t=s=!1,n=null},c=(r,c)=>{if(n===r&&t)return s=!0,void e.show(i,"block");a=a||(()=>{const e=document.createElement("div");return e.className="oe-patient-quick-overview",e.style.display="none",e.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<div class="oe-patient-meta">','<div class="patient-name">','<a href="/v3-SEM/patient-overview"><span class="patient-surname">SURNAME</span>, <span class="patient-firstname">First (M.)</span></a>','</div><div class="patient-details">','<div class="hospital-number"><span>ID</span>0000000</div>','<div class="nhs-number"><span>NHS</span>111 222 3333</div>','<div class="patient-gender"><em>Gen</em>Male</div>','<div class="patient-age"><em>Age</em>00y</div>',"</div></div>",'<div class="quick-overview-content"></div>'].join(""),document.body.appendChild(e),i=e.querySelector(".close-icon-btn"),l.surname=e.querySelector(".patient-surname"),l.first=e.querySelector(".patient-firstname"),l.hospital=e.querySelector(".hospital-number"),l.nhs=e.querySelector(".nhs-number"),l.gender=e.querySelector(".patient-gender"),l.age=e.querySelector(".patient-age"),e})(),t=!0,s=c,n=r;let d=r.dataset,u=r.getBoundingClientRect(),p=d.mode,h=d.php,y=JSON.parse(d.patient);l.surname.textContent=y.surname,l.first.textContent=y.first,l.hospital.innerHTML="<span>ID</span> "+y.id,l.nhs.innerHTML="<span>NHS</span> "+y.nhs,l.gender.innerHTML="<em>Gen</em> "+y.gender,l.age.innerHTML="<em>Age</em> "+y.age,a.style.cssText=" ","float"==p?(a.classList.remove("side-panel"),o-u.y>300?a.style.top=u.y+u.height+5+"px":a.style.bottom=o-u.top+10+"px",a.style.left=u.x-250+u.width/2+"px"):a.classList.add("side-panel");let g=a.querySelector(".quick-overview-content");g.innerHTML="";let m=setTimeout(()=>g.innerHTML='<i class="spinner"></i>',400);c?e.show(i,"block"):e.hide(i),e.xhr("/idg-php/v3/_load/"+h).then(e=>{clearTimeout(m),t&&(g.innerHTML=e,a.style.display="block")}).catch(e=>console.log("ed3app php failed to load",e))};e.userDown(".js-patient-quick-overview",e=>{let a=e.target;t&&s&&n===a?r():c(a,!0)}),e.userEnter(".js-patient-quick-overview",e=>{s||c(e.target,!1)}),e.userLeave(".js-patient-quick-overview",e=>{s||r()}),e.userDown(".oe-patient-quick-overview .close-icon-btn .oe-i",r),e.listenForResize(()=>o=window.inneHeight)})(bluejay),(function(e){"use strict";e.addModule("proView");const t=[],s=e=>({options:function(e){e.lock&&(this.pro=null),0!=e.linkID&&(this.linked=!0,this.linkedProView=a(document.querySelector("#"+e.linkID)),e.lock&&(this.linkedProView.pro=null))}}),n=e=>{let t=e.querySelector(".pro-view-btn"),n=e.querySelector(".data-pro-view"),a=e.querySelector(".data-standard-view"),i={btn:t,oei:t.querySelector(".oe-i"),pro:n,standard:a,inPro:!0,linked:!1};return Object.assign(i,{change:function(){this.inPro?(this.hideShow(this.pro,this.standard),this.icon("expand","collapse")):(this.hideShow(this.standard,this.pro),this.icon("collapse","expand")),this.linked&&this.linkedProView.change(),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}},{icon:function(e,t){this.oei.classList.replace(e,t)}},s())},a=e=>{let t={pro:e.querySelector(".data-pro-view"),standard:e.querySelector(".data-standard-view"),inPro:!0};return Object.assign(t,{change:function(){this.inPro?this.hideShow(this.pro,this.standard):this.hideShow(this.standard,this.pro),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}})};e.userDown(".pro-view-btn",s=>{const a=s.target;let i=e.getDataAttr(a);if(i)t[parseFloat(i)].change();else{e.setDataAttr(a,t.length);let s=n(e.getParent(a,".pro-data-view"));s.options(JSON.parse(a.dataset.proview)),s.change(),t.push(s)}})})(bluejay),(function(e){"use strict";e.addModule("problemsPlans");const t=e.nodeArray(document.querySelectorAll(".problems-plans-sortable"));if(t.length<1)return;const s=[],n=(e,t,s)=>({id:e,text:t,info:s});e.nodeArray(t[0].querySelectorAll("li")).forEach(e=>{s.push(n(s.length,e.textContent,e.querySelector(".info").getAttribute("data-tooltip-content")))}),t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach((t,s)=>{e.setDataAttr(t,s)})});let a=s.length+1;const i=(e,t)=>['<span class="drag-handle"><i class="oe-i menu medium pro-theme"></i></span>',e,'<div class="metadata">','<i class="oe-i info small pro-theme js-has-tooltip" data-tooltip-content="',t,'"></i></div>','<div class="remove"><i class="oe-i remove-circle small pro-theme pad"></i></div>'].join(""),o=(n,a)=>{let o=s.findIndex(e=>e.id==n),l=s.findIndex(e=>e.id==a);s[o]=s.splice(l,1,s[o])[0],t.length>1&&t.forEach(t=>{let n=t.querySelectorAll("li");for(let t=0,a=s.length;t<a;t++){let a=s[t],o=n[t];a.id!=e.getDataAttr(o)&&(e.setDataAttr(o,a.id),o.innerHTML=i(a.text,a.info))}})};e.userDown(".create-new-problem-plan button",o=>{o.preventDefault();let l=e.getParent(o.target,".create-new-problem-plan").querySelector("input");if(!l||l.value.length<2)return;let r=n(a++,l.value,"Added now!");var c;s.push(r),c=(t=>{const s=new DocumentFragment,n=document.createElement("li");return n.innerHTML=i(t.text,t.info),e.setDataAttr(n,t.id),s.appendChild(n),s})(r),t.forEach(e=>{e.appendChild(c.cloneNode(!0)),h(e.lastChild)})}),e.userDown(".problems-plans-sortable .remove-circle",n=>{let a=e.getParent(n.target,"li"),i=0;for(;null!==(a=a.previousSibling);)i++;t.forEach(t=>{e.remove(t.childNodes[i])}),s.splice(i,1)}),document.addEventListener("DOMContentLoaded",()=>{t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach(e=>{h(e)})})});let l=null,r="js-sorting-list";const c=e=>{l=e.target,e.target.parentNode.classList.add(r),e.dataTransfer.setData("source",l.innerHTML)},d=e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"},u=e=>(e.preventDefault&&e.preventDefault(),!1),p=t=>{if(t.stopPropagation&&t.stopPropagation(),!1!==t.target.parentNode.classList.contains(r))return t.target.parentNode.classList.remove(r),l!=t.target&&(l.innerHTML=t.target.innerHTML,t.target.innerHTML=t.dataTransfer.getData("source"),o(e.getDataAttr(l),e.getDataAttr(t.target))),!1},h=e=>{e.setAttribute("draggable","true"),e.addEventListener("dragstart",c,!1),e.addEventListener("dragenter",d,!1),e.addEventListener("dragover",u,!1),e.addEventListener("drop",p,!1)}})(bluejay),(function(e){"use strict";e.addModule("quicktag");const t={qtags:["Adverse_Event","Serious_Adverse_Event","Note","My_research","my_teaching","Research","Teaching","Referred","Results","My_Results_pending"].map(e=>e.toLowerCase())};e.extend("wrapQtags",e=>{let s=e.split(" "),n=[],a=[];if(s.forEach((e,s)=>{e.startsWith("#")&&t.qtags.indexOf(e.substring(1))>=0?a.push(e):n.push(e)}),a.sort(),a.length){let e=a.map(e=>`<span class="qtag">${e}</span>`);return{text:a.join(" ")+" "+n.join(" "),DOMString:e.join(" ")+'<span class="dot-list-divider"></span>'+n.join(" ")}}return{text:e,DOMString:e}});const s=(()=>{let s=!1,n="";const a={input:null,tags:null,flag:null},i=e=>{e.length?(n=e[0],a.tags.innerHTML=Mustache.render('{{#qtags}}<span class="qtag">#{{.}}</span> {{/qtags}}',{qtags:e}),a.tags.querySelector(".qtag:first-child").classList.add("selected")):(n="",a.tags.innerHTML='<div class="no-matching-tags">No matching Patient Tags</div>')};return{init:n=>{if(s)return;s=!0;const o=e.wrap(n,"js-qtag-wrapper");n.focus();let l=document.createElement("div");l.className="oe-qtags",l.style.display="none";let r=document.createElement("div");r.className="oe-qtags-flag",r.textContent="#",n.getBoundingClientRect().top<e.getWinH()-170?(l.style.top="100%",r.style.top="100%"):(l.style.bottom="100%",r.style.bottom="100%"),o.appendChild(r),o.appendChild(l),a.input=n,a.tags=l,a.flag=r,i(t.qtags)},showTags:()=>{a.tags.style.display="block",a.flag.style.display="none",i(t.qtags)},hideTags:()=>{a.tags.style.display="none",a.flag.style.display="block"},userTyping:e=>{const s=(e=e.toLowerCase()).match(/[a-z-_]*/)[0],n=s.length,a=t.qtags.filter(e=>e.substring(0,n)==s);i(a)},selectedTag:()=>n,reset:()=>{s&&(e.remove(a.tags),e.remove(a.flag),e.unwrap(a.input),a.tags=null,a.flag=null,a.input=null,s=!1)}}})(),n=e=>{e.isComposing||229===e.keyCode||("Enter"!=e.key&&"Tab"!=e.key||(e.preventDefault(),e.stopPropagation(),a.insertTag(s.selectedTag()))," "==e.key&&a.stopTagging())},a=(()=>{let t=!1,i=null,o=0,l="",r=!1;const c=()=>{document.removeEventListener("input",y,{capture:!0}),document.removeEventListener("blur",h,{capture:!0}),i=null,t=!1,o=0,s.reset()},d=()=>{t=!1,o=0,s.hideTags(),e.log("[qTags] - Keys: Enter, Tab and Spacebar - normal"),document.removeEventListener("keydown",n,!0)},u=a=>{t=!0,o=a,l=i.value,s.showTags(),e.log("[qTags] - Keys: Enter, Tab & Spacebar - suspended (keydown)"),document.addEventListener("keydown",n,!0)},p=()=>{r=!0,setTimeout(()=>{i.focus(),r=!1},20)},h=()=>{r||c()},y=e=>{t?s.userTyping(i.value.substring(o)):"#"===e.data&&u(e.target.selectionStart)};return{init:e=>{e.isSameNode(i)||(null!==i&&c(),e.classList.contains("js-allow-qtags")&&(i=e,s.init(i),document.addEventListener("input",y,{capture:!0}),document.addEventListener("blur",h,{capture:!0})))},stopTagging:d,insertTag:e=>{let t=e+" ";o===l.length?i.value=l+t:i.value=l.substring(0,o)+t+l.substring(o+1),d()},userClicksFlag:()=>{i.value=i.value+" #",u(i.value.length),p()},userClicksTag:e=>{a.insertTag(e),p()},reset:c,focusOut:h}})();document.addEventListener("focus",e=>a.init(e.target),{capture:!0}),e.userDown(".oe-qtags",a.stopTagging),e.userDown(".oe-qtags-flag",a.userClicksFlag),e.userDown(".oe-qtags .qtag",e=>{const t=e.target.textContent;a.userClicksTag(t.substring(1))})})(bluejay),(function(e){"use strict";e.addModule("reduceElementHeight");const t=[],s=e=>(e.reduced=!1,Object.assign(e,{change:function(){this.reduced?(this.elem.classList.remove("reduced-height"),this.icon.classList.replace("increase-height-orange","reduce-height")):(this.elem.classList.add("reduced-height"),this.icon.classList.replace("reduce-height","increase-height-orange")),this.reduced=!this.reduced}}));e.userDown(".element .js-elem-reduce .oe-i",(n,a)=>{let i=n.target,o=e.getDataAttr(i);if(o)t[parseFloat(o)].change();else{let n=s({elem:e.getParent(i,".element"),icon:i});n.change(),e.setDataAttr(i,t.length),t.push(n)}})})(bluejay),(function(e){"use strict";e.addModule("restrictDataHeightFlag");const t="restrict-data-shown-flag",s=e.getDataAttributeName(),n=[];function a(e,t,s){this.hasScrolled=!1,this.flag=e,this.content=t,this.scrollEndPos=s,this.content.addEventListener("scroll",()=>this.scroll(),{once:!0})}a.prototype.scroll=function(t){this.hasScrolled=!0,this.flag.className+=" fade-out",setTimeout(()=>e.remove(this.flag),400)},a.prototype.userClick=function(){this.hasScrolled||i(this.content,this.scrollEndPos)};const i=(e,t)=>{let s=1,n=0,a=setInterval(()=>{var i;n=Math.min(1,s/200),e.scrollTop=Math.ceil((i=n)*(2-i)*t),s+=1,1==n&&clearInterval(a)},2)};(()=>{let i=e.nodeArray(document.querySelectorAll(".restrict-data-shown"));if(i.length<1)return;const o=document.createDocumentFragment(),l=document.createElement("div");l.className=t,o.appendChild(l),i.forEach(e=>{let t=e.querySelector(".restrict-data-content"),i=e.clientHeight,l=t.scrollHeight;if(l>i&&0===t.scrollTop){let r=o.cloneNode(!0),c=r.firstChild;c.setAttribute(s,n.length),e.appendChild(r),n.push(new a(c,t,l-i))}})})(),e.userDown("."+t,e=>{n[e.target.getAttribute(s)].userClick()})})(bluejay),(function(e){"use strict";e.addModule("sideNavSelectList");const t=e.nodeArray(document.querySelectorAll(".js-list-filter"));if(0==t.length)return;const s=e.nodeArray(document.querySelectorAll(".js-filter-group"));let n=document.querySelector(".js-list-filter.selected");const a=e=>{s.forEach(t=>{t.style.display=e})};t.forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let s=t.target;var i;s.classList.add("selected"),"all"==(i=s.dataset.list)?a("block"):(a("none"),e.show(document.querySelector("#"+i),"block")),n.classList.remove("selected"),n=s})})})(bluejay),(function(e){"use strict";bluejay.addModule("sidebarElementList");let t=document.querySelector(".sidebar-eventlist .oe-element-list");if(null===t)return;let s=document.querySelectorAll(".element-title");if(s.length<1)return;let n=document.createDocumentFragment();s.forEach((function(e){let t=document.createElement("li");t.innerHTML='<a href="#">'+e.textContent+"</a>",n.appendChild(t)})),t.appendChild(n)})(),(function(e){"use strict";if(e.addModule("sidebarQuicklookView"),null===document.querySelector("ul.events"))return;let t=null;const s=t=>e.getParent(t,"li").querySelector(".quicklook"),n=()=>({show:function(t){this.open=!0;const s=JSON.parse(t.dataset.quickview);this.icon.className="oe-i-e large "+s.icon,this.titleDate.textContent=s.title+" - "+s.date,e.xhr("/idg-php/v3/_load/sidebar/quick-view/"+s.php).then(e=>{!1!==this.open&&(this.open=!0,this.content.innerHTML=e,this.div.classList.remove("fade-out"),this.div.classList.add("fade-in"))}).catch(e=>console.log("PHP failed to load",e))}}),a=()=>({hide:function(){this.open=!1,this.div.classList.add("fade-out"),this.div.classList.remove("fade-in"),setTimeout(()=>this.div.classList.remove("fade-out"),300)}}),i=(()=>{const e=document.createElement("div");return e.className="oe-event-quick-view",e.id="js-event-quick-view",e.innerHTML=['<div class="event-icon"><i class="oe-i-e large"></i></div>','<div class="title-date">Title - DD Mth YYYY</div>','<div class="audit-trail">Michael Morgan</div>','<div class="quick-view-content"></div>'].join(""),document.body.appendChild(e),Object.assign({div:e,titleDate:e.querySelector(".title-date"),icon:e.querySelector(".event-icon > .oe-i-e"),content:e.querySelector(".quick-view-content"),open:!1},n(),a())})();e.userEnter(".event .event-type",e=>{var n;n=e.target,s(n).classList.add("fade-in"),t=n,i.show(e.target)}),e.userLeave(".event .event-type",e=>{null!=t&&(s(t).classList.remove("fade-in"),t=null),i.hide()})})(bluejay),(function(e){"use strict";if(e.addModule("signatureCapture"),null===document.querySelector(".js-idg-capture-signature"))return;const t=()=>{e.xhr("/idg-php/v3/_load/signature-pad.php").then(t=>{const s=e.div("oe-popup-wrap");s.innerHTML=t,document.body.appendChild(s);let n=s.querySelector(".close-icon-btn");n&&n.addEventListener("mousedown",t=>{e.remove(s)},{once:!0}),(()=>{var e=document.getElementById("signature-pad").querySelector("canvas"),t=document.getElementById("signature-pad-clear"),s=new SignaturePad(e,{backgroundColor:"rgb(255, 255, 255)"});function n(){var t=Math.max(window.devicePixelRatio||1,1);e.width=e.offsetWidth*t,e.height=e.offsetHeight*t,e.getContext("2d").scale(t,t),s.clear()}window.onresize=n,n(),t.addEventListener("click",(function(e){s.clear()}))})()}).catch(e=>console.log("signature pad: failed to load",e))};e.loadJS("https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js",!0).then(()=>{e.userDown(".js-idg-capture-signature",t)})})(bluejay),(function(e){"use strict";e.addModule("textAreaResize");const t=e=>{let t=e.scrollHeight;t-e.clientHeight>15&&(e.style.height="auto",e.style.height=t+5+"px")};e.extend("resizeTextArea",t),document.addEventListener("input",e=>{"TEXTAREA"==e.target.tagName&&t(e.target)},!1),document.addEventListener("DOMContentLoaded",()=>{e.nodeArray(document.querySelectorAll("textarea")).forEach(e=>{t(e)})})})(bluejay),(function(e){"use strict";e.addModule("tooltip");const t=Object.assign({selector:".js-has-tooltip",showing:!1,target:null,type:null,clickThrough:!1,tip:null,eyeIcons:null,reset(){this.showing=!1,this.type=null,this.target=null,this.views.notify()},update(e){if(this.showing=!0,this.target=e,e.hasAttribute("data-tooltip-content"))this.type="basic",this.tip=e.dataset.tooltipContent;else{const t=JSON.parse(e.dataset.tt);this.type=t.type,this.clickThrough=t.clickPopup,"bilateral"==this.type?(this.tip={r:t.tipR,l:t.tipL},this.eyeIcons=t.eyeIcons):this.tip=t.tip}this.views.notify()}},e.ModelViews()),s=(()=>{const s=document.createElement("div");let n=window.innerWidth;e.listenForResize(()=>n=window.innerWidth);const a=()=>{s.innerHTML="",s.className="oe-tooltip",s.style.cssText="display:none"};return t.views.add(()=>{t.showing||a()}),a(),document.body.appendChild(s),{div:s,reset:a,show:(a,i)=>{let o=i/2,l=e.getHiddenElemSize(s).h,r=t.target.getBoundingClientRect(),c=r.right-r.width/2,d=r.top-l-8,u=n>e.settings("cssHotlistFixed")?e.settings("cssExtended"):n;c<=o&&(o=20,s.classList.add("offset-right")),c>u-o&&(o=i-20,s.classList.add("offset-left")),r.top<l&&(d=r.bottom+8,s.classList.add("inverted")),s.style.top=d+"px",s.style.left=c-o+"px",s.style.display=a}}})();t.views.add(()=>{"basic"===t.type&&(s.reset(),s.div.innerHTML=t.tip,s.show("block",200))});t.views.add(()=>{"bilateral"===t.type&&(s.reset(),s.div.classList.add("bilateral"),s.div.innerHTML=Mustache.render('<div class="right">{{&r}}</div><div class="left">{{&l}}</div>',t.tip),t.eyeIcons||s.div.classList.add("no-icons"),s.show("flex",400))});const n=e=>{!1!==t.showing&&(t.reset(),window.removeEventListener("scroll",n,{capture:!0,once:!0}))},a=e=>{t.update(e.target),window.addEventListener("scroll",n,{capture:!0,once:!0})};e.userDown(t.selector,e=>{e.target.isSameNode(t.target)&&t.showing?n():a(e)}),e.userEnter(t.selector,a),e.userLeave(t.selector,n)})(bluejay),(function(e){"use strict";bluejay.addModule("userPIN");document.addEventListener("input",e=>{e.target.matches(".user-pin-entry")&&(e=>{let t=e.value,s=e.parentNode;s.classList.remove("accepted-pin","wrong-pin"),4===t.length&&("1234"==t?s.classList.add("accepted-pin"):s.classList.add("wrong-pin"))})(e.target)},{capture:!0})})(),(function(e){"use strict";e.addModule("vcScratchPad");const t=document.querySelector("#oe-vc-scratchpad");if(null===t)return;let s,n,a=!1;t.addEventListener("dragstart",e=>{e.dataTransfer.dropEffect="move";let t=e.target.getBoundingClientRect();s=e.clientX-t.left,n=e.clientY-t.top},!1),t.addEventListener("dragend",e=>{let a=Math.round(e.clientY-n),i=Math.round(e.clientX-s);a=a<1?1:a,i=i<1?1:i,t.style.top=a+"px",t.style.left=i+"px"},!1);e.userDown("#js-vc-scratchpad",s=>{let n=s.target;a?(e.hide(t),n.textContent="ScratchPad"):(e.show(t,"block"),n.textContent="Hide ScratchPad"),a=!a})})(bluejay),(function(e){"use strict";if(e.addModule("whiteboard"),null===document.querySelector("main.oe-whiteboard"))return;e.hide(document.querySelector("#oe-admin-notifcation"));const t=document.querySelector(".wb3-actions"),s=document.querySelector("#js-wb3-openclose-actions");if(e.userDown("#js-wb3-openclose-actions",e=>{s.classList.contains("up")?(s.classList.replace("up","close"),t.classList.replace("down","up")):(s.classList.replace("close","up"),t.classList.replace("up","down"))}),e.userDown(".wb-idg-demo-btn",e=>{window.location="/v3-whiteboard/"+e.target.dataset.url}),e.userDown(".edit-widget-btn .oe-i",t=>{let s=t.target,n=e.getParent(s,".oe-wb-widget"),a=n.querySelector(".wb-data ul"),i=n.querySelector(".wb-data .edit-widget");s.classList.contains("pencil")?(s.classList.replace("pencil","tick"),e.hide(a),e.show(i,"block")):(s.classList.replace("tick","pencil"),e.hide(i),e.show(a,"block"))}),null===document.querySelector(".multipage-nav"))return;let n=document.querySelector(".multipage-stack"),a=e.nodeArray(n.querySelectorAll("img")),i=a[0].height+20;e.listenForResize(()=>i=a[0].height+20);let o=0;const l=e=>{o+=e,o<0&&(o=0),o>a.length*i&&(o=a.length*i),n.scrollTop=o};e.userDown("#js-scroll-btn-down",()=>l(200)),e.userDown("#js-scroll-btn-up",()=>l(-200));let r=document.querySelector(".page-jump");a.forEach((e,t)=>{let s=document.createElement("div");s.className="page-num-btn",s.setAttribute("data-page",t),s.textContent=t+1,r.appendChild(s)}),e.userDown(".page-num-btn",e=>{o=0;let t=parseInt(e.target.dataset.page*i);l(t)})})(bluejay),(function(e){"use strict";e.addModule("addSelect");const t=e.namespace("addSelect");t.all=[],t.closeAll=function(){this.all.forEach(e=>e.close())},t.init=function(){const s=e.nodeArray(document.querySelectorAll(".js-add-select-btn"));s.length<1||s.forEach(e=>{let s=new t.Popup(e);this.all.push(s)})},document.addEventListener("DOMContentLoaded",()=>t.init(),{once:!0})})(bluejay),(function(e){"use strict";const t=bluejay.namespace("addSelect");t.ListOption=function(e,s){let n=e.classList.contains("selected"),a=!1,i=JSON.parse(e.dataset.insert);void 0!==i.dependents&&(a=new t.OptionDependents(i.dependents,s.uniqueId)),this.click=function(){this.toggleState(),s.optionClicked(n,this),0!=a&&a.show(n)},this.toggleState=function(){e.classList.toggle("selected"),n=!n},this.deselect=function(){n&&this.toggleState()},Object.defineProperty(this,"selected",{get:()=>n,set:t=>{n=t,t||e.classList.remove("selected")}}),Object.defineProperty(this,"dependents",{get:()=>!1!==a}),Object.defineProperty(this,"value",{get:()=>i.value}),e.addEventListener("mousedown",this.click.bind(this))}})(),(function(e){"use strict";e.namespace("addSelect").OptionDependents=function(t,s){if(void 0===t)return!1;const n="#add-to-"+s+"-";let a=[];t.split(",").forEach(e=>{let t=e.split("."),s={};if(0===t[0]&&console.log("Error: OptionDependents, listGroup = 0 !!",n+"listgroup"+t[0]),s.div=document.querySelector(n+"listgroup"+t[0]),null===s.div&&console.log("obj.div = null!",n+"listgroup"+t[0]),s.holder=s.div.querySelector(".optional-placeholder"),null===s.holder&&console.log("Adder: no placeholder text for optional group"),0==t[1])s.showDefaultText=!0;else{s.showDefaultText=!1,s.lists=[];for(let e=1;e<t.length;e++){let a=document.querySelector(n+"list"+t[e]);null===a?console.log("Err: OptionDependents, list? ",n+"list"+t[e]):s.lists.push(a)}}a.push(s)}),this.show=function(e){e?this.myLists():this.reset()},this.hideAllOptionalLists=function(t){e.nodeArray(t.querySelectorAll(".optional-list")).forEach(t=>{e.hide(t)})},this.myLists=function(){a.forEach(t=>{this.hideAllOptionalLists(t.div),t.showDefaultText?t.holder&&e.show(t.holder,"block"):(t.holder&&e.hide(t.holder),t.lists.forEach(t=>{e.show(t,"block")}))})},this.reset=function(){a.forEach(t=>{this.hideAllOptionalLists(t.div),t.holder&&e.show(t.holder,"block")})}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.OptionsList=function(s){let n=JSON.parse(s.dataset.options);const a="inputTemplate"==n.type,i="single"==n.type,o=(n.hasExtraOptions,"true"===n.isOptionalList);this.uniqueId=s.dataset.id,o&&e.hide(s.parentNode);let l=[],r=[];e.nodeArray(s.querySelectorAll("li")).forEach(e=>{let s=new t.ListOption(e,this);l.push(s),s.selected&&s.dependents&&r.push(s)}),this.optionClicked=function(e,t){if(a){let e=s.previousElementSibling,n=t.value,a=n.indexOf("{"),i=n.indexOf("}")+1;return e.value=n,t.deselect(),void setTimeout(()=>{e.focus(),e.select(),e.setSelectionRange(a,i)},50)}e&&i&&l.forEach(e=>{e!==t&&e.deselect()})},this.checkForDefaultSelections=()=>{r.length&&r.forEach(e=>{e.selected=!1,e.click()})}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.Popup=function(s){let n=document.querySelector("#"+s.dataset.popup);if(null==n)return;let a=[];this.anchorLeft=!!n.dataset.anchorLeft,this.btn=s,this.popup=n,this.closeBtn=n.querySelector(".close-icon-btn"),this.open=function(){this.position(),t.closeAll(),e.show(n,"block"),this.closeBtn.addEventListener("mousedown",this.close.bind(this))},this.close=function(){n.style.display="none"},this.reset=function(){},e.nodeArray(n.querySelectorAll(".add-options")).forEach(e=>{let s=new t.OptionsList(e);s.checkForDefaultSelections(),a.push(s)}),this.btn.addEventListener("mousedown",this.open.bind(this))},t.Popup.prototype.position=function(){let e=this.btn.getBoundingClientRect(),t=window.innerWidth,s=window.innerHeight,n=s-e.bottom;if(s-n<325&&(n=s-325),this.anchorLeft)this.popup.style.left=e.left+"px";else{let s=e.right-this.popup.getBoundingClientRect().width,n=s<0?s-25:0;this.popup.style.right=t-e.right+n+"px"}this.popup.style.bottom=n+"px"}})(bluejay),(function(e){"use strict";Object.preventExtensions(e),e.ready()})(bluejay);