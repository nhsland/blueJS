Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";console.time("[blue] Ready"),console.time("[blue] DOM Loaded");const e={};let t=1;return e.extend=((s,i)=>i._app||s in e?(bluejay.log('** Err: Can not extend again: "'+s+'"'),!1):(i._app=t++,e[s]=i,!0)),e.log=function(e){console.log("[blue] "+e)},e.log('OE JS UI layer ("blue") ...'),e.log("DEBUG MODE"),document.addEventListener("DOMContentLoaded",()=>{let t=[];for(const s in e)t.push(s);e.log("[API] [Helper Methods] "+t.join(", ")),console.timeEnd("[blue] DOM Loaded")},{once:!0}),e})();!(function(e){"use strict";const t=[],s=[],i=[],n=[],o=(e,t,s)=>{e.push({selector:t,cb:s})},l=(e,t)=>{e.target!==document&&t.forEach(t=>{e.target.matches(t.selector)&&t.cb(e)})},a=e=>{e.forEach(e=>{e.cb()})};const r=(function(e){let t=!1;return()=>{t||(t=!0,setTimeout(()=>{t=!1,a(e)},160))}})(n);document.addEventListener("mouseenter",e=>l(e,s),{capture:!0}),document.addEventListener("mousedown",e=>l(e,t),{capture:!0}),document.addEventListener("mouseleave",e=>l(e,i),{capture:!0}),window.onresize=r,e.extend("registerForHover",(e,t)=>o(s,e,t)),e.extend("registerForClick",(e,s)=>o(t,e,s)),e.extend("registerForExit",(e,t)=>o(i,e,t)),e.extend("listenForResize",e=>o(n,null,e))})(bluejay),(function(e){"use strict";bluejay.extend("uiEvent",(e,t)=>{const s=new CustomEvent(e,{detail:t});document.dispatchEvent(s)})})(),(function(e){"use strict";e.extend("nodeArray",e=>Array.prototype.slice.call(e)),e.extend("appendTo",(e,t,s)=>{(s||document).querySelector(e).appendChild(t)}),e.extend("getParent",(e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1}),e.extend("removeElement",e=>{e.parentNode.removeChild(e)}),e.extend("show",(e,t="block")=>{null!==e&&(e.style.display=t)}),e.extend("reshow",e=>{null!==e&&(e.style.display="")}),e.extend("hide",e=>{null!==e&&(e.style.display="none")}),e.extend("xhr",t=>(e.log("[XHR] - "+t),new Promise((s,i)=>{let n=new XMLHttpRequest;n.open("GET",t),n.onreadystatechange=function(){4===n.readyState&&(n.status>=200&&n.status<300?(e.log("[XHR] - Success"),s(n.responseText)):(e.log("[XHR] - Failed"),i(this.status+" "+this.statusText)))},n.send()}))),e.extend("getHiddenElemSize",e=>{e.style.visibility="hidden",e.style.display="";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="inherit",e.style.display="none",t})})(bluejay),(function(e){"use strict";const t=new Map;let s=s=>t.has(s)?t.get(s):(e.log("Module does not exist?: "+s),!1);e.extend("addModule",(i,n)=>t.has(i)?(e.log("** Err: Module aleady added? "+i),!1):(e.log("[Module] "+i),t.set(i,{}),s(i))),e.extend("getModule",s)})(bluejay),(function(e){"use strict";const t={get cssTopBarHeight(){return 60},get cssExtendBrowserSize(){return 1890},get cssBrowserHotlistFixSize(){return 1440},get PHPLOAD(){return"/idg-php/v3/_load/"}},s=(e=!1)=>{return"data-"+(e?"bluejay-"+e:"bluejay")};e.extend("settings",t),e.extend("getDataAttributeName",s),e.extend("setDataAttr",(e,t)=>{e.setAttribute(s(),t)}),e.extend("getDataAttr",e=>{const t=s();return!!e.hasAttribute(t)&&e.getAttribute(t)})})(bluejay),(function(e){"use strict";e.addModule("collapseExpand");const t=[],s=()=>({show:function(){e.show(this.content),this.btn.classList.replace("expand","collapse"),this.open=!0}}),i=()=>({hide:function(){e.hide(this.content),this.btn.classList.replace("collapse","expand"),this.open=!1}}),n=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),i()),o=(s,i)=>{let o=s.target,l=e.getDataAttr(o);if(l)t[parseFloat(l)].change();else{e.setDataAttr(o,t.length);let s={btn:o,content:o.parentNode.querySelector(".collapse-"+i+"-content"),open:o.classList.contains("collapse")},l=n(s);l.change(),t.push(l)}};e.registerForClick(".collapse-data-header-icon",e=>o(e,"data")),e.registerForClick(".collapse-group > .header-icon",e=>o(e,"group"))})(bluejay),(function(e){"use strict";const t=e.nodeArray(document.querySelectorAll(".hidden"));t.length&&t.forEach(t=>{e.hide(t),t.classList.remove("hidden")});const s=e.nodeArray(document.querySelectorAll(".tr-collapse"));s.length&&s.forEach(e=>{e.style.visibility="collapse",e.classList.remove("tr-collapse")})})(bluejay),(function(e){"use strict";e.addModule("tooltip");const t={selector:".js-has-tooltip",css:{basicWidth:200,bilateralWidth:400},showing:!1,target:null,type:"basic",tip:null,eyeIcons:null,onChange(e){if("function"!=typeof e)throw new Error("Tooltip Model requires View callback as funciton");this.onChange=e},reset(){this.showing=!1,this.target=null,this.onChange()},update(e){this.showing=!0,this.target=e,"bilateral"==e.dataset.ttType?(this.type="bilateral",this.eyeIcons="no"!==e.dataset.ttEyeicons,this.tip={r:e.dataset.ttRight,l:e.dataset.ttLeft}):(this.type="basic",this.tip=e.dataset.tooltipContent),this.onChange()}},s=((t=>{let s,i=null,n="block",o=t.css.basicWidth,l=window.innerWidth;e.listenForResize(()=>l=window.innerWidth);const a=()=>{i.innerHTML="",i.className="oe-tooltip",i.style.cssText="display:none"},r=()=>{i=i||(()=>(i=document.createElement("div"),e.appendTo("body",i),a(),i))(),"block"==n?i.innerHTML=t.tip:(i.classList.add("bilateral"),t.eyeIcons||i.classList.add("no-icons"),i.innerHTML='<div class="right"></div><div class="left"></div>',i.querySelector(".right").innerHTML=t.tip.r,i.querySelector(".left").innerHTML=t.tip.l);let s=o/2,r=e.getHiddenElemSize(i).h,c=t.target.getBoundingClientRect(),d=c.right-c.width/2,u=c.top-r-8,h=e.settings.cssExtendBrowserSize,p=l>h?h:l;d<=s&&(s=20,i.classList.add("offset-right")),d>p-s&&(s=o-20,i.classList.add("offset-left")),c.top<r&&(u=c.bottom+8,i.classList.add("inverted")),i.style.top=u+"px",i.style.left=d-s+"px",i.style.display=n};t.onChange(()=>{0==t.showing?a():(s=t.tip,"basic"==t.type?(n="block",o=t.css.basicWidth):(n="flex",o=t.css.bilateralWidth),r())})})(t),e=>{t.update(e.target),window.addEventListener("scroll",i,{capture:!0,once:!0})}),i=e=>{t.showing&&t.reset()};e.registerForClick(t.selector,e=>{e.target.isSameNode(t.target)&&t.showing?i():s(e)}),e.registerForHover(t.selector,s),e.registerForExit(t.selector,i)})(bluejay),(function(e){"use strict";null!==document.querySelector(".js-idg-demo-ed2")&&(e.registerForClick(".js-idg-demo-doodle-drawer",t=>{let s=t.target;e.getParent(s,"li").classList.toggle("ed2-drawer-open")}),e.registerForClick(".ed-canvas-edit",t=>{let s=t.target;e.getParent(s,".ed2-editor").querySelector(".ed2-doodle-popup").classList.toggle("closed")}),e.registerForClick("#js-idg-demo-ed2-search-input",e=>{let t=e.target.nextElementSibling;console.log("hi"),"none"==t.style.display?t.style.display="block":t.style.display="none"}))})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-idg-demo-13420"))return;document.addEventListener("input",t=>{let s=t.target;if(s.matches(".js-idg-demo-13420 .toggle-switch input")){let t=e.getParent(s,"tr"),i=t.querySelector(".js-idg-ongoing-text"),n=t.querySelector(".js-idg-date-stop"),o=t.querySelector(".js-idg-duration-dispense"),l=t.querySelector(".js-idg-taper-btn"),a=t.querySelector(".js-idg-stopped-reasons");s.checked?(e.hide(n),e.hide(a),e.show(i),e.show(o),e.reshow(l)):(e.show(n),e.hide(i),e.hide(o),e.hide(l))}});const t=(t,s)=>{let i=t.querySelector(".js-idg-stop-btn"),n=t.querySelector(".js-idg-stop-date"),o=t.querySelector(".js-idg-stopped-reasons"),l=t.querySelector(".js-idg-cancel-stop");s?(e.hide(i),e.show(n),e.show(o),e.show(l)):(e.show(i),e.hide(n),e.hide(o),e.hide(l))};document.addEventListener("click",s=>{s.target.matches(".js-idg-stop-btn")&&t(e.getParent(s.target,"td"),!0)}),document.addEventListener("mousedown",s=>{s.target.matches(".js-idg-cancel-stop")&&t(e.getParent(s.target,"td"),!1)}),document.addEventListener("mousedown",e=>{let t=e.target;if(t.matches(".js-show-medication-history")){document.querySelectorAll(".js-idg-medication-history-"+t.dataset.idgdemo).forEach(e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"})}})})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-idg-diagnosis-active-switcher"))return;const t=(t,i)=>{let n=t.querySelector(".js-idg-diagnosis-text"),o=t.querySelector(".toggle-switch"),l=t.querySelector(".remove-circle"),a=t.querySelector(".js-idg-diagnosis-add-btn"),r=t.querySelector(".js-idg-diagnosis-doubt"),c=t.querySelector(".js-idg-diagnosis-doubt-input"),d=t.dataset.idgside,u=t.parentNode.previousElementSibling.querySelector(".oe-eye-lat-icons .oe-i"),h=t.parentNode.nextElementSibling.querySelector(".js-idg-diagnosis-date");switch(i){case"active":e.reshow(n),e.reshow(o),e.reshow(r),e.hide(l),e.hide(a),e.reshow(h),n.textContent="Active (confirmed)",n.classList.remove("fade"),r.querySelector("input").checked=!1,o.querySelector("input").checked=!0,s(u,d,"active");break;case"confirmed":e.hide(c),e.reshow(n);break;case"doubt":e.reshow(c),e.hide(n);break;case"inactive":e.reshow(n),e.reshow(o),e.reshow(l),e.hide(a),e.hide(r),e.hide(c),e.reshow(h),n.textContent="Inactive from",n.classList.add("fade"),s(u,d,"inactive");break;case"removed":e.hide(o),e.hide(l),e.reshow(a),e.hide(h),n.textContent="Not present",s(u,d,"none")}},s=(e,t,s)=>{if(null===e)return;let i=["oe-i"],n="left"==t?"L":"R";switch(s){case"active":i.push("laterality",n);break;case"inactive":i.push("laterality",n+"i");break;case"none":i.push("laterality","NA")}i.push("small","pad"),e.className=i.join(" ")};let i=null;const n=(t,s)=>{let n=t.querySelector(".js-idg-diagnosis-state-options"),o=t.querySelector(".js-idg-right-icon .oe-systemic-icons"),l=t.querySelector(".js-idg-right-icon .oe-eye-lat-icons .oe-i");if(s){n.innerHTML='<span class="oe-eye-lat-icons"><i class="oe-i laterality NA small pad"></i></span>',n.colSpan=0;let s=t.insertCell(2),i=t.insertCell(3);if(s.innerHTML='<div class="flex-layout cols-11 js-idg-diagnosis-active-switcher" data-idgdemo="-r-nSysEx2" data-idgside="right"><div class="js-idg-diagnosis-actions"><label class="toggle-switch" style="display: none;"><input type="checkbox"><div class="toggle-btn"></div></label><label class="inline highlight js-idg-diagnosis-doubt" style="display: none;"><input value="diagnosis-doubt" name="idg-4131" type="checkbox"> <i class="oe-i doubt small-icon js-has-tooltip" data-tt-type="basic" data-tooltip-content="? = doubts; suspected, etc"></i></label><i class="oe-i remove-circle small-icon pad-left" style="display: none;"></i><button class="js-idg-diagnosis-add-btn ">Add right side</button></div><div class="js-idg-diagnosis-state"><input class="js-idg-diagnosis-doubt-input" value="Suspected" placeholder="Suspected" maxlength="32" style="display: none;"><span class="js-idg-diagnosis-text js-active-state fade ">Not present</span></div></div>',i.innerHTML='<div class="js-idg-diagnosis-date"><input type="text" class="date" value="30 Apr 2020"></div>',e.hide(t.cells[5].querySelector(".toggle-switch")),e.hide(t.cells[5].querySelector(".highlight")),null===t.cells[5].querySelector(".js-idg-diagnosis-actions .js-idg-diagnosis-add-btn")){let e=document.createElement("button");e.className="js-idg-diagnosis-add-btn",e.textContent="Add left side",t.cells[5].querySelector(".js-idg-diagnosis-actions").appendChild(e)}else e.reshow(t.cells[5].querySelector(".js-idg-diagnosis-add-btn"));let a=t.cells[5].querySelector(".js-idg-diagnosis-text");a.textContent="Inactive from",a.classList.add("fade"),o.style.display="none",l.style.display="inline-block"}else t.deleteCell(2),t.deleteCell(2),n.innerHTML=i,n.colSpan=3,e.hide(t.cells[3].querySelector(".js-idg-diagnosis-add-btn")),e.reshow(t.cells[3].querySelector(".toggle-switch")),t.cells[3].querySelector(".toggle-switch").checked=!0,e.reshow(t.cells[3].querySelector(".highlight")),n.querySelector("input").checked=!0,o.style.display="inline-block",l.style.display="none"};document.addEventListener("input",s=>{let n=s.target;if(n.matches(".js-idg-diagnosis-active-switcher .toggle-switch input")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,n.checked?"active":"inactive")}if(n.matches(".js-idg-diagnosis-doubt input")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,n.checked?"doubt":"confirmed")}if(n.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-diagnosis-state-options input")){((t,s)=>{let n=t.querySelector(".js-idg-sides"),o=t.querySelector(".js-idg-diagnosis-text"),l=t.querySelector(".js-idg-diagnosis-active-switcher"),a=l.querySelector(".toggle-switch"),r=l.querySelector(".js-idg-diagnosis-doubt"),c=l.querySelector(".js-idg-diagnosis-doubt-input"),d=t.querySelector(".js-idg-right-icon .oe-systemic-icons");switch(null==i&&(i=t.querySelector(".js-idg-diagnosis-state-options").innerHTML,e.reshow(o)),s){case"0":e.reshow(n),e.reshow(o),o.textContent="Active (confirmed)",o.classList.remove("fade"),e.reshow(a),a.querySelector("input").checked=!0,e.reshow(r),r.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i person-green small pad";break;case"1":e.hide(n),e.reshow(o),o.textContent="Not present",o.classList.add("fade"),e.hide(a),e.reshow(r),r.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad";break;case"2":e.hide(n),e.reshow(o),o.textContent="Not checked",o.classList.add("fade"),e.hide(a),e.hide(r),e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad"}})(e.getParent(n,".js-idg-demo-sys-diag-side-switcher"),n.value)}}),document.addEventListener("click",t=>{let s=t.target;if(s.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-sides")){let t=e.getParent(s,".js-idg-demo-sys-diag-side-switcher"),i=s.querySelector(".oe-i");"no-sides"==s.dataset.state?(n(t,!0),s.dataset.state="sides",i.classList.replace("person","person-split")):(n(t,!1),s.dataset.state="no-sides",i.classList.replace("person-split","person"))}}),document.addEventListener("mousedown",s=>{let i=s.target;if(i.matches(".js-show-diagnosis-history")&&(e=>{document.querySelectorAll(".js-idg-diagnosis-history-"+e).forEach(e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"})})(i.dataset.idgdemo),i.matches(".js-idg-diagnosis-active-switcher .remove-circle")){let s=e.getParent(i,".js-idg-diagnosis-active-switcher");t(s,"removed")}if(i.matches(".js-idg-diagnosis-add-btn")){let s=e.getParent(i,".js-idg-diagnosis-active-switcher");t(s,"active")}});e.registerForClick(".js-idg-demo-remove-oph-diag",t=>{e.xhr("/idg-php/v3/_load/specific/exam-oph-diag-delete.php").then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t,s.querySelector(".close-icon-btn").addEventListener("mousedown",t=>{t.stopPropagation(),e.removeElement(s)},{once:!0}),e.appendTo("body",s)}).catch(e=>console.log("failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("attachmentThumbnail");const t="oe-attachment-thumbnail";let s,i=!1;const n={};if(e.nodeArray(document.querySelectorAll("."+t)).length<1)return;const o=()=>{n.close.removeEventListener("mousedown",o),n.save&&(n.save.removeEventListener("mousedown",o),n.cancel.removeEventListener("mousedown",o)),e.removeElement(s),i=!1},l=t=>{i||(t=>{i=!0,(s=document.createElement("div")).className="oe-popup-wrap";let l='<div class="oe-popup-attachment">';l+='<div class="title">'+t.title+"</div>",l+='<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>',l+='<div class="file-attachment-content"></div>',l+='<div class="file-size-controls"></div>',l+="</div>",s.innerHTML=l;const a=s.querySelector(".file-attachment-content"),r=s.querySelector(".file-size-controls"),c=new DocumentFragment,d=(e,t,s=!1)=>{let i=document.createElement("button");return i.className=t,s&&(i.id=s),i.textContent=e,c.appendChild(i),i};if("png"===t.type){let e="url('"+t.file+"')";a.style.backgroundImage=e,a.innerHTML='<img src="'+t.file+'" style="display:none"/>';const i=s.querySelector("img"),n=d("Fit to screen","pro-theme selected","oe-att-fit"),o=d("Actual size","pro-theme","oe-att-actual"),l=(e,t,s,n)=>{a.style.backgroundImage=e,i.style.display=t,s.classList.add("selected"),n.classList.remove("selected")};o.addEventListener("mousedown",e=>{e.stopPropagation(),l("none","block",o,n)}),n.addEventListener("mousedown",t=>{t.stopPropagation(),l(e,"none",n,o)})}else a.innerHTML='<embed src="'+t.file+'" width="100%" height="100%"></embed>',d("PDF","pro-theme selected");if(t.annotate){a.classList.add("annotation");let i=document.createElement("div");i.className="attachment-annotation",e.appendTo(".oe-popup-attachment",i,s),e.xhr(t.idgPHP).then(e=>{i.innerHTML=e,"L"==t.eyelat&&(i.querySelector("#annotation-right").style.visibility="hidden"),"R"==t.eyelat&&(i.querySelector("#annotation-left").style.visibility="hidden")}).catch(e=>console.log("XHR failed: ",e)),n.save=d("Save annotations","green hint"),n.cancel=d("Cancel","red hint"),n.save.addEventListener("mousedown",o,{once:!0}),n.cancel.addEventListener("mousedown",o,{once:!0})}if(t.stack){let i=t.title.split(" - "),n="<option>"+t.title+"</option>";for(let e=t.stack;e;e--)n+="<option>"+i[0]+" - ("+e+" Jan 1975 09:30)</option>";let o=document.createElement("div");o.className="attachment-stack",o.innerHTML='Choose report: <select class="pro-theme">'+n+"</select>",e.appendTo(".oe-popup-attachment",o,s)}n.close=s.querySelector(".close-icon-btn"),n.close.addEventListener("mousedown",o,{once:!0}),r.appendChild(c),e.appendTo("body",s)})(JSON.parse(t.target.dataset.attachment))};e.registerForClick("."+t,l),document.querySelectorAll(".js-annotate-attachment")&&e.registerForClick(".js-annotate-attachment",l)})(bluejay),(function(e){"use strict";e.addModule("comments");e.registerForClick(".js-add-comments",t=>{const s=t.target,i=JSON.parse(s.dataset.idgdemo);if(e.hide(s),i.bilateral){const t=document.querySelector("#"+i.id+"-right"),n=document.querySelector("#"+i.id+"-left");e.show(t),e.show(n),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.reshow(s),e.hide(t),e.hide(n)},{once:!0}),n.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.reshow(s),e.hide(t),e.hide(n)},{once:!0})}else{const t=document.querySelector("#"+i.id);e.show(t),t.querySelector("textarea").focus(),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.reshow(s),e.hide(t)},{once:!0})}})})(bluejay),(function(e){"use strict";e.addModule("commentHotlist");const t=".oe-hotlist-panel .js-patient-comments",s=document.querySelector("#hotlist-quicklook"),i=t=>{return e.getParent(t,"tr").nextSibling.querySelector("textarea").value};e.registerForClick(t,t=>{const s=t.target,n=(i(s),e.getParent(s,"tr").nextSibling),o=n.querySelector("textarea");n.style.display="table-row",e.resizeTextArea(o)}),e.registerForHover(t,t=>{const n=t.target;let o=e.getParent(n,".patient-activity"),l=n.getBoundingClientRect().top-o.getBoundingClientRect().top+21;n.classList.contains("comments-added")&&(s.textContent=i(n),s.style.top=l+"px",e.show(s))}),e.registerForExit(t,()=>{e.hide(s)})})(bluejay),(function(e){"use strict";e.addModule("ed3");let t=!1;e.registerForClick(".js-idg-ed3-app-btn",s=>{let i=s.target;t=t||(()=>{let t=document.createElement("div");return t.className="oe-eyedraw-app spinner-loader",e.appendTo("body",t),t})();let n=i.getBoundingClientRect().bottom-532;t.style.top=n<60?"60px":n+"px",e.show(t);let o=JSON.parse(i.dataset.idgDemo);var l=Object.keys(o).map(e=>e+"="+o[e]).join("&");e.xhr("/idg-php/v3/_load/ed3/ed3-app.php?"+l).then(e=>{t.innerHTML=e,t.querySelector(".close-icon-btn").addEventListener("mousedown",()=>{t.style.display="none"},{once:!0})}).catch(e=>console.log("ed3app php failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("elementSelector");const t=()=>({loadPHP:function(t){e.xhr(t).then(t=>{!1!==this.open&&(this.nav=document.createElement("nav"),this.nav.className=this.wrapClass,this.nav.innerHTML=t,this.btn.classList.add("selected"),e.appendTo("body",this.nav))}).catch(e=>console.log("PHP failed to load",e))}}),s=()=>({close:function(){this.open=!1,this.btn.classList.remove("selected"),e.removeElement(this.nav)}}),i=()=>({change:function(e){if(null===this.btn&&(this.btn=e.target),this.open)this.close();else{this.open=!0;let e=JSON.parse(this.btn.dataset.demophp);!1!==e?this.loadPHP(e):this.elementSideNav()}}}),n=()=>({elementSideNav:function(){this.nav=document.createElement("nav"),this.nav.className=this.wrapClass;const t=e.nodeArray(document.querySelectorAll(".element .element-title")).map(e=>'<li class="element" id="side-element-contacts"><a href="#" class="selected">'+e.textContent+"</a></li>");this.nav.innerHTML=['<div class="element-structure">','<ul class="oe-element-list">',t.join(""),"</ul>","</div>"].join(""),e.appendTo("body",this.nav)}}),o=e=>Object.assign({btn:null,open:!1,wrapClass:e},i(),t(),n(),s());if(null!==document.querySelector("#js-manage-elements-btn")){const t=o("oe-element-selector");e.registerForClick("#js-manage-elements-btn",e=>t.change(e)),e.registerForClick(".oe-element-selector .close-icon-btn button",()=>t.close())}if(null!==document.querySelector("#js-element-structure-btn")){const t=o("sidebar element-overlay");e.registerForClick("#js-element-structure-btn",e=>t.change(e))}})(bluejay),(function(e){"use strict";e.addModule("elementTiles");const t=[],s=()=>({show:function(){this.h3.textContent=this.title,e.show(this.content)}}),i=()=>({hide:function(){this.h3.innerHTML=this.title+" <small>["+this.count+"]</small>",e.hide(this.content)}}),n=e=>Object.assign({tiles:[],btn:e,collapsed:!1},{addTile:function(e){this.tiles.push(e)}},{change:function(){this.tiles.forEach(e=>{this.collapsed?(this.btn.classList.replace("increase-height","reduce-height"),e.show()):(this.btn.classList.replace("reduce-height","increase-height"),e.hide())}),this.collapsed=!this.collapsed}});e.registerForClick(".collapse-tile-group .oe-i",o=>{let l=e.getParent(o.target,".element-tile-group"),a=e.getDataAttr(l);if(a)t[parseFloat(a)].change();else{let a=n(o.target);e.nodeArray(l.querySelectorAll(".element.tile")).forEach(e=>{a.addTile((e=>{const t=e.querySelector(".element-title"),n=t.textContent,o=e.querySelector(".element-data"),l=o.querySelectorAll("tbody tr").length;return Object.assign({h3:t,title:n,content:o,count:l.toString()},s(),i())})(e))}),a.change(),e.setDataAttr(l,t.length),t.push(a)}})})(bluejay),(function(e){"use strict";e.addModule("eventAuditTrial");const t="#js-event-audit-trail-btn",s=document.querySelector(t);if(null===s)return;const i=document.querySelector("#js-event-audit-trail");null===i&&e.log("Audit Trail content not available in DOM?");let n=!1;const o=t=>{e.show(i),s.classList.add("active"),n=!0},l=t=>{e.hide(i),s.classList.remove("active"),n=!1};e.registerForClick(t,e=>n?l(e):o(e)),e.registerForHover(t,o),e.registerForExit(t,l)})(bluejay),(function(e){"use strict";if(e.addModule("eventsUserTrail"),null===document.querySelector("#js-events-user-trail"))return;let t=null;e.registerForClick("#js-events-user-trail",()=>{(t=document.createElement("div")).className="oe-popup-wrap";let s=document.createElement("div");s.className="oe-popup oe-events-user-trail",t.appendChild(s),e.appendTo("body",t);let i=setTimeout(()=>s.innerHTML='<i class="spinner"></i>',400);e.xhr("/idg-php/v3/_load/sidebar/events-user-trail-v2.php").then(e=>{clearTimeout(i),s.innerHTML=e}).catch(e=>console.log("ed3app php failed to load",e))}),e.registerForClick(".js-idg-toggle-event-audit-trail",e=>{let s=e.target,i=t.querySelector("#"+s.dataset.auditid);"block"===i.style.display?i.style.display="none":i.style.display="block"}),e.registerForClick(".oe-events-user-trail .close-icon-btn .oe-i",()=>{e.removeElement(t)})})(bluejay),(function(e){"use strict";if(e.addModule("examElementSearch"),null===document.querySelector("#js-search-in-event-popup"))return;e.registerForClick("#js-search-in-event",t=>{const s=t.target,i=document.querySelector("#js-search-in-event-popup"),n=document.querySelector(".main-event"),o=i.querySelector(".close-icon-btn");s.classList.add("selected"),e.show(i),n.classList.add("examination-search-active"),o.addEventListener("mousedown",t=>{t.stopPropagation(),n.classList.remove("examination-search-active"),e.hide(i),s.classList.remove("selected")},{once:!0})})})(bluejay),(function(e){"use strict";e.addModule("filterOptions");const t=[],s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("active"),this.positionContent(),e.show(this.content),this.mouseOutHide(),this.closeIconBtn())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("active"),e.hide(this.content))}}),n=()=>({positionContent:function(){this.defaultCSS=this.defaultCSS||this.content.className;let t,s,i,n=this.btn.getBoundingClientRect(),o=e.getHiddenElemSize(this.content);n.top<400?(t="top",s=n.top):(t="bottom",s=n.bottom-o.h),n.left<500?(t+="-left",i=n.left):(t+="-right",i=n.right-o.w),this.content.className=this.defaultCSS+" "+t,this.content.style.top=s+"px",this.content.style.left=i+"px"}}),o=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}},{closeIconBtn:function(){this.wrapper.querySelector(".close-icon-btn").addEventListener("mousedown",e=>{e.stopPropagation(),this.hide()},{once:!0})}},n());e.registerForClick(".oe-filter-options .oe-filter-btn",s=>(s=>{let i=s.target,n=e.getDataAttr(i);if(n)t[parseFloat(n)].change();else{let s=e.getParent(i,".oe-filter-options"),n=o({btn:i,wrapper:s,content:s.querySelector(".filter-options-popup")});n.show(),e.setDataAttr(i,t.length),t.push(n)}})(s))})(bluejay),(function(e){"use strict";e.addModule("lightning");if(null===document.querySelector(".oe-lightning-viewer"))return;const t=()=>({updateView:function(e){this.updateStack(e),this.updateMeta(document.querySelector(this.iconPrefix+e).dataset.meta)}}),s=()=>({updateStack:function(t){e.hide(document.querySelector(this.stackPrefix+this.currentStack)),e.show(document.querySelector(this.stackPrefix+t)),this.currentStack=t,this.updateCounter(),this.timelineIcon()}}),i=()=>({updateCounter:function(){document.querySelector(".lightning-ui .stack-position").textContent=this.currentStack+1+"/"+this.totalStackNum}}),n=()=>({timelineIcon:function(){document.querySelector(".icon-event").classList.remove("js-hover"),document.querySelector(this.iconPrefix+this.currentStack).classList.add("js-hover")}}),o=()=>({xscroll:function(e,t){var s=Math.floor(e/(this.xscrollWidth/this.totalStackNum));0==this.locked&&this.updateView(s)}}),l=()=>({swipeLock:function(){this.locked=!this.locked;let e=document.querySelector(".lightning-ui .user-help");this.locked?e.textContent="Swipe is LOCKED | Click to unlock":e.textContent="Swipe to scan or use key RIGHT / LEFT | Click to LOCK swipe"}}),a=(()=>Object.assign({currentStack:0,iconPrefix:"#lqv_",stackPrefix:"#lsg_",totalStackNum:document.querySelectorAll(".stack-group").length,xscrollWidth:document.querySelector(".lightning-view").clientWidth,locked:!0},t(),(()=>({updateMeta:function(e){let t=document.querySelector(".lightning-meta"),s=e.split(",");[".type",".date",".who"].forEach((e,i)=>{t.querySelector(e).textContent=s[i]})}}))(),s(),i(),n(),o(),l(),{stepThrough:function(e){var t=this.currentStack+e;t>=0&&t<this.totalStackNum&&this.updateView(t)}}))();a.updateCounter(),a.swipeLock(),e.registerForClick("#lightning-left-btn",()=>a.stepThrough(-1)),e.registerForClick("#lightning-right-btn",()=>a.stepThrough(1)),e.registerForClick(".lightning-view",()=>a.swipeLock()),e.registerForClick(".icon-event",()=>a.swipeLock()),e.registerForHover(".icon-event",e=>{let t=e.target;a.updateStack(t.dataset.id),a.updateMeta(t.dataset.meta)});const r=document.querySelector(".lightning-view");r.addEventListener("mousemove",e=>{}),e.listenForResize(()=>a.xscrollWidth=r.clientWidth),document.addEventListener("keydown",e=>{37==(e.keyCode||e.which)&&a.stepThrough(-1),39==(e.keyCode||e.which)&&a.stepThrough(1)})})(bluejay),(function(e){"use strict";e.addModule("lightningFilterOptions");const t=document.querySelector(".lightning-btn");if(null===t)return;const s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("active"),e.show(this.content))}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("active"),e.hide(this.content))}}),n=(()=>Object.assign({btn:t,content:document.querySelector(".change-timeline"),open:!1},{change:function(){this.open?this.hide():this.show()}},s(),i()))();e.registerForClick(".lightning-btn",()=>n.change())})(bluejay),(function(e){"use strict";e.addModule("lightningIconGroups");const t=e.nodeArray(document.querySelectorAll(".icon-group"));if(t.length<1)return;t.forEach(t=>{let s=t.childElementCount,i=document.createElement("div");i.textContent="("+s+")",e.hide(i),t.parentNode.appendChild(i)});e.registerForClick(".js-timeline-date",t=>{let s=t.target,i=document.querySelector("#js-icon-"+s.dataset.icons);s.classList.contains("collapse")?(e.hide(i),e.show(i.nextElementSibling),s.classList.replace("collapse","expand")):(e.show(i),e.hide(i.nextElementSibling),s.classList.replace("expand","collapse"))})})(bluejay),(function(e){"use strict";if(e.addModule("messagePreview"),null===document.querySelector(".home-messages"))return;e.nodeArray(document.querySelectorAll(".js-message .message")).forEach(e=>{e.scrollWidth<=e.clientWidth&&(e.parentNode.nextSibling.querySelector(".js-expand-message").style.display="none")});e.registerForClick(".js-expand-message",t=>{let s=t.target,i=e.getParent(s,"tr").querySelector(".message");s.classList.contains("expand")?(i.classList.add("expand"),s.classList.replace("expand","collapse")):(i.classList.remove("expand"),s.classList.replace("collapse","expand"))})})(bluejay),(function(e){"use strict";e.addModule("multiPageScroll");let t=e.nodeArray(document.querySelectorAll(".lightning-multipage-scroll"));if(0===t.length)return;const s=()=>({animateScrollTo:function(e){let t=1,s=0,i=this.stack.scrollTop,n=this.pageH*e-i;clearInterval(this.animateID),this.animateID=setInterval(()=>{s=Math.min(1,t/80),this.stack.scrollTop=Math.ceil((e=>e<.5?2*e*e:(4-2*e)*e-1)(s)*n)+i,t+=1,1==s&&clearInterval(this.animateID)},2)}}),i=()=>({pageBtn:function(e){e.matches(".page-num-btn")&&this.animateScrollTo(parseFloat(e.dataset.page))}});t.forEach(e=>{(e=>{e.numOfImgs=e.stack.querySelectorAll("img").length,e.pageH=parseFloat(e.stack.querySelector("img").height+10),e.animateID=null;let t=new DocumentFragment;for(let s=0;s<e.numOfImgs;s++){let i=document.createElement("div");i.className="page-num-btn",i.setAttribute("data-page",s),i.textContent=s+1+"/"+e.numOfImgs,t.appendChild(i)}e.nav.appendChild(t),e.nav.addEventListener("mouseenter",t=>e.pageBtn(t.target),{capture:!0}),e.nav.addEventListener("mousedown",t=>e.pageBtn(t.target),{capture:!0}),Object.assign(e,i(),s())})({nav:e.querySelector(".multipage-nav"),stack:e.querySelector(".multipage-stack")})})})(bluejay),(function(e){"use strict";e.addModule("navHotlist");const t="#js-nav-hotlist-btn",s=document.querySelector(t);if(null===s)return;const i=()=>({show:function(){this.open||(this.open=!0,e.show(this.content),this.mouseOutHide())}}),n=()=>({hide:function(){!1===this.open||this.isLocked||this.isFixed||(this.open=!1,this.btn.classList.remove("active","open"),e.hide(this.content))}}),o=(()=>Object.assign({btn:s,content:document.querySelector("#js-hotlist-panel"),wrapper:document.querySelector("#js-hotlist-panel-wrapper"),open:!1,isLocked:!1,isFixed:!1},{changeState:function(){this.isFixed||(this.open?this.isLocked?(this.isLocked=!1,this.hide()):this.makeLocked():(this.makeLocked(),this.over()))}},{over:function(){this.isFixed||(this.btn.classList.add("active"),this.show())}},{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}},{makeLocked:function(){this.isLocked=!0,this.btn.classList.add("open")}},i(),n(),{fixedOpen:function(e){this.isFixed=e,e?(this.isLocked=!1,this.btn.classList.add("open"),this.btn.classList.remove("active"),this.show()):this.hide()}}))(),l=()=>{"true"===s.dataset.fixable&&o.fixedOpen(window.innerWidth>e.settings.cssExtendBrowserSize)};e.registerForClick(t,()=>o.changeState()),e.registerForHover(t,()=>o.over()),e.listenForResize(l),l()})(bluejay),(function(e){"use strict";e.addModule("navLogo");const t="#js-openeyes-btn";null!==document.querySelector(".oe-login")&&document.querySelector(t).classList.add("active");const s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("open"),e.show(this.content),this.mouseOutHide())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("open","active"),e.hide(this.content))}}),n=(()=>{let n=document.querySelector(t);return Object.assign({btn:n,content:document.querySelector("#js-openeyes-info"),wrapper:e.getParent(n,".openeyes-brand"),open:!1},{over:function(){this.btn.classList.add("active")}},{out:function(){this.btn.classList.remove("active")}},{change:function(){this.open?this.hide():this.show()}},s(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}})})();e.registerForClick(t,()=>n.change()),e.registerForHover(t,()=>n.over()),e.registerForExit(t,()=>n.out())})(bluejay),(function(e){"use strict";e.addModule("navShortcuts");const t="#js-nav-shortcuts-btn",s=document.querySelector(t);if(null===s)return;const i=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("active"),e.show(this.content),this.mouseOutHide())}}),n=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("active"),e.hide(this.content))}}),o=(()=>Object.assign({btn:s,content:document.querySelector("#js-nav-shortcuts-subnav"),wrapper:document.querySelector("#js-nav-shortcuts"),open:!1},{change:function(){this.open?this.hide():this.show()}},i(),n(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}}))();e.registerForClick(t,()=>o.change()),e.registerForHover(t,()=>o.show())})(bluejay),(function(e){"use strict";e.addModule("navShortlists");const t="#js-nav-shortlists-btn",s=document.querySelector(t);if(null===s)return;const i=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("active"),e.show(this.content),this.mouseOutHide())}}),n=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("active"),e.hide(this.content))}}),o=(()=>Object.assign({btn:s,content:document.querySelector("#js-shortlists-panel"),wrapper:document.querySelector("#js-shortlists-panel-wrapper"),open:!1},{change:function(){this.open?this.hide():this.show()}},i(),n(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}}))();e.registerForClick(t,()=>o.change()),e.registerForHover(t,()=>o.show())})(bluejay),(function(e){"use strict";if(e.addModule("notificationBanner"),null===document.querySelector("#oe-admin-notifcation"))return;const t="#oe-admin-notifcation .oe-i",s=document.querySelector("#notification-short"),i=document.querySelector("#notification-full");if(null!==document.querySelector(".oe-login"))return e.hide(s),e.show(i),void(document.querySelector(t).style.display="none");let n=s,o=i,l=!0;const a=(e,t)=>{e.style.display="block",t.style.display="none"};e.registerForHover(t,()=>a(o,n)),e.registerForExit(t,()=>a(n,o)),e.registerForClick(t,()=>{n=l?i:s,o=l?s:i,l=!l,a(n,o)})})(bluejay),(function(e){"use strict";e.addModule("overlayPopup");const t=[{id:"#js-idg-popup-content-template",php:"_popup-content-template.php"},{id:"#js-change-context-btn",php:"change-context.php"},{id:"#copy-edit-history-btn",php:"previous-history-elements.php"},{id:"#copy-edit-anterior-segment-btn",php:"previous-ed-anterior.php"},{id:"#js-virtual-clinic-btn",php:"virtual-clinic.php"},{id:"#js-delete-event-btn",php:"delete-event.php"},{id:"#js-close-element-btn",php:"close-element.php"},{id:"#js-add-new-event",php:"add-new-event.php"},{id:"#js-idg-preview-correspondence",php:"letter-preview.php"},{id:"#js-idg-exam-complog",php:"exam-va-COMPlog.php"},{id:"#js-duplicate-event-btn",php:"duplicate-event-warning.php"},{id:"#js-idg-worklist-ps-add",php:"worklist-PS.php"},{id:"#analytics-change-filters",php:"analytics-filters.php"},{id:"#js-idg-add-new-contact-popup",php:"add-new-contact.php"},{id:"#js-idg-admin-queset-demo",php:"admin-add-queue.php"},{id:"#js-idg-search-query-save",php:"query-save.php"},{id:"#js-idg-search-all-searches",php:"query-all-searches.php"}],s=(t,s)=>{e.registerForClick(t,()=>{e.xhr("/idg-php/v3/_load/"+s).then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t,s.querySelector(".close-icon-btn").addEventListener("mousedown",t=>{t.stopPropagation(),e.removeElement(s)},{once:!0}),e.appendTo("body",s)}).catch(e=>console.log("OverlayPopup failed to load: Err msg -",e))})};for(let e=0,i=t.length;e<i;e++){let i=t[e];null!==document.querySelector(i.id)&&s(i.id,i.php)}})(bluejay),(function(e){"use strict";e.addModule("overlayPopupJSON");e.registerForClick(".js-idg-demo-popup-json",t=>{let s;if(void 0===t.target.dataset.idgDemo)throw new Error("overlayPopupJSON: No php file info? Needs data-idg-demo=json");s=JSON.parse(t.target.dataset.idgDemo).php,e.xhr("/idg-php/v3/_load/"+s).then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t,e.appendTo("body",s);let i=s.querySelector(".close-icon-btn");i&&i.addEventListener("mousedown",t=>{t.stopPropagation(),e.removeElement(s)},{once:!0})}).catch(e=>console.log("overlayPopupJSON: Failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("pathSteps");const t=".oe-pathstep-btn";if(null===document.querySelector(t))return;let s=!1;const i=document.createElement("div");i.style.display="none",i.className="oe-pathstep-popup",i.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<h3 class="title"></h3>','<div class="popup-overflow"><div class="data-group">','<table class="data-table"><tbody>',"</tbody></table>","</div></div>",'<div class="step-actions"><div class="flex-layout">','<button class="red hint">Remove PSD</button><button class="green hint">Administer</button>',"</div></div>",'<div class="step-status"></div>'].join(""),e.appendTo("body",i);const n={title:i.querySelector(".title"),closeBtn:i.querySelector(".close-icon-btn .oe-i"),status:i.querySelector(".step-status"),tbody:i.querySelector(".data-table tbody"),actions:i.querySelector(".step-actions"),detailRows:null,locked:!1},o=e=>{let t,s="NA";return"R"!=e&&"B"!=e||(t="R"),"L"!=e&&"B"!=e||(s="L"),`<span class="oe-eye-lat-icons"><i class="oe-i laterality ${t} small"></i><i class="oe-i laterality ${s} small"></i></span>`},l=e=>`<i class="oe-i ${e} small"></i>`,a=(e,t,s=!1)=>{let i=document.createElement("tr");s&&(i.className=s),e.forEach(e=>{let t=document.createElement("td");t.innerHTML=e,i.appendChild(t)}),t.appendChild(i)},r=t=>{let s=document.createDocumentFragment();t.forEach(e=>{a((e=>[o(e[0]),e[1],e[2]])(e.directive),s),e.steps.forEach(e=>{a((e=>(1==e.length&&(e=e.concat(['<em class="fade">to do</em>',""])),[l(e[0]),e[1],e[2]]))(e),s,"administer-details")})}),n.tbody.innerHTML="",n.tbody.appendChild(s),n.detailRows=e.nodeArray(i.querySelectorAll(".administer-details"))},c=()=>{let e=JSON.parse(s.dataset.step);n.title.textContent=e.title,r(e.psd),(e=>{let t="No status set",s="default";switch(e){case"done":t="PSD: Completed at 11:40",s="green";break;case"todo":t="PSD: Waiting to start",s="default";break;case"progress":t="PSD: In progress",s="orange";break;case"problem":t="Issue with PSD",s="red"}n.status.textContent=t,n.status.className=["step-status",s].join(" ")})(e.status)},d=e=>{let t=e?"block":"none",s=e?"table-row":"none";n.title.style.display=t,n.closeBtn.style.display=t,n.actions.style.display=t,n.detailRows.forEach(e=>e.style.display=s)},u=()=>{n.locked=!1,i.style.display="none"},h=(e,t,s=0)=>{i.style.top=e+s+"px",i.style.left=t-360+"px",i.style.display="block"};e.registerForClick(t,e=>{e.target!==s&&(s=e.target,c()),d(!0),n.locked=!0;let t=s.getBoundingClientRect();h(t.top,t.right,-5),window.addEventListener("scroll",u,{capture:!0,once:!0})}),e.registerForHover(t,e=>{if(n.locked)return;s=e.target,c(),d(!1);let t=s.getBoundingClientRect();h(t.bottom,t.right)}),e.registerForExit(t,e=>{n.locked||u()}),e.registerForClick(".oe-pathstep-popup .close-icon-btn .oe-i",u)})(bluejay),(function(e){"use strict";e.addModule("patientPopups");const t=[{btn:"#js-quicklook-btn",content:"#patient-summary-quicklook"},{btn:"#js-demographics-btn",content:"#patient-popup-demographics"},{btn:"#js-management-btn",content:"#patient-popup-management"},{btn:"#js-allergies-risks-btn",content:"#patient-popup-allergies-risks"},{btn:"#js-charts-btn",content:"#patient-popup-charts"},{btn:"#js-patient-extra-btn",content:"#patient-popup-trials"}],s=()=>({show:function(){this.open||(this.open=!0,o(this),e.show(this.content))}}),i=()=>({hide:function(){!1===this.open||this.isLocked||(this.open=!1,this.btn.classList.remove("active","open"),e.hide(this.content))}}),n=e=>(e.open=!1,e.isLocked=!1,Object.assign(e,{over:function(){this.btn.classList.add("active"),this.show()}},{out:function(e){e.relatedTarget!==this.content&&(this.hide(),this.btn.classList.remove("active"))}},{makeLocked:function(){this.isLocked=!0,this.btn.classList.add("open")}},s(),i(),{makeHidden:function(){this.open&&(this.isLocked=!1,this.hide())}})),o=e=>{t.forEach(t=>{t.popup!=e&&t.popup.makeHidden()})};t.forEach(t=>{let s=document.querySelector(t.btn);if(null!==s){let i=n({btn:s,content:document.querySelector(t.content)});e.registerForClick(t.btn,()=>i.over()),e.registerForHover(t.btn,()=>i.over()),e.registerForExit(t.btn,e=>i.out(e)),e.registerForExit(t.content,e=>i.out(e)),t.popup=i}})})(bluejay),(function(e){"use strict";e.addModule("patientQuickMeta");let t=!1,s=!1,i=null,n=null,o=null,l=window.innerHeight;const a={},r=()=>{n.style.display="none",t=s=!1,i=null},c=(r,c)=>{if(i===r&&t)return s=!0,void e.show(o);n=n||(()=>{const t=document.createElement("div");return t.className="oe-patient-quick-overview",t.style.display="none",t.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<div class="oe-patient-meta">','<div class="patient-name">','<a href="/v3-SEM/patient-overview"><span class="patient-surname">SURNAME</span>, <span class="patient-firstname">First (M.)</span></a>','</div><div class="patient-details">','<div class="hospital-number"><span>ID</span>0000000</div>','<div class="nhs-number"><span>NHS</span>111 222 3333</div>','<div class="patient-gender"><em>Gen</em>Male</div>','<div class="patient-age"><em>Age</em>00y</div>',"</div></div>",'<div class="quick-overview-content"></div>'].join(""),e.appendTo("body",t),o=t.querySelector(".close-icon-btn"),a.surname=t.querySelector(".patient-surname"),a.first=t.querySelector(".patient-firstname"),a.hospital=t.querySelector(".hospital-number"),a.nhs=t.querySelector(".nhs-number"),a.gender=t.querySelector(".patient-gender"),a.age=t.querySelector(".patient-age"),t})(),t=!0,s=c,i=r;let d=r.dataset,u=r.getBoundingClientRect(),h=d.mode,p=d.php,g=JSON.parse(d.patient);a.surname.textContent=g.surname,a.first.textContent=g.first,a.hospital.innerHTML="<span>ID</span> "+g.id,a.nhs.innerHTML="<span>NHS</span> "+g.nhs,a.gender.innerHTML="<em>Gen</em> "+g.gender,a.age.innerHTML="<em>Age</em> "+g.age,n.style.cssText=" ","float"==h?(n.classList.remove("side-panel"),l-u.y>300?n.style.top=u.y+u.height+5+"px":n.style.bottom=l-u.top+10+"px",n.style.left=u.x-250+u.width/2+"px"):n.classList.add("side-panel");let m=n.querySelector(".quick-overview-content");m.innerHTML="";let y=setTimeout(()=>m.innerHTML='<i class="spinner"></i>',400);c?e.show(o):e.hide(o),e.xhr("/idg-php/v3/_load/"+p).then(e=>{clearTimeout(y),t&&(m.innerHTML=e,n.style.display="block")}).catch(e=>console.log("ed3app php failed to load",e))};e.registerForClick(".js-patient-quick-overview",e=>{let n=e.target;t&&s&&i===n?r():c(n,!0)}),e.registerForHover(".js-patient-quick-overview",e=>{s||c(e.target,!1)}),e.registerForExit(".js-patient-quick-overview",e=>{s||r()}),e.registerForClick(".oe-patient-quick-overview .close-icon-btn .oe-i",r),e.listenForResize(()=>l=window.inneHeight)})(bluejay),(function(e){"use strict";e.addModule("printOptions");const t="#js-header-print-dropdown-btn",s=document.querySelector(t);if(null===s)return;const i=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("active"),e.show(this.content),this.mouseOutHide())}}),n=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("active"),e.hide(this.content))}}),o=(()=>Object.assign({btn:s,content:document.querySelector("#js-header-print-subnav"),wrapper:document.querySelector("#js-header-print-dropdown"),open:!1},{change:function(){this.open?this.hide():this.show()}},i(),n(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}}))();e.registerForClick(t,()=>o.change()),e.registerForHover(t,()=>o.show())})(bluejay),(function(e){"use strict";e.addModule("proView");const t=[],s=e=>({options:function(e){e.lock&&(this.pro=null),0!=e.linkID&&(this.linked=!0,this.linkedProView=n(document.querySelector("#"+e.linkID)),e.lock&&(this.linkedProView.pro=null))}}),i=e=>{let t=e.querySelector(".pro-view-btn"),i=e.querySelector(".data-pro-view"),n=e.querySelector(".data-standard-view"),o={btn:t,oei:t.querySelector(".oe-i"),pro:i,standard:n,inPro:!0,linked:!1};return Object.assign(o,{change:function(){this.inPro?(this.hideShow(this.pro,this.standard),this.icon("expand","collapse")):(this.hideShow(this.standard,this.pro),this.icon("collapse","expand")),this.linked&&this.linkedProView.change(),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}},{icon:function(e,t){this.oei.classList.replace(e,t)}},s())},n=e=>{let t={pro:e.querySelector(".data-pro-view"),standard:e.querySelector(".data-standard-view"),inPro:!0};return Object.assign(t,{change:function(){this.inPro?this.hideShow(this.pro,this.standard):this.hideShow(this.standard,this.pro),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}})};e.registerForClick(".pro-view-btn",s=>{const n=s.target;let o=e.getDataAttr(n);if(o)t[parseFloat(o)].change();else{e.setDataAttr(n,t.length);let s=i(e.getParent(n,".pro-data-view"));s.options(JSON.parse(n.dataset.proview)),s.change(),t.push(s)}})})(bluejay),(function(e){"use strict";e.addModule("problemsPlans");const t=e.nodeArray(document.querySelectorAll(".problems-plans-sortable"));if(t.length<1)return;const s=[],i=(e,t,s)=>({id:e,text:t,info:s});e.nodeArray(t[0].querySelectorAll("li")).forEach(e=>{s.push(i(s.length,e.textContent,e.querySelector(".info").getAttribute("data-tooltip-content")))}),t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach((t,s)=>{e.setDataAttr(t,s)})});let n=s.length+1;const o=(e,t)=>['<span class="drag-handle"><i class="oe-i menu medium pro-theme"></i></span>',e,'<div class="metadata">','<i class="oe-i info small pro-theme js-has-tooltip" data-tooltip-content="',t,'"></i></div>','<div class="remove"><i class="oe-i remove-circle small pro-theme pad"></i></div>'].join(""),l=(i,n)=>{let l=s.findIndex(e=>e.id==i),a=s.findIndex(e=>e.id==n);s[l]=s.splice(a,1,s[l])[0],t.length>1&&t.forEach(t=>{let i=t.querySelectorAll("li");for(let t=0,n=s.length;t<n;t++){let n=s[t],l=i[t];n.id!=e.getDataAttr(l)&&(e.setDataAttr(l,n.id),l.innerHTML=o(n.text,n.info))}})};e.registerForClick(".create-new-problem-plan button",l=>{l.preventDefault();let a=e.getParent(l.target,".create-new-problem-plan").querySelector("input");if(!a||a.value.length<2)return;let r=i(n++,a.value,"Added now!");s.push(r),((e,s)=>{t.forEach(t=>{t.appendChild(e.cloneNode(!0)),h(t.lastChild)})})((t=>{const s=new DocumentFragment,i=document.createElement("li");return i.innerHTML=o(t.text,t.info),e.setDataAttr(i,t.id),s.appendChild(i),s})(r))}),e.registerForClick(".problems-plans-sortable .remove-circle",i=>{let n=e.getParent(i.target,"li"),o=0;for(;null!==(n=n.previousSibling);)o++;t.forEach(t=>{e.removeElement(t.childNodes[o])}),s.splice(o,1)}),document.addEventListener("DOMContentLoaded",()=>{t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach(e=>{h(e)})})});let a=null;const r=e=>{a=e.target,e.target.parentNode.classList.add("js-sorting-list"),e.dataTransfer.setData("source",a.innerHTML)},c=e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"},d=e=>(e.preventDefault&&e.preventDefault(),!1),u=t=>{if(t.stopPropagation&&t.stopPropagation(),!1!==t.target.parentNode.classList.contains("js-sorting-list"))return t.target.parentNode.classList.remove("js-sorting-list"),a!=t.target&&(a.innerHTML=t.target.innerHTML,t.target.innerHTML=t.dataTransfer.getData("source"),l(e.getDataAttr(a),e.getDataAttr(t.target))),!1},h=e=>{e.setAttribute("draggable","true"),e.addEventListener("dragstart",r,!1),e.addEventListener("dragenter",c,!1),e.addEventListener("dragover",d,!1),e.addEventListener("drop",u,!1)}})(bluejay),(function(e){"use strict";e.addModule("reduceElementHeight");const t=[],s=e=>(e.reduced=!1,Object.assign(e,{change:function(){this.reduced?(this.elem.classList.remove("reduced-height"),this.icon.classList.replace("increase-height-orange","reduce-height")):(this.elem.classList.add("reduced-height"),this.icon.classList.replace("reduce-height","increase-height-orange")),this.reduced=!this.reduced}}));e.registerForClick(".element .js-elem-reduce .oe-i",(i,n)=>{let o=i.target,l=e.getDataAttr(o);if(l)t[parseFloat(l)].change();else{let i=s({elem:e.getParent(o,".element"),icon:o});i.change(),e.setDataAttr(o,t.length),t.push(i)}})})(bluejay),(function(e){"use strict";e.addModule("restrictDataHeightFlag");const t="restrict-data-shown-flag",s=e.getDataAttributeName(),i=[];function n(e,t,s){this.hasScrolled=!1,this.flag=e,this.content=t,this.scrollEndPos=s,this.content.addEventListener("scroll",()=>this.scroll(),{once:!0})}n.prototype.scroll=function(t){this.hasScrolled=!0,this.flag.className+=" fade-out",setTimeout(()=>e.removeElement(this.flag),400)},n.prototype.userClick=function(){this.hasScrolled||o(this.content,this.scrollEndPos)};const o=(e,t)=>{let s=1,i=0,n=setInterval(()=>{i=Math.min(1,s/200),e.scrollTop=Math.ceil((e=>e*(2-e))(i)*t),s+=1,1==i&&clearInterval(n)},2)};(()=>{let o=e.nodeArray(document.querySelectorAll(".restrict-data-shown"));if(o.length<1)return;const l=document.createDocumentFragment(),a=document.createElement("div");a.className=t,l.appendChild(a),o.forEach(e=>{let t=e.querySelector(".restrict-data-content"),o=e.clientHeight,a=t.scrollHeight;if(a>o&&0===t.scrollTop){let r=l.cloneNode(!0),c=r.firstChild;c.setAttribute(s,i.length),e.appendChild(r),i.push(new n(c,t,a-o))}})})(),e.registerForClick("."+t,e=>{i[e.target.getAttribute(s)].userClick()})})(bluejay),(function(e){"use strict";e.addModule("sideNavSelectList");const t=e.nodeArray(document.querySelectorAll(".js-list-filter"));if(0==t.length)return;const s=e.nodeArray(document.querySelectorAll(".js-filter-group"));let i=document.querySelector(".js-list-filter.selected");const n=e=>{s.forEach(t=>{t.style.display=e})};t.forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let s=t.target;s.classList.add("selected"),(t=>{"all"==t?n("block"):(n("none"),e.show(document.querySelector("#"+t)))})(s.dataset.list),i.classList.remove("selected"),i=s})})})(bluejay),(function(e){"use strict";bluejay.addModule("sidebarElementList");let t=document.querySelector(".sidebar-eventlist .oe-element-list");if(null===t)return;let s=document.querySelectorAll(".element-title");if(s.length<1)return;let i=document.createDocumentFragment();s.forEach((function(e){let t=document.createElement("li");t.innerHTML='<a href="#">'+e.textContent+"</a>",i.appendChild(t)})),t.appendChild(i)})(),(function(e){"use strict";e.addModule("sidebarEventFilter");const t="#js-sidebar-filter-btn",s=document.querySelector(t);if(null===s)return;const i=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("active"),e.show(this.content),this.mouseOutHide())}}),n=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("active"),e.hide(this.content))}}),o=(()=>Object.assign({btn:s,content:document.querySelector("#js-sidebar-filter-options"),wrapper:document.querySelector("#js-sidebar-filter"),open:!1},{change:function(){this.open?this.hide():this.show()}},i(),n(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}}))();e.registerForClick(t,()=>o.change()),e.registerForHover(t,()=>o.show())})(bluejay),(function(e){"use strict";if(e.addModule("sidebarQuicklookView"),null===document.querySelector("ul.events"))return;let t=null;const s=t=>{return e.getParent(t,"li").querySelector(".quicklook")},i=()=>({show:function(t){this.open=!0;const s=JSON.parse(t.dataset.quickview);this.icon.className="oe-i-e large "+s.icon,this.titleDate.textContent=s.title+" - "+s.date,e.xhr("/idg-php/v3/_load/sidebar/quick-view/"+s.php).then(e=>{!1!==this.open&&(this.open=!0,this.content.innerHTML=e,this.div.classList.remove("fade-out"),this.div.classList.add("fade-in"))}).catch(e=>console.log("PHP failed to load",e))}}),n=()=>({hide:function(){this.open=!1,this.div.classList.add("fade-out"),this.div.classList.remove("fade-in"),setTimeout(()=>this.div.classList.remove("fade-out"),300)}}),o=(()=>{const t=document.createElement("div");return t.className="oe-event-quick-view",t.id="js-event-quick-view",t.innerHTML=['<div class="event-icon"><i class="oe-i-e large"></i></div>','<div class="title-date">Title - DD Mth YYYY</div>','<div class="audit-trail">Michael Morgan</div>','<div class="quick-view-content"></div>'].join(""),e.appendTo("body",t),Object.assign({div:t,titleDate:t.querySelector(".title-date"),icon:t.querySelector(".event-icon > .oe-i-e"),content:t.querySelector(".quick-view-content"),open:!1},i(),n())})();e.registerForHover(".event .event-type",e=>{(e=>{s(e).classList.add("fade-in"),t=e})(e.target),o.show(e.target)}),e.registerForExit(".event .event-type",e=>{null!=t&&(s(t).classList.remove("fade-in"),t=null),o.hide()})})(bluejay),(function(e){"use strict";e.addModule("textAreaResize");const t=e=>{let t=e.scrollHeight;t<20||(e.style.height="auto",e.style.height=t+"px")};e.extend("resizeTextArea",t),document.addEventListener("input",e=>{e.target.matches("textarea")&&t(e.target)},{capture:!0}),document.addEventListener("DOMContentLoaded",()=>{e.nodeArray(document.querySelectorAll("textarea")).forEach(e=>{t(e)})})})(bluejay),(function(e){"use strict";bluejay.addModule("userPIN");document.addEventListener("input",e=>{e.target.matches(".user-pin-entry")&&(e=>{let t=e.value,s=e.parentNode;s.classList.remove("accepted-pin","wrong-pin"),4===t.length&&("1234"==t?s.classList.add("accepted-pin"):s.classList.add("wrong-pin"))})(e.target)},{capture:!0})})(),(function(e){"use strict";e.addModule("vcScratchPad");const t=document.querySelector("#oe-vc-scratchpad");if(null===t)return;let s,i,n=!1;t.addEventListener("dragstart",e=>{e.dataTransfer.dropEffect="move";let t=e.target.getBoundingClientRect();s=e.clientX-t.left,i=e.clientY-t.top},!1),t.addEventListener("dragend",e=>{let n=Math.round(e.clientY-i),o=Math.round(e.clientX-s);n=n<1?1:n,o=o<1?1:o,t.style.top=n+"px",t.style.left=o+"px"},!1);e.registerForClick("#js-vc-scratchpad",s=>{let i=s.target;n?(e.hide(t),i.textContent="ScratchPad"):(e.show(t),i.textContent="Hide ScratchPad"),n=!n})})(bluejay),(function(e){"use strict";if(e.addModule("whiteboard"),null===document.querySelector("main.oe-whiteboard"))return;e.hide(document.querySelector("#oe-minimum-width-warning")),e.hide(document.querySelector("#oe-admin-notifcation"));const t=document.querySelector(".wb3-actions");e.registerForClick("#js-wb3-openclose-actions",e=>{let s=e.target;s.classList.contains("up")?(s.classList.replace("up","close"),t.classList.replace("down","up")):(s.classList.replace("close","up"),t.classList.replace("up","down"))}),e.registerForClick(".wb-idg-demo-btn",e=>{window.location="/v3-whiteboard/"+e.target.dataset.url})})(bluejay),(function(e){"use strict";const t=e.addModule("addSelect");t.all=[],t.closeAll=function(){this.all.forEach(e=>e.close())},t.init=function(){const s=e.nodeArray(document.querySelectorAll(".js-add-select-btn"));s.length<1||s.forEach(e=>{let s=new t.Popup(e);this.all.push(s)})},document.addEventListener("DOMContentLoaded",()=>t.init(),{once:!0})})(bluejay),(function(e){"use strict";const t=bluejay.getModule("addSelect");t.ListOption=function(e,s){let i=e.classList.contains("selected"),n=!1,o=JSON.parse(e.dataset.insert);void 0!==o.dependents&&(n=new t.OptionDependents(o.dependents,s.uniqueId)),this.click=function(){this.toggleState(),s.optionClicked(i,this),0!=n&&n.show(i)},this.toggleState=function(){e.classList.toggle("selected"),i=!i},this.deselect=function(){i&&this.toggleState()},Object.defineProperty(this,"selected",{get:()=>i,set:t=>{i=t,t||e.classList.remove("selected")}}),Object.defineProperty(this,"dependents",{get:()=>!1!==n}),e.addEventListener("mousedown",this.click.bind(this))}})(),(function(e){"use strict";e.getModule("addSelect").OptionDependents=function(t,s){if(void 0===t)return!1;const i="#add-to-"+s+"-";let n=[];t.split(",").forEach(e=>{let t=e.split("."),s={};if(0===t[0]&&console.log("Error: OptionDependents, listGroup = 0 !!",i+"listgroup"+t[0]),s.div=document.querySelector(i+"listgroup"+t[0]),null===s.div&&console.log("obj.div = null!",i+"listgroup"+t[0]),s.holder=s.div.querySelector(".optional-placeholder"),null===s.holder&&console.log("Adder: no placeholder text for optional group"),0==t[1])s.showDefaultText=!0;else{s.showDefaultText=!1,s.lists=[];for(let e=1;e<t.length;e++){let n=document.querySelector(i+"list"+t[e]);null===n?console.log("Err: OptionDependents, list? ",i+"list"+t[e]):s.lists.push(n)}}n.push(s)}),this.show=function(e){e?this.myLists():this.reset()},this.hideAllOptionalLists=function(t){e.nodeArray(t.querySelectorAll(".optional-list")).forEach(t=>{e.hide(t)})},this.myLists=function(){n.forEach(t=>{this.hideAllOptionalLists(t.div),t.showDefaultText?t.holder&&e.show(t.holder):(t.holder&&e.hide(t.holder),t.lists.forEach(t=>{e.show(t)}))})},this.reset=function(){n.forEach(t=>{this.hideAllOptionalLists(t.div),t.holder&&e.show(t.holder)})}}})(bluejay),(function(e){"use strict";const t=e.getModule("addSelect");t.OptionsList=function(s){let i=JSON.parse(s.dataset.options);const n="single"==i.type,o=(i.hasExtraOptions,"true"===i.isOptionalList);this.uniqueId=s.dataset.id,o&&e.hide(s.parentNode);let l=[],a=[];e.nodeArray(s.querySelectorAll("li")).forEach(e=>{let s=new t.ListOption(e,this);l.push(s),s.selected&&s.dependents&&a.push(s)}),this.optionClicked=function(e,t){e&&n&&l.forEach(e=>{e!==t&&e.deselect()})},this.checkForDefaultSelections=(()=>{a.length&&a.forEach(e=>{e.selected=!1,e.click()})})}})(bluejay),(function(e){"use strict";const t=e.getModule("addSelect");t.Popup=function(s){let i=document.querySelector("#"+s.dataset.popup),n=[];this.anchorLeft=!!i.dataset.anchorLeft,this.btn=s,this.popup=i,this.closeBtn=i.querySelector(".close-icon-btn"),this.open=function(){this.position(),t.closeAll(),e.show(i),this.closeBtn.addEventListener("mousedown",this.close.bind(this))},this.close=function(){i.style.display="none"},this.reset=function(){},e.nodeArray(i.querySelectorAll(".add-options")).forEach(e=>{let s=new t.OptionsList(e);s.checkForDefaultSelections(),n.push(s)}),this.btn.addEventListener("mousedown",this.open.bind(this))},t.Popup.prototype.position=function(){let e=this.btn.getBoundingClientRect(),t=window.innerWidth,s=window.innerHeight,i=s-e.bottom;if(s-i<325&&(i=s-325),this.anchorLeft)this.popup.style.left=e.left+"px";else{let s=e.right-this.popup.getBoundingClientRect().width,i=s<0?s-25:0;this.popup.style.right=t-e.right+i+"px"}this.popup.style.bottom=i+"px"}})(bluejay),(function(){"use strict";console.timeEnd("[blue] Ready")})();