Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";const e={};return console.time("[bluejay] Ready"),console.time("[bluejay] DOM Loaded"),e.extend=(t,s)=>{if("function"!=typeof s)throw new TypeError("[bluejay] [app.js] - only extend with a function: "+t);if(s._bj||t in e)throw new TypeError("[bluejay] [app.js] - already extended with: "+t);e[t]=s,s._bj=!0},e.log=e=>{console.log("[bluejay] "+e)},e.ready=()=>{console.timeEnd("[bluejay] Ready")},e.log("OE JS UI layer [bluejay] ..."),e.log("DEBUG MODE"),e.log("Mustache version: "+Mustache.version),document.addEventListener("DOMContentLoaded",()=>{e.log("[Modules] - "+e.registeredModules()),console.timeEnd("[bluejay] DOM Loaded")},{once:!0}),e})();!(function(e){"use strict";const t=new Map,s=new Map,o=new Map,n=new Set,i=(e,t,s)=>{if(e.has(t))throw new TypeError("DOM Events: selector already added : "+t);e.set(t,s)},a=(e,t)=>{const s=e.target;if(s===document)return!1;t.forEach((t,o)=>{s.matches(o)&&t(e)})},l=(()=>{let e=0;return{delay:()=>{clearTimeout(e),e=setTimeout(()=>{n.forEach(e=>{e()})},150)}}})();function r(e){a(e,s)}function c(e){a(e,t)}function d(e){a(e,o)}let u=e=>{document.removeEventListener("mouseenter",r,{capture:!0}),document.removeEventListener("mousedown",c,{capture:!0}),document.removeEventListener("mouseleave",d,{capture:!0}),a(e,t),u=e=>{a(e,t)}};document.addEventListener("mouseenter",r,{capture:!0}),document.addEventListener("mousedown",c,{capture:!0}),document.addEventListener("mouseleave",d,{capture:!0}),document.addEventListener("touchstart",e=>u(e),{capture:!0}),window.onresize=()=>l.delay(),e.extend("userEnter",(e,t)=>i(s,e,t)),e.extend("userDown",(e,s)=>i(t,e,s)),e.extend("userLeave",(e,t)=>i(o,e,t)),e.extend("listenForResize",e=>n.add(e))})(bluejay),(function(e){"use strict";const t=(function*(){let e=10;for(;;)yield++e})(),s=()=>t.next().value;function o(){this.map=new Map,this.dataAttr="data-oebjk"}e.extend("getKey",s),o.prototype.add=function(e,t){const o=s();return this.map.set(o,e),t.setAttribute(this.dataAttr,o),o},o.prototype.getKey=function(e){let t=e.getAttribute(this.dataAttr);return null!==t&&""!=t&&t},o.prototype.get=function(e){return"string"==typeof e&&(e=parseInt(e,10)),this.map.get(e)},o.prototype.has=function(e){return this.map.has(e)},e.extend("Collection",o)})(bluejay),(function(e){"use strict";bluejay.extend("customEvent",(e,t)=>{const s=new CustomEvent(e,{detail:t});document.dispatchEvent(s)})})(),(function(e){"use strict";e.extend("nodeArray",e=>Array.prototype.slice.call(e)),e.extend("appendTo",(e,t,s)=>{(s||document).querySelector(e).appendChild(t)}),e.extend("getParent",(e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1}),e.extend("removeElement",e=>{e.parentNode.removeChild(e)}),e.extend("show",(e,t="")=>{null!==e&&(e.style.display=t)}),e.extend("reshow",e=>{null!==e&&(e.style.display="")}),e.extend("hide",e=>{null!==e&&(e.style.display="none")}),e.extend("xhr",t=>(e.log("[XHR] - "+t),new Promise((s,o)=>{let n=new XMLHttpRequest;n.open("GET",t),n.onreadystatechange=function(){4===n.readyState&&(n.status>=200&&n.status<300?(e.log("[XHR] - Success"),s(n.responseText)):(e.log("[XHR] - Failed"),o(this.status+" "+this.statusText)))},n.send()}))),e.extend("getHiddenElemSize",e=>{e.style.visibility="hidden",e.style.display="";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="inherit",e.style.display="none",t}),e.extend("idgReporter",e=>{let t="idg-js-ui-message-out",s=document.getElementById(t),o=document.createElement("li");null===s&&(s=document.createElement("ul"),s.id=t,s.style="position:fixed; bottom:10px; right:10px; z-index:9999; background:orange; padding:10px; list-style-position:inside; max-height:vh90; overflow-y: scroll; font-size:14px;",document.body.appendChild(s));let n=s.children.length;o.appendChild(document.createTextNode(n+" - "+e)),s.appendChild(o)})})(bluejay),(function(e){"use strict";const t=[],s=new Map;e.extend("addModule",e=>t.push(e)),e.extend("registeredModules",()=>(t.sort(),t.join(", "))),e.extend("namespace",e=>(s.has(e)||s.set(e,{}),s.get(e)))})(bluejay),(function(e){"use strict";const t={list:new Set,add(e){return this.list.add(e),this.list.has(e)},remove(e){this.list.remove(e)},size(){return this.list.size},notify(){let e=this.list.values();for(let t of e)t()}};e.extend("ModelViews",()=>({views:Object.create(t)}))})(bluejay),(function(e){"use strict";const t=(e=!1)=>"data-"+(e?"bluejay-"+e:"bluejay");e.extend("settings",t=>{switch(t){case"cssHeaderHeight":return 60;case"cssExtended":return 1440;case"cssHotlistFixed":return 1890;case"idgPHPLoadURL":return"/idg-php/v3/_load/";default:return e.log("Setting request not recognised: "+t),null}}),e.extend("getDataAttributeName",t),e.extend("setDataAttr",(e,s)=>{e.setAttribute(t(),s)}),e.extend("getDataAttr",e=>{const s=t();return!!e.hasAttribute(s)&&e.getAttribute(s)})})(bluejay);const oePlotly=(function(e){"use strict";e.log("Plot.ly version: "+Plotly.version),e.log("oePlotly - Plot.ly layout builder");const t={dark:{blue:"#63d7d6",highlight:"#fff",green:"#65d235",greenSeries:["#65d235","#A5D712","#36be8d","#02B546"],red:"#ea2b34",redSeries:["#ea2b34","#F65B20","#D41C50","#D44304"],standard:["#1451b3","#175ece","#1a69e5"],varied:["#0a83ea","#18949f","#781cea","#3f0aea"],dual:["#1472DE","#2E4259"]},light:{blue:"#00f",highlight:"#000",green:"#418c20",greenSeries:["#418c20","#708017","#147019","#667D3C"],red:"#da3e43",redSeries:["#da3e43","#AB274A","#BA4B2B","#AB2C22"],standard:["#0a4198","#1451b3","#175ece"],varied:["#0a2aea","#ea0a8e","#00b827","#890aea"],dual:["#2126C2","#8FAEC2"]}};return{isDarkTheme:()=>"dark"===window.oeThemeMode,getBlue:e=>e?t.dark.blue:t.light.blue,getColorSeries:(e,s)=>{let o=null;switch(e){case"varied":o=s?t.dark.varied:t.light.varied;break;case"posNeg":o=s?t.dark.dual:t.light.dual;break;case"rightEyeSeries":o=s?t.dark.greenSeries:t.light.greenSeries;break;case"leftEyeSeries":o=s?t.dark.redSeries:t.light.redSeries;break;default:o=s?t.dark.standard:t.light.standard}return o},getColor:(e,s)=>{switch(e){case"highlight":return s?t.dark.highlight:t.light.highlight;case"rightEye":return s?t.dark.green:t.light.green;case"leftEye":return s?t.dark.red:t.light.red;case"error_y":return s?"#5b6c77":"#7da7cb";default:return"pink"}}}})(bluejay);!(function(e){"use strict";e.findRegression=function(e,t){let s=0,o=0,n=0,i=0,a=0,l=0,r=0,c=e.length;if(c!=t.length)throw new Error("The parameters values_x and values_y need to have same size!");if(0===c)return[[],[]];for(let d=0;d<c;d++)l=e[d],r=t[d],s+=l,o+=r,i+=l*l,n+=l*r,a++;const d=(a*n-s*o)/(a*i-s*s),u=o/a-d*s/a;let h=[],p=[];for(let t=0;t<c;t++)l=e[t],r=l*d+u,h.push(parseFloat(Number.parseFloat(l).toFixed(2))),p.push(parseFloat(Number.parseFloat(r).toFixed(2)));return{x:h,y:p}}})(oePlotly),(function(e){"use strict";e.getAxis=function(e,t){let s={linecolor:t?"#666":"#999",linewidth:1,showgrid:!0,gridcolor:t?"#292929":"#e6e6e6",tickmode:"auto",nticks:20,ticks:"outside",ticklen:3,tickcolor:t?"#666":"#ccc",automargin:!0,mirror:!0,connectgaps:!1};const o="y"==e.type;if(e.noMirrorLines&&(s.mirror=!1),e.domain&&o&&(s.domain=e.domain),e.title&&(s.title={text:e.title,standoff:o?10:20,font:{size:12}}),e.rightSide&&o&&(s.overlaying=e.rightSide,s.side="right",s.showgrid=!1,s.zeroline=!1,s.title.standoff=15),e.numTicks&&(s.nticks=e.numTicks),e.useDates&&(s.tickformat="%b %Y"),e.fixRange&&(s.fixedrange=!0),e.range&&(s.range=e.range),e.axisType&&(s.type=e.axisType),e.useCategories){let t=e.useCategories.categoryarray;s.type="category",s.categoryarray=[" "].concat(t),e.useCategories.showAll&&(s.range=[0,t.length+1])}return e.spikes&&(s.showspikes=!0,s.spikecolor=t?"#0ff":"#00f",s.spikethickness=t?.5:1,s.spikedash=t?"1px,3px":"2px,3px"),s}})(oePlotly),(function(e){"use strict";e.getLayout=function(t){const s=t.darkTheme;let o={isDark:s,hovermode:"closest",autosize:!0,margin:{l:50,r:50,t:30,b:80,pad:4,autoexpand:!0},paper_bgcolor:s?"rgba(30,46,66,0.5)":"rgba(255,255,255,0.5)",plot_bgcolor:s?"rgb(10,10,30)":"#fff",font:{family:"Roboto, 'Open Sans', verdana, arial, sans-serif",size:11,color:s?"#aaa":"#333"},hoverlabel:{bgcolor:s?"#003":"#fff",bordercolor:s?"#003":"#00f",font:{size:11,color:e.getBlue(s)}}};if(t.colors?o.colorway=e.getColorSeries(t.colors,s):o.colorway=e.getColorSeries("default",s),t.plotTitle&&(o.title={text:t.plotTitle,xref:"paper",yref:"container",x:0,y:1,yanchor:"top",pad:{t:20},font:{size:15}},o.margin.t=50),t.legend){o.showlegend=!0;const e={font:{size:9},itemclick:"toggleothers",orientation:"h",xanchor:"right",yanchor:"bottom",x:1,y:1};"boolean"==typeof t.legend?o.legend=e:o.legend=Object.assign(e,t.legend)}else o.showlegend=!1;if(t.subplot&&(o.grid={rows:t.subplot,columns:1,pattern:"independent"}),o.shapes=[],o.annotations=[],t.vLineLabel){const n=t.vLineLabel.x,i=t.vLineLabel.h,a=(t,o)=>({type:"line",layer:"above",yref:"paper",x0:t.x,y0:0,x1:t.x,y1:i,line:{color:e.getBlue(s),width:.5}}),l=(t,o)=>({showarrow:!1,text:t.name,textangle:90,align:"left",font:{color:e.getBlue(s)},borderpad:2,x:t.x,xshift:8,yref:"paper",y:i});o.shapes=o.shapes.concat(n.map(a)),o.annotations=o.annotations.concat(n.map(l))}if(t.hLineLabel){const n=t.hLineLabel.y,i=t.hLineLabel.axis,a=(t,o)=>({type:"line",layer:"below",xref:"paper",yref:i,x0:0,y0:t.y,x1:1,y1:t.y,line:{color:e.getBlue(s),width:2,dash:"3px,12px"}}),l=(t,o)=>({showarrow:!1,text:t.name,align:"left",font:{color:e.getBlue(s)},borderpad:2,xref:"paper",x:0,yshift:8,yref:i,y:t.y});o.shapes=o.shapes.concat(n.map(a)),o.annotations=o.annotations.concat(n.map(l))}if(t.xaxis&&(o.xaxis=t.xaxis),t.yaxes&&t.yaxes.forEach((e,t)=>{t?o["yaxis"+(t+1)]=e:o.yaxis=e,e.title&&("right"==e.side?o.margin.r=80:o.margin.l=80)}),t.rangeSlider){const e={thickness:.08};s&&(e.bgcolor=o.paper_bgcolor,e.borderwidth=1,e.bordercolor=o.plot_bgcolor),"boolean"!=typeof t.rangeSlider&&(e.range=t.rangeSlider),o.xaxis.rangeslider=e,o.margin.b=15}return t.dateRangeButtons&&(o.xaxis.rangeselector=Object.assign({x:1,xanchor:"right",buttons:[{label:"Show all",step:"all"},{label:"2 Yr",step:"year",count:2},{label:"1 Yr",step:"year",count:1},{label:"6 Mth",step:"month",count:6}]},e.buttonStyling(s))),o}})(oePlotly),(function(e,t){"use strict";e.buildDiv=(e,t,s)=>{const o=document.createElement("div");return o.id="oePlotly-"+e,o.style.height=t,o.style.minHeight=s,o},e.fullDateRange=()=>({all:[],add(e){this.all=this.all.concat(e),this.all.sort()},firstLast(){let e=this.all.filter(e=>null!==e);return[e[0],e.pop()]}}),e.addClickEvent=(e,s)=>{e.on("plotly_click",(function(e){const o=e.points[0];let n={eye:s,name:o.data.name,index:o.pointIndex,x:o.x,y:o.y};t.customEvent("oePlotlyClick",n),t.log('"oePlotlyClick" Event data: '+JSON.stringify(n))}))},e.addHoverEvent=(e,s)=>{t.log('"oePlotlyHover" ('+s+") Event available (click point to see data structure)"),e.on("plotly_hover",(function(e){const o=e.points[0];let n={eye:s,name:o.data.name,index:o.pointIndex,x:o.x,y:o.y};t.customEvent("oePlotlyHover",n)}))},e.dashedLine=e=>({dash:"2px,2px",width:2}),e.markerFor=e=>{const t={};switch(e){case"image":t.symbol="triangle-down",t.size=10;break;case"drug":t.symbol="diamond",t.size=8;break;case"injection":t.symbol="star-diamond",t.size=9}return t},e.eventStyle=t=>{const s={marker:e.markerFor(t)};switch(t){case"image":s.mode="markers";break;case"drug":s.mode="lines+markers",s.line={width:3};break;case"injection":s.mode="markers"}return s},e.buttonStyling=e=>({font:{color:e?"#ccc":"#666"},bgcolor:e?"rgb(30,46,66)":"rgb(255,255,255)",activecolor:e?"rgb(7,69,152)":"rgb(205,205,255)",bordercolor:e?"rgb(10,26,36))":"rgb(255,255,255)",borderwidth:2}),e.addDropDown=t=>{let s=[];s.push({method:"update",args:["visible",[!0,!1,!1,!1]],label:"Option 1"}),s.push({method:"update",args:[{},{title:"some new title",colorway:e.getColorSeries("default",!0)}],label:"Options Title"});let o=Object.assign({type:"dropdown",xanchor:"left",yanchor:"top",x:0,y:.35,buttons:s},e.buttonStyling());t.updatemenus=[o]}})(oePlotly,bluejay),(function(e){"use strict";e.highlighPoint=(t,s)=>(o,n)=>{let i=o.split(".");if(2!=i.length)return void bj.log('oePlotly - for highlightPoint to work it needs EyeSide & Date JSON name e.g. "leftEye.OCT" ');let a,l,r=i[0],c=i[1],d=0;t.get(r).get("data").forEach((e,t)=>{t===c&&(a=e,l=d),d++});let u=e.getColor(r,s),h=[];for(let e=0;e<a.x.length;e++)h.push(u);h[n]=e.getColor("highlight",s);let p=e.markerFor(a.oeEventType);p.color=h,Plotly.restyle(t.get(r).get("div"),{marker:p},[l])}})(oePlotly),(function(e){"use strict";e.selectableUnits=()=>{const t=new Map,s=[];let o,n=0;const i=e=>{n=e.target.selectedIndex;for(const e of t.keys())o(e)};return{init:t=>{o=t.plotlyUpdate;const a=t.darkTheme,l=t.axisDefaults,r=l.title,c=[];t.unitRanges.forEach((t,o)=>{let i;t.makeDefault&&(n=o),c.push(t.option),l.title=`${r} - ${t.option}`,i="number"==typeof t.range[0]?Object.assign({},l,{range:t.range.reverse(),axisType:"linear"}):Object.assign({},l,{useCategories:{showAll:!0,categoryarray:t.range.reverse()}}),s.push(e.getAxis(i,a))}),(e=>{const t=["VA Scale ","<select>","{{#options}}","<option>{{.}}</option>","{{/options}}","</select>"].join(""),s=document.createElement("div");s.className="oesplotly-options",s.innerHTML=Mustache.render(t,{options:e}),s.style.position="absolute",s.style.top="1px",s.style.left="50%",s.style.transform="translateX( -50% )",s.style.zIndex=1;const o=document.querySelector(".oes-v2");o.style.position="relative",o.appendChild(s);let a=s.querySelector("select");a.options[n].selected=!0,a.addEventListener("change",i,!1)})(c)},addTrace:(e,s)=>{t.has(e)?t.get(e).push(s):t.set(e,[s])},selectedTrace:e=>t.get(e)[n],selectedAxis:()=>s[n]}}})(oePlotly),(function(e){"use strict";const t=oePlotly.isDarkTheme();e.extend("plotBarChart",(s=null)=>{if(null===s)return e.log("[oePlotly] - no JSON data provided for Plot.ly Bar Chart ??"),!1;e.log("[oePlotly] - building Plot.ly Bar Chart");const o=(e=>{const t={y:e.data.y,name:e.data.name,type:"bar"};return e.data.x&&(t.x=e.data.x),e.data.hovertemplate&&(t.hovertemplate=e.data.hovertemplate),[t]})(s),n=oePlotly.getAxis({type:"x",numTicks:20},t),i=oePlotly.getAxis({type:"y",numTicks:20},t);s.title.xaxis&&(n.title=s.title.xaxis),s.title.yaxis&&(i.title=s.title.yaxis),console.log(s),(e=>{const s=oePlotly.getLayout({darkTheme:t,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes});s.barmode="stack",Plotly.react(e.div,e.data,s,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(s.dom),title:s.title.plot,data:o,xaxis:n,yaxes:[i]})})})(bluejay),(function(e){"use strict";const t="Bar Percent Complete",s=oePlotly.isDarkTheme();e.extend("plotBarPercentComplete",(o=null)=>{if(null===o)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const n=(e=>{let t=e.percentComplete.map(e=>100-e);return[{x:e.xAxis,y:e.percentComplete,name:"",hovertemplate:"Complete<br>%{y}%",type:"bar"},{x:e.xAxis,y:t,name:"",hovertemplate:"Incomplete<br>%{y}%",type:"bar"}]})(o),i=oePlotly.getAxis({type:"x",numTicks:20},s),a=oePlotly.getAxis({type:"y",range:[0,100],numTicks:20},s);(e=>{const t=oePlotly.getLayout({darkTheme:s,colors:"posNeg",xaxis:e.xaxis,yaxes:e.yaxes});t.barmode="stack",Plotly.react(e.div,e.data,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(o.dom),data:n,xaxis:i,yaxes:[a]})})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme(),s=new Map,o=oePlotly.fullDateRange(),n=oePlotly.selectableUnits(),i=oePlotly.highlighPoint(s,t),a=(e,t)=>{s.get(t).set("data",new Map);const i={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers"};s.get(t).get("data").set(e.VA.offScale.name,i),o.add(e.VA.offScale.x);const a={x:e.VFI.x,y:e.VFI.y,name:e.VFI.name,yaxis:"y5",hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dashedLine()};s.get(t).get("data").set(e.VFI.name,a),o.add(e.VFI.x);const l={x:e.IOP.x,y:e.IOP.y,name:e.IOP.name,yaxis:"y3",hovertemplate:"IOP: %{y}<br>%{x}",type:"scatter",mode:"lines+markers"};s.get(t).get("data").set(e.IOP.name,l),o.add(e.IOP.x),Object.values(e.VA.units).forEach((e,s)=>{n.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y2",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers"}),s||o.add(e.x)}),s.get(t).get("data").set("VA",n.selectedTrace(t)),Object.values(e.events).forEach(e=>{let n=e.customdata?"%{y}<br>%{customdata}<br>%{x}":"%{y}<br>%{x}",i=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:n,type:"scatter",showlegend:!1},oePlotly.eventStyle(e.event));s.get(t).get("data").set(e.name,i),o.add(e.x)})},l=e=>{let t=s.get(e);t.get("data").set("VA",n.selectedTrace(e)),t.get("layout").yaxis2=Object.assign({},n.selectedAxis());const o=Array.from(t.get("data").values());Plotly.react(t.get("div"),o,t.get("layout"),{displayModeBar:!1,responsive:!0})},r=e=>{const n=e.eyeSide,i=oePlotly.getLayout({darkTheme:t,legend:{traceorder:"reversed",yanchor:"bottom",y:.82},colors:e.colors,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes,subplot:4,rangeSlider:o.firstLast(),dateRangeButtons:!0,vLineLabel:{x:Object.values(e.procedures),h:.82},hLineLabel:{y:Object.values(e.targetIOP),axis:"y3"}}),a=oePlotly.buildDiv("Glaucoma-"+n,"80vh","850px");document.querySelector(e.parentDOM).appendChild(a),s.get(n).set("div",a),s.get(n).set("layout",i),l(n),oePlotly.addClickEvent(a,n),oePlotly.addHoverEvent(a,n),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(a,i)})};e.extend("plotSummaryGlaucoma",(c=null)=>{if(null===c)return e.log("[oePlotly] - no JSON data provided for Plot.ly Glaucoma ??"),!1;e.log("[oePlotly] - building Plot.ly Glaucoma");const d=[[0,.08],[.1,.45],[.47,.82],[.88,1]];n.init({darkTheme:t,plotlyUpdate:l,axisDefaults:{type:"y",domain:d[1],title:"VA",spikes:!0},unitRanges:Object.values(c.yaxis.unitRanges)}),c.rightEye&&(s.set("rightEye",new Map),a(c.rightEye,"rightEye")),c.leftEye&&(s.set("leftEye",new Map),a(c.leftEye,"leftEye"));const u=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,range:o.firstLast(),noMirrorLines:!0},t),h=oePlotly.getAxis({type:"y",domain:d[0],useCategories:{showAll:!0,categoryarray:c.yaxis.offScale.reverse()},spikes:!0},t),p=oePlotly.getAxis({type:"y",domain:d[2],title:"IOP",range:[0,75],spikes:!0},t),y=oePlotly.getAxis({type:"y",domain:d[3],useCategories:{showAll:!0,categoryarray:c.eventTypes.reverse()},spikes:!0},t),m=oePlotly.getAxis({type:"y",domain:d[1],title:"VFI",range:[-30,5],rightSide:"y2",spikes:!0},t),g=n.selectedAxis();return s.has("rightEye")&&r({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:u,yaxes:[h,g,p,y,m],procedures:c.rightEye.procedures,targetIOP:c.rightEye.targetIOP,parentDOM:c.rightEye.dom}),s.has("leftEye")&&r({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:u,yaxes:[h,g,p,y,m],procedures:c.leftEye.procedures,targetIOP:c.leftEye.targetIOP,parentDOM:c.leftEye.dom}),e.log("[oePlotly] - method: highlightPoint()"),{highlightPoint:i}})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme(),s=new Map,o=oePlotly.fullDateRange(),n=oePlotly.selectableUnits(),i=(e,t)=>{s.get(t).set("data",new Map);const i={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers"};s.get(t).get("data").set(e.VA.offScale.name,i),o.add(e.VA.offScale.x);const a={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dashedLine()};s.get(t).get("data").set(e.CRT.name,a),o.add(e.CRT.x),Object.values(e.VA.units).forEach((e,s)=>{n.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y3",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers"}),s||o.add(e.x)}),s.get(t).get("data").set("VA",n.selectedTrace(t)),Object.values(e.events).forEach(e=>{let n=e.customdata?"%{y}<br>%{customdata}<br>%{x}":"%{y}<br>%{x}",i=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:n,type:"scatter",showlegend:!1},oePlotly.eventStyle(e.event));s.get(t).get("data").set(e.name,i),o.add(e.x)})},a=e=>{let t=s.get(e);t.get("data").set("VA",n.selectedTrace(e)),t.get("layout").yaxis3=Object.assign({},n.selectedAxis());const o=Array.from(t.get("data").values());Plotly.react(t.get("div"),o,t.get("layout"),{displayModeBar:!1,responsive:!0})},l=e=>{const n=e.eyeSide,i=oePlotly.getLayout({darkTheme:t,legend:{yanchor:"bottom",y:.82},colors:e.colors,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes,subplot:3,rangeSlider:o.firstLast(),dateRangeButtons:!0}),l=oePlotly.buildDiv("Medical Retina-"+n,"80vh","650px");document.querySelector(e.parentDOM).appendChild(l),s.get(n).set("div",l),s.get(n).set("layout",i),a(n),oePlotly.addClickEvent(l,e.eye),oePlotly.addHoverEvent(l,n),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(l,i)})};e.extend("plotSummaryMedicalRetina",(r=null)=>{if(null===r)return e.log("[oePlotly] - no JSON data provided for Plot.ly Medical Retina ??"),!1;e.log("[oePlotly] - building Plot.ly Medical Retina");const c=[[0,.15],[.2,.82],[.88,1]];n.init({darkTheme:t,plotlyUpdate:a,axisDefaults:{type:"y",rightSide:"y2",domain:c[1],title:"VA",spikes:!0},unitRanges:Object.values(r.yaxis.unitRanges)}),r.rightEye&&(s.set("rightEye",new Map),i(r.rightEye,"rightEye")),r.leftEye&&(s.set("leftEye",new Map),i(r.leftEye,"leftEye"));const d=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,range:o.firstLast(),spikes:!0,noMirrorLines:!0},t),u=oePlotly.getAxis({type:"y",domain:c[0],useCategories:{showAll:!0,categoryarray:r.yaxis.offScale.reverse()},spikes:!0},t),h=oePlotly.getAxis({type:"y",domain:c[1],title:"CRT",range:[200,650],spikes:!0},t),p=oePlotly.getAxis({type:"y",domain:c[2],useCategories:{showAll:!0,categoryarray:r.eventTypes.reverse()},spikes:!0},t),y=n.selectedAxis();s.has("rightEye")&&l({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:d,yaxes:[u,h,y,p],parentDOM:".oes-left-side"}),s.has("leftEye")&&l({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:d,yaxes:[u,h,y,p],parentDOM:".oes-right-side"})})})(bluejay),(function(e){"use strict";const t="Outcomes with Error bars",s=oePlotly.isDarkTheme();e.extend("plotOutcomesWithErrors",(o=null)=>{if(null===o)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const n=(e=>[{x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y1",error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}},{x:e.IOP.x,y:e.IOP.y,name:"IOP",hovertemplate:"Mean ± SD<br>IOP: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y2",error_y:{type:"data",array:e.IOP.error_y,visible:!0,thickness:.5}}])(o),i=oePlotly.getAxis({type:"x",title:"Weeks",numTicks:20,range:[-20,220]},s),a=oePlotly.getAxis({type:"y",title:"VA (change) from baseline (LogMAR)",range:[70,110],numTicks:20},s),l=oePlotly.getAxis({type:"y",title:"IOP (mm Hg))",rightSide:"y1",numTicks:20},s);(e=>{const t=oePlotly.getLayout({darkTheme:s,colors:"varied",legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});Plotly.react(e.div,e.data,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(o.dom),data:n,xaxis:i,yaxes:[a,l]})})})(bluejay),(function(e){"use strict";e.addModule("oesLayoutOptions");const t=document.querySelector(".oes-hd-data-layout");if(null==t)return;const s=Object.assign({selector:{rootElem:".oes-hd-data-layout",btn:".oes-hd-data-layout .layout-select-btn",optionBtn:".oes-hd-data-layout .option-btn",options:".layout-options"},current:{eye:JSON.parse(t.dataset.oes).eyeIcons,layout:JSON.parse(t.dataset.oes).layout},get eye(){return this.current.eye},set eye(e){if(e===this.current.eye)return!1;this.current.eye=e,this.views.notify()},get layout(){return this.current.layout},set layout(e){if(this.current.layout===e)return!1;this.current.layout=e,this.views.notify()}},e.ModelViews()),o=((()=>{const o=["{{#sides}}",'<div class="option-btn" data-oes=\'{"opt":"eye.{{eyelat.r}}-{{eyelat.l}}"}\'><span class="oe-eye-lat-icons"><i class="oe-i laterality {{eyelat.r}} small"></i><i class="oe-i laterality {{eyelat.l}} small"></i></span></div>',"{{/sides}}","{{#layouts}}",'<div class="option-btn" data-oes=\'{"opt":"layout.{{.}}"}\'><i class="oes-layout-icon i-{{.}}"></i></div>',"{{/layouts}}"].join(""),n=document.createElement("div");n.className=s.selector.options.replace(".",""),n.innerHTML=Mustache.render(o,{sides:[{eyelat:{r:"R",l:"NA"}},{eyelat:{r:"R",l:"L"}},{eyelat:{r:"NA",l:"L"}}],layouts:["1-0","2-1","1-1","1-2","0-1"]}),e.hide(n),t.appendChild(n)})(),(()=>{const t="oes-layout-icon",o=document.querySelector(s.selector.btn),n=o.querySelector("."+t),i=o.querySelector(".oe-eye-lat-icons");s.views.add(()=>{n.className=t+"  i-"+s.layout;let o=s.eye.split("-");i.innerHTML=Mustache.render('{{#eyes}}<i class="oe-i laterality {{.}} small pad"></i>{{/eyes}}',{eyes:o}),e.customEvent("oesLayoutEyeSide",o)})})(),(()=>{let t=null;const o=document.querySelector(".oes-v2 .oes-right-side"),n=document.querySelector(".oes-v2 .oes-left-side"),i=()=>{if(s.layout!==t){switch(t=s.layout,t){case"1-0":n.style.width="",e.show(n),e.hide(o);break;case"0-1":o.style.width="",e.hide(n),e.show(o);break;case"2-1":n.style.width="66%",o.style.width="33%",e.show(n),e.show(o);break;case"1-2":n.style.width="33%",o.style.width="66%",e.show(n),e.show(o);break;case"1-1":n.style.width="50%",o.style.width="50%",e.show(n),e.show(o);break;default:throw new TypeError("[bluejay] [oesLayoutOptions] - unknown layout: "+t)}e.customEvent("oesLayoutChange",t)}};i(),s.views.add(i)})(),(()=>{let o=!1;const n=t.querySelector(s.selector.btn),i=t.querySelector(s.selector.options),a=t=>{o=!0,e.show(i),n.classList.add("active")},l=t=>{o=!1,e.hide(i),n.classList.remove("active")};return{show:a,hide:l,change:e=>{o?l():a()}}})());e.userDown(s.selector.btn,o.change),e.userEnter(s.selector.btn,o.show),e.userLeave(s.selector.rootElem,o.hide),e.userDown(s.selector.optionBtn,e=>(e=>{let t=JSON.parse(e).opt.split(".");"eye"==t[0]&&(s.eye=t[1]),"layout"==t[0]&&(s.layout=t[1])})(e.target.dataset.oes))})(bluejay),(function(e){"use strict";if(null===document.querySelector("#tinymce-letterheader-editor"))return;let t=null;const s={user_name:{label:"User Name",value:"<span>Admin Admin</span>"},firm_name:{label:"Firm Name",value:"<span>Glaucoma Clinic</span>"},site_name:{label:"Site Name",value:"<span>Kings Hospital</span>"},site_phone:{label:"Site Phone",value:"<span>0123456789</span>"},site_fax:{label:"Site Fax",value:null},site_email:{label:"Site Email",value:null},site_address:{label:"Site Address",value:"<span>100 Main Road</span>"},site_city:{label:"Site City",value:"<span>London</span>"},site_postcode:{label:"Site Postcode",value:"<span>W1 1AA</span>"},primary_logo:{label:"Primary Logo",value:'<img src="/idg-php/imgDemo/correspondence/letterhead-logo.png">'},secondary_logo:{label:"Secondary Logo",value:null},current_date:{label:"Today's Date",value:"<span>"+document.documentElement.dataset.today+"</span>"}};tinymce.init({selector:"#tinymce-letterheader-editor",schema:"html5-strict",branding:!1,min_height:400,menubar:!1,plugins:["lists table paste code"],contextmenu:"table",toolbar:"undo redo | bold italic underline | alignleft aligncenter alignright | table | code",custom_undo_redo_levels:10,hidden_input:!1,block_formats:"Paragraph=p; Header 2=h2; Header 3=h3",content_css:"/newblue/css/style_oe3_print.min.css",setup:function(e){e.on("init",(function(o){t=e,(()=>{var e=new DocumentFragment;for(const o in s){let n=s[o].label,i=s[o].value;if(null!==i){var t=document.createElement("button");t.className="idg-quick-insert",t.textContent=n,t.setAttribute("data-insert",JSON.stringify({key:o,value:i})),e.appendChild(t)}}document.querySelector(".editor-quick-insert-btns").appendChild(e)})()}))}}),e.userDown(".idg-quick-insert",e=>{let s=JSON.parse(e.target.dataset.insert);var o,n;o=s.key,n=s.value,t.insertContent('<span contenteditable="false" data-substitution="'+o+'">'+n+"</span>")})})(bluejay),(function(e){"use strict";null!==document.querySelector(".js-idg-demo-ed2")&&(e.userDown(".js-idg-demo-doodle-drawer",t=>{let s=t.target;e.getParent(s,"li").classList.toggle("ed2-drawer-open")}),e.userDown(".ed-canvas-edit",t=>{let s=t.target;e.getParent(s,".ed2-editor").querySelector(".ed2-doodle-popup").classList.toggle("closed")}),e.userDown("#js-idg-demo-ed2-search-input",e=>{let t=e.target.nextElementSibling;console.log("hi"),"none"==t.style.display?t.style.display="block":t.style.display="none"}))})(bluejay),(function(e){"use strict";bluejay.demoLoginTimeOut=()=>{const e=document.createElement("div");e.className="oe-popup-wrap dark",document.body.appendChild(e);const t=['<div class="oe-login timeout">','<div class="login">',"<h1>Timed out</h1>",'<div class="user">','<input type="text" placeholder="Username">','<input type="password" placeholder="Password">','<button class="green hint" id="js-login">Login</button>',"</div>",'<div class="info">',"For security reasons you have been logged out. Please login again","</div>","</div>","</div>"].join("");e.innerHTML=Mustache.render(t,{})}})(),(function(e){"use strict";if(null===document.querySelector(".js-idg-demo-13420"))return;document.addEventListener("input",t=>{let s=t.target;if(s.matches(".js-idg-demo-13420 .toggle-switch input")){let t=e.getParent(s,"tr"),o=t.querySelector(".js-idg-ongoing-text"),n=t.querySelector(".js-idg-date-stop"),i=t.querySelector(".js-idg-duration-dispense"),a=t.querySelector(".js-idg-taper-btn"),l=t.querySelector(".js-idg-stopped-reasons");s.checked?(e.hide(n),e.hide(l),e.show(o,"block"),e.show(i,"block"),e.show(a,"block")):(e.show(n,"block"),e.hide(o),e.hide(i),e.hide(a))}});const t=(t,s)=>{let o=t.querySelector(".js-idg-stop-btn"),n=t.querySelector(".js-idg-stop-date"),i=t.querySelector(".js-idg-stopped-reasons"),a=t.querySelector(".js-idg-cancel-stop");s?(e.hide(o),e.show(n,"block"),e.show(i,"block"),e.show(a,"block")):(e.show(o,"block"),e.hide(n),e.hide(i),e.hide(a))};document.addEventListener("click",s=>{s.target.matches(".js-idg-stop-btn")&&t(e.getParent(s.target,"td"),!0)}),document.addEventListener("mousedown",s=>{s.target.matches(".js-idg-cancel-stop")&&t(e.getParent(s.target,"td"),!1)}),document.addEventListener("mousedown",e=>{let t=e.target;if(t.matches(".js-show-medication-history")){document.querySelectorAll(".js-idg-medication-history-"+t.dataset.idgdemo).forEach(e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"})}})})(bluejay),(function(e){"use strict";if(null===document.querySelector(".js-idg-diagnosis-active-switcher"))return;const t=(t,o)=>{let n=t.querySelector(".js-idg-diagnosis-text"),i=t.querySelector(".toggle-switch"),a=t.querySelector(".remove-circle"),l=t.querySelector(".js-idg-diagnosis-add-btn"),r=t.querySelector(".js-idg-diagnosis-doubt"),c=t.querySelector(".js-idg-diagnosis-doubt-input"),d=t.dataset.idgside,u=t.parentNode.previousElementSibling.querySelector(".oe-eye-lat-icons .oe-i"),h=t.parentNode.nextElementSibling.querySelector(".js-idg-diagnosis-date");switch(o){case"active":e.reshow(n),e.reshow(i),e.reshow(r),e.hide(a),e.hide(l),e.reshow(h),n.textContent="Active (confirmed)",n.classList.remove("fade"),r.querySelector("input").checked=!1,i.querySelector("input").checked=!0,s(u,d,"active");break;case"confirmed":e.hide(c),e.reshow(n);break;case"doubt":e.reshow(c),e.hide(n);break;case"inactive":e.reshow(n),e.reshow(i),e.reshow(a),e.hide(l),e.hide(r),e.hide(c),e.reshow(h),n.textContent="Inactive from",n.classList.add("fade"),s(u,d,"inactive");break;case"removed":e.hide(i),e.hide(a),e.reshow(l),e.hide(h),n.textContent="Not present",s(u,d,"none")}},s=(e,t,s)=>{if(null===e)return;let o=["oe-i"],n="left"==t?"L":"R";switch(s){case"active":o.push("laterality",n);break;case"inactive":o.push("laterality",n+"i");break;case"none":o.push("laterality","NA")}o.push("small","pad"),e.className=o.join(" ")};let o=null;const n=(t,s)=>{let n=t.querySelector(".js-idg-diagnosis-state-options"),i=t.querySelector(".js-idg-right-icon .oe-systemic-icons"),a=t.querySelector(".js-idg-right-icon .oe-eye-lat-icons .oe-i");if(s){n.innerHTML='<span class="oe-eye-lat-icons"><i class="oe-i laterality NA small pad"></i></span>',n.colSpan=0;let s=t.insertCell(2),o=t.insertCell(3);if(s.innerHTML='<div class="flex-layout cols-11 js-idg-diagnosis-active-switcher" data-idgdemo="-r-nSysEx2" data-idgside="right"><div class="js-idg-diagnosis-actions"><label class="toggle-switch" style="display: none;"><input type="checkbox"><div class="toggle-btn"></div></label><label class="inline highlight js-idg-diagnosis-doubt" style="display: none;"><input value="diagnosis-doubt" name="idg-4131" type="checkbox"> <i class="oe-i doubt small-icon js-has-tooltip" data-tt-type="basic" data-tooltip-content="? = doubts; suspected, etc"></i></label><i class="oe-i remove-circle small-icon pad-left" style="display: none;"></i><button class="js-idg-diagnosis-add-btn ">Add right side</button></div><div class="js-idg-diagnosis-state"><input class="js-idg-diagnosis-doubt-input" value="Suspected" placeholder="Suspected" maxlength="32" style="display: none;"><span class="js-idg-diagnosis-text js-active-state fade ">Not present</span></div></div>',o.innerHTML='<div class="js-idg-diagnosis-date"><input type="text" class="date" value="30 Apr 2020"></div>',e.hide(t.cells[5].querySelector(".toggle-switch")),e.hide(t.cells[5].querySelector(".highlight")),null===t.cells[5].querySelector(".js-idg-diagnosis-actions .js-idg-diagnosis-add-btn")){let e=document.createElement("button");e.className="js-idg-diagnosis-add-btn",e.textContent="Add left side",t.cells[5].querySelector(".js-idg-diagnosis-actions").appendChild(e)}else e.reshow(t.cells[5].querySelector(".js-idg-diagnosis-add-btn"));let l=t.cells[5].querySelector(".js-idg-diagnosis-text");l.textContent="Inactive from",l.classList.add("fade"),i.style.display="none",a.style.display="inline-block"}else t.deleteCell(2),t.deleteCell(2),n.innerHTML=o,n.colSpan=3,e.hide(t.cells[3].querySelector(".js-idg-diagnosis-add-btn")),e.reshow(t.cells[3].querySelector(".toggle-switch")),t.cells[3].querySelector(".toggle-switch").checked=!0,e.reshow(t.cells[3].querySelector(".highlight")),n.querySelector("input").checked=!0,i.style.display="inline-block",a.style.display="none"};document.addEventListener("input",s=>{let n=s.target;if(n.matches(".js-idg-diagnosis-active-switcher .toggle-switch input")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,n.checked?"active":"inactive")}if(n.matches(".js-idg-diagnosis-doubt input")){let s=e.getParent(n,".js-idg-diagnosis-active-switcher");t(s,n.checked?"doubt":"confirmed")}if(n.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-diagnosis-state-options input")){((t,s)=>{let n=t.querySelector(".js-idg-sides"),i=t.querySelector(".js-idg-diagnosis-text"),a=t.querySelector(".js-idg-diagnosis-active-switcher"),l=a.querySelector(".toggle-switch"),r=a.querySelector(".js-idg-diagnosis-doubt"),c=a.querySelector(".js-idg-diagnosis-doubt-input"),d=t.querySelector(".js-idg-right-icon .oe-systemic-icons");switch(null==o&&(o=t.querySelector(".js-idg-diagnosis-state-options").innerHTML,e.reshow(i)),s){case"0":e.reshow(n),e.reshow(i),i.textContent="Active (confirmed)",i.classList.remove("fade"),e.reshow(l),l.querySelector("input").checked=!0,e.reshow(r),r.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i person-green small pad";break;case"1":e.hide(n),e.reshow(i),i.textContent="Not present",i.classList.add("fade"),e.hide(l),e.reshow(r),r.querySelector("input").checked=!1,e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad";break;case"2":e.hide(n),e.reshow(i),i.textContent="Not checked",i.classList.add("fade"),e.hide(l),e.hide(r),e.hide(c),d.querySelector(".oe-i").className="oe-i NA small pad"}})(e.getParent(n,".js-idg-demo-sys-diag-side-switcher"),n.value)}}),document.addEventListener("click",t=>{let s=t.target;if(s.matches(".js-idg-demo-sys-diag-side-switcher .js-idg-sides")){let t=e.getParent(s,".js-idg-demo-sys-diag-side-switcher"),o=s.querySelector(".oe-i");"no-sides"==s.dataset.state?(n(t,!0),s.dataset.state="sides",o.classList.replace("person","person-split")):(n(t,!1),s.dataset.state="no-sides",o.classList.replace("person-split","person"))}}),document.addEventListener("mousedown",s=>{let o=s.target;var n;if(o.matches(".js-show-diagnosis-history")&&(n=o.dataset.idgdemo,document.querySelectorAll(".js-idg-diagnosis-history-"+n).forEach(e=>{"collapse"==e.style.visibility?e.style.visibility="visible":e.style.visibility="collapse"})),o.matches(".js-idg-diagnosis-active-switcher .remove-circle")){let s=e.getParent(o,".js-idg-diagnosis-active-switcher");t(s,"removed")}if(o.matches(".js-idg-diagnosis-add-btn")){let s=e.getParent(o,".js-idg-diagnosis-active-switcher");t(s,"active")}});e.userDown(".js-idg-demo-remove-oph-diag",t=>{e.xhr("/idg-php/v3/_load/specific/exam-oph-diag-delete.php").then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t,s.querySelector(".close-icon-btn").addEventListener("mousedown",t=>{t.stopPropagation(),e.removeElement(s)},{once:!0}),e.appendTo("body",s)}).catch(e=>console.log("failed to copy",e))})})(bluejay),(function(e){"use strict";e.addModule("attachmentThumbnail");const t="oe-attachment-thumbnail";let s,o=!1;const n={};if(e.nodeArray(document.querySelectorAll("."+t)).length<1)return;const i=()=>{n.close.removeEventListener("mousedown",i),n.save&&(n.save.removeEventListener("mousedown",i),n.cancel.removeEventListener("mousedown",i)),e.removeElement(s),o=!1},a=t=>{o||(t=>{o=!0,s=document.createElement("div"),s.className="oe-popup-wrap";let a='<div class="oe-popup-attachment">';a+='<div class="title">'+t.title+"</div>",a+='<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>',a+='<div class="file-attachment-content"></div>',a+='<div class="file-size-controls"></div>',a+="</div>",s.innerHTML=a;const l=s.querySelector(".file-attachment-content"),r=s.querySelector(".file-size-controls"),c=new DocumentFragment,d=(e,t,s=!1)=>{let o=document.createElement("button");return o.className=t,s&&(o.id=s),o.textContent=e,c.appendChild(o),o};if("pdf"!==t.type){let e="url('"+t.file+"')";l.style.backgroundImage=e,l.innerHTML='<img src="'+t.file+'" style="display:none"/>';const o=s.querySelector("img"),n=d("Fit to screen","pro-theme selected","oe-att-fit"),i=d("Actual size","pro-theme","oe-att-actual"),a=(e,t,s,n)=>{l.style.backgroundImage=e,o.style.display=t,s.classList.add("selected"),n.classList.remove("selected")};i.addEventListener("mousedown",e=>{e.stopPropagation(),a("none","block",i,n)}),n.addEventListener("mousedown",t=>{t.stopPropagation(),a(e,"none",n,i)})}else l.innerHTML='<embed src="'+t.file+'" width="100%" height="100%"></embed>',d("PDF","pro-theme selected");if(t.annotate){l.classList.add("annotation");let o=document.createElement("div");o.className="attachment-annotation",e.appendTo(".oe-popup-attachment",o,s),e.xhr(t.idgPHP).then(e=>{o.innerHTML=e,"L"==t.eyelat&&(o.querySelector("#annotation-right").style.visibility="hidden"),"R"==t.eyelat&&(o.querySelector("#annotation-left").style.visibility="hidden")}).catch(e=>console.log("XHR failed: ",e)),n.save=d("Save annotations","green hint"),n.cancel=d("Cancel","red hint"),n.save.addEventListener("mousedown",i,{once:!0}),n.cancel.addEventListener("mousedown",i,{once:!0})}if(t.stack){let o=t.title.split(" - "),n="<option>"+t.title+"</option>";for(let e=t.stack;e;e--)n+="<option>"+o[0]+" - ("+e+" Jan 1975 09:30)</option>";let i=document.createElement("div");i.className="attachment-stack",i.innerHTML='Choose report: <select class="pro-theme">'+n+"</select>",e.appendTo(".oe-popup-attachment",i,s)}n.close=s.querySelector(".close-icon-btn"),n.close.addEventListener("mousedown",i,{once:!0}),r.appendChild(c),e.appendTo("body",s)})(JSON.parse(t.target.dataset.attachment))};e.userDown("."+t,a),document.querySelectorAll(".js-annotate-attachment")&&e.userDown(".js-annotate-attachment",a)})(bluejay),(function(e){"use strict";e.addModule("collapseExpand");const t=[],s=()=>({show:function(){e.show(this.content,"block"),this.btn.classList.replace("expand","collapse"),this.open=!0}}),o=()=>({hide:function(){e.hide(this.content),this.btn.classList.replace("collapse","expand"),this.open=!1}}),n=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),o()),i=(s,o)=>{let i=s.target,a=e.getDataAttr(i);if(a)t[parseFloat(a)].change();else{e.setDataAttr(i,t.length);let s={btn:i,content:i.parentNode.querySelector(".collapse-"+o+"-content"),open:i.classList.contains("collapse")},a=n(s);a.change(),t.push(a)}};e.userDown(".collapse-data-header-icon",e=>i(e,"data")),e.userDown(".collapse-group > .header-icon",e=>i(e,"group"))})(bluejay),(function(e){"use strict";e.addModule("comments");e.userDown(".js-add-comments",t=>{const s=t.target,o=JSON.parse(s.dataset.idgdemo);if(e.hide(s),o.bilateral){const t=document.querySelector("#"+o.id+"-right"),n=document.querySelector("#"+o.id+"-left");e.show(t,"block"),e.show(n,"block"),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(s,"block"),e.hide(t),e.hide(n)},{once:!0}),n.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(s,"block"),e.hide(t),e.hide(n)},{once:!0})}else{const t=document.querySelector("#"+o.id);e.show(t,"block"),t.querySelector("textarea").focus(),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(s,"block"),e.hide(t)},{once:!0})}})})(bluejay),(function(e){"use strict";e.addModule("commentHotlist");const t=new e.Collection,s=()=>({reset(){this.editMode=!1,this.icon("comment"),e.hide(this.elem.textarea),e.hide(this.elem.userComment)}}),o=()=>({show(){this.editMode=!1,this.icon("edit"),this.elem.userComment.textContent=this.comment,e.hide(this.elem.textarea),e.show(this.elem.userComment,"block")}}),n=()=>({edit(){this.editMode=!0,this.icon("save"),e.show(this.elem.textarea,"block"),e.hide(this.elem.userComment),this.elem.textarea.value=this.comment,e.resizeTextArea(this.elem.textarea),setTimeout(()=>this.elem.textarea.focus(),20);const t=e=>{e.stopPropagation(),"Enter"===e.key&&(this.elem.textarea.removeEventListener("keydown",t,!1),this.update())};this.elem.textarea.addEventListener("keydown",t,!1)}}),i=()=>({icon(t){switch(this.elem.icon.classList.remove("comments","comments-added","save","active"),t){case"comment":this.elem.icon.classList.add("comments");break;case"edit":this.elem.icon.classList.add("comments-added");break;case"save":this.elem.icon.classList.add("save","active");break;default:e.log("commentHotlist - unknown icon: "+t)}}}),a=()=>({userClick(){this.editMode?this.update():this.edit()}}),l=()=>({update(){let e=this.elem.textarea.value.trim();e.length<2?(this.comment="",this.reset()):(this.comment=e,this.show())}}),r=(e,t,r="")=>{const c=['<textarea placeholder="Comments" rows="1" class="cols-full" style="display:none"></textarea>','<div class="user-comment" style="display:none">{{comment}}</div>'].join("");let d=document.createElement("div");d.className="patient-comments",d.innerHTML=Mustache.render(c,{comment:r}),t.appendChild(d);let u=d.querySelector("textarea"),h=d.querySelector(".user-comment");return Object.assign({editMode:!1,comment:r,elem:{icon:e,textarea:u,userComment:h}},s(),o(),n(),i(),a(),l())};e.nodeArray(document.querySelectorAll(".oe-hotlist-panel .patients-open tr, .oe-hotlist-panel .patients-closed tr")).forEach(e=>{let s=JSON.parse(e.dataset.comment);if(s.comment){let o=e.querySelector(".oe-i.comments"),n=e.querySelector(".js-patient-comment"),i=r(o,n,s.comment);i.show(),t.add(i,o)}});e.userDown(".oe-hotlist-panel .js-comment-icon",s=>{const o=s.target;let n=t.getKey(o);if(n){t.get(n).userClick()}else{let s=e.getParent(o,"tr").querySelector(".js-patient-comment"),n=r(o,s);n.edit(),t.add(n,o)}})})(bluejay),(function(e){"use strict";e.addModule("copyToClipboard");if(null===document.querySelector(".js-copytext-to-clipboard"))return;e.nodeArray(document.querySelectorAll(".js-copytext-to-clipboard")).forEach(e=>{e.style.cursor="pointer"});const t=t=>{let s=t.getBoundingClientRect(),o=s.right-s.width/2,n=s.top-5;const i=document.createElement("div");i.className="oe-tooltip fade-out",i.innerHTML="Copied",i.style.width="80px",i.style.top=n-30+"px",i.style.left=o-40+"px",e.appendTo("body",i),setTimeout(()=>e.removeElement(i),2500)};e.userDown(".js-copytext-to-clipboard",s=>{(s=>{if(navigator.clipboard)navigator.clipboard.writeText(s.textContent).then(()=>{e.log("[ASYNC] copied text to clipboard"),t(s)}).catch(t=>{e.log("failed to copy text to clipboard")});else{const o=document.createElement("input");o.value=s.textContent,o.style.position="absolute",o.style.top="-200px",document.body.appendChild(o),o.select(),document.execCommand("copy"),t(s),e.removeElement(o)}})(s.target)})})(bluejay),(function(e){"use strict";e.addModule("ed3");let t=!1;e.userDown(".js-idg-ed3-app-btn",s=>{let o=s.target;t=t||(()=>{let t=document.createElement("div");return t.className="oe-eyedraw-app spinner-loader",e.appendTo("body",t),t})();let n=o.getBoundingClientRect().bottom-532;t.style.top=n<60?"60px":n+"px",e.show(t,"block");let i=JSON.parse(o.dataset.idgDemo);var a=Object.keys(i).map(e=>e+"="+i[e]).join("&");e.xhr("/idg-php/v3/_load/ed3/ed3-app.php?"+a).then(e=>{t.innerHTML=e,t.querySelector(".close-icon-btn").addEventListener("mousedown",()=>{t.style.display="none"},{once:!0})}).catch(e=>console.log("ed3app php failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("elementSelector");const t=()=>({loadPHP:function(t){e.xhr(t).then(t=>{!1!==this.open&&(this.nav=document.createElement("nav"),this.nav.className=this.wrapClass,this.nav.innerHTML=t,this.btn.classList.add("selected"),e.appendTo("body",this.nav))}).catch(e=>console.log("PHP failed to load",e))}}),s=()=>({close:function(){this.open=!1,this.btn.classList.remove("selected"),e.removeElement(this.nav)}}),o=()=>({change:function(e){if(null===this.btn&&(this.btn=e.target),this.open)this.close();else{this.open=!0;let e=JSON.parse(this.btn.dataset.demophp);!1!==e?this.loadPHP(e):this.elementSideNav()}}}),n=()=>({elementSideNav:function(){this.nav=document.createElement("nav"),this.nav.className=this.wrapClass;const t=e.nodeArray(document.querySelectorAll(".element .element-title")).map(e=>'<li class="element" id="side-element-contacts"><a href="#" class="selected">'+e.textContent+"</a></li>");this.nav.innerHTML=['<div class="element-structure">','<ul class="oe-element-list">',t.join(""),"</ul>","</div>"].join(""),e.appendTo("body",this.nav)}}),i=e=>Object.assign({btn:null,open:!1,wrapClass:e},o(),t(),n(),s());if(null!==document.querySelector("#js-manage-elements-btn")){const t=i("oe-element-selector");e.userDown("#js-manage-elements-btn",e=>t.change(e)),e.userDown(".oe-element-selector .close-icon-btn button",()=>t.close())}if(null!==document.querySelector("#js-element-structure-btn")){const t=i("sidebar element-overlay");e.userDown("#js-element-structure-btn",e=>t.change(e))}})(bluejay),(function(e){"use strict";e.addModule("elementTiles");const t=[],s=()=>({show:function(){this.h3.textContent=this.title,e.show(this.content,"block")}}),o=()=>({hide:function(){this.h3.innerHTML=this.title+" <small>["+this.count+"]</small>",e.hide(this.content)}}),n=e=>Object.assign({tiles:[],btn:e,collapsed:!1},{addTile:function(e){this.tiles.push(e)}},{change:function(){this.tiles.forEach(e=>{this.collapsed?(this.btn.classList.replace("increase-height","reduce-height"),e.show()):(this.btn.classList.replace("reduce-height","increase-height"),e.hide())}),this.collapsed=!this.collapsed}});e.userDown(".collapse-tile-group .oe-i",i=>{let a=e.getParent(i.target,".element-tile-group"),l=e.getDataAttr(a);if(l)t[parseFloat(l)].change();else{let l=n(i.target);e.nodeArray(a.querySelectorAll(".element.tile")).forEach(e=>{l.addTile((e=>{const t=e.querySelector(".element-title"),n=t.textContent,i=e.querySelector(".element-data"),a=i.querySelectorAll("tbody tr").length;return Object.assign({h3:t,title:n,content:i,count:a.toString()},s(),o())})(e))}),l.change(),e.setDataAttr(a,t.length),t.push(l)}})})(bluejay),(function(e){"use strict";e.addModule("eventAuditTrial");const t="#js-event-audit-trail-btn",s=document.querySelector(t);if(null===s)return;const o=document.querySelector("#js-event-audit-trail");null===o&&e.log("Audit Trail content not available in DOM?");let n=!1;const i=t=>{e.show(o,"block"),s.classList.add("active"),n=!0},a=t=>{e.hide(o),s.classList.remove("active"),n=!1};e.userDown(t,e=>n?a(e):i(e)),e.userEnter(t,i),e.userLeave(t,a)})(bluejay),(function(e){"use strict";e.addModule("eventsUserTrail");if(null===document.querySelector("#js-events-user-trail"))return;let t=null;e.userDown("#js-events-user-trail",()=>{t=document.createElement("div"),t.className="oe-popup-wrap";let s=document.createElement("div");s.className="oe-popup oe-events-user-trail",t.appendChild(s),e.appendTo("body",t);let o=setTimeout(()=>s.innerHTML='<i class="spinner"></i>',400);e.xhr("/idg-php/v3/_load/sidebar/events-user-trail-v2.php").then(e=>{clearTimeout(o),s.innerHTML=e}).catch(e=>console.log("ed3app php failed to load",e))}),e.userDown(".js-idg-toggle-event-audit-trail",e=>{let s=e.target,o=t.querySelector("#"+s.dataset.auditid);"block"===o.style.display?o.style.display="none":o.style.display="block"}),e.userDown(".oe-events-user-trail .close-icon-btn .oe-i",()=>{e.removeElement(t)})})(bluejay),(function(e){"use strict";if(e.addModule("examElementSearch"),null===document.querySelector("#js-search-in-event-popup"))return;e.userDown("#js-search-in-event",t=>{const s=t.target,o=document.querySelector("#js-search-in-event-popup"),n=document.querySelector(".main-event"),i=o.querySelector(".close-icon-btn");s.classList.add("selected"),e.show(o,"block"),n.classList.add("examination-search-active"),i.addEventListener("mousedown",t=>{t.stopPropagation(),n.classList.remove("examination-search-active"),e.hide(o),s.classList.remove("selected")},{once:!0})})})(bluejay),(function(e){"use strict";e.addModule("filterOptions");const t=[],s="active",o=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(s),this.positionContent(),e.show(this.content,"block"),this.mouseOutHide(),this.closeIconBtn())}}),n=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(s),e.hide(this.content))}}),i=()=>({positionContent:function(){this.defaultCSS=this.defaultCSS||this.content.className;let t,s,o,n=this.btn.getBoundingClientRect(),i=e.getHiddenElemSize(this.content);n.top<400?(t="top",s=n.top):(t="bottom",s=n.bottom-i.h),n.left<500?(t+="-left",o=n.left):(t+="-right",o=n.right-i.w),this.content.className=this.defaultCSS+" "+t,this.content.style.top=s+"px",this.content.style.left=o+"px"}}),a=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},o(),n(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}},{closeIconBtn:function(){this.wrapper.querySelector(".close-icon-btn").addEventListener("mousedown",e=>{e.stopPropagation(),this.hide()},{once:!0})}},i());e.userDown(".oe-filter-options .oe-filter-btn",s=>(s=>{let o=s.target,n=e.getDataAttr(o);if(n)t[parseFloat(n)].change();else{let s=e.getParent(o,".oe-filter-options"),n=a({btn:o,wrapper:s,content:s.querySelector(".filter-options-popup")});n.show(),e.setDataAttr(o,t.length),t.push(n)}})(s))})(bluejay),(function(e){"use strict";const t=e.nodeArray(document.querySelectorAll(".hidden"));t.length&&t.forEach(t=>{e.hide(t),t.classList.remove("hidden")});const s=e.nodeArray(document.querySelectorAll(".tr-collapse"));s.length&&s.forEach(e=>{e.style.visibility="collapse",e.classList.remove("tr-collapse")})})(bluejay),(function(e){"use strict";e.addModule("lightning");if(null===document.querySelector(".oe-lightning-viewer"))return;const t=()=>({updateView:function(e){this.updateStack(e),this.updateMeta(document.querySelector(this.iconPrefix+e).dataset.meta)}}),s=()=>({updateStack:function(t){e.hide(document.querySelector(this.stackPrefix+this.currentStack)),e.show(document.querySelector(this.stackPrefix+t),"block"),this.currentStack=t,this.updateCounter(),this.timelineIcon()}}),o=()=>({updateCounter:function(){document.querySelector(".lightning-ui .stack-position").textContent=this.currentStack+1+"/"+this.totalStackNum}}),n=()=>({timelineIcon:function(){document.querySelector(".icon-event").classList.remove("js-hover"),document.querySelector(this.iconPrefix+this.currentStack).classList.add("js-hover")}}),i=()=>({xscroll:function(e,t){var s=Math.floor(e/(this.xscrollWidth/this.totalStackNum));0==this.locked&&this.updateView(s)}}),a=()=>({swipeLock:function(){this.locked=!this.locked;let e=document.querySelector(".lightning-ui .user-help");this.locked?e.textContent="Swipe is LOCKED | Click to unlock":e.textContent="Swipe to scan or use key RIGHT / LEFT | Click to LOCK swipe"}}),l=Object.assign({currentStack:0,iconPrefix:"#lqv_",stackPrefix:"#lsg_",totalStackNum:document.querySelectorAll(".stack-group").length,xscrollWidth:document.querySelector(".lightning-view").clientWidth,locked:!0},t(),{updateMeta:function(e){let t=document.querySelector(".lightning-meta"),s=e.split(",");[".type",".date",".who"].forEach((e,o)=>{t.querySelector(e).textContent=s[o]})}},s(),o(),n(),i(),a(),{stepThrough:function(e){var t=this.currentStack+e;t>=0&&t<this.totalStackNum&&this.updateView(t)}});l.updateCounter(),l.swipeLock(),e.userDown("#lightning-left-btn",()=>l.stepThrough(-1)),e.userDown("#lightning-right-btn",()=>l.stepThrough(1)),e.userDown(".lightning-view",()=>l.swipeLock()),e.userDown(".icon-event",()=>l.swipeLock()),e.userEnter(".icon-event",e=>{let t=e.target;l.updateStack(t.dataset.id),l.updateMeta(t.dataset.meta)});const r=document.querySelector(".lightning-view");r.addEventListener("mousemove",e=>{}),e.listenForResize(()=>l.xscrollWidth=r.clientWidth),document.addEventListener("keydown",e=>{37==(e.keyCode||e.which)&&l.stepThrough(-1),39==(e.keyCode||e.which)&&l.stepThrough(1)})})(bluejay),(function(e){"use strict";e.addModule("lightningFilterOptions");const t="active",s=".lightning-btn",o=document.querySelector(s);if(null===o)return;const n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),e.show(this.content,"block"))}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(t),e.hide(this.content))}}),a=Object.assign({btn:o,content:document.querySelector(".change-timeline"),open:!1},{change:function(){this.open?this.hide():this.show()}},n(),i());e.userDown(s,()=>a.change())})(bluejay),(function(e){"use strict";e.addModule("lightningIconGroups");const t=e.nodeArray(document.querySelectorAll(".icon-group"));if(t.length<1)return;t.forEach(t=>{let s=t.childElementCount,o=document.createElement("div");o.textContent="("+s+")",e.hide(o),t.parentNode.appendChild(o)});e.userDown(".js-timeline-date",t=>{let s=t.target,o=document.querySelector("#js-icon-"+s.dataset.icons);s.classList.contains("collapse")?(e.hide(o),e.show(o.nextElementSibling,"block"),s.classList.replace("collapse","expand")):(e.show(o,"block"),e.hide(o.nextElementSibling),s.classList.replace("expand","collapse"))})})(bluejay),(function(e){"use strict";if(e.addModule("messagePreview"),null===document.querySelector(".home-messages"))return;e.nodeArray(document.querySelectorAll(".js-message .message")).forEach(e=>{e.scrollWidth<=e.clientWidth&&(e.parentNode.nextSibling.querySelector(".js-expand-message").style.display="none")});e.userDown(".js-expand-message",t=>{let s=t.target,o=e.getParent(s,"tr").querySelector(".message");s.classList.contains("expand")?(o.classList.add("expand"),s.classList.replace("expand","collapse")):(o.classList.remove("expand"),s.classList.replace("collapse","expand"))})})(bluejay),(function(e){"use strict";e.addModule("multiPageScroll");let t=e.nodeArray(document.querySelectorAll(".lightning-multipage-scroll"));if(0===t.length)return;const s=()=>({animateScrollTo:function(e){let t=1,s=0,o=this.stack.scrollTop,n=this.pageH*e-o;clearInterval(this.animateID),this.animateID=setInterval(()=>{var e;s=Math.min(1,t/80),this.stack.scrollTop=Math.ceil(((e=s)<.5?2*e*e:(4-2*e)*e-1)*n)+o,t+=1,1==s&&clearInterval(this.animateID)},2)}}),o=()=>({pageBtn:function(e){e.matches(".page-num-btn")&&this.animateScrollTo(parseFloat(e.dataset.page))}});t.forEach(e=>{(e=>{e.numOfImgs=e.stack.querySelectorAll("img").length,e.pageH=parseFloat(e.stack.querySelector("img").height+10),e.animateID=null;let t=new DocumentFragment;for(let s=0;s<e.numOfImgs;s++){let o=document.createElement("div");o.className="page-num-btn",o.setAttribute("data-page",s),o.textContent=s+1+"/"+e.numOfImgs,t.appendChild(o)}e.nav.appendChild(t),e.nav.addEventListener("mouseenter",t=>e.pageBtn(t.target),{capture:!0}),e.nav.addEventListener("mousedown",t=>e.pageBtn(t.target),{capture:!0}),Object.assign(e,o(),s())})({nav:e.querySelector(".multipage-nav"),stack:e.querySelector(".multipage-stack")})})})(bluejay),(function(e){"use strict";e.addModule("navHotlist");const t="active",s="open",o="#js-nav-hotlist-btn",n=document.querySelector(o);if(null===n)return;const i=()=>({over:function(){this.isFixed||(this.btn.classList.add(t),this.show())}}),a=()=>({show:function(){this.open||(this.open=!0,e.show(this.content,"block"),this.mouseOutHide())}}),l=()=>({hide:function(){!1===this.open||this.isLocked||this.isFixed||(this.open=!1,this.btn.classList.remove(t,s),e.hide(this.content))}}),r=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(s)}}),c=()=>({fixedOpen:function(e){this.isFixed=e,e?(this.isLocked=!1,this.btn.classList.add(s),this.btn.classList.remove(t),this.show()):this.hide()}}),d=Object.assign({btn:n,content:document.querySelector("#js-hotlist-panel"),wrapper:document.querySelector("#js-hotlist-panel-wrapper"),open:!1,isLocked:!1,isFixed:!1},{changeState:function(){this.isFixed||(this.open?this.isLocked?(this.isLocked=!1,this.hide()):this.makeLocked():(this.makeLocked(),this.over()))}},i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}},r(),a(),l(),c()),u=()=>{"true"===n.dataset.fixable&&d.fixedOpen(window.innerWidth>e.settings("cssHotlistFixed"))};e.userDown(o,()=>d.changeState()),e.userEnter(o,()=>d.over()),e.listenForResize(u),u()})(bluejay),(function(e){"use strict";e.addModule("navLogo");const t="active",s="open",o="#js-openeyes-btn";null!==document.querySelector(".oe-login")&&document.querySelector(o).classList.add(t);const n=()=>({over:function(){this.btn.classList.add(t)}}),i=()=>({out:function(){this.btn.classList.remove(t)}}),a=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(s),e.show(this.content,"block"),this.mouseOutHide())}}),l=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(s,t),e.hide(this.content))}}),r=(()=>{let t=document.querySelector(o);return Object.assign({btn:t,content:document.querySelector("#js-openeyes-info"),wrapper:e.getParent(t,".openeyes-brand"),open:!1},n(),i(),{change:function(){this.open?this.hide():this.show()}},a(),l(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}})})();e.userDown(o,()=>r.change()),e.userEnter(o,()=>r.over()),e.userLeave(o,()=>r.out())})(bluejay),(function(e){"use strict";e.addModule("navShortcuts");const t="active",s="#js-nav-shortcuts-btn",o=document.querySelector(s);if(null===o)return;const n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),e.show(this.content,"block"),this.mouseOutHide())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(t),e.hide(this.content))}}),a=Object.assign({btn:o,content:document.querySelector("#js-nav-shortcuts-subnav"),wrapper:document.querySelector("#js-nav-shortcuts"),open:!1},{change:function(){this.open?this.hide():this.show()}},n(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}});e.userDown(s,()=>a.change()),e.userEnter(s,()=>a.show())})(bluejay),(function(e){"use strict";e.addModule("navShortlists");const t="active",s="#js-nav-shortlists-btn",o=document.querySelector(s);if(null===o)return;const n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),e.show(this.content,"block"),this.mouseOutHide())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(t),e.hide(this.content))}}),a=Object.assign({btn:o,content:document.querySelector("#js-shortlists-panel"),wrapper:document.querySelector("#js-shortlists-panel-wrapper"),open:!1},{change:function(){this.open?this.hide():this.show()}},n(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}});e.userDown(s,()=>a.change()),e.userEnter(s,()=>a.show())})(bluejay),(function(e){"use strict";if(e.addModule("notificationBanner"),null===document.querySelector("#oe-admin-notifcation"))return;const t="#oe-admin-notifcation .oe-i",s=document.querySelector("#notification-short"),o=document.querySelector("#notification-full");if(null!==document.querySelector(".oe-login"))return e.hide(s),e.show(o,"block"),void(document.querySelector(t).style.display="none");let n=s,i=o,a=!0;const l=(e,t)=>{e.style.display="block",t.style.display="none"};e.userEnter(t,()=>l(i,n)),e.userLeave(t,()=>l(n,i)),e.userDown(t,()=>{n=a?o:s,i=a?s:o,a=!a,l(n,i)})})(bluejay),(function(e){"use strict";e.addModule("overlayPopup");const t=[{id:"#js-idg-popup-content-template",php:"_popup-content-template.php"},{id:"#js-change-context-btn",php:"change-context.php"},{id:"#copy-edit-history-btn",php:"previous-history-elements.php"},{id:"#copy-edit-anterior-segment-btn",php:"previous-ed-anterior.php"},{id:"#js-virtual-clinic-btn",php:"virtual-clinic.php"},{id:"#js-delete-event-btn",php:"delete-event.php"},{id:"#js-close-element-btn",php:"close-element.php"},{id:"#js-add-new-event",php:"add-new-event.php"},{id:"#js-idg-preview-correspondence",php:"letter-preview.php"},{id:"#js-idg-exam-complog",php:"exam-va-COMPlog.php"},{id:"#js-duplicate-event-btn",php:"duplicate-event-warning.php"},{id:"#js-idg-worklist-ps-add",php:"worklist-PS.php"},{id:"#analytics-change-filters",php:"analytics-filters.php"},{id:"#js-idg-add-new-contact-popup",php:"add-new-contact.php"},{id:"#js-idg-admin-queset-demo",php:"admin-add-queue.php"},{id:"#js-idg-search-query-save",php:"query-save.php"},{id:"#js-idg-search-all-searches",php:"query-all-searches.php"}],s=(t,s)=>{e.userDown(t,()=>{e.xhr("/idg-php/v3/_load/"+s).then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t,s.querySelector(".close-icon-btn").addEventListener("mousedown",t=>{t.stopPropagation(),e.removeElement(s)},{once:!0}),e.appendTo("body",s)}).catch(e=>console.log("OverlayPopup failed to load: Err msg -",e))})};for(let e=0,o=t.length;e<o;e++){let o=t[e];null!==document.querySelector(o.id)&&s(o.id,o.php)}})(bluejay),(function(e){"use strict";e.addModule("overlayPopupJSON");e.userDown(".js-idg-demo-popup-json",t=>{let s;if(void 0===t.target.dataset.idgDemo)throw new Error("overlayPopupJSON: No php file info? Needs data-idg-demo=json");s=JSON.parse(t.target.dataset.idgDemo).php,e.xhr("/idg-php/v3/_load/"+s).then(t=>{const s=document.createElement("div");s.className="oe-popup-wrap",s.innerHTML=t,e.appendTo("body",s);let o=s.querySelector(".close-icon-btn");o&&o.addEventListener("mousedown",t=>{t.stopPropagation(),e.removeElement(s)},{once:!0})}).catch(e=>console.log("overlayPopupJSON: Failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("pathSteps");const t=".oe-pathstep-btn";if(null===document.querySelector(t))return;let s=!1;const o=document.createElement("div");o.style.display="none",o.className="oe-pathstep-popup",o.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<h3 class="title"></h3>','<div class="popup-overflow"><div class="data-group">','<table class="data-table"><tbody>',"</tbody></table>","</div></div>",'<div class="step-actions"><div class="flex-layout">','<button class="red hint">Remove PSD</button><button class="green hint">Administer</button>',"</div></div>",'<div class="step-status"></div>'].join(""),e.appendTo("body",o);const n={title:o.querySelector(".title"),closeBtn:o.querySelector(".close-icon-btn .oe-i"),status:o.querySelector(".step-status"),tbody:o.querySelector(".data-table tbody"),actions:o.querySelector(".step-actions"),detailRows:null,locked:!1},i=e=>{let t,s="NA";return"R"!=e&&"B"!=e||(t="R"),"L"!=e&&"B"!=e||(s="L"),`<span class="oe-eye-lat-icons"><i class="oe-i laterality ${t} small"></i><i class="oe-i laterality ${s} small"></i></span>`},a=(e,t,s=!1)=>{let o=document.createElement("tr");s&&(o.className=s),e.forEach(e=>{let t=document.createElement("td");t.innerHTML=e,o.appendChild(t)}),t.appendChild(o)},l=t=>{let s=document.createDocumentFragment();t.forEach(e=>{var t;a((t=e.directive,[i(t[0]),t[1],t[2]]),s),e.steps.forEach(e=>{a((e=>{return 1==e.length&&(e=e.concat(['<em class="fade">to do</em>',""])),[(t=e[0],`<i class="oe-i ${t} small"></i>`),e[1],e[2]];var t})(e),s,"administer-details")})}),n.tbody.innerHTML="",n.tbody.appendChild(s),n.detailRows=e.nodeArray(o.querySelectorAll(".administer-details"))},r=()=>{let e=JSON.parse(s.dataset.step);n.title.textContent=e.title,l(e.psd),(e=>{let t="No status set",s="default";switch(e){case"done":t="PSD: Completed at 11:40",s="green";break;case"todo":t="PSD: Waiting to start",s="default";break;case"progress":t="PSD: In progress",s="orange";break;case"problem":t="Issue with PSD",s="red"}n.status.textContent=t,n.status.className=["step-status",s].join(" ")})(e.status)},c=e=>{let t=e?"block":"none",s=e?"table-row":"none";n.title.style.display=t,n.closeBtn.style.display=t,n.actions.style.display=t,n.detailRows.forEach(e=>e.style.display=s)},d=()=>{n.locked=!1,o.style.display="none"},u=(e,t,s=0)=>{o.style.top=e+s+"px",o.style.left=t-360+"px",o.style.display="block"};e.userDown(t,e=>{e.target!==s&&(s=e.target,r()),c(!0),n.locked=!0;let t=s.getBoundingClientRect();u(t.top,t.right,-5),window.addEventListener("scroll",d,{capture:!0,once:!0})}),e.userEnter(t,e=>{if(n.locked)return;s=e.target,r(),c(!1);let t=s.getBoundingClientRect();u(t.bottom,t.right)}),e.userLeave(t,e=>{n.locked||d()}),e.userDown(".oe-pathstep-popup .close-icon-btn .oe-i",d)})(bluejay),(function(e){"use strict";e.addModule("patientPopups");const t="active",s="open",o=[{btn:"#js-quicklook-btn",content:"#patient-summary-quicklook"},{btn:"#js-demographics-btn",content:"#patient-popup-demographics"},{btn:"#js-management-btn",content:"#patient-popup-management"},{btn:"#js-allergies-risks-btn",content:"#patient-popup-allergies-risks"},{btn:"#js-charts-btn",content:"#patient-popup-charts"},{btn:"#js-patient-extra-btn",content:"#patient-popup-trials"}],n=()=>({over:function(){this.btn.classList.add(t),this.show()}}),i=()=>({out:function(e){e.relatedTarget!==this.content&&(this.hide(),this.btn.classList.remove(t))}}),a=()=>({show:function(){this.open||(this.open=!0,d(this),this.btn.classList.add(s),e.show(this.content,"block"))}}),l=()=>({hide:function(){!1===this.open||this.isLocked||(this.open=!1,this.btn.classList.remove(t,s),e.hide(this.content))}}),r=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(s)}}),c=e=>(e.open=!1,e.isLocked=!1,Object.assign(e,{change:function(){this.open?this.hide():this.show()}},n(),i(),r(),a(),l(),{makeHidden:function(){this.open&&(this.isLocked=!1,this.hide())}})),d=e=>{o.forEach(t=>{t.popup!=e&&t.popup.makeHidden()})};o.forEach(t=>{let s=document.querySelector(t.btn);if(null!==s){let o=c({btn:s,content:document.querySelector(t.content)});e.userDown(t.btn,()=>o.change()),e.userEnter(t.btn,()=>o.over()),e.userLeave(t.btn,e=>o.out(e)),e.userLeave(t.content,e=>o.out(e)),t.popup=o}})})(bluejay),(function(e){"use strict";e.addModule("patientQuickMeta");let t=!1,s=!1,o=null,n=null,i=null,a=window.innerHeight;const l={},r=()=>{n.style.display="none",t=s=!1,o=null},c=(r,c)=>{if(o===r&&t)return s=!0,void e.show(i,"block");n=n||(()=>{const t=document.createElement("div");return t.className="oe-patient-quick-overview",t.style.display="none",t.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<div class="oe-patient-meta">','<div class="patient-name">','<a href="/v3-SEM/patient-overview"><span class="patient-surname">SURNAME</span>, <span class="patient-firstname">First (M.)</span></a>','</div><div class="patient-details">','<div class="hospital-number"><span>ID</span>0000000</div>','<div class="nhs-number"><span>NHS</span>111 222 3333</div>','<div class="patient-gender"><em>Gen</em>Male</div>','<div class="patient-age"><em>Age</em>00y</div>',"</div></div>",'<div class="quick-overview-content"></div>'].join(""),e.appendTo("body",t),i=t.querySelector(".close-icon-btn"),l.surname=t.querySelector(".patient-surname"),l.first=t.querySelector(".patient-firstname"),l.hospital=t.querySelector(".hospital-number"),l.nhs=t.querySelector(".nhs-number"),l.gender=t.querySelector(".patient-gender"),l.age=t.querySelector(".patient-age"),t})(),t=!0,s=c,o=r;let d=r.dataset,u=r.getBoundingClientRect(),h=d.mode,p=d.php,y=JSON.parse(d.patient);l.surname.textContent=y.surname,l.first.textContent=y.first,l.hospital.innerHTML="<span>ID</span> "+y.id,l.nhs.innerHTML="<span>NHS</span> "+y.nhs,l.gender.innerHTML="<em>Gen</em> "+y.gender,l.age.innerHTML="<em>Age</em> "+y.age,n.style.cssText=" ","float"==h?(n.classList.remove("side-panel"),a-u.y>300?n.style.top=u.y+u.height+5+"px":n.style.bottom=a-u.top+10+"px",n.style.left=u.x-250+u.width/2+"px"):n.classList.add("side-panel");let m=n.querySelector(".quick-overview-content");m.innerHTML="";let g=setTimeout(()=>m.innerHTML='<i class="spinner"></i>',400);c?e.show(i,"block"):e.hide(i),e.xhr("/idg-php/v3/_load/"+p).then(e=>{clearTimeout(g),t&&(m.innerHTML=e,n.style.display="block")}).catch(e=>console.log("ed3app php failed to load",e))};e.userDown(".js-patient-quick-overview",e=>{let n=e.target;t&&s&&o===n?r():c(n,!0)}),e.userEnter(".js-patient-quick-overview",e=>{s||c(e.target,!1)}),e.userLeave(".js-patient-quick-overview",e=>{s||r()}),e.userDown(".oe-patient-quick-overview .close-icon-btn .oe-i",r),e.listenForResize(()=>a=window.inneHeight)})(bluejay),(function(e){"use strict";e.addModule("printOptions");const t="active",s="#js-header-print-dropdown-btn",o=document.querySelector(s);if(null===o)return;const n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),e.show(this.content,"block"),this.mouseOutHide())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(t),e.hide(this.content))}}),a=Object.assign({btn:o,content:document.querySelector("#js-header-print-subnav"),wrapper:document.querySelector("#js-header-print-dropdown"),open:!1},{change:function(){this.open?this.hide():this.show()}},n(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}});e.userDown(s,()=>a.change()),e.userEnter(s,()=>a.show())})(bluejay),(function(e){"use strict";e.addModule("proView");const t=[],s=e=>({options:function(e){e.lock&&(this.pro=null),0!=e.linkID&&(this.linked=!0,this.linkedProView=n(document.querySelector("#"+e.linkID)),e.lock&&(this.linkedProView.pro=null))}}),o=e=>{let t=e.querySelector(".pro-view-btn"),o=e.querySelector(".data-pro-view"),n=e.querySelector(".data-standard-view"),i={btn:t,oei:t.querySelector(".oe-i"),pro:o,standard:n,inPro:!0,linked:!1};return Object.assign(i,{change:function(){this.inPro?(this.hideShow(this.pro,this.standard),this.icon("expand","collapse")):(this.hideShow(this.standard,this.pro),this.icon("collapse","expand")),this.linked&&this.linkedProView.change(),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}},{icon:function(e,t){this.oei.classList.replace(e,t)}},s())},n=e=>{let t={pro:e.querySelector(".data-pro-view"),standard:e.querySelector(".data-standard-view"),inPro:!0};return Object.assign(t,{change:function(){this.inPro?this.hideShow(this.pro,this.standard):this.hideShow(this.standard,this.pro),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}})};e.userDown(".pro-view-btn",s=>{const n=s.target;let i=e.getDataAttr(n);if(i)t[parseFloat(i)].change();else{e.setDataAttr(n,t.length);let s=o(e.getParent(n,".pro-data-view"));s.options(JSON.parse(n.dataset.proview)),s.change(),t.push(s)}})})(bluejay),(function(e){"use strict";e.addModule("problemsPlans");const t=e.nodeArray(document.querySelectorAll(".problems-plans-sortable"));if(t.length<1)return;const s=[],o=(e,t,s)=>({id:e,text:t,info:s});e.nodeArray(t[0].querySelectorAll("li")).forEach(e=>{s.push(o(s.length,e.textContent,e.querySelector(".info").getAttribute("data-tooltip-content")))}),t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach((t,s)=>{e.setDataAttr(t,s)})});let n=s.length+1;const i=(e,t)=>['<span class="drag-handle"><i class="oe-i menu medium pro-theme"></i></span>',e,'<div class="metadata">','<i class="oe-i info small pro-theme js-has-tooltip" data-tooltip-content="',t,'"></i></div>','<div class="remove"><i class="oe-i remove-circle small pro-theme pad"></i></div>'].join(""),a=(o,n)=>{let a=s.findIndex(e=>e.id==o),l=s.findIndex(e=>e.id==n);s[a]=s.splice(l,1,s[a])[0],t.length>1&&t.forEach(t=>{let o=t.querySelectorAll("li");for(let t=0,n=s.length;t<n;t++){let n=s[t],a=o[t];n.id!=e.getDataAttr(a)&&(e.setDataAttr(a,n.id),a.innerHTML=i(n.text,n.info))}})};e.userDown(".create-new-problem-plan button",a=>{a.preventDefault();let l=e.getParent(a.target,".create-new-problem-plan").querySelector("input");if(!l||l.value.length<2)return;let r=o(n++,l.value,"Added now!");var c;s.push(r),c=(t=>{const s=new DocumentFragment,o=document.createElement("li");return o.innerHTML=i(t.text,t.info),e.setDataAttr(o,t.id),s.appendChild(o),s})(r),t.forEach(e=>{e.appendChild(c.cloneNode(!0)),p(e.lastChild)})}),e.userDown(".problems-plans-sortable .remove-circle",o=>{let n=e.getParent(o.target,"li"),i=0;for(;null!==(n=n.previousSibling);)i++;t.forEach(t=>{e.removeElement(t.childNodes[i])}),s.splice(i,1)}),document.addEventListener("DOMContentLoaded",()=>{t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach(e=>{p(e)})})});let l=null,r="js-sorting-list";const c=e=>{l=e.target,e.target.parentNode.classList.add(r),e.dataTransfer.setData("source",l.innerHTML)},d=e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"},u=e=>(e.preventDefault&&e.preventDefault(),!1),h=t=>{if(t.stopPropagation&&t.stopPropagation(),!1!==t.target.parentNode.classList.contains(r))return t.target.parentNode.classList.remove(r),l!=t.target&&(l.innerHTML=t.target.innerHTML,t.target.innerHTML=t.dataTransfer.getData("source"),a(e.getDataAttr(l),e.getDataAttr(t.target))),!1},p=e=>{e.setAttribute("draggable","true"),e.addEventListener("dragstart",c,!1),e.addEventListener("dragenter",d,!1),e.addEventListener("dragover",u,!1),e.addEventListener("drop",h,!1)}})(bluejay),(function(e){"use strict";e.addModule("reduceElementHeight");const t=[],s=e=>(e.reduced=!1,Object.assign(e,{change:function(){this.reduced?(this.elem.classList.remove("reduced-height"),this.icon.classList.replace("increase-height-orange","reduce-height")):(this.elem.classList.add("reduced-height"),this.icon.classList.replace("reduce-height","increase-height-orange")),this.reduced=!this.reduced}}));e.userDown(".element .js-elem-reduce .oe-i",(o,n)=>{let i=o.target,a=e.getDataAttr(i);if(a)t[parseFloat(a)].change();else{let o=s({elem:e.getParent(i,".element"),icon:i});o.change(),e.setDataAttr(i,t.length),t.push(o)}})})(bluejay),(function(e){"use strict";e.addModule("restrictDataHeightFlag");const t="restrict-data-shown-flag",s=e.getDataAttributeName(),o=[];function n(e,t,s){this.hasScrolled=!1,this.flag=e,this.content=t,this.scrollEndPos=s,this.content.addEventListener("scroll",()=>this.scroll(),{once:!0})}n.prototype.scroll=function(t){this.hasScrolled=!0,this.flag.className+=" fade-out",setTimeout(()=>e.removeElement(this.flag),400)},n.prototype.userClick=function(){this.hasScrolled||i(this.content,this.scrollEndPos)};const i=(e,t)=>{let s=1,o=0,n=setInterval(()=>{var i;o=Math.min(1,s/200),e.scrollTop=Math.ceil((i=o)*(2-i)*t),s+=1,1==o&&clearInterval(n)},2)};(()=>{let i=e.nodeArray(document.querySelectorAll(".restrict-data-shown"));if(i.length<1)return;const a=document.createDocumentFragment(),l=document.createElement("div");l.className=t,a.appendChild(l),i.forEach(e=>{let t=e.querySelector(".restrict-data-content"),i=e.clientHeight,l=t.scrollHeight;if(l>i&&0===t.scrollTop){let r=a.cloneNode(!0),c=r.firstChild;c.setAttribute(s,o.length),e.appendChild(r),o.push(new n(c,t,l-i))}})})(),e.userDown("."+t,e=>{o[e.target.getAttribute(s)].userClick()})})(bluejay),(function(e){"use strict";e.addModule("sideNavSelectList");const t=e.nodeArray(document.querySelectorAll(".js-list-filter"));if(0==t.length)return;const s=e.nodeArray(document.querySelectorAll(".js-filter-group"));let o=document.querySelector(".js-list-filter.selected");const n=e=>{s.forEach(t=>{t.style.display=e})};t.forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let s=t.target;var i;s.classList.add("selected"),"all"==(i=s.dataset.list)?n("block"):(n("none"),e.show(document.querySelector("#"+i),"block")),o.classList.remove("selected"),o=s})})})(bluejay),(function(e){"use strict";bluejay.addModule("sidebarElementList");let t=document.querySelector(".sidebar-eventlist .oe-element-list");if(null===t)return;let s=document.querySelectorAll(".element-title");if(s.length<1)return;let o=document.createDocumentFragment();s.forEach((function(e){let t=document.createElement("li");t.innerHTML='<a href="#">'+e.textContent+"</a>",o.appendChild(t)})),t.appendChild(o)})(),(function(e){"use strict";e.addModule("sidebarEventFilter");const t="active",s="#js-sidebar-filter-btn",o=document.querySelector(s);if(null===o)return;const n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),e.show(this.content,"block"),this.mouseOutHide())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(t),e.hide(this.content))}}),a=Object.assign({btn:o,content:document.querySelector("#js-sidebar-filter-options"),wrapper:document.querySelector("#js-sidebar-filter"),open:!1},{change:function(){this.open?this.hide():this.show()}},n(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}});e.userDown(s,()=>a.change()),e.userEnter(s,()=>a.show())})(bluejay),(function(e){"use strict";if(e.addModule("sidebarQuicklookView"),null===document.querySelector("ul.events"))return;let t=null;const s=t=>e.getParent(t,"li").querySelector(".quicklook"),o=()=>({show:function(t){this.open=!0;const s=JSON.parse(t.dataset.quickview);this.icon.className="oe-i-e large "+s.icon,this.titleDate.textContent=s.title+" - "+s.date,e.xhr("/idg-php/v3/_load/sidebar/quick-view/"+s.php).then(e=>{!1!==this.open&&(this.open=!0,this.content.innerHTML=e,this.div.classList.remove("fade-out"),this.div.classList.add("fade-in"))}).catch(e=>console.log("PHP failed to load",e))}}),n=()=>({hide:function(){this.open=!1,this.div.classList.add("fade-out"),this.div.classList.remove("fade-in"),setTimeout(()=>this.div.classList.remove("fade-out"),300)}}),i=(()=>{const t=document.createElement("div");return t.className="oe-event-quick-view",t.id="js-event-quick-view",t.innerHTML=['<div class="event-icon"><i class="oe-i-e large"></i></div>','<div class="title-date">Title - DD Mth YYYY</div>','<div class="audit-trail">Michael Morgan</div>','<div class="quick-view-content"></div>'].join(""),e.appendTo("body",t),Object.assign({div:t,titleDate:t.querySelector(".title-date"),icon:t.querySelector(".event-icon > .oe-i-e"),content:t.querySelector(".quick-view-content"),open:!1},o(),n())})();e.userEnter(".event .event-type",e=>{var o;o=e.target,s(o).classList.add("fade-in"),t=o,i.show(e.target)}),e.userLeave(".event .event-type",e=>{null!=t&&(s(t).classList.remove("fade-in"),t=null),i.hide()})})(bluejay),(function(e){"use strict";e.addModule("textAreaResize");const t=e=>{let t=e.scrollHeight;t<20||(e.style.height="auto",e.style.height=t+"px")};e.extend("resizeTextArea",t),document.addEventListener("input",e=>{e.target.matches("textarea")&&t(e.target)},{capture:!0}),document.addEventListener("DOMContentLoaded",()=>{e.nodeArray(document.querySelectorAll("textarea")).forEach(e=>{t(e)})})})(bluejay),(function(e){"use strict";e.addModule("tooltip");const t={selector:".js-has-tooltip",css:{basicWidth:200,bilateralWidth:400},showing:!1,target:null,type:"basic",tip:null,eyeIcons:null,onChange(e){if("function"!=typeof e)throw new Error("Tooltip Model requires View callback as funciton");this.onChange=e},reset(){this.showing=!1,this.target=null,this.onChange()},update(e){this.showing=!0,this.target=e,"bilateral"==e.dataset.ttType?(this.type="bilateral",this.eyeIcons="no"!==e.dataset.ttEyeicons,this.tip={r:e.dataset.ttRight,l:e.dataset.ttLeft}):(this.type="basic",this.tip=e.dataset.tooltipContent),this.onChange()}},s=((t=>{let s,o=null,n="block",i=t.css.basicWidth,a=window.innerWidth;e.listenForResize(()=>a=window.innerWidth);const l=()=>{o.innerHTML="",o.className="oe-tooltip",o.style.cssText="display:none"},r=()=>{o=o||(o=document.createElement("div"),e.appendTo("body",o),l(),o),"block"==n?o.innerHTML=t.tip:(o.classList.add("bilateral"),t.eyeIcons||o.classList.add("no-icons"),o.innerHTML='<div class="right"></div><div class="left"></div>',o.querySelector(".right").innerHTML=t.tip.r,o.querySelector(".left").innerHTML=t.tip.l);let s=i/2,r=e.getHiddenElemSize(o).h,c=t.target.getBoundingClientRect(),d=c.right-c.width/2,u=c.top-r-8,h=e.settings("cssHotlistFixed"),p=a>h?h:a;d<=s&&(s=20,o.classList.add("offset-right")),d>p-s&&(s=i-20,o.classList.add("offset-left")),c.top<r&&(u=c.bottom+8,o.classList.add("inverted")),o.style.top=u+"px",o.style.left=d-s+"px",o.style.display=n};t.onChange(()=>{0==t.showing?l():(s=t.tip,"basic"==t.type?(n="block",i=t.css.basicWidth):(n="flex",i=t.css.bilateralWidth),r())})})(t),e=>{t.update(e.target),window.addEventListener("scroll",o,{capture:!0,once:!0})}),o=e=>{t.showing&&t.reset()};e.userDown(t.selector,e=>{e.target.isSameNode(t.target)&&t.showing?o():s(e)}),e.userEnter(t.selector,s),e.userLeave(t.selector,o)})(bluejay),(function(e){"use strict";bluejay.addModule("userPIN");document.addEventListener("input",e=>{e.target.matches(".user-pin-entry")&&(e=>{let t=e.value,s=e.parentNode;s.classList.remove("accepted-pin","wrong-pin"),4===t.length&&("1234"==t?s.classList.add("accepted-pin"):s.classList.add("wrong-pin"))})(e.target)},{capture:!0})})(),(function(e){"use strict";e.addModule("vcScratchPad");const t=document.querySelector("#oe-vc-scratchpad");if(null===t)return;let s,o,n=!1;t.addEventListener("dragstart",e=>{e.dataTransfer.dropEffect="move";let t=e.target.getBoundingClientRect();s=e.clientX-t.left,o=e.clientY-t.top},!1),t.addEventListener("dragend",e=>{let n=Math.round(e.clientY-o),i=Math.round(e.clientX-s);n=n<1?1:n,i=i<1?1:i,t.style.top=n+"px",t.style.left=i+"px"},!1);e.userDown("#js-vc-scratchpad",s=>{let o=s.target;n?(e.hide(t),o.textContent="ScratchPad"):(e.show(t,"block"),o.textContent="Hide ScratchPad"),n=!n})})(bluejay),(function(e){"use strict";if(e.addModule("whiteboard"),null===document.querySelector("main.oe-whiteboard"))return;e.hide(document.querySelector("#oe-admin-notifcation"));const t=document.querySelector(".wb3-actions"),s=document.querySelector("#js-wb3-openclose-actions");e.userDown("#js-wb3-openclose-actions",e=>{s.classList.contains("up")?(s.classList.replace("up","close"),t.classList.replace("down","up")):(s.classList.replace("close","up"),t.classList.replace("up","down"))}),e.userDown(".wb-idg-demo-btn",e=>{window.location="/v3-whiteboard/"+e.target.dataset.url}),e.userDown(".edit-widget-btn .oe-i",t=>{let s=t.target,o=e.getParent(s,".oe-wb-widget"),n=o.querySelector(".wb-data ul"),i=o.querySelector(".wb-data .edit-widget");s.classList.contains("pencil")?(s.classList.replace("pencil","tick"),e.hide(n),e.show(i,"block")):(s.classList.replace("tick","pencil"),e.hide(i),e.show(n,"block"))});if(e.userDown(".overflow-icon-btn",t=>{const s=JSON.parse(t.target.dataset.overflow);let o=document.createElement("div");o.className="oe-popup-wrap clear",o.innerHTML=`<div class="wb-data-overflow-popup">${s.data}</div>`,document.body.appendChild(o),o.addEventListener("mousedown",t=>{e.removeElement(o)},{once:!0})}),null===document.querySelector(".multipage-nav"))return;let o=document.querySelector(".multipage-stack"),n=e.nodeArray(o.querySelectorAll("img")),i=n[0].height+20;e.listenForResize(()=>i=n[0].height+20);let a=0;const l=e=>{a+=e,a<0&&(a=0),a>n.length*i&&(a=n.length*i),o.scrollTop=a};e.userDown("#js-scroll-btn-down",()=>l(200)),e.userDown("#js-scroll-btn-up",()=>l(-200));let r=document.querySelector(".page-jump");n.forEach((e,t)=>{let s=document.createElement("div");s.className="page-num-btn",s.setAttribute("data-page",t),s.textContent=t+1,r.appendChild(s)}),e.userDown(".page-num-btn",e=>{a=0;let t=parseInt(e.target.dataset.page*i);l(t)})})(bluejay),(function(e){"use strict";e.addModule("addSelect");const t=e.namespace("addSelect");t.all=[],t.closeAll=function(){this.all.forEach(e=>e.close())},t.init=function(){const s=e.nodeArray(document.querySelectorAll(".js-add-select-btn"));s.length<1||s.forEach(e=>{let s=new t.Popup(e);this.all.push(s)})},document.addEventListener("DOMContentLoaded",()=>t.init(),{once:!0})})(bluejay),(function(e){"use strict";const t=bluejay.namespace("addSelect");t.ListOption=function(e,s){let o=e.classList.contains("selected"),n=!1,i=JSON.parse(e.dataset.insert);void 0!==i.dependents&&(n=new t.OptionDependents(i.dependents,s.uniqueId)),this.click=function(){this.toggleState(),s.optionClicked(o,this),0!=n&&n.show(o)},this.toggleState=function(){e.classList.toggle("selected"),o=!o},this.deselect=function(){o&&this.toggleState()},Object.defineProperty(this,"selected",{get:()=>o,set:t=>{o=t,t||e.classList.remove("selected")}}),Object.defineProperty(this,"dependents",{get:()=>!1!==n}),Object.defineProperty(this,"value",{get:()=>i.value}),e.addEventListener("mousedown",this.click.bind(this))}})(),(function(e){"use strict";e.namespace("addSelect").OptionDependents=function(t,s){if(void 0===t)return!1;const o="#add-to-"+s+"-";let n=[];t.split(",").forEach(e=>{let t=e.split("."),s={};if(0===t[0]&&console.log("Error: OptionDependents, listGroup = 0 !!",o+"listgroup"+t[0]),s.div=document.querySelector(o+"listgroup"+t[0]),null===s.div&&console.log("obj.div = null!",o+"listgroup"+t[0]),s.holder=s.div.querySelector(".optional-placeholder"),null===s.holder&&console.log("Adder: no placeholder text for optional group"),0==t[1])s.showDefaultText=!0;else{s.showDefaultText=!1,s.lists=[];for(let e=1;e<t.length;e++){let n=document.querySelector(o+"list"+t[e]);null===n?console.log("Err: OptionDependents, list? ",o+"list"+t[e]):s.lists.push(n)}}n.push(s)}),this.show=function(e){e?this.myLists():this.reset()},this.hideAllOptionalLists=function(t){e.nodeArray(t.querySelectorAll(".optional-list")).forEach(t=>{e.hide(t)})},this.myLists=function(){n.forEach(t=>{this.hideAllOptionalLists(t.div),t.showDefaultText?t.holder&&e.show(t.holder,"block"):(t.holder&&e.hide(t.holder),t.lists.forEach(t=>{e.show(t,"block")}))})},this.reset=function(){n.forEach(t=>{this.hideAllOptionalLists(t.div),t.holder&&e.show(t.holder,"block")})}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.OptionsList=function(s){let o=JSON.parse(s.dataset.options);const n="inputTemplate"==o.type,i="single"==o.type,a=(o.hasExtraOptions,"true"===o.isOptionalList);this.uniqueId=s.dataset.id,a&&e.hide(s.parentNode);let l=[],r=[];e.nodeArray(s.querySelectorAll("li")).forEach(e=>{let s=new t.ListOption(e,this);l.push(s),s.selected&&s.dependents&&r.push(s)}),this.optionClicked=function(e,t){if(n){let e=s.previousElementSibling,o=t.value,n=o.indexOf("{"),i=o.indexOf("}")+1;return e.value=o,t.deselect(),void setTimeout(()=>{e.focus(),e.select(),e.setSelectionRange(n,i)},50)}e&&i&&l.forEach(e=>{e!==t&&e.deselect()})},this.checkForDefaultSelections=()=>{r.length&&r.forEach(e=>{e.selected=!1,e.click()})}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.Popup=function(s){let o=document.querySelector("#"+s.dataset.popup),n=[];this.anchorLeft=!!o.dataset.anchorLeft,this.btn=s,this.popup=o,this.closeBtn=o.querySelector(".close-icon-btn"),this.open=function(){this.position(),t.closeAll(),e.show(o,"block"),this.closeBtn.addEventListener("mousedown",this.close.bind(this))},this.close=function(){o.style.display="none"},this.reset=function(){},e.nodeArray(o.querySelectorAll(".add-options")).forEach(e=>{let s=new t.OptionsList(e);s.checkForDefaultSelections(),n.push(s)}),this.btn.addEventListener("mousedown",this.open.bind(this))},t.Popup.prototype.position=function(){let e=this.btn.getBoundingClientRect(),t=window.innerWidth,s=window.innerHeight,o=s-e.bottom;if(s-o<325&&(o=s-325),this.anchorLeft)this.popup.style.left=e.left+"px";else{let s=e.right-this.popup.getBoundingClientRect().width,o=s<0?s-25:0;this.popup.style.right=t-e.right+o+"px"}this.popup.style.bottom=o+"px"}})(bluejay),(function(e){"use strict";Object.preventExtensions(e),e.ready()})(bluejay);