Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";console.time("[blue] Ready");const e={};let t=1;return e.extend=((n,s)=>s._app||n in e?(bluejay.log('** Err: Can not extend again: "'+n+'"'),!1):(s._app=t++,e[n]=s,!0)),e.log=function(e){console.log("[blue] "+e)},e.log("OE JS UI layer... starting"),e.log("DEBUG MODE"),document.addEventListener("DOMContentLoaded",()=>{let t=[];for(const n in e)t.push(n);e.log("[API] [Helper Methods] "+t.join(", ")),console.timeEnd("[blue] Ready")},{once:!0}),e})();!(function(e){"use strict";const t=[],n=[],s=[],i=[],o=(e,t,n)=>{e.push({selector:t,cb:n})},a=(e,t)=>{e.target!==document&&t.forEach(t=>{e.target.matches(t.selector)&&t.cb(e)})},l=e=>{e.forEach(e=>{e.cb()})};const r=(function(e){let t=!1;return()=>{t||(t=!0,setTimeout(()=>{t=!1,l(e)},160))}})(i);document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("mouseenter",e=>a(e,n),{capture:!0}),document.addEventListener("mousedown",e=>a(e,t),{capture:!0}),document.addEventListener("mouseleave",e=>a(e,s),{capture:!0}),window.onresize=(()=>r())},{once:!0}),e.extend("registerForHover",(e,t)=>o(n,e,t)),e.extend("registerForClick",(e,n)=>o(t,e,n)),e.extend("registerForExit",(e,t)=>o(s,e,t)),e.extend("listenForResize",e=>o(i,null,e))})(bluejay),(function(e){"use strict";bluejay.extend("triggerCustomEvent",(e,t)=>{const n=new CustomEvent("blue-"+e,{detail:t});document.dispatchEvent(n),bluejay.log('[Custom Event] - "'+e+'"')})})(),(function(e){"use strict";e.extend("nodeArray",e=>Array.prototype.slice.call(e)),e.extend("appendTo",(e,t,n)=>{(n||document).querySelector(e).appendChild(t)}),e.extend("getParent",(e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1}),e.extend("removeElement",e=>{e.parentNode.removeChild(e)}),e.extend("show",(e,t="block")=>{e.style.display=t}),e.extend("hide",e=>{e.style.display="none"}),e.extend("xhr",t=>(e.log("[XHR] - "+t),new Promise((n,s)=>{let i=new XMLHttpRequest;i.open("GET",t),i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<300?(e.log("[XHR] - Success"),n(i.responseText)):(e.log("[XHR] - Failed"),s(this.status+" "+this.statusText)))},i.send()}))),e.extend("getHiddenElemSize",e=>{e.style.visibility="hidden",e.style.display="block";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="inherit",e.style.display="none",t})})(bluejay),(function(e){"use strict";const t={};e.extend("addModule",(n,s)=>n in t?(e.log("** Err: Module aleady added? "+n),!1):(e.log("[Module] "+n),t[n]={},t[n])),e.extend("getModule",n=>{if(n in t)return t[n];e.log("Module does not exist?: "+n)})})(bluejay),(function(e){"use strict";const t={get cssTopBarHeight(){return 60},get cssExtendBrowserSize(){return 1890},get cssBrowserHotlistFixSize(){return 1440},get PHPLOAD(){return"/idg-php/v3/_load/"}},n=(e=!1)=>{return"data-"+(e?"bluejay-"+e:"bluejay")};e.extend("settings",t),e.extend("getDataAttributeName",n),e.extend("setDataAttr",(e,t)=>{e.setAttribute(n(),t)}),e.extend("getDataAttr",e=>{const t=n();return!!e.hasAttribute(t)&&e.getAttribute(t)})})(bluejay),(function(e){"use strict";e.addModule("collapseExpand");const t=[],n=()=>({show:function(){e.show(this.content),this.btn.classList.replace("expand","collapse"),this.open=!0}}),s=()=>({hide:function(){e.hide(this.content),this.btn.classList.replace("collapse","expand"),this.open=!1}}),i=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},n(),s()),o=(n,s)=>{let o=n.target,a=e.getDataAttr(o);if(a)t[parseFloat(a)].change();else{e.setDataAttr(o,t.length);let n={btn:o,content:o.parentNode.querySelector(".collapse-"+s+"-content"),open:o.classList.contains("collapse")},a=i(n);a.change(),t.push(a)}};e.registerForClick(".collapse-data-header-icon",e=>o(e,"data")),e.registerForClick(".collapse-group > .header-icon",e=>o(e,"group"))})(bluejay),(function(e){"use strict";const t=e.nodeArray(document.querySelectorAll(".hidden"));t.length<1||t.forEach(t=>{e.hide(t),t.classList.remove("hidden")})})(bluejay),(function(e){"use strict";e.addModule("tooltip");let t=null,n=!1,s=window.innerWidth;const i=()=>{t.innerHTML="",t.className="oe-tooltip",t.style.cssText="display:none"},o=()=>{n&&(n=!1,i())},a=a=>{if(n)return;n=!0;const l=a.target;(t=t||(()=>(t=document.createElement("div"),e.appendTo("body",t),i(),t))()).innerHTML=l.dataset.tooltipContent;let r=100,c=e.getHiddenElemSize(t).h,d=l.getBoundingClientRect(),u=d.right-d.width/2,p=d.top-c-8,h=e.settings.cssExtendBrowserSize,g=s>h?h:s;u<=r&&(r=20,t.classList.add("offset-right")),u>g-r&&(r=180,t.classList.add("offset-left")),d.top<c&&(p=d.bottom+8,t.classList.add("inverted")),t.style.top=p+"px",t.style.left=u-r+"px",t.style.display="block",window.addEventListener("scroll",o,{capture:!0,once:!0})};e.registerForClick(".js-has-tooltip",e=>n?o():a(e)),e.registerForHover(".js-has-tooltip",a),e.registerForExit(".js-has-tooltip",o),e.listenForResize(()=>s=window.innerWidth)})(bluejay),(function(e){"use strict";e.addModule("attachmentThumbnail");const t="oe-attachment-thumbnail";let n,s=!1;const i={};if(e.nodeArray(document.querySelectorAll("."+t)).length<1)return;const o=()=>{i.close.removeEventListener("mousedown",o),i.save&&(i.save.removeEventListener("mousedown",o),i.cancel.removeEventListener("mousedown",o)),e.removeElement(n),s=!1},a=t=>{s||(t=>{s=!0,(n=document.createElement("div")).className="oe-popup-wrap";let a='<div class="oe-popup-attachment">';a+='<div class="title">'+t.title+"</div>",a+='<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>',a+='<div class="file-attachment-content"></div>',a+='<div class="file-size-controls"></div>',a+="</div>",n.innerHTML=a;const l=n.querySelector(".file-attachment-content"),r=n.querySelector(".file-size-controls"),c=new DocumentFragment,d=(e,t,n=!1)=>{let s=document.createElement("button");return s.className=t,n&&(s.id=n),s.textContent=e,c.appendChild(s),s};if("png"===t.type){let e="url('"+t.file+"')";l.style.backgroundImage=e,l.innerHTML='<img src="'+t.file+'" style="display:none"/>';const s=n.querySelector("img"),i=d("Fit to screen","pro-theme selected","oe-att-fit"),o=d("Actual size","pro-theme","oe-att-actual"),a=(e,t,n,i)=>{l.style.backgroundImage=e,s.style.display=t,n.classList.add("selected"),i.classList.remove("selected")};o.addEventListener("mousedown",e=>{e.stopPropagation(),a("none","block",o,i)}),i.addEventListener("mousedown",t=>{t.stopPropagation(),a(e,"none",i,o)})}else l.innerHTML='<embed src="'+t.file+'" width="100%" height="100%"></embed>',d("PDF","pro-theme selected");if(t.annotate){l.classList.add("annotation");let s=document.createElement("div");s.className="attachment-annotation",e.appendTo(".oe-popup-attachment",s,n),e.xhr(t.idgPHP).then(e=>{s.innerHTML=e,"L"==t.eyelat&&(s.querySelector("#annotation-right").style.visibility="hidden"),"R"==t.eyelat&&(s.querySelector("#annotation-left").style.visibility="hidden")}).catch(e=>console.log("XHR failed: ",e)),i.save=d("Save annotations","green hint"),i.cancel=d("Cancel","red hint"),i.save.addEventListener("mousedown",o,{once:!0}),i.cancel.addEventListener("mousedown",o,{once:!0})}if(t.stack){let s=t.title.split(" - "),i="<option>"+t.title+"</option>";for(let e=t.stack;e;e--)i+="<option>"+s[0]+" - ("+e+" Jan 1975 09:30)</option>";let o=document.createElement("div");o.className="attachment-stack",o.innerHTML='Choose report: <select class="pro-theme">'+i+"</select>",e.appendTo(".oe-popup-attachment",o,n)}i.close=n.querySelector(".close-icon-btn"),i.close.addEventListener("mousedown",o,{once:!0}),r.appendChild(c),e.appendTo("body",n)})(JSON.parse(t.target.dataset.attachment))};e.registerForClick("."+t,a),document.querySelectorAll(".js-annotate-attachment")&&e.registerForClick(".js-annotate-attachment",a)})(bluejay),(function(e){"use strict";e.addModule("comments");e.registerForClick(".js-add-comments",t=>{const n=t.target,s=document.querySelector("#"+n.dataset.input);e.hide(n),e.show(s),s.querySelector("textarea").focus(),s.querySelector(".js-remove-add-comments").addEventListener("mousedown",()=>{e.show(n,"inline-block"),e.hide(s)},{once:!0})})})(bluejay),(function(e){"use strict";e.addModule("commentHotlist");const t=".oe-hotlist-panel .js-patient-comments",n=document.querySelector("#hotlist-quicklook"),s=t=>{return e.getParent(t,"tr").nextSibling.querySelector("textarea").value};e.registerForClick(t,t=>{const n=t.target,i=(s(n),e.getParent(n,"tr").nextSibling),o=i.querySelector("textarea");i.style.display="table-row",e.resizeTextArea(o)}),e.registerForHover(t,t=>{const i=t.target;let o=e.getParent(i,".patient-activity"),a=i.getBoundingClientRect().top-o.getBoundingClientRect().top+21;i.classList.contains("comments-added")&&(n.textContent=s(i),n.style.top=a+"px",e.show(n))}),e.registerForExit(t,()=>{e.hide(n)})})(bluejay),(function(e){"use strict";e.addModule("ed3");let t=!1;e.registerForClick(".js-idg-ed3-app-btn",n=>{let s=n.target;t=t||(()=>{let t=document.createElement("div");return t.className="oe-eyedraw-app spinner-loader",e.appendTo("body",t),t})();let i=s.getBoundingClientRect().bottom-532;t.style.top=i<60?"60px":i+"px",e.show(t),e.xhr("/idg-php/v3/_load/ed3/"+s.dataset.php).then(e=>{t.innerHTML=e,t.querySelector(".close-icon-btn").addEventListener("mousedown",()=>{t.style.display="none"},{once:!0})}).catch(e=>console.log("ed3app php failed to load",e))})})(bluejay),(function(e){"use strict";e.addModule("elementSelector");const t=()=>({loadPHP:function(){e.xhr("/idg-php/v3/_load/sidebar/"+this.php).then(t=>{!1!==this.open&&(this.nav=document.createElement("nav"),this.nav.className=this.wrapClass,this.nav.innerHTML=t,this.btn.classList.add("selected"),e.appendTo("body",this.nav))}).catch(e=>console.log("PHP failed to load",e))}}),n=()=>({close:function(){this.open=!1,this.btn.classList.remove("selected"),e.removeElement(this.nav)}}),s=e=>(e.btn=null,e.open=!1,Object.assign(e,{change:function(e){null===this.btn&&(this.btn=e.target),this.open?this.close():(this.open=!0,this.loadPHP())}},t(),n()));if(null!==document.querySelector("#js-manage-elements-btn")){const t=s({wrapClass:"oe-element-selector",php:"element-selector.php"}),n=s({wrapClass:"sidebar element-overlay",php:"examination-elements.php"});e.registerForClick("#js-manage-elements-btn",e=>t.change(e)),e.registerForClick(".oe-element-selector .close-icon-btn button",()=>t.close()),e.registerForClick("#js-element-structure-btn",e=>n.change(e))}})(bluejay),(function(e){"use strict";e.addModule("elementTiles");const t=[],n=()=>({show:function(){this.h3.textContent=this.title,e.show(this.content)}}),s=()=>({hide:function(){this.h3.innerHTML=this.title+" <small>["+this.count+"]</small>",e.hide(this.content)}}),i=e=>Object.assign({tiles:[],btn:e,collapsed:!1},{addTile:function(e){this.tiles.push(e)}},{change:function(){this.tiles.forEach(e=>{this.collapsed?(this.btn.classList.replace("increase-height","reduce-height"),e.show()):(this.btn.classList.replace("reduce-height","increase-height"),e.hide())}),this.collapsed=!this.collapsed}});e.registerForClick(".collapse-tile-group .oe-i",o=>{let a=e.getParent(o.target,".element-tile-group"),l=e.getDataAttr(a);if(l)t[parseFloat(l)].change();else{let l=i(o.target);e.nodeArray(a.querySelectorAll(".element.tile")).forEach(e=>{l.addTile((e=>{const t=e.querySelector(".element-title"),i=t.textContent,o=e.querySelector(".element-data"),a=o.querySelectorAll("tbody tr").length;return Object.assign({h3:t,title:i,content:o,count:a.toString()},n(),s())})(e))}),l.change(),e.setDataAttr(a,t.length),t.push(l)}})})(bluejay),(function(e){"use strict";e.addModule("eventAuditTrial");const t="#js-event-audit-trail-btn",n=document.querySelector(t);if(null===n)return;const s=document.querySelector("#js-event-audit-trail");null===s&&e.log("Audit Trail content not available in DOM?");let i=!1;const o=t=>{e.show(s),n.classList.add("active"),i=!0},a=t=>{e.hide(s),n.classList.remove("active"),i=!1};e.registerForClick(t,e=>i?a(e):o(e)),e.registerForHover(t,o),e.registerForExit(t,a)})(bluejay),(function(e){"use strict";if(e.addModule("examElementSearch"),null===document.querySelector("#js-search-in-event-popup"))return;e.registerForClick("#js-search-in-event",t=>{const n=t.target,s=document.querySelector("#js-search-in-event-popup"),i=document.querySelector(".main-event"),o=s.querySelector(".close-icon-btn");n.classList.add("selected"),e.show(s),i.classList.add("examination-search-active"),o.addEventListener("mousedown",t=>{t.stopPropagation(),i.classList.remove("examination-search-active"),e.hide(s),n.classList.remove("selected")},{once:!0})})})(bluejay),(function(e){"use strict";e.addModule("filterOptions");const t=[];if(e.nodeArray(document.querySelectorAll(".oe-filter-options")).length<1)return;const n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("active"),this.positionContent(),e.show(this.content),this.mouseOutHide())}}),s=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("active"),e.hide(this.content))}}),i=()=>({positionContent:function(){this.defaultCSS=this.defaultCSS||this.content.className;let t,n,s,i=this.btn.getBoundingClientRect(),o=e.getHiddenElemSize(this.content);i.top<400?(t="top",n=i.top):(t="bottom",n=i.bottom-o.h),i.left<500?(t+="-left",s=i.left):(t+="-right",s=i.right-o.w),this.content.className=this.defaultCSS+" "+t,this.content.style.top=n+"px",this.content.style.left=s+"px"}}),o=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},n(),s(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}},i());e.registerForClick(".oe-filter-options .oe-filter-btn",n=>(n=>{let s=n.target,i=e.getDataAttr(s);if(i)t[parseFloat(i)].change();else{let n=e.getParent(s,".oe-filter-options"),i=o({btn:s,wrapper:n,content:n.querySelector(".filter-options-popup")});i.show(),e.setDataAttr(s,t.length),t.push(i)}})(n))})(bluejay),(function(e){"use strict";if(e.addModule("messagePreview"),null===document.querySelector(".home-messages"))return;e.registerForClick(".js-expand-message",t=>{let n=t.target,s=e.getParent(n,"tr").querySelector(".message");n.classList.contains("expand")?(s.classList.add("expand"),n.classList.replace("expand","collapse")):(s.classList.remove("expand"),n.classList.replace("collapse","expand"))})})(bluejay),(function(e){"use strict";e.addModule("multiPageScroll");let t=e.nodeArray(document.querySelectorAll(".lightning-multipage-scroll"));if(0===t.length)return;const n=()=>({animateScrollTo:function(e){let t=1,n=0,s=this.stack.scrollTop,i=this.pageH*e-s;clearInterval(this.animateID),this.animateID=setInterval(()=>{n=Math.min(1,t/80),this.stack.scrollTop=Math.ceil((e=>e<.5?2*e*e:(4-2*e)*e-1)(n)*i)+s,t+=1,1==n&&clearInterval(this.animateID)},2)}}),s=()=>({pageBtn:function(e){e.matches(".page-num-btn")&&this.animateScrollTo(parseFloat(e.dataset.page))}});t.forEach(e=>{(e=>{e.numOfImgs=e.stack.querySelectorAll("img").length,e.pageH=parseFloat(e.stack.querySelector("img").height+10),e.animateID=null;let t=new DocumentFragment;for(let n=0;n<e.numOfImgs;n++){let s=document.createElement("div");s.className="page-num-btn",s.setAttribute("data-page",n),s.textContent=n+1+"/"+e.numOfImgs,t.appendChild(s)}e.nav.appendChild(t),e.nav.addEventListener("mouseenter",t=>e.pageBtn(t.target),{capture:!0}),e.nav.addEventListener("mousedown",t=>e.pageBtn(t.target),{capture:!0}),Object.assign(e,s(),n())})({nav:e.querySelector(".multipage-nav"),stack:e.querySelector(".multipage-stack")})})})(bluejay),(function(e){"use strict";e.addModule("navHotlist");const t="#js-nav-hotlist-btn",n=document.querySelector(t);if(null===n)return;const s=()=>({show:function(){this.open||(this.open=!0,e.show(this.content),this.mouseOutHide())}}),i=()=>({hide:function(){!1===this.open||this.isLocked||this.isFixed||(this.open=!1,this.btn.classList.remove("active","open"),e.hide(this.content))}}),o=(()=>Object.assign({btn:n,content:document.querySelector("#js-hotlist-panel"),wrapper:document.querySelector("#js-hotlist-panel-wrapper"),open:!1,isLocked:!1,isFixed:!1},{changeState:function(){this.isFixed||(this.open?this.isLocked?(this.isLocked=!1,this.hide()):this.makeLocked():(this.makeLocked(),this.over()))}},{over:function(){this.isFixed||(this.btn.classList.add("active"),this.show())}},{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}},{makeLocked:function(){this.isLocked=!0,this.btn.classList.add("open")}},s(),i(),{fixedOpen:function(e){this.isFixed=e,e?(this.isLocked=!1,this.btn.classList.add("open"),this.btn.classList.remove("active"),this.show()):this.hide()}}))(),a=()=>{n.dataset.fixable&&o.fixedOpen(window.innerWidth>e.settings.cssExtendBrowserSize)};e.registerForClick(t,()=>o.changeState()),e.registerForHover(t,()=>o.over()),e.listenForResize(a),a()})(bluejay),(function(e){"use strict";e.addModule("navLogo");const t="#js-openeyes-btn",n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("open"),e.show(this.content),this.mouseOutHide())}}),s=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("open","active"),e.hide(this.content))}}),i=(()=>{let i=document.querySelector(t);return Object.assign({btn:i,content:document.querySelector("#js-openeyes-info"),wrapper:e.getParent(i,".openeyes-brand"),open:!1},{over:function(){this.btn.classList.add("active")}},{out:function(){this.btn.classList.remove("active")}},{change:function(){this.open?this.hide():this.show()}},n(),s(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}})})();e.registerForClick(t,()=>i.change()),e.registerForHover(t,()=>i.over()),e.registerForExit(t,()=>i.out())})(bluejay),(function(e){"use strict";e.addModule("navShortcuts");const t="#js-nav-shortcuts-btn",n=document.querySelector(t);if(null===n)return;const s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("active"),e.show(this.content),this.mouseOutHide())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("active"),e.hide(this.content))}}),o=(()=>Object.assign({btn:n,content:document.querySelector("#js-nav-shortcuts-subnav"),wrapper:document.querySelector("#js-nav-shortcuts"),open:!1},{change:function(){this.open?this.hide():this.show()}},s(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}}))();e.registerForClick(t,()=>o.change()),e.registerForHover(t,()=>o.show())})(bluejay),(function(e){"use strict";if(e.addModule("notificationBanner"),null===document.querySelector("#oe-admin-notifcation"))return;const t="#oe-admin-notifcation .oe-i",n=document.querySelector("#notification-short"),s=document.querySelector("#notification-full");if(null!==document.querySelector(".oe-login"))return e.hide(n),e.show(s),void(document.querySelector(t).style.display="none");let i=n,o=s,a=!0;const l=(e,t)=>{e.style.display="block",t.style.display="none"};e.registerForHover(t,()=>l(o,i)),e.registerForExit(t,()=>l(i,o)),e.registerForClick(t,()=>{i=a?s:n,o=a?n:s,a=!a,l(i,o)})})(bluejay),(function(e){"use strict";e.addModule("overlayPopup");const t=[{id:"#js-change-context-btn",php:"change-context.php",close:".close-icon-btn"},{id:"#copy-edit-history-btn",php:"previous-history-elements.php",close:".close-icon-btn"},{id:"#copy-edit-anterior-segment-btn",php:"previous-ed-anterior.php",close:".close-icon-btn"},{id:"#js-virtual-clinic-btn",php:"virtual-clinic.php",close:".close-icon-btn"},{id:"#js-delete-event-btn",php:"delete-event.php",close:".js-demo-cancel-btn"},{id:"#js-close-element-btn",php:"close-element.php",close:".js-demo-cancel-btn"},{id:"#js-add-new-event",php:"add-new-event.php",close:".close-icon-btn"},{id:"#js-idg-preview-correspondence",php:"letter-preview.php",close:".close-icon-btn"},{id:"#js-idg-exam-complog",php:"exam-va-COMPlog.php",close:".close-icon-btn"},{id:"#js-duplicate-event-btn",php:"duplicate-event-warning.php",close:".close-icon-btn"},{id:"#js-idg-worklist-ps-add",php:"worklist-PS.php",close:".close-icon-btn"},{id:"#analytics-change-filters",php:"analytics-filters.php",close:".close-icon-btn"},{id:"#js-idg-add-new-contact-popup",php:"add-new-contact.php",close:".close-icon-btn"},{id:"#js-idg-admin-queset-demo",php:"admin-add-queue.php",close:".close-icon-btn"}],n=(t,n,s)=>{e.registerForClick(t,()=>{e.xhr("/idg-php/v3/_load/"+n).then(t=>{const n=document.createElement("div");n.className="oe-popup-wrap",n.innerHTML=t,n.querySelector(s).addEventListener("mousedown",t=>{t.stopPropagation(),e.removeElement(n)},{once:!0}),e.appendTo("body",n)}).catch(e=>console.log("overlayPopup failed to load",e))})};for(let e=0,s=t.length;e<s;e++){let s=t[e];null!==document.querySelector(s.id)&&n(s.id,s.php,s.close)}})(bluejay),(function(e){"use strict";e.addModule("pathSteps");const t=".oe-pathstep-btn";if(null===document.querySelector(t))return;let n=!1;const s=document.createElement("div");s.style.display="none",s.className="oe-pathstep-popup",s.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<h3 class="title"></h3>','<div class="popup-overflow"><div class="data-group">','<table class="data-table"><tbody>',"</tbody></table>","</div></div>",'<div class="step-actions"><div class="flex-layout">','<button class="red hint">Remove PSD</button><button class="green hint">Administer</button>',"</div></div>",'<div class="step-status"></div>'].join(""),e.appendTo("body",s);const i={title:s.querySelector(".title"),closeBtn:s.querySelector(".close-icon-btn .oe-i"),status:s.querySelector(".step-status"),tbody:s.querySelector(".data-table tbody"),actions:s.querySelector(".step-actions"),detailRows:null,locked:!1},o=e=>{let t,n="NA";return"R"!=e&&"B"!=e||(t="R"),"L"!=e&&"B"!=e||(n="L"),`<span class="oe-eye-lat-icons"><i class="oe-i laterality ${t} small"></i><i class="oe-i laterality ${n} small"></i></span>`},a=e=>`<i class="oe-i ${e} small"></i>`,l=(e,t,n=!1)=>{let s=document.createElement("tr");n&&(s.className=n),e.forEach(e=>{let t=document.createElement("td");t.innerHTML=e,s.appendChild(t)}),t.appendChild(s)},r=t=>{let n=document.createDocumentFragment();t.forEach(e=>{l((e=>[o(e[0]),e[1],e[2]])(e.directive),n),e.steps.forEach(e=>{l((e=>(1==e.length&&(e=e.concat(['<em class="fade">to do</em>',""])),[a(e[0]),e[1],e[2]]))(e),n,"administer-details")})}),i.tbody.innerHTML="",i.tbody.appendChild(n),i.detailRows=e.nodeArray(s.querySelectorAll(".administer-details"))},c=()=>{let e=JSON.parse(n.dataset.step);i.title.textContent=e.title,r(e.psd),(e=>{let t="No status set",n="default";switch(e){case"done":t="PSD: Completed at 11:40",n="green";break;case"todo":t="PSD: Waiting to start",n="default";break;case"progress":t="PSD: In progress",n="orange";break;case"problem":t="Issue with PSD",n="red"}i.status.textContent=t,i.status.className=["step-status",n].join(" ")})(e.status)},d=e=>{let t=e?"block":"none",n=e?"table-row":"none";i.title.style.display=t,i.closeBtn.style.display=t,i.actions.style.display=t,i.detailRows.forEach(e=>e.style.display=n)},u=()=>{i.locked=!1,s.style.display="none"},p=(e,t,n=0)=>{s.style.top=e+n+"px",s.style.left=t-360+"px",s.style.display="block"};e.registerForClick(t,e=>{e.target!==n&&(n=e.target,c()),d(!0),i.locked=!0;let t=n.getBoundingClientRect();p(t.top,t.right,-5),window.addEventListener("scroll",u,{capture:!0,once:!0})}),e.registerForHover(t,e=>{if(i.locked)return;n=e.target,c(),d(!1);let t=n.getBoundingClientRect();p(t.bottom,t.right)}),e.registerForExit(t,e=>{i.locked||u()}),e.registerForClick(".close-icon-btn .oe-i",u)})(bluejay),(function(e){"use strict";e.addModule("patientPopups");const t=()=>({show:function(){this.open||(this.open=!0,o(this),e.show(this.popup))}}),n=()=>({hide:function(){!1===this.open||this.isLocked||(this.open=!1,this.btn.classList.remove("active","open"),e.hide(this.popup))}}),s=e=>(e.open=!1,e.isLocked=!1,Object.assign(e,{changeState:function(){this.open?this.isLocked?(this.isLocked=!1,this.hide()):this.makeLocked():(this.makeLocked(),this.over())}},{over:function(){this.btn.classList.add("active"),this.show()}},{out:function(){this.btn.classList.remove("active"),this.hide()}},{makeLocked:function(){this.isLocked=!0,this.btn.classList.add("open")}},t(),n(),{makeHidden:function(){this.open&&(this.isLocked=!1,this.hide())}})),i=[],o=e=>{i.forEach(t=>{t!=e&&t.makeHidden()})};[{btn:"#js-quicklook-btn",popup:"#patient-summary-quicklook"},{btn:"#js-demographics-btn",popup:"#patient-popup-demographics"},{btn:"#js-management-btn",popup:"#patient-popup-management"},{btn:"#js-allergies-risks-btn",popup:"#patient-popup-allergies-risks"},{btn:"#js-charts-btn",popup:"#patient-popup-charts"},{btn:"#js-patient-extra-btn",popup:"#patient-popup-trials"}].forEach(t=>{if(null!==document.querySelector(t.btn)){let n=s({btn:document.querySelector(t.btn),popup:document.querySelector(t.popup)});e.registerForClick(t.btn,()=>n.changeState()),e.registerForHover(t.btn,()=>n.over()),e.registerForExit(t.btn,()=>n.out()),i.push(n)}})})(bluejay),(function(e){"use strict";e.addModule("patientQuickMeta");let t=!1,n=!1,s=null,i=null;const o={},a=()=>{i.style.display="none",t=n=!1,s=null},l=(t,n)=>{i=i||(()=>{const t=document.createElement("div");return t.className="oe-patient-quick-overview",t.style.display="none",t.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<div class="oe-patient-meta">','<div class="patient-name">','<a href="/v3-SEM/patient-overview"><span class="patient-surname">SURNAME</span>, <span class="patient-firstname">First (M.)</span></a>','</div><div class="patient-details">','<div class="hospital-number"><span>ID</span>0000000</div>','<div class="nhs-number"><span>NHS</span>111 222 3333</div>','<div class="patient-gender"><em>Gen</em>Male</div>','<div class="patient-age"><em>Age</em>00y</div>','<div class="quick-overview-content"></div>',"</div></div>"].join(""),e.appendTo("body",t),o.surname=t.querySelector(".patient-surname"),o.first=t.querySelector(".patient-firstname"),o.hospital=t.querySelector(".hospital-number"),o.nhs=t.querySelector(".nhs-number"),o.gender=t.querySelector(".patient-gender"),o.age=t.querySelector(".patient-age"),t})();let s=t.mode,a=t.php,l=JSON.parse(t.patient);if(o.surname.textContent=l.surname,o.first.textContent=l.first,o.hospital.innerHTML="<span>ID</span> "+l.id,o.nhs.innerHTML="<span>NHS</span> "+l.nhs,o.gender.innerHTML="<em>Gen</em> "+l.gender,o.age.innerHTML="<em>Age</em> "+l.age,"side"==s)i.style.top=i.style.left=null,i.classList.add("side-panel");else{i.classList.remove("side-panel");window.innerHeight;i.style.top=n.y+n.height+5+"px",i.style.left=n.x-250+n.width/2+"px"}let r=i.querySelector(".quick-overview-content");r.innerHTML="";let c=setTimeout(()=>r.innerHTML='<i class="spinner"></i>',400);e.xhr("/idg-php/v3/_load/"+a).then(e=>{clearTimeout(c),r.innerHTML=e,i.style.display="block"}).catch(e=>console.log("ed3app php failed to load",e))};e.registerForClick(".js-patient-quick-overview",e=>{let i=e.target;t?n&&s===i?a():(n=!0,s=i,l(i.dataset,i.getBoundingClientRect())):(n=!0,s=e.target,l(s.dataset,s.getBoundingClientRect()))}),e.registerForHover(".js-patient-quick-overview",e=>{n||(s=e.target,l(s.dataset,s.getBoundingClientRect()),t=!0)}),e.registerForExit(".js-patient-quick-overview",e=>{n||a()})})(bluejay),(function(e){"use strict";e.addModule("proView");const t=[],n=e=>({options:function(e){e.lock&&(this.pro=null),0!=e.linkID&&(this.linked=!0,this.linkedProView=i(document.querySelector("#"+e.linkID)),e.lock&&(this.linkedProView.pro=null))}}),s=e=>{let t=e.querySelector(".pro-view-btn"),s=e.querySelector(".data-pro-view"),i=e.querySelector(".data-standard-view"),o={btn:t,oei:t.querySelector(".oe-i"),pro:s,standard:i,inPro:!0,linked:!1};return Object.assign(o,{change:function(){this.inPro?(this.hideShow(this.pro,this.standard),this.icon("expand","collapse")):(this.hideShow(this.standard,this.pro),this.icon("collapse","expand")),this.linked&&this.linkedProView.change(),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}},{icon:function(e,t){this.oei.classList.replace(e,t)}},n())},i=e=>{let t={pro:e.querySelector(".data-pro-view"),standard:e.querySelector(".data-standard-view"),inPro:!0};return Object.assign(t,{change:function(){this.inPro?this.hideShow(this.pro,this.standard):this.hideShow(this.standard,this.pro),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}})};e.registerForClick(".pro-view-btn",n=>{const i=n.target;let o=e.getDataAttr(i);if(o)t[parseFloat(o)].change();else{e.setDataAttr(i,t.length);let n=s(e.getParent(i,".pro-data-view"));n.options(JSON.parse(i.dataset.proview)),n.change(),t.push(n)}})})(bluejay),(function(e){"use strict";e.addModule("problemsPlans");const t=e.nodeArray(document.querySelectorAll(".problems-plans-sortable"));if(t.length<1)return;const n=[],s=(e,t,n)=>({id:e,text:t,info:n});e.nodeArray(t[0].querySelectorAll("li")).forEach(e=>{n.push(s(n.length,e.textContent,e.querySelector(".info").getAttribute("data-tooltip-content")))}),t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach((t,n)=>{e.setDataAttr(t,n)})});let i=n.length+1;const o=(e,t)=>['<span class="drag-handle"><i class="oe-i menu medium pro-theme"></i></span>',e,'<div class="metadata">','<i class="oe-i info small pro-theme js-has-tooltip" data-tooltip-content="',t,'"></i></div>','<div class="remove"><i class="oe-i remove-circle small pro-theme pad"></i></div>'].join(""),a=(s,i)=>{let a=n.findIndex(e=>e.id==s),l=n.findIndex(e=>e.id==i);n[a]=n.splice(l,1,n[a])[0],t.length>1&&t.forEach(t=>{let s=t.querySelectorAll("li");for(let t=0,i=n.length;t<i;t++){let i=n[t],a=s[t];i.id!=e.getDataAttr(a)&&(e.setDataAttr(a,i.id),a.innerHTML=o(i.text,i.info))}})};e.registerForClick(".create-new-problem-plan button",a=>{a.preventDefault();let l=e.getParent(a.target,".create-new-problem-plan").querySelector("input");if(!l||l.value.length<2)return;let r=s(i++,l.value,"Added now!");n.push(r),((e,n)=>{t.forEach(t=>{t.appendChild(e.cloneNode(!0)),p(t.lastChild)})})((t=>{const n=new DocumentFragment,s=document.createElement("li");return s.innerHTML=o(t.text,t.info),e.setDataAttr(s,t.id),n.appendChild(s),n})(r))}),e.registerForClick(".problems-plans-sortable .remove-circle",s=>{let i=e.getParent(s.target,"li"),o=0;for(;null!==(i=i.previousSibling);)o++;t.forEach(t=>{e.removeElement(t.childNodes[o])}),n.splice(o,1)}),document.addEventListener("DOMContentLoaded",()=>{t.forEach(t=>{e.nodeArray(t.querySelectorAll("li")).forEach(e=>{p(e)})})});let l=null;const r=e=>{l=e.target,e.target.parentNode.classList.add("js-sorting-list"),e.dataTransfer.setData("source",l.innerHTML)},c=e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"},d=e=>(e.preventDefault&&e.preventDefault(),!1),u=t=>{if(t.stopPropagation&&t.stopPropagation(),!1!==t.target.parentNode.classList.contains("js-sorting-list"))return t.target.parentNode.classList.remove("js-sorting-list"),l!=t.target&&(l.innerHTML=t.target.innerHTML,t.target.innerHTML=t.dataTransfer.getData("source"),a(e.getDataAttr(l),e.getDataAttr(t.target))),!1},p=e=>{e.setAttribute("draggable","true"),e.addEventListener("dragstart",r,!1),e.addEventListener("dragenter",c,!1),e.addEventListener("dragover",d,!1),e.addEventListener("drop",u,!1)}})(bluejay),(function(e){"use strict";e.addModule("reduceElementHeight");const t=[],n=e=>(e.reduced=!1,Object.assign(e,{change:function(){this.reduced?(this.elem.classList.remove("reduced-height"),this.icon.classList.replace("increase-height-orange","reduce-height")):(this.elem.classList.add("reduced-height"),this.icon.classList.replace("reduce-height","increase-height-orange")),this.reduced=!this.reduced}}));e.registerForClick(".element .js-elem-reduce .oe-i",(s,i)=>{let o=s.target,a=e.getDataAttr(o);if(a)t[parseFloat(a)].change();else{let s=n({elem:e.getParent(o,".element"),icon:o});s.change(),e.setDataAttr(o,t.length),t.push(s)}})})(bluejay),(function(e){"use strict";e.addModule("restrictDataHeightFlag");const t="restrict-data-shown-flag",n=e.getDataAttributeName(),s=[];function i(e,t,n){this.hasScrolled=!1,this.flag=e,this.content=t,this.scrollEndPos=n,this.content.addEventListener("scroll",()=>this.scroll(),{once:!0})}i.prototype.scroll=function(t){this.hasScrolled=!0,this.flag.className+=" fade-out",setTimeout(()=>e.removeElement(this.flag),400)},i.prototype.userClick=function(){this.hasScrolled||o(this.content,this.scrollEndPos)};const o=(e,t)=>{let n=1,s=0,i=setInterval(()=>{s=Math.min(1,n/200),e.scrollTop=Math.ceil((e=>e*(2-e))(s)*t),n+=1,1==s&&clearInterval(i)},2)};(()=>{let o=e.nodeArray(document.querySelectorAll(".restrict-data-shown"));if(o.length<1)return;const a=document.createDocumentFragment(),l=document.createElement("div");l.className=t,a.appendChild(l),o.forEach(e=>{let t=e.querySelector(".restrict-data-content"),o=e.clientHeight,l=t.scrollHeight;if(l>o&&0===t.scrollTop){let r=a.cloneNode(!0),c=r.firstChild;c.setAttribute(n,s.length),e.appendChild(r),s.push(new i(c,t,l-o))}})})(),e.registerForClick("."+t,e=>{s[e.target.getAttribute(n)].userClick()})})(bluejay),(function(e){"use strict";e.addModule("sideNavSelectList");const t=e.nodeArray(document.querySelectorAll(".js-list-filter"));if(0==t.length)return;const n=e.nodeArray(document.querySelectorAll(".js-filter-group"));let s=document.querySelector(".js-list-filter.selected");const i=e=>{n.forEach(t=>{t.style.display=e})};t.forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let n=t.target;n.classList.add("selected"),(t=>{"all"==t?i("block"):(i("none"),e.show(document.querySelector("#"+t)))})(n.dataset.list),s.classList.remove("selected"),s=n})})})(bluejay),(function(e){"use strict";bluejay.addModule("sidebarElementList");let t=document.querySelector(".sidebar-eventlist .oe-element-list"),n=document.querySelectorAll(".element-title");if(n.length<1)return;let s=document.createDocumentFragment();n.forEach((function(e){let t=document.createElement("li");t.innerHTML='<a href="#">'+e.textContent+"</a>",s.appendChild(t)})),t.appendChild(s)})(),(function(e){"use strict";e.addModule("sidebarEventFilter");const t="#js-sidebar-filter-btn",n=document.querySelector(t);if(null===n)return;const s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add("active"),e.show(this.content),this.mouseOutHide())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove("active"),e.hide(this.content))}}),o=(()=>Object.assign({btn:n,content:document.querySelector("#js-sidebar-filter-options"),wrapper:document.querySelector("#js-sidebar-filter"),open:!1},{change:function(){this.open?this.hide():this.show()}},s(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",e=>{e.stopPropagation(),this.hide()},{once:!0})}}))();e.registerForClick(t,()=>o.change()),e.registerForHover(t,()=>o.show())})(bluejay),(function(e){"use strict";if(e.addModule("sidebarQuicklookView"),null===document.querySelector("ul.events"))return;let t=null;const n=t=>{return e.getParent(t,"li").querySelector(".quicklook")},s=()=>({show:function(t){this.open=!0;const n=JSON.parse(t.dataset.quickview);this.icon.className="oe-i-e large "+n.icon,this.titleDate.textContent=n.title+" - "+n.date,e.xhr("/idg-php/v3/_load/sidebar/quick-view/"+n.php).then(e=>{!1!==this.open&&(this.open=!0,this.content.innerHTML=e,this.div.classList.remove("fade-out"),this.div.classList.add("fade-in"))}).catch(e=>console.log("PHP failed to load",e))}}),i=()=>({hide:function(){this.open=!1,this.div.classList.add("fade-out"),this.div.classList.remove("fade-in"),setTimeout(()=>this.div.classList.remove("fade-out"),300)}}),o=(()=>{const t=document.createElement("div");return t.className="oe-event-quick-view",t.id="js-event-quick-view",t.innerHTML=['<div class="event-icon"><i class="oe-i-e large"></i></div>','<div class="title-date">Title - DD Mth YYYY</div>','<div class="audit-trail">Michael Morgan</div>','<div class="quick-view-content"></div>'].join(""),e.appendTo("body",t),Object.assign({div:t,titleDate:t.querySelector(".title-date"),icon:t.querySelector(".event-icon > .oe-i-e"),content:t.querySelector(".quick-view-content"),open:!1},s(),i())})();e.registerForHover(".event .event-type",e=>{(e=>{n(e).classList.add("fade-in"),t=e})(e.target),o.show(e.target)}),e.registerForExit(".event .event-type",e=>{null!=t&&(n(t).classList.remove("fade-in"),t=null),o.hide()})})(bluejay),(function(e){"use strict";e.addModule("textAreaResize");const t=e=>{let t=e.scrollHeight;t<20||(e.style.height="auto",e.style.height=t+"px")};e.extend("resizeTextArea",t),document.addEventListener("input",e=>{e.target.matches("textarea")&&t(e.target)},{capture:!0}),document.addEventListener("DOMContentLoaded",()=>{e.nodeArray(document.querySelectorAll("textarea")).forEach(e=>{t(e)})})})(bluejay),(function(e){"use strict";bluejay.addModule("userPIN");document.addEventListener("input",e=>{e.target.matches(".user-pin-entry")&&(e=>{let t=e.value,n=e.parentNode;n.classList.remove("accepted-pin","wrong-pin"),4===t.length&&("1234"==t?n.classList.add("accepted-pin"):n.classList.add("wrong-pin"))})(e.target)},{capture:!0})})(),(function(e){"use strict";bluejay.addModule("vcScratchPad");const t=document.querySelector("#oe-vc-scratchpad");if(null===t)return;let n,s;t.addEventListener("dragstart",e=>{e.dataTransfer.dropEffect="move";let t=e.target.getBoundingClientRect();n=e.clientX-t.left,s=e.clientY-t.top},!1),t.addEventListener("dragend",e=>{let i=Math.round(e.clientY-s),o=Math.round(e.clientX-n);i=i<1?1:i,o=o<1?1:o,t.style.top=i+"px",t.style.left=o+"px"},!1)})(),(function(e){"use strict";const t=e.addModule("addSelect");t.all=[],t.closeAll=function(){this.all.forEach(e=>e.close())},t.init=function(){console.log("addSelect - init",this);const n=e.nodeArray(document.querySelectorAll(".js-add-select-btn"));n.length<1||n.forEach(e=>{let n=new t.Popup(e);this.all.push(n)})},document.addEventListener("DOMContentLoaded",()=>t.init(),{once:!0})})(bluejay),(function(e){"use strict";const t=bluejay.getModule("addSelect");t.ListOption=function(e,n){let s=e.classList.contains("selected"),i=!1,o=JSON.parse(e.dataset.insert);void 0!==o.dependents&&(i=new t.OptionDependents(o.dependents,n.uniqueId)),this.click=function(){this.toggleState(),n.optionClicked(s,this),0!=i&&i.show(s)},this.toggleState=function(){e.classList.toggle("selected"),s=!s},this.deselect=function(){s&&this.toggleState()},Object.defineProperty(this,"selected",{get:()=>s,set:e=>{s=e,e||$li.removeClass("selected")}}),Object.defineProperty(this,"dependents",{get:()=>!1!==i}),e.addEventListener("mousedown",this.click.bind(this))}})(),(function(e){"use strict";e.getModule("addSelect").OptionDependents=function(t,n){if(void 0===t)return!1;const s="#add-to-"+n+"-";let i=[];t.split(",").forEach(e=>{let t=e.split("."),n={};if(n.div=document.querySelector(s+"listgroup"+t[0]),n.holder=n.div.querySelector(".optional-placeholder"),0==t[1])n.showDefaultText=!0;else{n.showDefaultText=!1,n.lists=[];for(let e=1;e<t.length;e++)n.lists.push(document.querySelector(s+"list"+t[e]))}i.push(n)}),this.show=function(e){e?this.myLists():this.reset()},this.hideAllOptionalLists=function(t){e.nodeArray(t.querySelectorAll(".optional-list")).forEach(t=>{e.hide(t)})},this.myLists=function(){i.forEach(t=>{this.hideAllOptionalLists(t.div),t.showDefaultText?e.show(t.holder):(e.hide(t.holder),t.lists.forEach(t=>{e.show(t)}))})},this.reset=function(){i.forEach(t=>{this.hideAllOptionalLists(t.div),e.show(t.holder)})}}})(bluejay),(function(e){"use strict";const t=e.getModule("addSelect");t.OptionsList=function(n){let s=JSON.parse(n.dataset.options);const i="single"==s.type,o=(s.hasExtraOptions,"true"===s.isOptionalList);this.uniqueId=n.dataset.id,o&&e.hide(n.parentNode);let a=[],l=[];e.nodeArray(n.querySelectorAll("li")).forEach(e=>{let n=new t.ListOption(e,this);a.push(n),n.selected&&n.dependents&&l.push(n)}),this.optionClicked=function(e,t){e&&i&&a.forEach(e=>{e!==t&&e.deselect()})},this.checkForDefaultSelections=(()=>{l.length&&l.forEach(e=>{e.selected=!1,e.click()})})}})(bluejay),(function(e){"use strict";const t=e.getModule("addSelect");t.Popup=function(n){let s=document.querySelector("#"+n.dataset.popup),i=[];this.anchorLeft=!!s.dataset.anchorLeft,this.btn=n,this.popup=s,this.closeBtn=s.querySelector(".close-icon-btn"),this.open=function(){this.position(),t.closeAll(),e.show(s),this.closeBtn.addEventListener("mousedown",this.close.bind(this)),window.addEventListener("scroll",this.close.bind(this),{capture:!0,once:!0})},this.close=function(){s.style.display="none"},this.reset=function(){},e.nodeArray(s.querySelectorAll(".add-options")).forEach(e=>{let n=new t.OptionsList(e);n.checkForDefaultSelections(),i.push(n)}),this.btn.addEventListener("mousedown",this.open.bind(this))},t.Popup.prototype.position=function(){let e=this.btn.getBoundingClientRect(),t=window.innerWidth,n=window.innerHeight,s=n-e.bottom;if(n-s<325&&(s=n-325),this.anchorLeft)this.popup.style.left=e.left+"px";else{let n=e.right-this.popup.getBoundingClientRect().width,s=n<0?n-25:0;this.popup.style.right=t-e.right+s+"px"}this.popup.style.bottom=s+"px"}})(bluejay);