Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";const e={};return console.time("[bluejay] Ready"),console.time("[bluejay] DOM Loaded"),e.extend=(t,n)=>{if("function"!=typeof n)throw new TypeError("[bluejay] [app.js] - only extend with a function: "+t);if(n._bj||t in e)throw new TypeError("[bluejay] [app.js] - already extended with: "+t);e[t]=n,n._bj=!0},e.log=e=>{console.log("[bluejay] "+e)},e.ready=()=>{console.timeEnd("[bluejay] Ready")},e.log("OE JS UI layer [bluejay] ..."),e.log("DEBUG MODE"),e.log("Mustache version: "+Mustache.version),document.addEventListener("DOMContentLoaded",(()=>{e.log("[Modules] - "+e.registeredModules()),console.timeEnd("[bluejay] DOM Loaded")}),{once:!0}),e})();!(function(e){"use strict";const t=(function*(){let e=10;for(;;)yield++e})(),n=()=>t.next().value;function s(){this.map=new Map,this.dataAttr="data-bjc"}e.extend("getKey",n),s.prototype.add=function(e,t){const s=n();return this.map.set(s,e),t.setAttribute(this.dataAttr,s),s},s.prototype.getKey=function(e){let t=e.getAttribute(this.dataAttr);return null!==t&&""!=t&&t},s.prototype.get=function(e){return"string"==typeof e&&(e=parseInt(e,10)),this.map.get(e)},s.prototype.getFirst=function(){return this.map.values().next().value},s.prototype.next=function(e){const t=this.map.keys();let n=t.next();for(;!n.done;){if(n.value===e)return t.next().value;n=t.next()}},s.prototype.prev=function(e){const t=this.map.keys();let n=!1;for(const s of t){if(s===e)return n;n=s}},s.prototype.has=function(e){return this.map.has(e)},s.prototype.delete=function(e){return this.map.delete(e)},e.extend("Collection",s)})(bluejay),(function(e){"use strict";bluejay.extend("customEvent",((e,t)=>{const n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)}))})(),(function(e){"use strict";new URL(window.location).hostname;const t=new Map,n=new Map,s=new Map,i=new Map,o=new Set,a=(e,t,n)=>{if(e.has(t))throw new TypeError("Event Delegation: selector already added : "+t);e.set(t,n)},l=(e,t)=>{const n=e.target;if(n===document)return!1;t.forEach(((t,s)=>{n.matches(s)&&t(e)}))},r=(()=>{let e=0;return{delay:()=>{clearTimeout(e),e=setTimeout((()=>{o.forEach((e=>{e()}))}),150)}}})();function c(e){l(e,n)}function d(e){l(e,t)}function u(e){l(e,s)}window.onresize=()=>r.delay();let p=e=>{document.removeEventListener("mouseenter",c,{capture:!0}),document.removeEventListener("mousedown",d,{capture:!0}),document.removeEventListener("mouseleave",u,{capture:!0}),l(e,t),p=e=>{l(e,t)}};document.addEventListener("mouseenter",c,{capture:!0}),document.addEventListener("mousedown",d,{capture:!0}),document.addEventListener("mouseleave",u,{capture:!0}),document.addEventListener("touchstart",(e=>p(e)),{capture:!0}),document.addEventListener("click",(e=>l(e,i)),{capture:!0}),e.extend("userEnter",((e,t)=>a(n,e,t))),e.extend("userDown",((e,n)=>a(t,e,n))),e.extend("userLeave",((e,t)=>a(s,e,t))),e.extend("userClick",((e,t)=>a(i,e,t))),e.extend("listenForResize",(e=>o.add(e)))})(bluejay),(function(e){"use strict";const t=e=>{e.parentNode.removeChild(e)};const n=(function*(){let e=1;for(;;)++e,yield`bj${e}`})();e.extend("nodeArray",(e=>Array.prototype.slice.call(e))),e.extend("find",((e,t)=>(t||document).querySelector(e))),e.extend("getParent",((e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1})),e.extend("wrap",((e,t="")=>{const n=document.createElement("div"),s=window.getComputedStyle(e);return n.style.width=s.getPropertyValue("width"),n.style.position="relative",n.style.display="inline-block",e.style.width="100%",e.parentNode.insertBefore(n,e),n.appendChild(e),n})),e.extend("unwrap",(e=>{const n=e.parentNode,s=n.parentNode;e.style.width="",s.insertBefore(e,n),t(n)})),e.extend("div",((e,t=!1)=>{const n=document.createElement("div");return n.className=e,t&&(n.innerHTML=t),n})),e.extend("dom",((e,t,n=!1)=>{const s=document.createElement(e);return s.className=t,n&&(s.innerHTML=n),s})),e.extend("remove",t),e.extend("show",((e,t="")=>{null!==e&&(e.style.display=t)})),e.extend("reshow",(e=>{null!==e&&(e.style.display="")})),e.extend("hide",(e=>{null!==e&&(e.style.display="none")})),e.extend("empty",(e=>{e.firstChild&&(e.textContent=null)})),e.extend("xhr",((t,n=!1)=>(e.log("[XHR] - "+t),new Promise(((s,i)=>{let o=new XMLHttpRequest;o.open("GET",t),o.onreadystatechange=function(){4===o.readyState&&(o.status>=200&&o.status<300?(e.log("[XHR] - Success"),o.token=n,s({html:o.responseText,token:n})):(e.log("[XHR] - Failed"),i(this.status+" "+this.statusText)))},o.send()}))))),e.extend("getToken",(()=>n.next().value)),e.extend("loadJS",((t,n=!1)=>(e.log("[JS script] - "+t),new Promise(((s,i)=>{const o=document.createElement("script");o.src=t,n&&o.setAttribute("crossorigin",""),o.onload=()=>{setTimeout((()=>{e.log("[JS loaded] - "+t),s()}),100)},o.onerror=()=>e.log("[JS ERROR ] - "+t),document.head.appendChild(o)}))))),e.extend("getHiddenElemSize",(e=>{e.style.visibility="hidden",e.style.display="";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="",e.style.display="none",t})),e.extend("idgReporter",(e=>{let t="idg-js-ui-message-out",n=document.getElementById(t),s=document.createElement("li");null===n&&(n=document.createElement("ul"),n.id=t,n.style="position:fixed; bottom:10px; right:10px; z-index:9999; background:orange; padding:10px; list-style-position:inside; max-height:vh90; overflow-y: scroll; font-size:14px;",document.body.appendChild(n));let i=n.children.length;s.appendChild(document.createTextNode(i+" - "+e)),n.appendChild(s)})),e.extend("clock24",(e=>e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")))})(bluejay),(function(e){"use strict";const t=[],n=new Map;e.extend("addModule",(e=>t.push(e))),e.extend("registeredModules",(()=>(t.sort(),t.join(", ")))),e.extend("namespace",(e=>(n.has(e)||n.set(e,{}),n.get(e))))})(bluejay),(function(e){"use strict";const t=()=>({list:new Set,add(e){return this.list.add(e),this.list.has(e)},remove(e){this.list.remove(e)},size(){return this.list.size},notify(){let e=this.list.values();for(let t of e)t()}});bluejay.extend("ModelViews",(()=>({views:Object.create(t())})))})(),(function(e){"use strict";let t=window.innerWidth,n=window.innerHeight;e.listenForResize((()=>{t=window.innerWidth,n=window.innerHeight}));const s=(e=!1)=>"data-"+(e?"bluejay-"+e:"bluejay");e.extend("settings",(t=>{switch(t){case"cssHeaderHeight":return 60;case"cssExtended":return 1440;case"cssHotlistFixed":return 1890;case"idgPHPLoadURL":return"/idg-php/v3/_load/";default:return e.log("Setting request not recognised: "+t),null}})),e.extend("getWinH",(()=>n)),e.extend("getWinW",(()=>t)),e.extend("getDataAttributeName",s),e.extend("setDataAttr",((e,t)=>{e.setAttribute(s(),t)})),e.extend("getDataAttr",(e=>{const t=s();return!!e.hasAttribute(t)&&e.getAttribute(t)}))})(bluejay),(function(e){"use strict";if(null===document.querySelector(".openers-menu"))return;const t="active",n="show",s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),this.panel.classList.add(n),this.panel.style.pointerEvents="auto")}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(t),this.panel.classList.remove(n),this.panel.style.pointerEvents="none")}}),o="#js-openers-menu-btn";if(null===document.querySelector(o))return;const a=(l={btn:document.querySelector(o),panel:document.querySelector(".menu-info"),open:!1},Object.assign(l,{change:function(){this.open?this.hide():this.show()}},s(),i()));var l;e.userDown(o,(()=>a.change())),e.userEnter(o,(()=>a.show())),e.userLeave(".openers-menu",(()=>a.hide()))})(bluejay),(function(e){"use strict";e.addModule("GUI-btnShowContent");const t="active",n=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(t),e.show(this.content,"block"))}}),s=()=>({hide:function(){this.open&&(this.open=!1,this.btn.classList.remove(t),e.hide(this.content))}}),i=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},n(),s());[{btn:"js-nav-shortcuts-btn",wrapper:"js-nav-shortcuts",contentID:"js-nav-shortcuts-subnav"},{btn:"js-nav-patientgroups-btn",wrapper:"js-patientgroups-panel-wrapper",contentID:"js-patientgroups-panel"},{btn:"js-header-print-dropdown-btn",wrapper:"js-header-print-dropdown",contentID:"js-header-print-subnav"},{btn:"js-sidebar-filter-btn",wrapper:"js-sidebar-filter",contentID:"js-sidebar-filter-options"},{btn:"js-sync-btn",wrapper:"js-sync-data",contentID:"js-sync-options"}].forEach((t=>{const n=document.getElementById(t.btn);if(null!==n){const s=i({btn:n,content:document.getElementById(t.contentID),open:!1});e.userDown(`#${t.btn}`,(()=>s.change())),e.userEnter(`#${t.btn}`,(()=>s.show())),e.userLeave(`#${t.wrapper}`,(()=>s.hide()))}}))})(bluejay),(function(e){"use strict";e.addModule("collapseExpand");const t=new e.Collection,n=()=>({show:function(){e.show(this.content,"block"),this.btn.classList.replace("expand","collapse"),this.open=!0}}),s=()=>({hide:function(){e.hide(this.content),this.btn.classList.replace("collapse","expand"),this.open=!1}}),i=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},n(),s()),o=(n,s)=>{let o,a=n.target,l=t.getKey(a);l?o=t.get(l):(o=i({btn:a,content:e.find(".collapse-"+s+"-content",a.parentNode),open:a.classList.contains("collapse")}),t.add(o,a)),o.change()};e.userDown(".collapse-data-header-icon",(e=>o(e,"data"))),e.userDown(".collapse-group > .header-icon",(e=>o(e,"group"))),e.userDown(".collapse-hotlist > .header-icon",(e=>o(e,"hotlist")))})(bluejay),(function(e){"use strict";e.addModule("comments");e.userDown(".js-add-comments",(t=>{const n=t.target,s=JSON.parse(n.dataset.idgdemo);if(e.hide(n),s.bilateral){const t=document.querySelector("#"+s.id+"-right"),i=document.querySelector("#"+s.id+"-left");e.show(t,"block"),e.show(i,"block"),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",(()=>{e.show(n),e.hide(t),e.hide(i)}),{once:!0}),i.querySelector(".js-remove-add-comments").addEventListener("mousedown",(()=>{e.show(n),e.hide(t),e.hide(i)}),{once:!0})}else{const t=document.querySelector("#"+s.id);e.show(t,"block"),t.querySelector("textarea").focus(),t.querySelector(".js-remove-add-comments").addEventListener("mousedown",(()=>{e.show(n),e.hide(t)}),{once:!0})}}))})(bluejay),(function(e){"use strict";e.addModule("commentHotlist");const t=new e.Collection,n=()=>({reset(){this.editMode=!1,this.icon("comment"),e.hide(this.elem.textarea),e.hide(this.elem.userComment)}}),s=()=>({show(){this.editMode=!1,this.icon("edit");let t=e.wrapQtags(this.comment);this.elem.userComment.innerHTML=t.DOMString,this.comment=t.text,e.hide(this.elem.textarea),e.show(this.elem.userComment,"block")}}),i=()=>({edit(){this.editMode=!0,this.icon("save"),e.show(this.elem.textarea,"block"),e.hide(this.elem.userComment),this.elem.textarea.value=this.comment,e.resizeTextArea(this.elem.textarea),setTimeout((()=>this.elem.textarea.focus()),20);const t=e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),this.update(),this.elem.textarea.removeEventListener("keydown",t,!1))};this.elem.textarea.addEventListener("keydown",t,!1)}}),o=()=>({icon(t){switch(this.elem.icon.classList.remove("comments","comments-added","save","active"),t){case"comment":this.elem.icon.classList.add("comments");break;case"edit":this.elem.icon.classList.add("comments-added");break;case"save":this.elem.icon.classList.add("save","active");break;default:e.log(`commentHotlist - unknown icon: ${t}`)}}}),a=()=>({userClick(){this.editMode?this.update():this.edit()}}),l=()=>({update(){let e=this.elem.textarea.value.trim();e.length?(this.comment=e,this.show()):(this.comment="",this.reset())}}),r=(e,t,r="")=>{const c=['<textarea placeholder="Comments" rows="1" class="cols-full js-allow-qtags" style="display:none"></textarea>','<div class="user-comment" style="display:none">{{comment}}</div>'].join("");let d=document.createElement("div");d.className="patient-comments",d.innerHTML=Mustache.render(c,{comment:r}),t.appendChild(d);let u=d.querySelector("textarea"),p=d.querySelector(".user-comment");return Object.assign({editMode:!1,comment:r,elem:{icon:e,textarea:u,userComment:p}},n(),s(),i(),o(),a(),l())};e.userDown(".oe-hotlist-panel .js-comment-icon",(n=>{const s=n.target;let i=t.getKey(s);if(i){t.get(i).userClick()}else{let n=e.getParent(s,"tr").querySelector(".js-patient-comment"),i=r(s,n);i.edit(),t.add(i,s)}})),document.addEventListener("DOMContentLoaded",(()=>{e.nodeArray(document.querySelectorAll(".oe-hotlist-panel .activity-list tr")).forEach((e=>{if(e.hasAttribute("data-comment")){let n=JSON.parse(e.dataset.comment);if(n.comment){let s=e.querySelector(".oe-i.comments"),i=e.querySelector(".js-patient-comment"),o=r(s,i,n.comment);o.show(),t.add(o,s)}}}))}),{once:!0})})(bluejay),(function(e){"use strict";e.addModule("copyToClipboard");const t=".js-clipboard-copy";if(null===document.querySelector(t))return;e.nodeArray(document.querySelectorAll(t)).forEach((e=>{e.style.cursor="pointer"}));const n=t=>{let n=t.getBoundingClientRect(),s=n.right-n.width/2,i=n.top-5;const o=document.createElement("div");o.className="oe-tooltip fade-out",o.innerHTML="Copied",o.style.width="80px",o.style.top=i-30+"px",o.style.left=s-40+"px",document.body.appendChild(o),setTimeout((()=>e.remove(o)),2500)};e.userDown(t,(t=>(t=>{if(navigator.clipboard)navigator.clipboard.writeText(t.textContent).then((()=>{e.log("[ASYNC] copied text to clipboard"),n(t)})).catch((t=>{e.log("failed to copy text to clipboard")}));else{const s=document.createElement("input");s.value=t.textContent,s.style.position="absolute",s.style.top="-200px",document.body.appendChild(s),s.select(),document.execCommand("copy"),n(t),e.remove(s)}})(t.target)))})(bluejay),(function(e){"use strict";e.addModule("elementTiles");const t=[],n=()=>({show:function(){this.h3.textContent=this.title,e.show(this.content,"block")}}),s=()=>({hide:function(){this.h3.innerHTML=this.title+" <small>["+this.count+"]</small>",e.hide(this.content)}}),i=e=>Object.assign({tiles:[],btn:e,collapsed:!1},{addTile:function(e){this.tiles.push(e)}},{change:function(){this.tiles.forEach((e=>{this.collapsed?(this.btn.classList.replace("increase-height","reduce-height"),e.show()):(this.btn.classList.replace("reduce-height","increase-height"),e.hide())})),this.collapsed=!this.collapsed}});e.userDown(".collapse-tile-group .oe-i",(o=>{let a=e.getParent(o.target,".element-tile-group"),l=e.getDataAttr(a);if(l)t[parseFloat(l)].change();else{let l=i(o.target);e.nodeArray(a.querySelectorAll(".element.tile")).forEach((e=>{l.addTile((e=>{const t=e.querySelector(".element-title"),i=t.textContent,o=e.querySelector(".element-data"),a=o.querySelectorAll("tbody tr").length;return Object.assign({h3:t,title:i,content:o,count:a.toString()},n(),s())})(e))})),l.change(),e.setDataAttr(a,t.length),t.push(l)}}))})(bluejay),(function(e){"use strict";e.addModule("fastDatePicker");const t=Date.now(),n=new Date(t),s=Object.assign({pickDate:null,inputDate:null,get date(){return this.pickDate},set date(e){this.pickDate=e,this.views.notify()},get userDate(){return null!=this.inputDate&&this.inputDate},set userDate(e){this.inputDate=e},changeMonth(e){this.pickDate.setMonth(e),this.views.notify()},changeFullYear(e){this.pickDate.setFullYear(e),this.views.notify()}},e.ModelViews()),i=(()=>{let t;const i=(e,n)=>{if(e.getMonth()==s.date.getMonth()&&e.getFullYear()==s.date.getFullYear()){t.querySelector("#js-fast-date-"+e.getDate()).classList.add(n)}};return s.views.add((()=>{const e=s.date.getFullYear(),o=s.date.getMonth(),a=new Date(e,o,1).getDay(),l=new Date(e,o+1,0).getDate(),r=[],c=[],d=[];for(let t=(a||7)-1,n=new Date(e,o,0).getDate();t>0;t--,n--)r.push(n);for(let e=1;e<=l;e++)c.push(e);const u=42-(r.length+c.length);for(let e=1;e<=u;e++)d.push(e);r.reverse();const p=Mustache.render('{{#prev}}<div class="prev">{{.}}</div>{{/prev}}',{prev:r}),h=Mustache.render('{{#current}}<div id="js-fast-date-{{.}}">{{.}}</div>{{/current}}',{current:c}),m=Mustache.render('{{#next}}<div class="next">{{.}}</div>{{/next}}',{next:d});t.innerHTML=p+h+m,i(n,"today"),0!=s.userDate&&i(s.userDate,"selected")})),{reset:()=>{t=null},build:n=>{t=e.div("date-grid"),t.innerHTML=Mustache.render('{{#divs}}<div class="prev">{{.}}</div>{{/divs}}',{divs:new Array(42).fill("")}),n.appendChild(t)}}})(),o=(()=>{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let n,i;return s.views.add((()=>{const e=n.children[s.date.getMonth()];i&&i.classList.remove("selected"),e.classList.add("selected"),i=e})),{reset:()=>{n=null,i=null},build:s=>{n=e.div("month"),n.innerHTML=Mustache.render("{{#months}}<div>{{.}}</div>{{/months}}",{months:t}),s.appendChild(n)},getMonthNum:e=>t.indexOf(e),getMonthName:e=>t[e]}})(),a=(()=>{let t,n,i,o=!1;const a=()=>{const e=s.date.getFullYear();return{c:Math.floor(e/100),y:parseFloat(e.toString().substring(2))}};return s.views.add((()=>{const e=a();e.c=20==e.c?1:0,n.c.forEach((e=>e.classList.remove("selected"))),n.y.forEach((e=>e.classList.remove("selected"))),n.c[e.c].classList.add("selected"),n.y[e.y].classList.add("selected"),i.scrollTo({top:38.5*e.y-95,left:0,behavior:o?"smooth":"auto"}),o=!0})),{reset:()=>{t=null,n=null,i=null,o=!1},build:s=>{const o=['<div class="century">{{#century}}<div>{{.}}</div>{{/century}}</div>','<ul class="years">{{#years}}<li>{{.}}</li>{{/years}}</ul>'].join(""),a=Array.from(Array(100).keys()).map((e=>e<10?`0${e}`:e));t=e.div("year"),t.innerHTML=Mustache.render(o,{century:["19","20"],years:a}),i=t.querySelector(".years"),n={c:t.querySelector(".century").childNodes,y:i.childNodes},s.append(t)},getYearUnits:a}})(),l=(()=>{let r,c,d=!1;const u=()=>{if(d)return d=!1,void r.focus();i.reset(),o.reset(),a.reset(),document.removeEventListener("blur",l.remove,{capture:!0}),e.remove(c),c=null,r=null};return{show:n=>{if(n.isSameNode(r))return;r=n;const d=r.getBoundingClientRect();c=e.div("fast-date-picker"),c.style.left=d.right-430+"px",c.style.top=d.bottom+"px",d.left<430&&(c.style.left=d.left+"px"),d.bottom+240>e.getWinH()&&(c.style.top=d.top-240+"px"),a.build(c),o.build(c),i.build(c),document.body.appendChild(c),(()=>{let e,n=!1;if(r.value&&/^\d{1,2} [a-z]{3} \d{4}/i.test(r.value)&&(e=Date.parse(r.value),!isNaN(e))){const t=new Date(e),s=t.getFullYear();s>1900&&s<2099&&(n=t)}n?(s.userDate=n,s.date=new Date(e)):s.date=new Date(t)})(),document.addEventListener("blur",l.remove,{capture:!0})},remove:u,changeDate:(e,t)=>{d=!0;const i=parseFloat(e.textContent),l=a.getYearUnits();switch(t){case"month":s.changeMonth(o.getMonthNum(e.textContent));break;case"century":if(i==l.c)return;19==i?s.changeFullYear(1999):s.changeFullYear(n.getFullYear());break;case"year":let t=i-l.y;s.changeFullYear(s.date.getFullYear()+t)}},selectDate:e=>{const t=parseFloat(e.textContent);let n=s.date.getMonth();e.classList.contains("prev")&&s.changeMonth(n-1),e.classList.contains("next")&&s.changeMonth(n+1),s.date.setDate(t),r.value=(e=>e.getDate()+" "+o.getMonthName(e.getMonth())+" "+e.getFullYear())(s.date),u()}}})();document.addEventListener("focus",(e=>{e.target.matches("input.date")&&l.show(e.target)}),{capture:!0}),e.userDown(".fast-date-picker .month > div",(e=>l.changeDate(e.target,"month"))),e.userDown(".fast-date-picker .century > div",(e=>l.changeDate(e.target,"century"))),e.userDown(".fast-date-picker .years li",(e=>l.changeDate(e.target,"year"))),e.userDown(".fast-date-picker .date-grid > div",(e=>l.selectDate(e.target)))})(bluejay),(function(e){"use strict";e.addModule("fastDateRange");if(null==document.querySelector(".fast-date-range"))return;const t=document.querySelector(".js-filter-date-to"),n=document.querySelector(".js-filter-date-from"),s=document.getElementsByName("show-all-date-range")[0],i=Date.now(),o=new Date(i),a=864e5,l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=e=>e.getDate()+" "+l[e.getMonth()]+" "+e.getFullYear(),c=(e,i)=>{t.value=r(e),n.value=r(i),s.checked=!1},d=e=>c(e,e),u=e=>{let t=o.getDay(),n=i+a*(1-t)+a*e;c(new Date(n),new Date(n+4*a))},p=e=>{let t=o.getFullYear(),n=o.getMonth()+e;n>11&&(n=0,t+=1),n<0&&(n=11,t-=1),c(new Date(t,n,1),new Date(t,n+1,0))};e.userDown(".fast-date-range .range",(t=>{const n=t.target;if(!n.hasAttribute("data-range"))return;const s=n.getAttribute("data-range");switch(s){case"yesterday":d(new Date(i-a));break;case"today":d(o);break;case"tomorrow":d(new Date(i+a));break;case"last-week":u(-7);break;case"this-week":u(0);break;case"next-week":u(7);break;case"last-month":p(-1);break;case"this-month":p(0);break;case"next-month":p(1);break;default:e.log("[fastDateRange] unknown range request: "+s)}}))})(bluejay),(function(e){"use strict";const t=e.nodeArray(document.querySelectorAll(".hidden"));t.length&&t.forEach((t=>{e.hide(t),t.classList.remove("hidden")}));const n=e.nodeArray(document.querySelectorAll(".tr-collapse"));n.length&&n.forEach((e=>{e.style.visibility="collapse",e.classList.remove("tr-collapse")}))})(bluejay),(function(e){"use strict";if(e.addModule("messagePreview"),null===document.querySelector(".home-messages"))return;e.nodeArray(document.querySelectorAll(".js-message .message")).forEach((e=>{e.scrollWidth<=e.clientWidth&&(e.parentNode.nextSibling.querySelector(".js-expand-message").style.display="none")}));e.userDown(".js-expand-message",(t=>{let n=t.target,s=e.getParent(n,"tr").querySelector(".message");n.classList.contains("expand")?(s.classList.add("expand"),n.classList.replace("expand","collapse")):(s.classList.remove("expand"),n.classList.replace("collapse","expand"))}))})(bluejay),(function(e){"use strict";e.addModule("navHotlist");const t="active",n="open",s="#js-nav-hotlist-btn",i=document.querySelector(s);if(null===i)return;const o=()=>({over:function(){this.isFixed||(this.btn.classList.add(t),this.show())}}),a=()=>({show:function(){this.open||(this.open=!0,e.show(this.content,"block"))}}),l=()=>({hide:function(){!this.open||this.isLocked||this.isFixed||(this.open=!1,this.btn.classList.remove(t,n),e.hide(this.content))}}),r=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(n)}}),c=()=>({fixedOpen:function(e){this.isFixed=e,e?(this.isLocked=!1,this.btn.classList.add(n),this.btn.classList.remove(t),this.show()):this.hide()}}),d=Object.assign({btn:i,content:document.getElementById("js-hotlist-panel"),open:!1,isLocked:!1,isFixed:!1},{changeState:function(){this.isFixed||(this.open?this.isLocked?(this.isLocked=!1,this.hide()):this.makeLocked():(this.makeLocked(),this.over()))}},o(),r(),a(),l(),c()),u=()=>{"true"===i.dataset.fixable&&d.fixedOpen(window.innerWidth>e.settings("cssHotlistFixed"))};e.userDown(s,(()=>d.changeState())),e.userEnter(s,(()=>d.over())),e.userLeave("#js-hotlist-panel-wrapper",(()=>d.hide())),e.listenForResize(u),u()})(bluejay),(function(e){"use strict";e.addModule("navLogo");const t="active",n="open",s="#js-openeyes-btn";null!==document.querySelector(".oe-login")&&document.querySelector(s).classList.add(t);const i=()=>({over:function(){this.btn.classList.add(t)}}),o=()=>({out:function(){this.btn.classList.remove(t)}}),a=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(n),e.show(this.content,"block"))}}),l=()=>({hide:function(){this.open&&(this.open=!1,this.btn.classList.remove(n,t),e.hide(this.content))}}),r=Object.assign({btn:document.querySelector(s),content:document.querySelector("#js-openeyes-info"),open:!1},i(),o(),{change:function(){this.open?this.hide():this.show()}},a(),l());e.userDown(s,(()=>r.change())),e.userEnter(s,(()=>r.over())),e.userLeave(s,(()=>r.out())),e.userLeave(".openeyes-brand",(()=>r.hide()))})(bluejay),(function(e){"use strict";if(e.addModule("notificationBanner"),null===document.querySelector("#oe-admin-notifcation"))return;const t="#oe-admin-notifcation .oe-i",n=document.querySelector("#notification-short"),s=document.querySelector("#notification-full");if(null!==document.querySelector(".oe-login"))return e.hide(n),e.show(s,"block"),void(document.querySelector(t).style.display="none");let i=n,o=s,a=!0;const l=(e,t)=>{e.style.display="block",t.style.display="none"};e.userEnter(t,(()=>l(o,i))),e.userLeave(t,(()=>l(i,o))),e.userDown(t,(()=>{i=a?s:n,o=a?n:s,a=!a,l(i,o)}))})(bluejay),(function(e){"use strict";e.addModule("overlayPopup");const t=[{id:"#js-idg-popup-content-template",php:"_popup-content-template.php"},{id:"#js-change-context-btn",php:"change-context.php"},{id:"#copy-edit-history-btn",php:"previous-history-elements.php"},{id:"#copy-edit-anterior-segment-btn",php:"previous-ed-anterior.php"},{id:"#js-virtual-clinic-btn",php:"virtual-clinic.php"},{id:"#js-delete-event-btn",php:"delete-event.php"},{id:"#js-close-element-btn",php:"close-element.php"},{id:"#js-add-new-event",php:"add-new-event.php"},{id:"#js-idg-preview-correspondence",php:"letter-preview.php"},{id:"#js-idg-exam-complog",php:"exam-va-COMPlog.php"},{id:"#js-duplicate-event-btn",php:"duplicate-event-warning.php"},{id:"#js-idg-worklist-ps-add",php:"worklist-PS.php"},{id:"#analytics-change-filters",php:"analytics-filters.php"},{id:"#js-idg-add-new-contact-popup",php:"add-new-contact.php"},{id:"#js-idg-admin-queset-demo",php:"admin-add-queue.php"},{id:"#js-idg-search-query-save",php:"query-save.php"},{id:"#js-idg-search-all-searches",php:"query-all-searches.php"}],n=(t,n)=>{e.userDown(t,(()=>{e.xhr("/idg-php/v3/_load/"+n).then((t=>{const n=document.createElement("div");n.className="oe-popup-wrap",n.innerHTML=t.html,n.querySelector(".close-icon-btn").addEventListener("mousedown",(t=>{t.stopPropagation(),e.remove(n)}),{once:!0}),document.body.appendChild(n)})).catch((e=>console.log("OverlayPopup failed to load: Err msg -",e)))}))};for(let e=0,s=t.length;e<s;e++){let s=t[e];null!==document.querySelector(s.id)&&n(s.id,s.php)}})(bluejay),(function(e){"use strict";e.addModule("overlayPopupJSON");e.userDown(".js-idg-demo-popup-json",(t=>{let n;if(void 0===t.target.dataset.idgDemo)throw new Error("overlayPopupJSON: No php file info? Needs data-idg-demo=json");n=JSON.parse(t.target.dataset.idgDemo).php,e.xhr("/idg-php/v3/_load/"+n).then((t=>{const n=document.createElement("div");n.className="oe-popup-wrap",n.innerHTML=t.html,document.body.append(n);let s=n.querySelector(".close-icon-btn");s&&s.addEventListener("mousedown",(t=>{t.stopPropagation(),e.remove(n)}),{once:!0})})).catch((e=>console.log("overlayPopupJSON: Failed to load",e)))}))})(bluejay),(function(e){"use strict";e.addModule("patientPopups");const t="active",n="open",s=[{btn:"#js-quicklook-btn",content:"#patient-summary-quicklook"},{btn:"#js-demographics-btn",content:"#patient-popup-demographics"},{btn:"#js-management-btn",content:"#patient-popup-management"},{btn:"#js-allergies-risks-btn",content:"#patient-popup-allergies-risks"},{btn:"#js-charts-btn",content:"#patient-popup-charts"},{btn:"#js-patient-extra-btn",content:"#patient-popup-trials"}],i=()=>({over:function(){this.btn.classList.add(t),this.show()}}),o=()=>({out:function(e){e.relatedTarget!==this.content&&(this.hide(),this.btn.classList.remove(t))}}),a=()=>({show:function(){this.open||(this.open=!0,d(this),this.btn.classList.add(n),e.show(this.content,"block"))}}),l=()=>({hide:function(){!1===this.open||this.isLocked||(this.open=!1,this.btn.classList.remove(t,n),e.hide(this.content))}}),r=()=>({makeLocked:function(){this.isLocked=!0,this.btn.classList.add(n)}}),c=e=>(e.open=!1,e.isLocked=!1,Object.assign(e,{change:function(){this.open?this.hide():this.show()}},i(),o(),r(),a(),l(),{makeHidden:function(){this.open&&(this.isLocked=!1,this.hide())}})),d=e=>{s.forEach((t=>{t.popup!=e&&t.popup.makeHidden()}))};s.forEach((t=>{let n=document.querySelector(t.btn);if(null!==n){let s=c({btn:n,content:document.querySelector(t.content)});e.userDown(t.btn,(()=>s.change())),e.userEnter(t.btn,(()=>s.over())),e.userLeave(t.btn,(e=>s.out(e))),e.userLeave(t.content,(e=>s.out(e))),t.popup=s}}))})(bluejay),(function(e){"use strict";e.addModule("patientQuickMeta");let t=!1,n=!1,s=null,i=null,o=null,a=window.innerHeight;const l={},r=()=>{i.style.display="none",t=n=!1,s=null},c=(r,c)=>{if(s===r&&t)return n=!0,void e.show(o,"block");i=i||(()=>{const e=document.createElement("div");return e.className="oe-patient-quick-overview",e.style.display="none",e.innerHTML=['<div class="close-icon-btn"><i class="oe-i remove-circle medium"></i></div>','<div class="oe-patient-meta">','<div class="patient-name">','<a href="/v3-SEM/patient-overview"><span class="patient-surname">SURNAME</span>, <span class="patient-firstname">First (M.)</span></a>','</div><div class="patient-details">','<div class="hospital-number"><span>ID</span>0000000</div>','<div class="nhs-number"><span>NHS</span>111 222 3333</div>','<div class="patient-gender"><em>Gen</em>Male</div>','<div class="patient-age"><em>Age</em>00y</div>',"</div></div>",'<div class="quick-overview-content"></div>'].join(""),document.body.appendChild(e),o=e.querySelector(".close-icon-btn"),l.surname=e.querySelector(".patient-surname"),l.first=e.querySelector(".patient-firstname"),l.hospital=e.querySelector(".hospital-number"),l.nhs=e.querySelector(".nhs-number"),l.gender=e.querySelector(".patient-gender"),l.age=e.querySelector(".patient-age"),e})(),t=!0,n=c,s=r;let d=r.dataset,u=r.getBoundingClientRect(),p=d.mode,h=d.php,m=JSON.parse(d.patient);l.surname.textContent=m.surname,l.first.textContent=m.first,l.hospital.innerHTML="<span>ID</span> "+m.id,l.nhs.innerHTML="<span>NHS</span> "+m.nhs,l.gender.innerHTML="<em>Gen</em> "+m.gender,l.age.innerHTML="<em>Age</em> "+m.age,i.style.cssText=" ","float"==p?(i.classList.remove("side-panel"),a-u.y>300?i.style.top=u.y+u.height+5+"px":i.style.bottom=a-u.top+10+"px",i.style.left=u.x-250+u.width/2+"px"):i.classList.add("side-panel");let g=i.querySelector(".quick-overview-content");g.innerHTML="";let y=setTimeout((()=>g.innerHTML='<i class="spinner"></i>'),400);c?e.show(o,"block"):e.hide(o),e.xhr("/idg-php/v3/_load/"+h).then((e=>{clearTimeout(y),t&&(g.innerHTML=e.html,i.style.display="block")})).catch((e=>console.log("ed3app php failed to load",e)))};e.userDown(".js-patient-quick-overview",(e=>{let i=e.target;t&&n&&s===i?r():c(i,!0)})),e.userEnter(".js-patient-quick-overview",(e=>{n||c(e.target,!1)})),e.userLeave(".js-patient-quick-overview",(e=>{n||r()})),e.userDown(".oe-patient-quick-overview .close-icon-btn .oe-i",r),e.listenForResize((()=>a=window.inneHeight))})(bluejay),(function(e){"use strict";e.addModule("proView");const t=[],n=e=>({options:function(e){e.lock&&(this.pro=null),0!=e.linkID&&(this.linked=!0,this.linkedProView=i(document.querySelector("#"+e.linkID)),e.lock&&(this.linkedProView.pro=null))}}),s=e=>{let t=e.querySelector(".pro-view-btn"),s=e.querySelector(".data-pro-view"),i=e.querySelector(".data-standard-view"),o={btn:t,oei:t.querySelector(".oe-i"),pro:s,standard:i,inPro:!0,linked:!1};return Object.assign(o,{change:function(){this.inPro?(this.hideShow(this.pro,this.standard),this.icon("expand","collapse")):(this.hideShow(this.standard,this.pro),this.icon("collapse","expand")),this.linked&&this.linkedProView.change(),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}},{icon:function(e,t){this.oei.classList.replace(e,t)}},n())},i=e=>{let t={pro:e.querySelector(".data-pro-view"),standard:e.querySelector(".data-standard-view"),inPro:!0};return Object.assign(t,{change:function(){this.inPro?this.hideShow(this.pro,this.standard):this.hideShow(this.standard,this.pro),this.inPro=!this.inPro}},{hideShow:function(e,t){e&&(e.style.display="none"),t&&(t.style.display="block")}})};e.userDown(".pro-view-btn",(n=>{const i=n.target;let o=e.getDataAttr(i);if(o)t[parseFloat(o)].change();else{e.setDataAttr(i,t.length);let n=s(e.getParent(i,".pro-data-view"));n.options(JSON.parse(i.dataset.proview)),n.change(),t.push(n)}}))})(bluejay),(function(e){"use strict";if(e.addModule("syncData"),null==document.getElementById("js-sync-data"))return;const t=document.querySelector(".sync-data .sync-btn"),n=document.querySelector(".sync-data .last-sync"),s=document.querySelector(".sync-data .sync-interval");let i=null;const o=()=>n.textContent=e.clock24(new Date(Date.now())),a=e=>{if(clearInterval(i),e){const n=e>1?"mins":"min";s.textContent=`${e} ${n}`,i=setInterval((()=>o()),6e4*e),o(),t.classList.add("on")}else s.textContent="Sync OFF",t.classList.remove("on")};a(1),e.userClick(".sync-options button",(e=>{a(parseInt(e.target.dataset.sync,10))}))})(bluejay),(function(e){"use strict";e.addModule("textAreaResize");const t=e=>{let t=e.scrollHeight;t-e.clientHeight>15&&(e.style.height="auto",e.style.height=t+5+"px")};e.extend("resizeTextArea",t),document.addEventListener("input",(e=>{"TEXTAREA"==e.target.tagName&&t(e.target)}),!1),document.addEventListener("DOMContentLoaded",(()=>{e.nodeArray(document.querySelectorAll("textarea")).forEach((e=>{t(e)}))}))})(bluejay),(function(e){"use strict";e.addModule("tooltip");const t=Object.assign({selector:".js-has-tooltip",showing:!1,target:null,type:null,clickThrough:!1,tip:null,eyeIcons:null,reset(){this.showing=!1,this.type=null,this.target=null,this.views.notify()},update(e){if(this.showing=!0,this.target=e,e.hasAttribute("data-tooltip-content"))this.type="basic",this.tip=e.dataset.tooltipContent;else{const t=JSON.parse(e.dataset.tt);this.type=t.type,this.clickThrough=t.clickPopup,"bilateral"==this.type?(this.tip={r:t.tipR,l:t.tipL},this.eyeIcons=t.eyeIcons):this.tip=t.tip}this.views.notify()}},e.ModelViews()),n=(()=>{const n=document.createElement("div");let s=window.innerWidth;e.listenForResize((()=>s=window.innerWidth));const i=()=>{n.innerHTML="",n.className="oe-tooltip",n.style.cssText="display:none"};return t.views.add((()=>{t.showing||i()})),i(),document.body.appendChild(n),{div:n,reset:i,show:(i,o)=>{let a=o/2,l=e.getHiddenElemSize(n).h,r=t.target.getBoundingClientRect(),c=r.right-r.width/2,d=r.top-l-8,u=s>e.settings("cssHotlistFixed")?e.settings("cssExtended"):s;c<=a&&(a=20,n.classList.add("offset-right")),c>u-a&&(a=o-20,n.classList.add("offset-left")),r.top<l&&(d=r.bottom+8,n.classList.add("inverted")),n.style.top=d+"px",n.style.left=c-a+"px",n.style.display=i}}})();t.views.add((()=>{"basic"===t.type&&(n.reset(),n.div.innerHTML=t.tip,n.show("block",200))}));t.views.add((()=>{"bilateral"===t.type&&(n.reset(),n.div.classList.add("bilateral"),n.div.innerHTML=Mustache.render('<div class="right">{{&r}}</div><div class="left">{{&l}}</div>',t.tip),t.eyeIcons||n.div.classList.add("no-icons"),n.show("flex",400))}));const s=e=>{!1!==t.showing&&(t.reset(),window.removeEventListener("scroll",s,{capture:!0,once:!0}))},i=e=>{t.update(e.target),window.addEventListener("scroll",s,{capture:!0,once:!0})};e.userDown(t.selector,(e=>{e.target.isSameNode(t.target)&&t.showing?s():i(e)})),e.userEnter(t.selector,i),e.userLeave(t.selector,s)})(bluejay),(function(e){"use strict";if(e.addModule("whiteboard"),null===document.querySelector("main.oe-whiteboard"))return;e.hide(document.querySelector("#oe-admin-notifcation"));const t=document.querySelector(".wb3-actions"),n=document.querySelector("#js-wb3-openclose-actions");if(e.userDown("#js-wb3-openclose-actions",(e=>{n.classList.contains("up")?(n.classList.replace("up","close"),t.classList.replace("down","up")):(n.classList.replace("close","up"),t.classList.replace("up","down"))})),e.userDown(".wb-idg-demo-btn",(e=>{window.location="/v3-whiteboard/"+e.target.dataset.url})),e.userDown(".edit-widget-btn .oe-i",(t=>{let n=t.target,s=e.getParent(n,".oe-wb-widget"),i=s.querySelector(".wb-data ul"),o=s.querySelector(".wb-data .edit-widget");n.classList.contains("pencil")?(n.classList.replace("pencil","tick"),e.hide(i),e.show(o,"block")):(n.classList.replace("tick","pencil"),e.hide(o),e.show(i,"block"))})),null===document.querySelector(".multipage-nav"))return;let s=document.querySelector(".multipage-stack"),i=e.nodeArray(s.querySelectorAll("img")),o=i[0].height+20;e.listenForResize((()=>o=i[0].height+20));let a=0;const l=e=>{a+=e,a<0&&(a=0),a>i.length*o&&(a=i.length*o),s.scrollTop=a};e.userDown("#js-scroll-btn-down",(()=>l(200))),e.userDown("#js-scroll-btn-up",(()=>l(-200)));let r=document.querySelector(".page-jump");i.forEach(((e,t)=>{let n=document.createElement("div");n.className="page-num-btn",n.setAttribute("data-page",t),n.textContent=t+1,r.appendChild(n)})),e.userDown(".page-num-btn",(e=>{a=0;let t=parseInt(e.target.dataset.page*o);l(t)}))})(bluejay),(function(e){"use strict";e.addModule("attachmentThumbnail");const t="oe-attachment-thumbnail";let n,s=!1;const i={};if(e.nodeArray(document.querySelectorAll("."+t)).length<1)return;const o=()=>{i.close.removeEventListener("mousedown",o),i.save&&(i.save.removeEventListener("mousedown",o),i.cancel.removeEventListener("mousedown",o)),e.remove(n),s=!1},a=t=>{s||(t=>{s=!0,n=document.createElement("div"),n.className="oe-popup-wrap";let a='<div class="oe-popup-attachment">';a+='<div class="title">'+t.title+"</div>",a+='<div class="close-icon-btn"><i class="oe-i remove-circle pro-theme"></i></div>',a+='<div class="file-attachment-content"></div>',a+='<div class="file-size-controls"></div>',a+="</div>",n.innerHTML=a;const l=n.querySelector(".file-attachment-content"),r=n.querySelector(".file-size-controls"),c=new DocumentFragment,d=(e,t,n=!1)=>{let s=document.createElement("button");return s.className=t,n&&(s.id=n),s.textContent=e,c.appendChild(s),s};if("pdf"!==t.type){let e="url('"+t.file+"')";l.style.backgroundImage=e,l.innerHTML='<img src="'+t.file+'" style="display:none"/>';const s=n.querySelector("img"),i=d("Fit to screen","pro-theme selected","oe-att-fit"),o=d("Actual size","pro-theme","oe-att-actual"),a=(e,t,n,i)=>{l.style.backgroundImage=e,s.style.display=t,n.classList.add("selected"),i.classList.remove("selected")};o.addEventListener("mousedown",(e=>{e.stopPropagation(),a("none","block",o,i)})),i.addEventListener("mousedown",(t=>{t.stopPropagation(),a(e,"none",i,o)}))}else l.innerHTML='<embed src="'+t.file+'" width="100%" height="100%"></embed>',d("PDF","pro-theme selected");if(t.annotate){l.classList.add("annotation");let s=document.createElement("div");s.className="attachment-annotation",e.find(".oe-popup-attachment",n).appendChild(s),e.xhr(t.idgPHP).then((e=>{s.innerHTML=e.html,"L"==t.eyelat&&(s.querySelector("#annotation-right").style.visibility="hidden"),"R"==t.eyelat&&(s.querySelector("#annotation-left").style.visibility="hidden")})).catch((e=>console.log("XHR failed: ",e))),i.save=d("Save annotations","green hint"),i.cancel=d("Cancel","red hint"),i.save.addEventListener("mousedown",o,{once:!0}),i.cancel.addEventListener("mousedown",o,{once:!0})}if(t.stack){let s=t.title.split(" - "),i="<option>"+t.title+"</option>";for(let e=t.stack;e;e--)i+="<option>"+s[0]+" - ("+e+" Jan 1975 09:30)</option>";let o=document.createElement("div");o.className="attachment-stack",o.innerHTML='Choose report: <select class="pro-theme">'+i+"</select>",e.find(".oe-popup-attachment",n).appendChild(o)}i.close=n.querySelector(".close-icon-btn"),i.close.addEventListener("mousedown",o,{once:!0}),r.appendChild(c),document.body.appendChild(n)})(JSON.parse(t.target.dataset.attachment))};e.userDown("."+t,a),document.querySelectorAll(".js-annotate-attachment")&&e.userDown(".js-annotate-attachment",a)})(bluejay),(function(e){"use strict";e.addModule("ed3");let t=!1;e.userDown(".js-idg-ed3-app-btn",(n=>{let s=n.target;t=t||(()=>{let e=document.createElement("div");return e.className="oe-eyedraw-app spinner-loader",document.body.appendChild(e),e})();let i=s.getBoundingClientRect().bottom-532;t.style.top=i<60?"60px":i+"px",e.show(t,"block");let o=JSON.parse(s.dataset.idgDemo);var a=Object.keys(o).map((e=>e+"="+o[e])).join("&");e.xhr("/idg-php/v3/_load/ed3/ed3-app.php?"+a).then((e=>{t.innerHTML=e.html,t.querySelector(".close-icon-btn").addEventListener("mousedown",(()=>{t.style.display="none"}),{once:!0})})).catch((e=>console.log("ed3app php failed to load",e)))}))})(bluejay),(function(e){"use strict";e.addModule("elementSelector");const t=()=>({loadPHP:function(t){e.xhr(t).then((e=>{!1!==this.open&&(this.nav=document.createElement("nav"),this.nav.className=this.wrapClass,this.nav.innerHTML=e.html,this.btn.classList.add("selected"),document.body.appendChild(this.nav))})).catch((e=>console.log("PHP failed to load",e)))}}),n=()=>({close:function(){this.open=!1,this.btn.classList.remove("selected"),e.remove(this.nav)}}),s=()=>({change:function(e){if(null===this.btn&&(this.btn=e.target),this.open)this.close();else{this.open=!0;let e=JSON.parse(this.btn.dataset.demophp);!1!==e?this.loadPHP(e):this.elementSideNav()}}}),i=()=>({elementSideNav:function(){this.nav=document.createElement("nav"),this.nav.className=this.wrapClass;const t=e.nodeArray(document.querySelectorAll(".element .element-title")).map((e=>'<li class="element" id="side-element-contacts"><a href="#" class="selected">'+e.textContent+"</a></li>"));this.nav.innerHTML=['<div class="element-structure">','<ul class="oe-element-list">',t.join(""),"</ul>","</div>"].join(""),document.body.appendChild(this.nav)}}),o=e=>Object.assign({btn:null,open:!1,wrapClass:e},s(),t(),i(),n());if(null!==document.querySelector("#js-manage-elements-btn")){const t=o("oe-element-selector");e.userDown("#js-manage-elements-btn",(e=>t.change(e))),e.userDown(".oe-element-selector .close-icon-btn button",(()=>t.close()))}if(null!==document.querySelector("#js-element-structure-btn")){const t=o("sidebar element-overlay");e.userDown("#js-element-structure-btn",(e=>t.change(e)))}})(bluejay),(function(e){"use strict";e.addModule("eventAuditTrial");const t="#js-event-audit-trail-btn",n=document.querySelector(t);if(null===n)return;const s=document.querySelector("#js-event-audit-trail");null===s&&e.log("Audit Trail content not available in DOM?");let i=!1;const o=t=>{e.show(s,"block"),n.classList.add("active"),i=!0},a=t=>{e.hide(s),n.classList.remove("active"),i=!1};e.userDown(t,(e=>i?a(e):o(e))),e.userEnter(t,o),e.userLeave(t,a)})(bluejay),(function(e){"use strict";e.addModule("eventsUserTrail");if(null===document.querySelector("#js-events-user-trail"))return;let t=null;e.userDown("#js-events-user-trail",(()=>{t=document.createElement("div"),t.className="oe-popup-wrap";let n=document.createElement("div");n.className="oe-popup oe-events-user-trail",t.appendChild(n),document.body.appendChild(t);let s=setTimeout((()=>n.innerHTML='<i class="spinner"></i>'),400);e.xhr("/idg-php/v3/_load/sidebar/events-user-trail-v2.php").then((e=>{clearTimeout(s),n.innerHTML=e.html})).catch((e=>console.log("ed3app php failed to load",e)))})),e.userDown(".js-idg-toggle-event-audit-trail",(e=>{let n=e.target,s=t.querySelector("#"+n.dataset.auditid);"block"===s.style.display?s.style.display="none":s.style.display="block"})),e.userDown(".oe-events-user-trail .close-icon-btn .oe-i",(()=>{e.remove(t)}))})(bluejay),(function(e){"use strict";if(e.addModule("examElementSearch"),null===document.querySelector("#js-search-in-event-popup"))return;e.userDown("#js-search-in-event",(t=>{const n=t.target,s=document.querySelector("#js-search-in-event-popup"),i=document.querySelector(".main-event"),o=s.querySelector(".close-icon-btn");n.classList.add("selected"),e.show(s,"block"),i.classList.add("examination-search-active"),o.addEventListener("mousedown",(t=>{t.stopPropagation(),i.classList.remove("examination-search-active"),e.hide(s),n.classList.remove("selected")}),{once:!0})}))})(bluejay),(function(e){"use strict";e.addModule("filterOptions");const t=[],n="active",s=()=>({show:function(){this.open||(this.open=!0,this.btn.classList.add(n),this.positionContent(),e.show(this.content,"block"),this.mouseOutHide(),this.closeIconBtn())}}),i=()=>({hide:function(){!1!==this.open&&(this.open=!1,this.btn.classList.remove(n),e.hide(this.content))}}),o=()=>({positionContent:function(){this.defaultCSS=this.defaultCSS||this.content.className;let t,n,s,i=this.btn.getBoundingClientRect(),o=e.getHiddenElemSize(this.content);i.top<400?(t="top",n=i.top):(t="bottom",n=i.bottom-o.h),i.left<500?(t+="-left",s=i.left):(t+="-right",s=i.right-o.w),this.content.className=this.defaultCSS+" "+t,this.content.style.top=n+"px",this.content.style.left=s+"px"}}),a=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},s(),i(),{mouseOutHide:function(){this.wrapper.addEventListener("mouseleave",(e=>{e.stopPropagation(),this.hide()}),{once:!0})}},{closeIconBtn:function(){this.wrapper.querySelector(".close-icon-btn").addEventListener("mousedown",(e=>{e.stopPropagation(),this.hide()}),{once:!0})}},o());e.userDown(".oe-filter-options .oe-filter-btn",(n=>(n=>{let s=n.target,i=e.getDataAttr(s);if(i)t[parseFloat(i)].change();else{let n=e.getParent(s,".oe-filter-options"),i=a({btn:s,wrapper:n,content:n.querySelector(".filter-options-popup")});i.show(),e.setDataAttr(s,t.length),t.push(i)}})(n)))})(bluejay),(function(e){"use strict";e.addModule("lightning");if(null===document.querySelector(".oe-lightning-viewer"))return;const t=()=>({updateView:function(e){this.updateStack(e),this.updateMeta(document.querySelector(this.iconPrefix+e).dataset.meta)}}),n=()=>({updateStack:function(t){e.hide(document.querySelector(this.stackPrefix+this.currentStack)),e.show(document.querySelector(this.stackPrefix+t),"block"),this.currentStack=t,this.updateCounter(),this.timelineIcon()}}),s=()=>({updateCounter:function(){document.querySelector(".lightning-ui .stack-position").textContent=this.currentStack+1+"/"+this.totalStackNum}}),i=()=>({timelineIcon:function(){document.querySelector(".icon-event").classList.remove("js-hover"),document.querySelector(this.iconPrefix+this.currentStack).classList.add("js-hover")}}),o=()=>({xscroll:function(e,t){var n=Math.floor(e/(this.xscrollWidth/this.totalStackNum));0==this.locked&&this.updateView(n)}}),a=()=>({swipeLock:function(){this.locked=!this.locked;let e=document.querySelector(".lightning-ui .user-help");this.locked?e.textContent="Swipe is LOCKED | Click to unlock":e.textContent="Swipe to scan or use key RIGHT / LEFT | Click to LOCK swipe"}}),l=Object.assign({currentStack:0,iconPrefix:"#lqv_",stackPrefix:"#lsg_",totalStackNum:document.querySelectorAll(".stack-group").length,xscrollWidth:document.querySelector(".lightning-view").clientWidth,locked:!0},t(),{updateMeta:function(e){let t=document.querySelector(".lightning-meta"),n=e.split(",");[".type",".date",".who"].forEach(((e,s)=>{t.querySelector(e).textContent=n[s]}))}},n(),s(),i(),o(),a(),{stepThrough:function(e){var t=this.currentStack+e;t>=0&&t<this.totalStackNum&&this.updateView(t)}});l.updateCounter(),l.swipeLock(),e.userDown("#lightning-left-btn",(()=>l.stepThrough(-1))),e.userDown("#lightning-right-btn",(()=>l.stepThrough(1))),e.userDown(".lightning-view",(()=>l.swipeLock())),e.userDown(".icon-event",(()=>l.swipeLock())),e.userEnter(".icon-event",(e=>{let t=e.target;l.updateStack(t.dataset.id),l.updateMeta(t.dataset.meta)}));const r=document.querySelector(".lightning-view");r.addEventListener("mousemove",(e=>{})),e.listenForResize((()=>l.xscrollWidth=r.clientWidth)),document.addEventListener("keydown",(e=>{37==(e.keyCode||e.which)&&l.stepThrough(-1),39==(e.keyCode||e.which)&&l.stepThrough(1)}))})(bluejay),(function(e){"use strict";e.addModule("lightningIconGroups");const t=e.nodeArray(document.querySelectorAll(".icon-group"));if(t.length<1)return;t.forEach((t=>{let n=t.childElementCount,s=document.createElement("div");s.textContent="("+n+")",e.hide(s),t.parentNode.appendChild(s)}));e.userDown(".js-timeline-date",(t=>{let n=t.target,s=document.querySelector("#js-icon-"+n.dataset.icons);n.classList.contains("collapse")?(e.hide(s),e.show(s.nextElementSibling,"block"),n.classList.replace("collapse","expand")):(e.show(s,"block"),e.hide(s.nextElementSibling),n.classList.replace("expand","collapse"))}))})(bluejay),(function(e){"use strict";e.addModule("multiPageScroll");let t=e.nodeArray(document.querySelectorAll(".lightning-multipage-scroll"));if(0===t.length)return;const n=()=>({animateScrollTo:function(e){let t=1,n=0,s=this.stack.scrollTop,i=this.pageH*e-s;clearInterval(this.animateID),this.animateID=setInterval((()=>{var e;n=Math.min(1,t/80),this.stack.scrollTop=Math.ceil(((e=n)<.5?2*e*e:(4-2*e)*e-1)*i)+s,t+=1,1==n&&clearInterval(this.animateID)}),2)}}),s=()=>({pageBtn:function(e){e.matches(".page-num-btn")&&this.animateScrollTo(parseFloat(e.dataset.page))}});t.forEach((e=>{(e=>{e.numOfImgs=e.stack.querySelectorAll("img").length,e.pageH=parseFloat(e.stack.querySelector("img").height+10),e.animateID=null;let t=new DocumentFragment;for(let n=0;n<e.numOfImgs;n++){let s=document.createElement("div");s.className="page-num-btn",s.setAttribute("data-page",n),s.textContent=n+1+"/"+e.numOfImgs,t.appendChild(s)}e.nav.appendChild(t),e.nav.addEventListener("mouseenter",(t=>e.pageBtn(t.target)),{capture:!0}),e.nav.addEventListener("mousedown",(t=>e.pageBtn(t.target)),{capture:!0}),Object.assign(e,s(),n())})({nav:e.querySelector(".multipage-nav"),stack:e.querySelector(".multipage-stack")})}))})(bluejay),(function(e){"use strict";e.addModule("oesLayoutOptions");const t=document.querySelector(".oes-hd-data-layout");if(null==t)return;const n=Object.assign({selector:{rootElem:".oes-hd-data-layout",btn:".oes-hd-data-layout .layout-select-btn",optionBtn:".oes-hd-data-layout .option-btn",options:".layout-options"},current:{eye:JSON.parse(t.dataset.oes).eyeIcons,layout:JSON.parse(t.dataset.oes).layout},get eye(){return this.current.eye},set eye(e){if(e===this.current.eye)return!1;this.current.eye=e,this.views.notify()},get layout(){return this.current.layout},set layout(e){if(this.current.layout===e)return!1;this.current.layout=e,this.views.notify()}},e.ModelViews()),s=((()=>{const s=["{{#sides}}",'<div class="option-btn" data-oes=\'{"opt":"eye.{{eyelat.r}}-{{eyelat.l}}"}\'><span class="oe-eye-lat-icons"><i class="oe-i laterality {{eyelat.r}} small"></i><i class="oe-i laterality {{eyelat.l}} small"></i></span></div>',"{{/sides}}","{{#layouts}}",'<div class="option-btn" data-oes=\'{"opt":"layout.{{.}}"}\'><i class="oes-layout-icon i-{{.}}"></i></div>',"{{/layouts}}"].join(""),i=document.createElement("div");i.className=n.selector.options.replace(".",""),i.innerHTML=Mustache.render(s,{sides:[{eyelat:{r:"R",l:"NA"}},{eyelat:{r:"R",l:"L"}},{eyelat:{r:"NA",l:"L"}}],layouts:["1-0","2-1","1-1","1-2","0-1"]}),e.hide(i),t.appendChild(i)})(),(()=>{const t="oes-layout-icon",s=document.querySelector(n.selector.btn),i=s.querySelector("."+t),o=s.querySelector(".oe-eye-lat-icons");n.views.add((()=>{i.className=t+"  i-"+n.layout;let s=n.eye.split("-");o.innerHTML=Mustache.render('{{#eyes}}<i class="oe-i laterality {{.}} small pad"></i>{{/eyes}}',{eyes:s}),e.customEvent("oesLayoutEyeSide",s)}))})(),(()=>{let t=null;const s=document.querySelector(".oes-v2 .oes-right-side"),i=document.querySelector(".oes-v2 .oes-left-side"),o=()=>{if(n.layout!==t){switch(t=n.layout,t){case"1-0":i.style.width="",e.show(i),e.hide(s);break;case"0-1":s.style.width="",e.hide(i),e.show(s);break;case"2-1":i.style.width="66%",s.style.width="33%",e.show(i),e.show(s);break;case"1-2":i.style.width="33%",s.style.width="66%",e.show(i),e.show(s);break;case"1-1":i.style.width="50%",s.style.width="50%",e.show(i),e.show(s);break;default:throw new TypeError("[bluejay] [oesLayoutOptions] - unknown layout: "+t)}e.customEvent("oesLayoutChange",t)}};o(),n.views.add(o)})(),(()=>{let s=!1;const i=t.querySelector(n.selector.btn),o=t.querySelector(n.selector.options),a=t=>{s=!0,e.show(o),i.classList.add("active")},l=t=>{s=!1,e.hide(o),i.classList.remove("active")};return{show:a,hide:l,change:e=>{s?l():a()}}})());e.userDown(n.selector.btn,s.change),e.userEnter(n.selector.btn,s.show),e.userLeave(n.selector.rootElem,s.hide),e.userDown(n.selector.optionBtn,(e=>(e=>{let t=JSON.parse(e).opt.split(".");"eye"==t[0]&&(n.eye=t[1]),"layout"==t[0]&&(n.layout=t[1])})(e.target.dataset.oes)))})(bluejay),(function(e){"use strict";e.addModule("problemsPlans");const t=e.nodeArray(document.querySelectorAll(".problems-plans-sortable"));if(t.length<1)return;const n=[],s=(e,t,n)=>({id:e,text:t,info:n});e.nodeArray(t[0].querySelectorAll("li")).forEach((e=>{n.push(s(n.length,e.textContent,e.querySelector(".info").getAttribute("data-tooltip-content")))})),t.forEach((t=>{e.nodeArray(t.querySelectorAll("li")).forEach(((t,n)=>{e.setDataAttr(t,n)}))}));let i=n.length+1;const o=(e,t)=>['<span class="drag-handle"><i class="oe-i menu medium pro-theme"></i></span>',e,'<div class="metadata">','<i class="oe-i info small pro-theme js-has-tooltip" data-tooltip-content="',t,'"></i></div>','<div class="remove"><i class="oe-i remove-circle small pro-theme pad"></i></div>'].join(""),a=(s,i)=>{let a=n.findIndex((e=>e.id==s)),l=n.findIndex((e=>e.id==i));n[a]=n.splice(l,1,n[a])[0],t.length>1&&t.forEach((t=>{let s=t.querySelectorAll("li");for(let t=0,i=n.length;t<i;t++){let i=n[t],a=s[t];i.id!=e.getDataAttr(a)&&(e.setDataAttr(a,i.id),a.innerHTML=o(i.text,i.info))}}))};e.userDown(".create-new-problem-plan button",(a=>{a.preventDefault();let l=e.getParent(a.target,".create-new-problem-plan").querySelector("input");if(!l||l.value.length<2)return;let r=s(i++,l.value,"Added now!");var c;n.push(r),c=(t=>{const n=new DocumentFragment,s=document.createElement("li");return s.innerHTML=o(t.text,t.info),e.setDataAttr(s,t.id),n.appendChild(s),n})(r),t.forEach((e=>{e.appendChild(c.cloneNode(!0)),h(e.lastChild)}))})),e.userDown(".problems-plans-sortable .remove-circle",(s=>{let i=e.getParent(s.target,"li"),o=0;for(;null!==(i=i.previousSibling);)o++;t.forEach((t=>{e.remove(t.childNodes[o])})),n.splice(o,1)})),document.addEventListener("DOMContentLoaded",(()=>{t.forEach((t=>{e.nodeArray(t.querySelectorAll("li")).forEach((e=>{h(e)}))}))}));let l=null,r="js-sorting-list";const c=e=>{l=e.target,e.target.parentNode.classList.add(r),e.dataTransfer.setData("source",l.innerHTML)},d=e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"},u=e=>(e.preventDefault&&e.preventDefault(),!1),p=t=>{if(t.stopPropagation&&t.stopPropagation(),!1!==t.target.parentNode.classList.contains(r))return t.target.parentNode.classList.remove(r),l!=t.target&&(l.innerHTML=t.target.innerHTML,t.target.innerHTML=t.dataTransfer.getData("source"),a(e.getDataAttr(l),e.getDataAttr(t.target))),!1},h=e=>{e.setAttribute("draggable","true"),e.addEventListener("dragstart",c,!1),e.addEventListener("dragenter",d,!1),e.addEventListener("dragover",u,!1),e.addEventListener("drop",p,!1)}})(bluejay),(function(e){"use strict";e.addModule("quicktag");const t={qtags:["Adverse_Event","Serious_Adverse_Event","Note","My_research","my_teaching","Research","Teaching","Referred","Results","My_Results_pending"].map((e=>e.toLowerCase()))};e.extend("wrapQtags",(e=>{let n=e.split(" "),s=[],i=[];if(n.forEach(((e,n)=>{e.startsWith("#")&&t.qtags.indexOf(e.substring(1))>=0?i.push(e):s.push(e)})),i.sort(),i.length){let e=i.map((e=>`<span class="qtag">${e}</span>`));return{text:i.join(" ")+" "+s.join(" "),DOMString:e.join(" ")+'<span class="dot-list-divider"></span>'+s.join(" ")}}return{text:e,DOMString:e}}));const n=(()=>{let n=!1,s="";const i={input:null,tags:null,flag:null},o=e=>{e.length?(s=e[0],i.tags.innerHTML=Mustache.render('{{#qtags}}<span class="qtag">#{{.}}</span> {{/qtags}}',{qtags:e}),i.tags.querySelector(".qtag:first-child").classList.add("selected")):(s="",i.tags.innerHTML='<div class="no-matching-tags">No matching Patient Tags</div>')};return{init:s=>{if(n)return;n=!0;const a=e.wrap(s,"js-qtag-wrapper");s.focus();let l=document.createElement("div");l.className="oe-qtags",l.style.display="none";let r=document.createElement("div");r.className="oe-qtags-flag",r.textContent="#",s.getBoundingClientRect().top<e.getWinH()-170?(l.style.top="100%",r.style.top="100%"):(l.style.bottom="100%",r.style.bottom="100%"),a.appendChild(r),a.appendChild(l),i.input=s,i.tags=l,i.flag=r,o(t.qtags)},showTags:()=>{i.tags.style.display="block",i.flag.style.display="none",o(t.qtags)},hideTags:()=>{i.tags.style.display="none",i.flag.style.display="block"},userTyping:e=>{const n=(e=e.toLowerCase()).match(/[a-z-_]*/)[0],s=n.length,i=t.qtags.filter((e=>e.substring(0,s)==n));o(i)},selectedTag:()=>s,reset:()=>{n&&(e.remove(i.tags),e.remove(i.flag),e.unwrap(i.input),i.tags=null,i.flag=null,i.input=null,n=!1)}}})(),s=e=>{e.isComposing||229===e.keyCode||("Enter"!=e.key&&"Tab"!=e.key||(e.preventDefault(),e.stopPropagation(),i.insertTag(n.selectedTag()))," "==e.key&&i.stopTagging())},i=(()=>{let t=!1,o=null,a=0,l="",r=!1;const c=()=>{document.removeEventListener("input",m,{capture:!0}),document.removeEventListener("blur",h,{capture:!0}),o=null,t=!1,a=0,n.reset()},d=()=>{t=!1,a=0,n.hideTags(),e.log("[qTags] - Keys: Enter, Tab and Spacebar - normal"),document.removeEventListener("keydown",s,!0)},u=i=>{t=!0,a=i,l=o.value,n.showTags(),e.log("[qTags] - Keys: Enter, Tab & Spacebar - suspended (keydown)"),document.addEventListener("keydown",s,!0)},p=()=>{r=!0,setTimeout((()=>{o.focus(),r=!1}),20)},h=()=>{r||c()},m=e=>{t?n.userTyping(o.value.substring(a)):"#"===e.data&&u(e.target.selectionStart)};return{init:e=>{e.isSameNode(o)||(null!==o&&c(),e.classList.contains("js-allow-qtags")&&(o=e,n.init(o),document.addEventListener("input",m,{capture:!0}),document.addEventListener("blur",h,{capture:!0})))},stopTagging:d,insertTag:e=>{let t=e+" ";a===l.length?o.value=l+t:o.value=l.substring(0,a)+t+l.substring(a+1),d()},userClicksFlag:()=>{o.value=o.value+" #",u(o.value.length),p()},userClicksTag:e=>{i.insertTag(e),p()},reset:c,focusOut:h}})();document.addEventListener("focus",(e=>i.init(e.target)),{capture:!0}),e.userDown(".oe-qtags",i.stopTagging),e.userDown(".oe-qtags-flag",i.userClicksFlag),e.userDown(".oe-qtags .qtag",(e=>{const t=e.target.textContent;i.userClicksTag(t.substring(1))}))})(bluejay),(function(e){"use strict";e.addModule("reduceElementHeight");const t=[],n=e=>(e.reduced=!1,Object.assign(e,{change:function(){this.reduced?(this.elem.classList.remove("reduced-height"),this.icon.classList.replace("increase-height-orange","reduce-height")):(this.elem.classList.add("reduced-height"),this.icon.classList.replace("reduce-height","increase-height-orange")),this.reduced=!this.reduced}}));e.userDown(".element .js-elem-reduce .oe-i",((s,i)=>{let o=s.target,a=e.getDataAttr(o);if(a)t[parseFloat(a)].change();else{let s=n({elem:e.getParent(o,".element"),icon:o});s.change(),e.setDataAttr(o,t.length),t.push(s)}}))})(bluejay),(function(e){"use strict";e.addModule("restrictDataHeightFlag");const t="restrict-data-shown-flag",n=e.getDataAttributeName(),s=[];function i(e,t,n){this.hasScrolled=!1,this.flag=e,this.content=t,this.scrollEndPos=n,this.content.addEventListener("scroll",(()=>this.scroll()),{once:!0})}i.prototype.scroll=function(t){this.hasScrolled=!0,this.flag.className+=" fade-out",setTimeout((()=>e.remove(this.flag)),400)},i.prototype.userClick=function(){this.hasScrolled||o(this.content,this.scrollEndPos)};const o=(e,t)=>{let n=1,s=0,i=setInterval((()=>{var o;s=Math.min(1,n/200),e.scrollTop=Math.ceil((o=s)*(2-o)*t),n+=1,1==s&&clearInterval(i)}),2)};(()=>{let o=e.nodeArray(document.querySelectorAll(".restrict-data-shown"));if(o.length<1)return;const a=document.createDocumentFragment(),l=document.createElement("div");l.className=t,a.appendChild(l),o.forEach((e=>{let t=e.querySelector(".restrict-data-content"),o=e.clientHeight,l=t.scrollHeight;if(l>o&&0===t.scrollTop){let r=a.cloneNode(!0),c=r.firstChild;c.setAttribute(n,s.length),e.appendChild(r),s.push(new i(c,t,l-o))}}))})(),e.userDown("."+t,(e=>{s[e.target.getAttribute(n)].userClick()}))})(bluejay),(function(e){"use strict";e.addModule("sideNavSelectList");const t=e.nodeArray(document.querySelectorAll(".js-list-filter"));if(0==t.length)return;const n=e.nodeArray(document.querySelectorAll(".js-filter-group"));let s=document.querySelector(".js-list-filter.selected");const i=e=>{n.forEach((t=>{t.style.display=e}))};t.forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();let n=t.target;var o;n.classList.add("selected"),"all"==(o=n.dataset.list)?i("block"):(i("none"),e.show(document.querySelector("#"+o),"block")),s.classList.remove("selected"),s=n}))}))})(bluejay),(function(e){"use strict";bluejay.addModule("sidebarElementList");let t=document.querySelector(".sidebar-eventlist .oe-element-list");if(null===t)return;let n=document.querySelectorAll(".element-title");if(n.length<1)return;let s=document.createDocumentFragment();n.forEach((function(e){let t=document.createElement("li");t.innerHTML='<a href="#">'+e.textContent+"</a>",s.appendChild(t)})),t.appendChild(s)})(),(function(e){"use strict";if(e.addModule("sidebarQuicklookView"),null===document.querySelector(".sidebar-eventlist"))return;const t={el:null,show(e){this.el=e.parentNode.previousSibling,this.el.classList.add("fade-in")},hide(){this.el.classList.remove("fade-in")}},n={id:null,div:null,locked:!1,iCloseBtn:"i-btn-close",click(e){e.id==this.id?this.locked?this.unlock():this.lock():(this.show(e),this.lock())},over(e){this.locked||this.show(e)},out(){this.locked||this.remove()},lock(){this.locked=!0,this.div.appendChild(e.div(`${this.iCloseBtn}`))},unlock(){this.locked=!1,this.div.querySelector(`.${this.iCloseBtn}`).remove()},close(){this.remove(),this.locked=!1},remove(){this.div.remove(),this.div=null,this.id=null},show(t){null!==this.div&&this.remove(),this.id=t.id;const n=['<div class="event-icon"><i class="oe-i-e large {{icon}}"></i></div>','<div class="title">{{event}} - {{date}}</div>','<div class="quick-view-content {{type}}"></div>'].join("");this.div=e.div("oe-event-quickview fade-in"),this.div.innerHTML=Mustache.render(n,t),this.load(t.type,t.content),document.body.appendChild(this.div)},load(t,n){const s=this.div.querySelector(".quick-view-content");switch(t){case"img":s.innerHTML=`<img src="${n}" />`;break;case"pdf":s.innerHTML=`<embed src="${n}#toolbar=0" width="100%" height="100%"></embed>`;break;case"php":e.xhr(n,this.id).then((e=>{this.id==e.token&&(s.innerHTML=e.html)})).catch((e=>console.log("PHP failed to load",e)));break;case"none":s.innerHTML=`<div class="not-available">${n}</div>`;break;default:e.log("QuickView Error - load content type unknown:"+t)}}};e.userEnter(".event .event-type",(s=>{t.show(s.target);const i=e.getParent(s.target,"li.event");n.over(JSON.parse(i.dataset.quick))})),e.userLeave(".event .event-type",(e=>{t.hide(),n.out()})),e.userDown(`.oe-event-quickview .${n.iCloseBtn}`,(()=>{n.close()})),document.addEventListener("click",(t=>{if(t.target.matches(".event .event-type")){t.preventDefault(),t.stopImmediatePropagation();const s=e.getParent(t.target,"li.event");n.click(JSON.parse(s.dataset.quick))}}),{capture:!0})})(bluejay),(function(e){"use strict";if(e.addModule("signatureCapture"),null===document.querySelector(".js-idg-capture-signature"))return;const t=()=>{e.xhr("/idg-php/v3/_load/signature-pad.php").then((t=>{const n=e.div("oe-popup-wrap");n.innerHTML=t.html,document.body.appendChild(n);let s=n.querySelector(".close-icon-btn");s&&s.addEventListener("mousedown",(t=>{e.remove(n)}),{once:!0}),(()=>{var e=document.getElementById("signature-pad").querySelector("canvas"),t=document.getElementById("signature-pad-clear"),n=new SignaturePad(e,{backgroundColor:"rgb(255, 255, 255)"});function s(){var t=Math.max(window.devicePixelRatio||1,1);e.width=e.offsetWidth*t,e.height=e.offsetHeight*t,e.getContext("2d").scale(t,t),n.clear()}window.onresize=s,s(),t.addEventListener("click",(function(e){n.clear()}))})()})).catch((e=>console.log("signature pad: failed to load",e)))};e.loadJS("https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js",!0).then((()=>{e.userDown(".js-idg-capture-signature",t)}))})(bluejay),(function(e){"use strict";e.addModule("vcScratchPad");const t=document.querySelector("#oe-vc-scratchpad");if(null===t)return;let n,s,i=!1;t.addEventListener("dragstart",(e=>{e.dataTransfer.dropEffect="move";let t=e.target.getBoundingClientRect();n=e.clientX-t.left,s=e.clientY-t.top}),!1),t.addEventListener("dragend",(e=>{let i=Math.round(e.clientY-s),o=Math.round(e.clientX-n);i=i<1?1:i,o=o<1?1:o,t.style.top=i+"px",t.style.left=o+"px"}),!1);e.userDown("#js-vc-scratchpad",(n=>{let s=n.target;i?(e.hide(t),s.textContent="ScratchPad"):(e.show(t,"block"),s.textContent="Hide ScratchPad"),i=!i}))})(bluejay),(function(e){"use strict";const t=bluejay.namespace("addSelect");t.ListOption=function(e,n){let s=e.classList.contains("selected"),i=!1,o=JSON.parse(e.dataset.insert);void 0!==o.dependents&&(i=new t.OptionDependents(o.dependents,n.uniqueId)),this.click=function(){this.toggleState(),n.optionClicked(s,this),0!=i&&i.show(s)},this.toggleState=function(){e.classList.toggle("selected"),s=!s},this.deselect=function(){s&&this.toggleState()},Object.defineProperty(this,"selected",{get:()=>s,set:t=>{s=t,t||e.classList.remove("selected")}}),Object.defineProperty(this,"dependents",{get:()=>!1!==i}),Object.defineProperty(this,"value",{get:()=>o.value}),e.addEventListener("mousedown",this.click.bind(this))}})(),(function(e){"use strict";e.namespace("addSelect").OptionDependents=function(t,n){if(void 0===t)return!1;const s="#add-to-"+n+"-";let i=[];t.split(",").forEach((e=>{let t=e.split("."),n={};if(0===t[0]&&console.log("Error: OptionDependents, listGroup = 0 !!",s+"listgroup"+t[0]),n.div=document.querySelector(s+"listgroup"+t[0]),null===n.div&&console.log("obj.div = null!",s+"listgroup"+t[0]),n.holder=n.div.querySelector(".optional-placeholder"),null===n.holder&&console.log("Adder: no placeholder text for optional group"),0==t[1])n.showDefaultText=!0;else{n.showDefaultText=!1,n.lists=[];for(let e=1;e<t.length;e++){let i=document.querySelector(s+"list"+t[e]);null===i?console.log("Err: OptionDependents, list? ",s+"list"+t[e]):n.lists.push(i)}}i.push(n)})),this.show=function(e){e?this.myLists():this.reset()},this.hideAllOptionalLists=function(t){e.nodeArray(t.querySelectorAll(".optional-list")).forEach((t=>{e.hide(t)}))},this.myLists=function(){i.forEach((t=>{this.hideAllOptionalLists(t.div),t.showDefaultText?t.holder&&e.show(t.holder,"block"):(t.holder&&e.hide(t.holder),t.lists.forEach((t=>{e.show(t,"block")})))}))},this.reset=function(){i.forEach((t=>{this.hideAllOptionalLists(t.div),t.holder&&e.show(t.holder,"block")}))}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.OptionsList=function(n){let s=JSON.parse(n.dataset.options);const i="inputTemplate"==s.type,o="single"==s.type,a=(s.hasExtraOptions,"true"===s.isOptionalList);this.uniqueId=n.dataset.id,a&&e.hide(n.parentNode);let l=[],r=[];e.nodeArray(n.querySelectorAll("li")).forEach((e=>{let n=new t.ListOption(e,this);l.push(n),n.selected&&n.dependents&&r.push(n)})),this.optionClicked=function(e,t){if(i){let e=n.previousElementSibling,s=t.value,i=s.indexOf("{"),o=s.indexOf("}")+1;return e.value=s,t.deselect(),void setTimeout((()=>{e.focus(),e.select(),e.setSelectionRange(i,o)}),50)}e&&o&&l.forEach((e=>{e!==t&&e.deselect()}))},this.checkForDefaultSelections=()=>{r.length&&r.forEach((e=>{e.selected=!1,e.click()}))}}})(bluejay),(function(e){"use strict";const t=e.namespace("addSelect");t.Popup=function(n){let s=document.querySelector("#"+n.dataset.popup);if(null==s)return;let i=[];this.anchorLeft=!!s.dataset.anchorLeft,this.btn=n,this.popup=s,this.closeBtn=s.querySelector(".close-icon-btn"),this.open=function(){this.position(),t.closeAll(),e.show(s,"block"),this.closeBtn.addEventListener("mousedown",this.close.bind(this))},this.close=function(){s.style.display="none"},this.reset=function(){},e.nodeArray(s.querySelectorAll(".add-options")).forEach((e=>{let n=new t.OptionsList(e);n.checkForDefaultSelections(),i.push(n)})),this.btn.addEventListener("mousedown",this.open.bind(this))},t.Popup.prototype.position=function(){let e=this.btn.getBoundingClientRect(),t=window.innerWidth,n=window.innerHeight,s=n-e.bottom;if(n-s<325&&(s=n-325),this.anchorLeft)this.popup.style.left=e.left+"px";else{let n=e.right-this.popup.getBoundingClientRect().width,s=n<0?n-25:0;this.popup.style.right=t-e.right+s+"px"}this.popup.style.bottom=s+"px"}})(bluejay),(function(e){"use strict";e.addModule("addSelect");const t=e.namespace("addSelect");t.all=[],t.closeAll=function(){this.all.forEach((e=>{if(null==e.close)throw'Every button defined with "js-add-select-btn" needs a popup DOM!';e.close()}))},t.init=function(){const n=e.nodeArray(document.querySelectorAll(".js-add-select-btn"));n.length<1||n.forEach((e=>{let n=new t.Popup(e);this.all.push(n)}))},document.addEventListener("DOMContentLoaded",(()=>t.init()),{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",(()=>{const t=React.createElement,n=e.namespace("react");class s extends React.Component{constructor(e){super(e),this.setTitle=this.setTitle.bind(this),this.content=this.content.bind(this),this.stepPIN=this.stepPIN.bind(this),this.stepActions=this.stepActions.bind(this),this.stepStatus=this.stepStatus.bind(this)}setTitle(s){const i=n.fullShortCode(s.shortcode),o="next"==s.status?"Next":e.clock24(new Date(s.timestamp));return t("h3",null,`${o} - ${i}`)}content(){return t("div",{className:"popup-overflow"},t("div",{className:"data-group",dangerouslySetInnerHTML:{__html:'<table class="data-table"><tbody><tr><td><span class="oe-eye-lat-icons"><i class="oe-i laterality R small"></i><i class="oe-i laterality L small"></i></span></td><td>No step data being shown for this demo...</td><td>UX Demo</td></tr></tbody></table>'}}))}stepPIN(e){if("active"==e.status)return t("div",{className:"step-pin cols-6 flex"},t("div",{className:"oe-user-pin pin-right-eye"},t("input",{className:"user-pin-entry",type:"text",maxlength:4,inputmode:"numeric",placeholder:"****"})),t("div",{className:"oe-user-pin pin-left-eye"},t("input",{className:"user-pin-entry",type:"text",maxlength:4,inputmode:"numeric",placeholder:"****"})))}stepActions(e){if("active"!=e.status&&"next"!=e.status)return null;const n=(n,s,i)=>t("button",{className:n,onClick:()=>this.props.onChangeStepStatus(e.patientArrRef,e.arrRef,i)},s);return"active"==e.status?t("div",{className:"step-actions"},n("green hint","Complete","done"),n("red hint","Remove","remove")):"next"==e.status?t("div",{className:"step-actions"},n("blue hint","Make active","active"),n("red hint","Remove","remove")):void 0}stepStatus(e){let n="step-status";return"done"==e.status&&(n+=" green"),"active"==e.status&&(n+=" orange"),t("div",{className:n},e.status)}render(){const e=this.props.step;return"~Fields"==e.shortcode?t(n.PopupFields,{step:e,onActions:this.props.onClosePopup}):"~Img"==e.shortcode?t(n.PopupImage,{step:e,onActions:this.props.onClosePopup}):t("div",{className:"oe-pathstep-popup a-t-l",style:{top:e.rect.bottom,left:e.rect.left}},t("div",{className:"close-icon-btn",onClick:this.props.onClosePopup,dangerouslySetInnerHTML:{__html:'<i class="oe-i remove-circle medium"></i>'}}),this.setTitle(e),this.content(e),this.stepPIN(e),this.stepActions(e),this.stepStatus(e))}}n.PathStepPopup=s}),{once:!0})})(bluejay),(function(e){"use strict";document.addEventListener("reactJSloaded",(()=>{const t=React.createElement,n=e.namespace("react");class s extends React.Component{constructor(e){super(e),this.setTitle=this.setTitle.bind(this),this.content=this.content.bind(this),this.stepActions=this.stepActions.bind(this),this.stepStatus=this.stepStatus.bind(this)}setTitle(s){n.fullShortCode(s.shortcode),"next"==s.status||e.clock24(new Date(s.timestamp));return t("h3",null,"Configure - Imaging")}content(){return t("div",{className:"popup-overflow"},t("div",{className:"data-group"},t("table",null,t("tbody",null,t("tr",null,t("th",null,"Eye:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"checkbox",name:"eye"},null),t("i",{className:"oe-i laterality R medium"},null)),t("label",{className:"highlight inline"},t("input",{type:"checkbox",name:"eye"},null),t("i",{className:"oe-i laterality L medium"},null))))),t("tr",null,t("th",null,"OCT:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"radio",name:"fieldtest"},null),t("span",null,"Disc")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"fieldtest"},null),t("span",null,"Mac")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"fieldtest"},null),t("span",null,"Mac-Disc"))))),t("tr",null,t("th",null,"Type:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"radio",name:"type"},null),t("span",null,"Zeiss")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"type"},null),t("span",null,"Topcon")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"type"},null),t("span",null,"Spectralis"))))),t("tr",null,t("th",null,"KOWA-Disc:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"checkbox",name:"kowa"},null),t("span",null,"KOWA-Dis"))))),t("tr",null,t("th",null,"Optos:"),t("td",null,t("fieldset",null,t("label",{className:"highlight inline"},t("input",{type:"radio",name:"sta"},null),t("span",null,"Daytona")),t("label",{className:"highlight inline"},t("input",{type:"radio",name:"sta"},null),t("span",null,"Silverstone")))))))))}stepActions(e){if("active"!=e.status&&"next"!=e.status)return null;const n=(e,n,s)=>t("button",{className:e,onClick:this.props.onActions},n);return"active"==e.status?t("div",{className:"step-actions"},n("green hint","Complete"),n("red hint","Remove")):"next"==e.status?t("div",{className:"step-actions"},n("blue hint","Request Test"),n("red hint","Cancel Test")):void 0}stepStatus(e){let n="step-status";return"done"==e.status&&(n+=" green"),"active"==e.status&&(n+=" orange"),t("div",{className:n},e.status)}render(){const e=this.props.step;return t("div",{className:"oe-pathstep-popup a-t-l",style:{top:e.rect.bottom,left:e.rect.left}},t("div",{className:"close-icon-btn",onClick:this.props.onActions,dangerouslySetInnerHTML:{__html:'<i class="oe-i remove-circle medium"></i>'}}),this.setTitle(e),this.content(e),this.stepActions(e),this.stepStatus(e))}}n.PopupImage=s}),{once:!0})})(bluejay),(function(e,t){"use strict";if(e.addModule("clinicManager"),null===document.getElementById("js-clinic-manager"))return;const n=e.div("oe-popup-wrap",'<div class="spinner"></div><div class="spinner-message">Loading...</div>');document.body.append(n),setTimeout((()=>s()),500);const s=()=>{e.log("[Clinic Manager] - intialising");const s=JSON.parse(phpClinicDemoJSON);s.forEach(((t,n)=>{t.uid=e.getToken();const s=new Date(Date.now()+6e4*t.booked),i=s.getMinutes()%5;s.setMinutes(s.getMinutes()-i),t.booked=s.getTime(),t.time=e.clock24(new Date(t.booked)),t.pathway.forEach(((e,t,n)=>{const s={shortcode:e[0],timestamp:Date.now()+6e4*e[1],status:e[2],type:e[3]};n[t]=s}))}));const i=e.dom("table","oe-clinic-list");i.innerHTML=Mustache.render(["<thead><tr>{{#th}}<th>{{.}}</th>{{/th}}</tr></thead>","<tbody></tbody>"].join(""),{th:["Appt.","Hospital No.","Speciality","","Name","","Pathway","Assigned","Mins",""]}),document.getElementById("js-clinic-manager").appendChild(i),n.remove(),t.app(i.querySelector("tbody"),s)}})(bluejay,bluejay.namespace("clinic")),(function(e,t,n){"use strict";t.app=(s,i)=>{const o=new Map,a=new Set,l=t.adder(i);let r;const c=Object.assign({_filter:"all",get filter(){return this._filter},set filter(e){this._filter=e,this.views.notify()}},e.ModelViews()),d=()=>{const e=[];o.forEach((t=>e.push(t.getAssigned()))),a.forEach((t=>t.update(e,c.filter)))};c.views.add((()=>{const t=new DocumentFragment;o.forEach((e=>{const n=e.render(c.filter);null!=n&&t.appendChild(n)})),e.empty(s),s.append(t)})),c.views.add(d);const u=()=>{r.classList.replace("close","open"),l.hide()};e.userClick(".js-idg-clinic-btn-arrived",(e=>{const t=e.target.dataset.patient;o.get(t).onArrived(),l.onPatientArrived(t)})),e.userClick(".js-idg-clinic-btn-DNA",(e=>{o.get(e.target.dataset.patient).onDNA()})),e.userDown(".js-idg-clinic-icon-complete",(e=>{o.get(e.target.dataset.patient).onComplete()})),e.userDown(".js-idg-clinic-btn-filter",(e=>{c.filter=e.target.dataset.filter,u(),n.pathStepPopup.remove()})),e.userDown(".js-idg-clinic-icon-add",(e=>{const t=e.target.dataset.patient;l.showSingle(t,o.get(t).getTime(),o.get(t).getLastname())})),e.userDown(".oe-clinic-filter button.add-to-all",(e=>{r.classList.contains("open")?(r.classList.replace("open","close"),l.showAll()):u()})),e.userDown(".oe-clinic-adder .update-actions li",(e=>{var t,n;t=e.target.dataset.shortcode,n=e.target.dataset.type,l.getSelectedPatients().forEach((e=>{const s=o.get(e);"assign"==n?(s.setAssigned(t),d()):s.addPathStep({shortcode:t,timestamp:!1,status:"todo",type:n})}))})),e.userDown(".oe-clinic-adder .close-btn",u),(()=>{i.forEach((e=>o.set(e.uid,t.patient(e))));const n=document.getElementById("js-clinic-filter");[["Show all","all"],["Hide completed","completed"],["MM","MM"],["AB","AB"],["AG","AG"],["RB","RB"],["CW","CW"],["Not assigned","unassigned"]].forEach((e=>{a.add(t.filterBtn({name:e[0],filter:e[1]},n))}));const s=document.createElement("li");r=e.dom("button","add-to-all open"),s.append(r),n.append(s),c.filter="all",t.clock()})()}})(bluejay,bluejay.namespace("clinic"),bluejay.namespace("gui")),(function(e,t){"use strict";bluejay.namespace("clinic").adder=t=>{const n=e.div("oe-clinic-adder"),s=e.div("patients"),i=e.div("single-patient"),o=new Map,a=new Map,l=new Set,r=t=>{const n=e.div("row");return n.innerHTML=`<h4>${t}</h4>`,n},c=e=>{const t=document.createElement("ul");return t.className=e,t},d=()=>{const e=(e,t)=>{const n=r(e),s=c("row-list");return t.forEach(((e,t)=>{const n=document.createElement("li");n.innerHTML=`<label class="highlight"><input type="checkbox" value="${t}" /><span>${e.time} - ${e.lastname}</span></label>`,s.append(n)})),n.append(s),n};s.innerHTML="",s.append(e("Arrived",o)),s.append(e("Later",a))},u=()=>{l.clear();e.nodeArray(s.querySelectorAll("input[type=checkbox]")).forEach((e=>{e.checked&&l.add(e.value)}))};s.addEventListener("change",u);const p=()=>{n.classList.contains("fadein")&&n.classList.remove("fadein"),n.classList.add("fadein")},h=()=>n.classList.remove("fadein");return(()=>{t.forEach((e=>{"active"==e.status&&o.set(e.uid,{time:e.time,lastname:e.lastname}),"todo"===e.status&&a.set(e.uid,{time:e.time,lastname:e.lastname})})),d();const l=e.div("update-actions");l.append(i);const u=["MM","AB","AG","RB","CW"].sort(),p=["Dilate","VisAcu","Orth","Ref","Img","Fields"].sort(),m=(e,t,n)=>{const s=document.createElement("li");return s.setAttribute("data-shortcode",e),s.setAttribute("data-type",t),s.innerHTML=n,s},g=e.namespace("pathstep");let y=r("Assign to"),v=c("btn-list");["unassigned"].concat(u).forEach((e=>{v.append(m(e,"assign",g.fullShortCode(e)))})),y.append(v),l.append(y),y=r("Add to patient pathway"),v=c("btn-list"),[].concat(u,["Nurse"]).forEach((e=>{const t=g.fullShortCode(e);v.append(m(e,"person",`${e} <small>- ${t}</small>`))})),p.forEach((e=>{const t=g.fullShortCode(e);v.append(m(e,"process",`${e} <small>- ${t}</small>`))})),y.append(v),l.append(y),n.append(e.div("close-btn"),s,l),h(),document.querySelector(".oe-clinic").append(n)})(),{showAll:()=>{e.show(s),e.hide(i),u(),p()},showSingle:(t,n,o)=>{e.hide(s),i.innerHTML=`${n} - ${o}`,e.show(i),l.clear(),l.add(t),p()},hide:h,onPatientArrived:e=>{a.has(e)&&(o.set(e,a.get(e)),a.delete(e)),d()},getSelectedPatients:()=>l}}})(bluejay),(function(e,t){"use strict";bluejay.namespace("clinic").clock=()=>{const t=e.div("oe-clinic-clock");t.textContent="",t.style.top="100%",document.body.appendChild(t);setInterval((()=>{const n=e.nodeArray(document.querySelectorAll("table.oe-clinic-list tbody tr"));if(!n.length)return void(t.style.top="100%");const s=Date.now();let i="100%";n.every((e=>!(e.dataset.timestamp>s)||(i=e.getBoundingClientRect().top-9+"px",!1))),t.style.top=i,t.textContent=e.clock24(new Date(s))}),500)}})(bluejay),(function(e,t){"use strict";bluejay.namespace("clinic").filterBtn=(t,n)=>{const s=t.filter,i=document.createElement("li"),o=e.div("count");i.className="filter-btn js-idg-clinic-btn-filter",i.setAttribute("data-filter",s),(()=>{const a=t.name,l=e.namespace("pathstep").fullShortCode(a),r=l!=a&&l,c=e.div("filter");let d=`<div class="name">${a}</div>`;r&&(d+=`<div class="fullname">${r}</div>`),c.innerHTML=d,"all"!==s&&"completed"!==s&&c.appendChild(o),i.appendChild(c),n.appendChild(i)})();return{update:(e,t)=>{const n=e.reduce(((e,t)=>t==s?e+1:e),0);o.textContent=n,t===s?i.classList.add("selected"):i.classList.remove("selected")}}}})(bluejay),(function(e,t,n){"use strict";t.patient=s=>{const i=document.createElement("tr"),o=e.div("pathway"),a=document.createElement("td"),l=document.createElement("td"),r=document.createElement("td"),c=Object.assign({_uid:s.uid,_status:null,_assigned:!1,get status(){return this._status},set status(e){this._status=e,this.views.notify()},get assigned(){return this._assigned},set assigned(e){this._assigned=e,this.views.notify()}},e.ModelViews()),d=t.waitDuration(s.uid);c.views.add((()=>{i.className=c.status,o.className=`pathway ${c.status}`,l.innerHTML="complete"==c.status?"":`<i class="oe-i plus-circle small-icon pad js-idg-clinic-icon-add" data-patient="${c._uid}"></i>`,d.render(c.status)})),c.views.add((()=>{const t=e.namespace("pathstep").fullShortCode(c.assigned);a.innerHTML="unassigned"==c.assigned?`<small class="fade">${t}</small>`:`<div>${t}</div>`})),c.views.add((()=>{r.innerHTML="","complete"==c.status&&(r.innerHTML='<span class="fade">Done</span>'),"active"==c.status&&(r.innerHTML=`<i class="oe-i save medium-icon pad js-has-tooltip js-idg-clinic-icon-complete" data-tt-type="basic" data-tooltip-content="Patient pathway finished" data-patient="${c._uid}"></i>`)}));const u=t=>{"arrive"==t.type&&d.arrived(t.timestamp,c.status),"finish"==t.type&&d.finished(t.timestamp),t.info=0==t.timestamp?"clock":e.clock24(new Date(t.timestamp)),n.pathStep(t,o)};return(()=>{c.status=s.status,c.assigned=s.assigned,c.time=s.time,c.lastname=s.lastname,s.pathway.forEach((e=>u(e))),i.setAttribute("data-timestamp",s.booked),i.innerHTML=Mustache.render(["<td>{{time}}</td>","<td>{{num}}</td>",'<td><div class="speciality">{{speciality}}</div><small class="type">{{specialityState}}</small></td>'].join(""),s),i.append(t.patientQuickView(s)),i.append(t.patientMeta(s)),i.append(l);const e=document.createElement("td");e.append(o),i.append(e),i.append(a),i.append(d.render(s.status)),i.append(r)})(),{onArrived:()=>{u({shortcode:"Arr",timestamp:Date.now(),status:"done",type:"arrive"}),c.status="active"},onDNA:()=>{u({shortcode:"DNA",timestamp:Date.now(),status:"done",type:"DNA"}),c.status="complete"},onComplete:()=>{u({shortcode:"Fin",timestamp:Date.now(),status:"done",type:"finish"}),c.status="complete"},render:e=>"completed"==e&&"complete"==c.status||"all"!==e&&"completed"!==e&&c.assigned!==e?null:i,getAssigned:()=>c.assigned,setAssigned:e=>c.assigned=e,getTime:()=>c.time,getLastname:()=>c.lastname,addPathStep:u}}})(bluejay,bluejay.namespace("clinic"),bluejay.namespace("gui")),(function(e,t){"use strict";bluejay.namespace("clinic").patientMeta=e=>{const t=['<div class="oe-patient-meta">','<div class="patient-name">','<span class="patient-surname">{{lastname}}</span>, ','<span class="patient-firstname">{{firstname}}</span>',"</div>",'<div class="patient-details">','<div class="nhs-number"><span>NHS</span>{{nhs}}</div>','<div class="patient-gender"><span>Gen</span>{{gender}}</div>','<div class="patient-age"><span>Age</span>{{age}}</div>',"</div>","</div>"].join(""),n=document.createElement("td");return n.innerHTML=Mustache.render(t,e),n}})(),(function(e,t){"use strict";bluejay.namespace("clinic").patientQuickView=e=>{const t=document.createElement("i");t.className="oe-i eye-circle medium pad js-patient-quick-overview",t.setAttribute("data-mode","side"),t.setAttribute("data-php","patient/quick/overview.php"),t.setAttribute("data-patient",JSON.stringify({surname:e.lastname,first:e.firstname,id:!1,nhs:e.nhs,gender:e.gender,age:e.age}));const n=document.createElement("td");return n.appendChild(t),n}})(),(function(e,t){"use strict";bluejay.namespace("clinic").waitDuration=t=>{const n=document.createElement("td");let s=null,i=0,o=null;const a=(e=!1)=>{const t=0==e?Date.now():e;i=Math.floor((t-s)/6e4)},l=()=>{const t=e.div("mins"),n=i>1?"mins":"min";return t.innerHTML=`<span>${i}</span><small>${n}</small>`,t},r=s=>{const o=e.div();return"complete"==s&&(o.className="wait-duration",o.appendChild(l())),"active"==s&&(o.className="wait-duration",o.appendChild((()=>{let e="green";i>14&&(e="yellow"),i>29&&(e="orange"),i>59&&(e="red");const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class",`duration-graphic ${e}`),t.setAttribute("viewBox","0 0 48 12"),t.setAttribute("height",12),t.setAttribute("width",48);for(let e=0;e<4;e++){const n=12*(e+1)-6,s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttribute("class",`c${e}`),s.setAttribute("cx",`${n}`),s.setAttribute("cy","6"),s.setAttribute("r","6"),t.appendChild(s)}return t})()),o.appendChild(l())),"todo"==s&&(o.className="flex",o.innerHTML=[`<button class="cols-7 blue hint js-idg-clinic-btn-arrived" data-patient="${t}">Arrived</button>`,`<button class="cols-4 js-idg-clinic-btn-DNA" data-patient="${t}">DNA</button>`].join("")),n.innerHTML="",n.appendChild(o),n};return{arrived:(e,t)=>{null===s&&(s=e,a(),o=setInterval((()=>{a(),r("active")}),15e3))},finished:e=>{clearInterval(o),a(e)},render:r}}})(bluejay),(function(e){"use strict";bluejay.namespace("pathstep").fullShortCode=e=>{let t=e;switch(e){case"Arr":t="Arrived";break;case"Fin":t="Finish";break;case"DNA":t="Did Not Attend";break;case"unassigned":t="Not assigned";break;case"MM":t="Mr Michael Morgan";break;case"AB":t="Dr Amit Baum";break;case"AG":t="Dr Angela Glasby";break;case"RB":t="Dr Robin Baum";break;case"CW":t="Dr Coral Woodhouse";break;case"Img":t="Imaging";break;case"VisAcu":t="Visual Acuity";break;case"Orth":t="Orthoptics";break;case"Fields":t="Visual Fields";break;case"Ref":t="Refraction";break;case"PSD":t="Patient Specific Directive";break;case"PGD":t="Patient Group Directive";break;case"PSD-A-overview":case"PSD-A":t="PSD: Haider Special Mix Set";break;case"PSD-B-overview":case"PSD-B":t="PSD: Pre Op drops";break;case"PSD-C-overview":case"PSD-C":t="PGD: HCA Nightingale";break;case"PSD-D":t="David Haider (Custom)"}return t}})(),(function(e,t){"use strict";e.addModule("gui.pathStep");t.pathStep=(()=>{const n="oe-pathstep-btn",s=new e.Collection,i=()=>({userDown(){t.pathStepPopup.full(this,!1)},userOver(){t.pathStepPopup.quick(this)},userOut(){t.pathStepPopup.hide()}}),o=()=>({render(){const e=[n];e.push(this.status),e.push(this.type),this.span.className=e.join(" "),this.updateInfo()}}),a=()=>({setType(e){this.type=e,this.render()},setStatus(e){this.status=e,this.render()},nextState(){let e;switch(this.status){case"config":e="todo";break;case"todo":e="active";break;case"active":e="done"}this.setStatus(e),t.pathStepPopup.full(this,!0)},setIdgPopupCode(e){this.idgCode=e}}),l=()=>({setInfo(t){if(this.info=t,this.info){const t=e.dom("span","info");this.span.append(t),this.iSpan=t,this.render()}},updateInfo(){this.info&&(this.iSpan.textContent="clock"===this.info?e.clock24(new Date(Date.now())):this.info,"todo"==this.status||"config"==this.status?this.iSpan.classList.add("invisible"):this.iSpan.classList.remove("invisible"))}}),r=()=>({remove(){this.span.remove(),s.delete(this.key)}}),c=e=>Object.assign(e,{type:null},{setKey(e){this.key=e}},o(),a(),l(),i(),r()),d=e=>{const t=s.getKey(e);return s.get(t)};e.userLeave(`.${n}`,(e=>d(e.target).userOut())),e.userEnter(`.${n}`,(e=>d(e.target).userOver())),e.userDown(`.${n}`,(e=>d(e.target).userDown()));return({shortcode:t,status:i,type:o,info:a,idgPopupCode:l},r)=>{const d=t.startsWith("i-")?`<span class="step ${t}"></span>`:`<span class="step">${t}</span>`,u=e.dom("span",n,d),p=c({shortcode:t,span:u});p.setStatus(i),p.setType(o),l&&p.setIdgPopupCode(l),p.setInfo(a),p.setKey(s.add(p,u)),"Arr"===t?r.prepend(u):r.append(u)}})()})(bluejay,bluejay.namespace("gui")),(function(e,t,n){"use strict";e.addModule("gui.pathStep");t.pathStepPopup=(()=>{const t=e.div("oe-pathstep-popup");let n=null,s=!1,i=null,o=null;const a=({shortcode:s,status:i,type:a,span:l,idgCode:r},c)=>{clearTimeout(n);const d=r||s;e.empty(t),t.classList.remove("arrow-t","arrow-b"),t.append((t=>{const n=e.div("close-icon-btn");return n.innerHTML=t?'<i class="oe-i remove-circle medium-icon"></i>':'<i class="oe-i expand small-icon"></i>',n})(c)),t.append((t=>{const n=e.dom("h3","title");return n.textContent=e.namespace("pathstep").fullShortCode(t),n})(d)),((n,s,i)=>{const a=`${n}.${s}`.toLowerCase();e.xhr(`/idg-php/load/pathstep/_ps.php?full=${i}&code=${a}`,o).then((e=>{o==e.token&&t.insertAdjacentHTML("beforeend",e.html)})).catch((e=>console.log("PHP failed to load",e)))})(d,i,c);const u=e.getWinH(),p=l.getBoundingClientRect();t.style.left=p.right-380+"px",p.bottom<.7*u?(t.style.top=p.bottom+2+"px",t.style.bottom="auto",t.classList.add("arrow-t")):(t.style.top="auto",t.style.bottom=u-p.top+2+"px",t.classList.add("arrow-b")),document.body.append(t)},l=()=>{i=null,s=!1,n=setTimeout((()=>t.remove()),50)};return e.userDown(".oe-pathstep-popup .close-icon-btn .oe-i",l),e.userDown(".oe-pathstep-popup .js-idg-ps-popup-btn",(e=>{const t=e.target.dataset.action;"remove"==t&&(i.remove(),l()),"next"==t&&i.nextState()})),{full:(e,t=!1)=>{e===i&&0==t?l():(i=e,o=e.key,s=!0,a(e,!0))},quick:e=>{s||(o=e.key,a(e,!1))},hide:()=>{s||l()},remove:l}})()})(bluejay,bluejay.namespace("gui"),bluejay.namespace("clinic")),(function(e){"use strict";Object.preventExtensions(e),e.ready()})(bluejay);