Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";const e={};return console.time("[bluejay] Ready"),console.time("[bluejay] DOM Loaded"),e.extend=((t,a)=>{if("function"!=typeof a)throw new TypeError("[bluejay] [app.js] - only extend with a function: "+t);if(a._bj||t in e)throw new TypeError("[bluejay] [app.js] - already extended with: "+t);e[t]=a,a._bj=!0}),e.log=(e=>{console.log("[bluejay] "+e)}),e.ready=(()=>{console.timeEnd("[bluejay] Ready")}),e.log("OE JS UI layer [bluejay] ..."),e.log("DEBUG MODE"),e.log("Mustache version: "+Mustache.version),document.addEventListener("DOMContentLoaded",()=>{e.log("[Modules] - "+e.registeredModules()),console.timeEnd("[bluejay] DOM Loaded")},{once:!0}),e})();!(function(e){"use strict";const t=new Map,a=new Map,o=new Map,s=new Set,r=(e,t,a)=>{if(e.has(t))throw new TypeError("DOM Events: selector already added : "+t);e.set(t,a)},n=(e,t)=>{const a=e.target;if(a===document)return!1;t.forEach((t,o)=>{a.matches(o)&&t(e)})},i=(()=>{let e=0;return{delay:()=>{clearTimeout(e),e=setTimeout(()=>{s.forEach(e=>{e()})},150)}}})();function l(e){n(e,a)}function d(e){n(e,t)}function c(e){n(e,o)}let u=e=>{document.removeEventListener("mouseenter",l,{capture:!0}),document.removeEventListener("mousedown",d,{capture:!0}),document.removeEventListener("mouseleave",c,{capture:!0}),n(e,t),u=(e=>{n(e,t)})};document.addEventListener("mouseenter",l,{capture:!0}),document.addEventListener("mousedown",d,{capture:!0}),document.addEventListener("mouseleave",c,{capture:!0}),document.addEventListener("touchstart",e=>u(e),{capture:!0}),window.onresize=(()=>i.delay()),e.extend("userEnter",(e,t)=>r(a,e,t)),e.extend("userDown",(e,a)=>r(t,e,a)),e.extend("userLeave",(e,t)=>r(o,e,t)),e.extend("listenForResize",e=>s.add(e))})(bluejay),(function(e){"use strict";const t=(function*(){let e=10;for(;;)yield++e})(),a=()=>t.next().value;function o(){this.map=new Map,this.dataAttr="data-oebjk"}e.extend("getKey",a),o.prototype.add=function(e,t){const o=a();return this.map.set(o,e),t.setAttribute(this.dataAttr,o),o},o.prototype.getKey=function(e){let t=e.getAttribute(this.dataAttr);return null!==t&&""!=t&&t},o.prototype.get=function(e){return"string"==typeof e&&(e=parseInt(e,10)),this.map.get(e)},o.prototype.has=function(e){return this.map.has(e)},e.extend("Collection",o)})(bluejay),(function(e){"use strict";bluejay.extend("customEvent",(e,t)=>{bluejay.log('[Custom Event] - "'+e+'"');const a=new CustomEvent(e,{detail:t});document.dispatchEvent(a)})})(),(function(e){"use strict";e.extend("nodeArray",e=>Array.prototype.slice.call(e)),e.extend("appendTo",(e,t,a)=>{(a||document).querySelector(e).appendChild(t)}),e.extend("getParent",(e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1}),e.extend("removeElement",e=>{e.parentNode.removeChild(e)}),e.extend("show",(e,t="")=>{null!==e&&(e.style.display=t)}),e.extend("reshow",e=>{null!==e&&(e.style.display="")}),e.extend("hide",e=>{null!==e&&(e.style.display="none")}),e.extend("xhr",t=>(e.log("[XHR] - "+t),new Promise((a,o)=>{let s=new XMLHttpRequest;s.open("GET",t),s.onreadystatechange=function(){4===s.readyState&&(s.status>=200&&s.status<300?(e.log("[XHR] - Success"),a(s.responseText)):(e.log("[XHR] - Failed"),o(this.status+" "+this.statusText)))},s.send()}))),e.extend("getHiddenElemSize",e=>{e.style.visibility="hidden",e.style.display="";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="inherit",e.style.display="none",t}),e.extend("idgReporter",e=>{let t="idg-js-ui-message-out",a=document.getElementById(t),o=document.createElement("li");null===a&&((a=document.createElement("ul")).id=t,a.style="position:fixed; bottom:10px; right:10px; z-index:9999; background:orange; padding:10px; list-style-position:inside; max-height:vh90; overflow-y: scroll; font-size:14px;",document.body.appendChild(a));let s=a.children.length;o.appendChild(document.createTextNode(s+" - "+e)),a.appendChild(o)})})(bluejay),(function(e){"use strict";const t=[],a=new Map;e.extend("addModule",e=>t.push(e)),e.extend("registeredModules",()=>(t.sort(),t.join(", "))),e.extend("namespace",e=>(a.has(e)||a.set(e,{}),a.get(e)))})(bluejay),(function(e){"use strict";const t={list:new Set,add(e){return this.list.add(e),this.list.has(e)},remove(e){this.list.remove(e)},size(){return this.list.size},notify(){let e=this.list.values();for(let t of e)t()}};e.extend("ModelViews",()=>({views:Object.create(t)}))})(bluejay),(function(e){"use strict";const t=(e=!1)=>{return"data-"+(e?"bluejay-"+e:"bluejay")};e.extend("settings",t=>{switch(t){case"cssHeaderHeight":return 60;case"cssExtended":return 1440;case"cssHotlistFixed":return 1890;case"idgPHPLoadURL":return"/idg-php/v3/_load/";default:return e.log("Setting request not recognised: "+t),null}}),e.extend("getDataAttributeName",t),e.extend("setDataAttr",(e,a)=>{e.setAttribute(t(),a)}),e.extend("getDataAttr",e=>{const a=t();return!!e.hasAttribute(a)&&e.getAttribute(a)})})(bluejay);const oePlotly=(function(e){"use strict";bluejay.log("oePlotly - Plot.ly layout builder");const t={dark:{blue:"#63d7d6",green:"#65d235",greenSeries:["#65d235","#94d712","#36be8d","#099f18","#9bd727"],red:"#ea2b34",redSeries:["#ea2b34","#D41C81","#F65B20","#D4341C"],standard:["#1451b3","#175ece","#1a69e5"],varied:["#0a83ea","#18949f","#781cea","#3f0aea"],dual:["#3f0aea","#7b3131"]},light:{blue:"#00f",green:"#418c20",greenSeries:["#418c20","#99991C","#1DA323","#74A31D","#1C9944"],red:"#da3e43",redSeries:["#da3e43","#F0379A","#E66735","#F05037"],standard:["#0a4198","#1451b3","#175ece"],varied:["#0a2aea","#ea0a8e","#00b827","#890aea"],dual:["#0a4198","#874e4e"]}},a=e=>"dark"===e;return{isDarkTheme:a,getBlue:e=>e?t.dark.blue:t.light.blue,getColorSeries:(e,a)=>{let o=null;switch(e){case"varied":o=a?t.dark.varied:t.light.varied;break;case"twoPosNeg":o=a?t.dark.dual:t.light.dual;break;case"rightEye":o=a?t.dark.greenSeries:t.light.greenSeries;break;case"leftEye":o=a?t.dark.redSeries:t.light.redSeries;break;default:o=a?t.dark.standard:t.light.standard}return o},getColorFor:(e,o)=>{switch("string"==typeof o&&(o=a(o)),e){case"rightEye":return o?t.dark.green:t.light.green;case"leftEye":return o?t.dark.red:t.light.red;case"error_y":return o?"#5b6c77":"#7da7cb";default:return"pink"}},dashedLine:e=>({dash:"2px,2px",width:2}),markerFor:e=>"image"==e?{symbol:"triangle-down",size:10}:"drug"==e?{symbol:"star-diamond",size:9}:{},defaultAxis:(e,t)=>{"string"==typeof t&&(t=a(t));let o={linecolor:t?"#666":"#999",linewidth:1,showgrid:!0,gridcolor:t?"#292929":"#e6e6e6",tickmode:"auto",nticks:20,ticks:"outside",ticklen:3,tickcolor:t?"#666":"#ccc",automargin:!0,mirror:!0};return Object.assign(o,e)},makeCategoryAxis:(e,t,a=!0)=>(e.type="category",e.categoryarray=[" "].concat(t),a&&(e.range=[0,t.length+1]),e),addSpikes:(e,t)=>{"string"==typeof t&&(t=a(t)),e.showspikes=!0,e.spikecolor=t?"#0ff":"#00f",e.spikethickness=t?.5:1,e.spikedash=t?"1px,3px":"2px,3px"}}})();!(function(e){"use strict";e.findRegression=function(e,t){let a=0,o=0,s=0,r=0,n=0,i=0,l=0,d=e.length;if(d!=t.length)throw new Error("The parameters values_x and values_y need to have same size!");if(0===d)return[[],[]];for(let c=0;c<d;c++)a+=i=e[c],o+=l=t[c],r+=i*i,s+=i*l,n++;const c=(n*s-a*o)/(n*r-a*a),u=o/n-c*a/n;let y=[],p=[];for(let t=0;t<d;t++)l=(i=e[t])*c+u,y.push(parseFloat(Number.parseFloat(i).toFixed(2))),p.push(parseFloat(Number.parseFloat(l).toFixed(2)));return{x:y,y:p}}})(oePlotly),(function(e){"use strict";e.getLayout=function(t){const a=e.isDarkTheme(t.theme);let o={hovermode:"closest",autosize:!0,margin:{l:60,r:60,t:30,b:80,pad:4,autoexpand:!0},paper_bgcolor:a?"rgba(30,46,66,0.5)":"rgba(255,255,255,0.5)",plot_bgcolor:a?"rgb(10,10,30)":"#fff",font:{family:"Roboto, 'Open Sans', verdana, arial, sans-serif",size:11,color:a?"#aaa":"#333"},showlegend:t.legend,legend:{font:{size:10},orientation:"h",xanchor:"right",yanchor:"top",x:1,y:1},hoverlabel:{bgcolor:a?"#003":"#fff",bordercolor:a?"#003":"#00f",font:{size:11,color:e.getBlue(a)}}};t.colors?o.colorway=e.getColorSeries(t.colors,a):o.colorway=e.getColorSeries("default",a),t.plotTitle&&(o.title={text:t.plotTitle,xref:"paper",yref:"container",x:0,y:.97,font:{size:15}},o.margin.t=60);let s=e.defaultAxis({},a);if(t.spikes&&(s.showspikes=!0,s.spikecolor=a?"#0ff":"#00f",s.spikethickness=a?.5:1,s.spikedash=a?"1px,3px":"2px,3px"),o.xaxis=Object.assign({},s),o.xaxis.nticks=t.numTicksX,o.yaxis=Object.assign({},s),o.yaxis.nticks=t.numTicksY,!1===t.zoom&&(o.xaxis.fixedrange=!0,o.yaxis.fixedrange=!0),t.rangeX&&(o.xaxis.range=t.rangeX),t.rangeY&&(o.yaxis.range=t.rangeY),t.useCategories&&(o.yaxis=e.makeCategoryAxis(o.yaxis,t.useCategories.categoryarray,t.useCategories.showAll)),t.datesOnAxis)switch(t.datesOnAxis){case"x":o.xaxis.tickformat="%e %b %Y";break;case"y":o.yaxis.tickformat="%e %b %Y"}t.titleX&&(o.xaxis.title={text:t.titleX,standoff:20,font:{size:12}}),t.titleY&&(o.yaxis.title={text:t.titleY,standoff:15,font:{size:12}},o.margin.l=80),t.y2&&(o.yaxis2=Object.assign({},s),o.yaxis2.nticks=t.numTicksY,o.yaxis2.overlaying="y",o.yaxis2.side="right",o.yaxis2.showgrid=!1,t.y2.range&&(o.yaxis2.range=t.y2.range),t.y2.useCategories&&(o.yaxis2=e.makeCategoryAxis(o.yaxis2,t.y2.useCategories.categoryarray,t.y2.useCategories.showAll)),t.y2.title&&(o.yaxis2.title={text:t.y2.title,standoff:15,font:{size:12}},o.margin.r=80)),t.subplot&&(o.grid={rows:2,columns:1,pattern:"independent"},o.yaxis.domain=t.domain,o.yaxis2&&(o.yaxis2.domain=t.domain));let r=[],n=[];if(t.vLineMarker){const o=(t,o)=>({type:"line",layer:"below",yref:"paper",x0:t.x,y0:0,x1:t.x,y1:t.y,line:{color:e.getBlue(a),width:1,dash:"3px,1px"}}),s=(t,o)=>({showarrow:!1,text:t.name,textangle:90,align:"left",font:{color:e.getBlue(a)},borderpad:2,x:t.x,xshift:8,yref:"paper",y:t.y});r=r.concat(t.vLineMarker.map(o)),n=n.concat(t.vLineMarker.map(s))}if(t.hLineMarker){const o=(t,o)=>({type:"line",layer:"below",xref:"paper",yref:t.axis,x0:0,y0:t.y,x1:1,y1:t.y,line:{color:e.getBlue(a),width:2,dash:"3px,9px"}}),s=(t,o)=>({showarrow:!1,text:t.name,align:"left",font:{color:e.getBlue(a)},borderpad:2,xref:"paper",x:0,yshift:8,yref:t.axis,y:t.y});r=r.concat(t.hLineMarker.map(o)),n=n.concat(t.hLineMarker.map(s))}return o.shapes=r,o.annotations=n,t.rangeslider&&(o.xaxis.rangeslider=a?{bgcolor:o.paper_bgcolor,borderwidth:1,bordercolor:o.plot_bgcolor,thickness:.1}:{thickness:.1},o.margin.b=40),o}})(oePlotly),(function(e){"use strict";const t=e=>{const t={x:["2010-06-07","2011-06-13","2011-09-03","2012-06-02","2015-02-04","2015-05-01","2016-10-10","2017-12-08"],y:["6/9","6/9","6/9","6/18","6/6","6/6","HM","HM"],name:"VA",hovertemplate:"Snellen Metre: %{y}<br>%{x}",type:"scatter",mode:"lines+markers"},a={x:["2003-01-07","2003-06-03","2004-06-06","2004-12-21","2006-01-06","2007-07-21","2008-03-03","2008-09-14","2010-06-07","2010-09-01","2011-03-11","2011-03-28","2011-05-30","2011-06-13","2011-06-14","2011-07-11","2011-09-03","2011-09-04","2012-03-17","2012-09-03","2014-12-22","2015-02-04","2015-05-01","2016-01-07","2016-10-10","2017-12-08"],y:[30,17,15,18,14,32,32,32,20,12,13,14,26,18,17,22,22,22,20,24,19,18,19,50,10,10],name:"IOP",yaxis:"y3",hovertemplate:"IOP: %{y}<br>%{x}",type:"scatter",mode:"lines+markers"},o={x:["2003-01-10","2003-06-12"],y:["Timolol","Timolol"],customdata:["Timolol 0.25% eye drops","Timolol 0.25% eye drops"],name:"",yaxis:"y4",hovertemplate:"%{y}<br>%{customdata}<br>%{x}",type:"scatter",mode:"lines+markers",marker:oePlotly.markerFor("drug")},s={x:["2003-06-12","2010-09-29"],y:["Latanoprost","Latanoprost"],customdata:["Latanoprost 0.005% eye drops (XALATAN)","Latanoprost 0.005% eye drops (XALATAN)"],name:"",yaxis:"y4",hovertemplate:"%{y}<br>%{customdata}<br>%{x}",type:"scatter",mode:"lines+markers",marker:oePlotly.markerFor("drug")},r={x:["2010-09-29","2017-12-08"],y:["Latanoprost","Latanoprost"],customdata:["Latanoprost 0.005% eye drops (MONOPOST)","Latanoprost 0.005% eye drops (MONOPOST)"],name:"",yaxis:"y4",hovertemplate:"%{y}<br>%{customdata}<br>%{x}",type:"scatter",mode:"lines+markers",marker:oePlotly.markerFor("drug")},n={x:["2011-07-10","2017-12-08"],y:["Dorzolamide","Dorzolamide"],customdata:["Dorzolamide 2% single use eye drops (TRUSOPT)","Dorzolamide 2% single use eye drops (TRUSOPT)"],name:"",yaxis:"y4",hovertemplate:"%{y}<br>%{customdata}<br>%{x}",type:"scatter",mode:"lines+markers",marker:oePlotly.markerFor("drug")};return"right"==e?[t,a,o,s,r,n]:[{x:["2010-06-07","2011-06-13","2011-09-03","2012-06-02","2015-02-04","2015-05-01","2016-10-10","2017-12-08"],y:["6/6","6/6","6/6","6/12","6/12","6/7.5","6/9","6/9"],name:"VA",hovertemplate:"Snellen Metre: %{y}<br>%{x}",type:"scatter",mode:"lines+markers"}]},a=(e,t)=>oePlotly.getLayout({theme:window.oeThemeMode,legend:!1,colors:t,plotTitle:e,titleY:"VA (Snellen Metre)",numTicksX:10,numTicksY:20,datesOnAxis:"x",useCategories:{showAll:!0,categoryarray:["6/3","6/4","6/5","6/6","6/7.5","6/9","6/9.5","6/12","6/15","6/18","6/24","6/30","6/36","6/48","6/60","6/75","6/95","3/60","2/60","1/60","CF","HM","PL","NPL"].reverse()},rangeslider:!0,subplot:!0,domain:[0,.35],spikes:!0,vLineMarker:[{x:"2011-03-12",y:.75,name:"SLT"},{x:"2011-05-06",y:.75,name:"Traby, MMC"},{x:"2015-01-01",y:.75,name:"Phaco + IOL"},{x:"2015-09-09",y:.75,name:"PRP"},{x:"2015-09-10",y:.75,name:"PRP"},{x:"2016-02-21",y:.75,name:"Cycloablation"}],hLineMarker:[{axis:"y3",y:15,name:"Target IOP"}]}),o=e=>{const t=document.createElement("div");return t.id=e,t.style.height="calc(100vh - 150px)",t.style.minHeight="850px",t};e.extend("oesGlaucoma",e=>{const s=t("right"),r=t("left"),n=a("Right Eye","rightEye"),i=a("Left Eye","leftEye");let l={domain:[.4,.75],range:[0,75],title:{text:"IOP"}};oePlotly.addSpikes(l,window.oeThemeMode);let d={domain:[.8,1],range:[0,5]};d=oePlotly.makeCategoryAxis(d,["Timolol","Latanoprost","Dorzolamide"].reverse(),!0),n.yaxis3=oePlotly.defaultAxis(l,window.oeThemeMode),n.yaxis4=oePlotly.defaultAxis(d,window.oeThemeMode);const c=o("idgPlotlyLeft"),u=o("idgPlotlyRight");document.querySelector(".oes-left-side").appendChild(c),document.querySelector(".oes-right-side").appendChild(u),Plotly.newPlot(c,s,n,{displayModeBar:!1,responsive:!0}),Plotly.newPlot(u,r,i,{displayModeBar:!1,responsive:!0}),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(c,n),Plotly.relayout(u,i)})}),console.log(e)})(bluejay),(function(e){"use strict";e.addModule("collapseExpand");const t=[],a=()=>({show:function(){e.show(this.content,"block"),this.btn.classList.replace("expand","collapse"),this.open=!0}}),o=()=>({hide:function(){e.hide(this.content),this.btn.classList.replace("collapse","expand"),this.open=!1}}),s=e=>Object.assign(e,{change:function(){this.open?this.hide():this.show()}},a(),o()),r=(a,o)=>{let r=a.target,n=e.getDataAttr(r);if(n)t[parseFloat(n)].change();else{e.setDataAttr(r,t.length);let a={btn:r,content:r.parentNode.querySelector(".collapse-"+o+"-content"),open:r.classList.contains("collapse")},n=s(a);n.change(),t.push(n)}};e.userDown(".collapse-data-header-icon",e=>r(e,"data")),e.userDown(".collapse-group > .header-icon",e=>r(e,"group"))})(bluejay),(function(e){"use strict";const t=e.nodeArray(document.querySelectorAll(".hidden"));t.length&&t.forEach(t=>{e.hide(t),t.classList.remove("hidden")});const a=e.nodeArray(document.querySelectorAll(".tr-collapse"));a.length&&a.forEach(e=>{e.style.visibility="collapse",e.classList.remove("tr-collapse")})})(bluejay),(function(e){"use strict";e.addModule("tooltip");const t={selector:".js-has-tooltip",css:{basicWidth:200,bilateralWidth:400},showing:!1,target:null,type:"basic",tip:null,eyeIcons:null,onChange(e){if("function"!=typeof e)throw new Error("Tooltip Model requires View callback as funciton");this.onChange=e},reset(){this.showing=!1,this.target=null,this.onChange()},update(e){this.showing=!0,this.target=e,"bilateral"==e.dataset.ttType?(this.type="bilateral",this.eyeIcons="no"!==e.dataset.ttEyeicons,this.tip={r:e.dataset.ttRight,l:e.dataset.ttLeft}):(this.type="basic",this.tip=e.dataset.tooltipContent),this.onChange()}},a=((t=>{let a,o=null,s="block",r=t.css.basicWidth,n=window.innerWidth;e.listenForResize(()=>n=window.innerWidth);const i=()=>{o.innerHTML="",o.className="oe-tooltip",o.style.cssText="display:none"},l=()=>{o=o||(()=>(o=document.createElement("div"),e.appendTo("body",o),i(),o))(),"block"==s?o.innerHTML=t.tip:(o.classList.add("bilateral"),t.eyeIcons||o.classList.add("no-icons"),o.innerHTML='<div class="right"></div><div class="left"></div>',o.querySelector(".right").innerHTML=t.tip.r,o.querySelector(".left").innerHTML=t.tip.l);let a=r/2,l=e.getHiddenElemSize(o).h,d=t.target.getBoundingClientRect(),c=d.right-d.width/2,u=d.top-l-8,y=e.settings("cssHotlistFixed"),p=n>y?y:n;c<=a&&(a=20,o.classList.add("offset-right")),c>p-a&&(a=r-20,o.classList.add("offset-left")),d.top<l&&(u=d.bottom+8,o.classList.add("inverted")),o.style.top=u+"px",o.style.left=c-a+"px",o.style.display=s};t.onChange(()=>{0==t.showing?i():(a=t.tip,"basic"==t.type?(s="block",r=t.css.basicWidth):(s="flex",r=t.css.bilateralWidth),l())})})(t),e=>{t.update(e.target),window.addEventListener("scroll",o,{capture:!0,once:!0})}),o=e=>{t.showing&&t.reset()};e.userDown(t.selector,e=>{e.target.isSameNode(t.target)&&t.showing?o():a(e)}),e.userEnter(t.selector,a),e.userLeave(t.selector,o)})(bluejay),(function(e){"use strict";Object.preventExtensions(e),e.ready()})(bluejay);