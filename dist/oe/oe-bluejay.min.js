Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);const bluejay=(function(){"use strict";const e={};return console.time("[bluejay] Ready"),console.time("[bluejay] DOM Loaded"),e.extend=(t,o)=>{if("function"!=typeof o)throw new TypeError("[bluejay] [app.js] - only extend with a function: "+t);if(o._bj||t in e)throw new TypeError("[bluejay] [app.js] - already extended with: "+t);e[t]=o,o._bj=!0},e.log=e=>{console.log("[bluejay] "+e)},e.ready=()=>{console.timeEnd("[bluejay] Ready")},e.log("OE JS UI layer [bluejay] ..."),e.log("DEBUG MODE"),e.log("Mustache version: "+Mustache.version),document.addEventListener("DOMContentLoaded",()=>{e.log("[Modules] - "+e.registeredModules()),console.timeEnd("[bluejay] DOM Loaded")},{once:!0}),e})();!(function(e){"use strict";const t=(function*(){let e=10;for(;;)yield++e})(),o=()=>t.next().value;function a(){this.map=new Map,this.dataAttr="data-oebjk"}e.extend("getKey",o),a.prototype.add=function(e,t){const a=o();return this.map.set(a,e),t.setAttribute(this.dataAttr,a),a},a.prototype.getKey=function(e){let t=e.getAttribute(this.dataAttr);return null!==t&&""!=t&&t},a.prototype.get=function(e){return"string"==typeof e&&(e=parseInt(e,10)),this.map.get(e)},a.prototype.getFirst=function(){return this.map.values().next().value},a.prototype.next=function(e){const t=this.map.keys();let o=t.next();for(;!o.done;){if(o.value===e)return t.next().value;o=t.next()}},a.prototype.prev=function(e){const t=this.map.keys();let o=!1;for(const a of t){if(a===e)return o;o=a}},a.prototype.has=function(e){return this.map.has(e)},e.extend("Collection",a)})(bluejay),(function(e){"use strict";bluejay.extend("customEvent",(e,t)=>{const o=new CustomEvent(e,{detail:t});document.dispatchEvent(o)})})(),(function(e){"use strict";new URL(window.location).hostname;const t=new Map,o=new Map,a=new Map,l=new Set,s=(e,t,o)=>{if(e.has(t))throw new TypeError("Event Delegation: selector already added : "+t);e.set(t,o)},r=(e,t)=>{const o=e.target;if(o===document)return!1;t.forEach((t,a)=>{o.matches(a)&&t(e)})},n=(()=>{let e=0;return{delay:()=>{clearTimeout(e),e=setTimeout(()=>{l.forEach(e=>{e()})},150)}}})();function i(e){r(e,o)}function y(e){r(e,t)}function d(e){r(e,a)}window.onresize=()=>n.delay();let c=e=>{document.removeEventListener("mouseenter",i,{capture:!0}),document.removeEventListener("mousedown",y,{capture:!0}),document.removeEventListener("mouseleave",d,{capture:!0}),r(e,t),c=e=>{r(e,t)}};document.addEventListener("mouseenter",i,{capture:!0}),document.addEventListener("mousedown",y,{capture:!0}),document.addEventListener("mouseleave",d,{capture:!0}),document.addEventListener("touchstart",e=>c(e),{capture:!0}),e.extend("userEnter",(e,t)=>s(o,e,t)),e.extend("userDown",(e,o)=>s(t,e,o)),e.extend("userLeave",(e,t)=>s(a,e,t)),e.extend("listenForResize",e=>l.add(e))})(bluejay),(function(e){"use strict";const t=e=>{e.parentNode.removeChild(e)};const o=(function*(){let e=1;for(;;)++e,yield"t-"+e})();e.extend("nodeArray",e=>Array.prototype.slice.call(e)),e.extend("find",(e,t)=>(t||document).querySelector(e)),e.extend("getParent",(e,t)=>{for(;!e.matches("body");){if(e.matches(t))return e;e=e.parentNode}return!1}),e.extend("wrap",(e,t="")=>{const o=document.createElement("div"),a=window.getComputedStyle(e);return o.style.width=a.getPropertyValue("width"),o.style.position="relative",o.style.display="inline-block",e.style.width="100%",e.parentNode.insertBefore(o,e),o.appendChild(e),o}),e.extend("unwrap",e=>{const o=e.parentNode,a=o.parentNode;e.style.width="",a.insertBefore(e,o),t(o)}),e.extend("div",e=>{const t=document.createElement("div");return t.className=e,t}),e.extend("remove",t),e.extend("show",(e,t="")=>{null!==e&&(e.style.display=t)}),e.extend("reshow",e=>{null!==e&&(e.style.display="")}),e.extend("hide",e=>{null!==e&&(e.style.display="none")}),e.extend("xhr",(t,o=!1)=>(e.log("[XHR] - "+t),new Promise((a,l)=>{let s=new XMLHttpRequest;s.open("GET",t),s.onreadystatechange=function(){4===s.readyState&&(s.status>=200&&s.status<300?(e.log("[XHR] - Success"),s.token=o,a({html:s.responseText,token:o})):(e.log("[XHR] - Failed"),l(this.status+" "+this.statusText)))},s.send()}))),e.extend("getToken",()=>o.next().value),e.extend("loadJS",(t,o=!1)=>(e.log("[JS script] - "+t),new Promise((a,l)=>{const s=document.createElement("script");s.src=t,o&&s.setAttribute("crossorigin",""),s.onload=()=>{setTimeout(()=>{e.log("[JS loaded] - "+t),a()},100)},s.onerror=()=>e.log("[JS ERROR ] - "+t),document.head.appendChild(s)}))),e.extend("getHiddenElemSize",e=>{e.style.visibility="hidden",e.style.display="";let t={w:e.offsetWidth,h:e.offsetHeight};return e.style.visibility="",e.style.display="none",t}),e.extend("idgReporter",e=>{let t="idg-js-ui-message-out",o=document.getElementById(t),a=document.createElement("li");null===o&&(o=document.createElement("ul"),o.id=t,o.style="position:fixed; bottom:10px; right:10px; z-index:9999; background:orange; padding:10px; list-style-position:inside; max-height:vh90; overflow-y: scroll; font-size:14px;",document.body.appendChild(o));let l=o.children.length;a.appendChild(document.createTextNode(l+" - "+e)),o.appendChild(a)}),e.extend("clock24",e=>e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0"))})(bluejay),(function(e){"use strict";const t=[],o=new Map;e.extend("addModule",e=>t.push(e)),e.extend("registeredModules",()=>(t.sort(),t.join(", "))),e.extend("namespace",e=>(o.has(e)||o.set(e,{}),o.get(e)))})(bluejay),(function(e){"use strict";const t=()=>({list:new Set,add(e){return this.list.add(e),this.list.has(e)},remove(e){this.list.remove(e)},size(){return this.list.size},notify(){let e=this.list.values();for(let t of e)t()}});bluejay.extend("ModelViews",()=>({views:Object.create(t())}))})(),(function(e){"use strict";let t=window.innerWidth,o=window.innerHeight;e.listenForResize(()=>{t=window.innerWidth,o=window.innerHeight});const a=(e=!1)=>"data-"+(e?"bluejay-"+e:"bluejay");e.extend("settings",t=>{switch(t){case"cssHeaderHeight":return 60;case"cssExtended":return 1440;case"cssHotlistFixed":return 1890;case"idgPHPLoadURL":return"/idg-php/v3/_load/";default:return e.log("Setting request not recognised: "+t),null}}),e.extend("getWinH",()=>o),e.extend("getWinW",()=>t),e.extend("getDataAttributeName",a),e.extend("setDataAttr",(e,t)=>{e.setAttribute(a(),t)}),e.extend("getDataAttr",e=>{const t=a();return!!e.hasAttribute(t)&&e.getAttribute(t)})})(bluejay);const oePlotly=(function(e){"use strict";e.log("Plot.ly version: "+Plotly.version),e.log("oePlotly - Plot.ly builder available");const t={blue:"#63d7d6",highlight:"#fff",green:"#65d235",red:"#ea2b34",greenSeries:["#65d235","#A5D712","#02B546"],redSeries:["#ea2b34","#F64A2D","#C92845"],yellowSeries:["#FAD94B","#E8B131","#F1F555"],standard:["#1451b3","#175ece","#1a69e5"],varied:["#0a83ea","#18949f","#781cea","#3f0aea"],dual:["#1472DE","#2E4259"]},o={blue:"#00f",highlight:"#000",green:"#418c20",red:"#da3e43",greenSeries:["#418c20","#598617","#139149"],redSeries:["#da3e43","#E64C02","#E64562"],yellowSeries:["#FCCE14","#E69812","#FCBB21"],standard:["#0a4198","#1451b3","#175ece"],varied:["#0a2aea","#ea0a8e","#00b827","#890aea"],dual:["#2126C2","#8FAEC2"]},a=(e,a)=>{switch(e){case"highlight":return a?t.highlight:o.highlight;case"rightEye":return a?t.green:o.green;case"leftEye":return a?t.red:o.red;default:return"pink"}};return{isDarkTheme:()=>"dark"===window.oeThemeMode,getBlue:e=>e?t.blue:o.blue,getColorSeries:(e,a)=>{let l=null;const s=t,r=o;switch(e){case"varied":l=a?s.varied:r.varied;break;case"posNeg":l=a?s.dual:r.dual;break;case"rightEyeSeries":l=a?s.greenSeries:r.greenSeries;break;case"leftEyeSeries":l=a?s.redSeries:r.redSeries;break;case"BEOSeries":l=a?s.yellowSeries:r.yellowSeries;break;default:l=a?s.standard:r.standard}return l},getColor:a,getColorFor:(e,t)=>a(e,t)}})(bluejay);!(function(e){"use strict";e.findRegression=function(e,t){let o=0,a=0,l=0,s=0,r=0,n=0,i=0,y=e.length;if(y!=t.length)throw new Error("The parameters values_x and values_y need to have same size!");if(0===y)return[[],[]];for(let d=0;d<y;d++)n=e[d],i=t[d],o+=n,a+=i,s+=n*n,l+=n*i,r++;const d=(r*l-o*a)/(r*s-o*o),c=a/r-d*o/r;let u=[],p=[];for(let t=0;t<y;t++)n=e[t],i=n*d+c,u.push(parseFloat(Number.parseFloat(n).toFixed(2))),p.push(parseFloat(Number.parseFloat(i).toFixed(2)));return{x:u,y:p}}})(oePlotly),(function(e){"use strict";e.getAxis=function(e,t){let o={linecolor:t?"#666":"#999",linewidth:1,showgrid:!0,gridcolor:t?"#292929":"#e6e6e6",tickmode:"auto",nticks:20,ticks:"outside",ticklen:3,tickcolor:t?"#666":"#ccc",automargin:!0,mirror:!0,connectgaps:!1};const a="y"==e.type;if(e.noMirrorLines&&(o.mirror=!1),e.domain&&a&&(o.domain=e.domain),e.title&&(o.title={text:e.title,standoff:a?10:20,font:{size:12}}),e.rightSide&&a&&(o.overlaying=e.rightSide,o.side="right",o.showgrid=!1,o.zeroline=!1,o.title.standoff=15),e.numTicks&&(o.nticks=e.numTicks),e.useDates&&(o.tickformat="%b %Y"),e.fixRange&&(o.fixedrange=!0),e.range&&(o.range=e.range),e.axisType&&(o.type=e.axisType),e.useCategories){let t=e.useCategories.categoryarray;o.type="category",o.categoryarray=[" "].concat(t),e.useCategories.showAll&&(o.range=[0,t.length+1])}return e.spikes&&(o.showspikes=!0,o.spikecolor=t?"#0ff":"#00f",o.spikethickness=t?.5:1,o.spikedash=t?"1px,3px":"2px,3px"),o}})(oePlotly),(function(e){"use strict";e.getLayout=function(t){const o=t.darkTheme;let a={isDark:o,hovermode:"closest",autosize:!0,margin:{l:50,r:50,t:30,b:40,pad:4,autoexpand:!0},paper_bgcolor:o?"rgba(30,46,66,0.5)":"rgba(255,255,255,0.5)",plot_bgcolor:o?"rgb(10,10,30)":"#fff",font:{family:"Roboto, 'Open Sans', verdana, arial, sans-serif",size:11,color:o?"#aaa":"#333"},hoverlabel:{bgcolor:o?"#003":"#fff",bordercolor:o?"#003":"#00f",font:{size:11,color:e.getBlue(o)}}};if(t.colors?a.colorway=e.getColorSeries(t.colors,o):a.colorway=e.getColorSeries("default",o),t.plotTitle&&(a.title={text:t.plotTitle,xref:"paper",yref:"container",x:0,y:1,yanchor:"top",pad:{t:20},font:{size:15}},a.margin.t=50),t.legend){a.showlegend=!0;const e={font:{size:9},itemclick:"toggleothers",orientation:"h",xanchor:"right",yanchor:"bottom",x:1,y:1};"boolean"==typeof t.legend?a.legend=e:a.legend=Object.assign(e,t.legend)}else a.showlegend=!1;if(t.subplot&&(a.grid={rows:t.subplot,columns:1,pattern:"independent"}),a.shapes=[],a.annotations=[],t.vLineLabel){const l=t.vLineLabel.x,s=t.vLineLabel.h,r=(t,a)=>({type:"line",layer:"above",yref:"paper",x0:t.x,y0:0,x1:t.x,y1:s,line:{color:e.getBlue(o),width:.5}}),n=(t,a)=>({showarrow:!1,text:t.name,textangle:90,align:"left",font:{color:e.getBlue(o)},borderpad:2,x:t.x,xshift:8,yref:"paper",y:s});a.shapes=a.shapes.concat(l.map(r)),a.annotations=a.annotations.concat(l.map(n))}if(t.hLineLabel){const l=t.hLineLabel.y,s=t.hLineLabel.axis,r=(t,a)=>({type:"line",layer:"below",xref:"paper",yref:s,x0:0,y0:t.y,x1:1,y1:t.y,line:{color:e.getBlue(o),width:2,dash:"3px,12px"}}),n=(t,a)=>({showarrow:!1,text:t.name,align:"left",font:{color:e.getBlue(o)},borderpad:2,xref:"paper",x:0,yshift:8,yref:s,y:t.y});a.shapes=a.shapes.concat(l.map(r)),a.annotations=a.annotations.concat(l.map(n))}if(t.xaxis&&(a.xaxis=t.xaxis,a.xaxis.title&&(a.margin.b=80)),t.yaxes&&t.yaxes.forEach((e,t)=>{t?a["yaxis"+(t+1)]=e:a.yaxis=e,e.title&&("right"==e.side?a.margin.r=80:a.margin.l=80)}),t.rangeSlider){const e={thickness:.08};o&&(e.bgcolor=a.paper_bgcolor,e.borderwidth=1,e.bordercolor=a.plot_bgcolor),"boolean"!=typeof t.rangeSlider&&(e.range=t.rangeSlider),a.xaxis.rangeslider=e,a.margin.b=15}return t.dateRangeButtons&&(a.xaxis.rangeselector=Object.assign({x:1,xanchor:"right",buttons:[{label:"Show all",step:"all"},{label:"2 Yr",step:"year",count:2},{label:"1 Yr",step:"year",count:1},{label:"6 Mth",step:"month",count:6}]},e.buttonStyling(o))),a}})(oePlotly),(function(e,t){"use strict";e.buildDiv=(e,t,o,a=!1)=>{const l=document.createElement("div");let s=e.toLowerCase();return s=s.trim(),s=s.replace(" ","-"),l.id="oePlotly-"+s,l.style.height=t,l.style.minHeight=o,a&&(l.style.width=a),l},e.fullDateRange=()=>({all:[],add(e){this.all=this.all.concat(e),this.all.sort()},firstLast(){let e=this.all.filter(e=>null!==e);return[e[0],e.pop()]}}),e.addClickEvent=(e,o)=>{e.on("plotly_click",(function(e){const a=e.points[0];let l={eye:o,name:a.data.name,index:a.pointIndex,x:a.x,y:a.y};t.customEvent("oePlotlyClick",l),t.log('"oePlotlyClick" Event data: '+JSON.stringify(l))}))},e.addHoverEvent=(e,o)=>{t.log('"oePlotlyHover" ('+o+") Event available (click point to see data structure)"),e.on("plotly_hover",(function(e){const a=e.points[0];let l={eye:o,name:a.data.name,index:a.pointIndex,x:a.x,y:a.y};t.customEvent("oePlotlyHover",l)}))},e.dataLine=t=>{let o={};return t.color&&(o.color=t.color),t.dashed&&(o=Object.assign(o,e.dashedLine())),o},e.dashedLine=()=>({dash:"2px,2px",width:2}),e.markerFor=e=>{const t={};switch(e){case"image":t.symbol="triangle-down",t.size=10;break;case"drug":t.symbol="diamond",t.size=8;break;case"injection":t.symbol="star-diamond",t.size=9}return t},e.eventStyle=(t,o=!1)=>{const a={marker:e.markerFor(t)};switch(t){case"image":a.mode="markers";break;case"drug":a.mode="lines+markers",a.line={width:3};break;case"injection":a.mode="markers"}return o&&(a.marker&&(a.marker.color=o),a.line&&(a.line.color=o)),a},e.buttonStyling=e=>({font:{color:e?"#ccc":"#666"},bgcolor:e?"rgb(30,46,66)":"rgb(255,255,255)",activecolor:e?"rgb(7,69,152)":"rgb(205,205,255)",bordercolor:e?"rgb(10,26,36))":"rgb(255,255,255)",borderwidth:2}),e.addDropDown=t=>{let o=[];o.push({method:"update",args:["visible",[!0,!1,!1,!1]],label:"Option 1"}),o.push({method:"update",args:[{},{title:"some new title",colorway:e.getColorSeries("default",!0)}],label:"Options Title"});let a=Object.assign({type:"dropdown",xanchor:"left",yanchor:"top",x:0,y:.35,buttons:o},e.buttonStyling());t.updatemenus=[a]}})(oePlotly,bluejay),(function(e){"use strict";e.highlighPoint=(t,o)=>(a,l)=>{let s=a.split(".");if(2!=s.length)return void bj.log('oePlotly - for highlightPoint to work it needs EyeSide & Date JSON name e.g. "leftEye.OCT" ');let r,n,i=s[0],y=s[1],d=0;t.get(i).get("data").forEach((e,t)=>{t===y&&(r=e,n=d),d++});let c=e.getColor(i,o),u=[];for(let e=0;e<r.x.length;e++)u.push(c);u[l]=e.getColor("highlight",o);let p=e.markerFor(r.oeEventType);p.color=u,Plotly.restyle(t.get(i).get("div"),{marker:p},[n])}})(oePlotly),(function(e){"use strict";e.selectableUnits=()=>{const t=new Map,o=[];let a,l=0;const s=e=>{l=e.target.selectedIndex;for(const e of t.keys())a(e)};return{init:t=>{a=t.plotlyUpdate;const r=t.darkTheme,n=t.axisDefaults,i=n.title,y=[];t.unitRanges.forEach((t,a)=>{let s;t.makeDefault&&(l=a),y.push(t.option),n.title=`${i} - ${t.option}`,s="number"==typeof t.range[0]?Object.assign({},n,{range:t.range.reverse(),axisType:"linear"}):Object.assign({},n,{useCategories:{showAll:!0,categoryarray:t.range.reverse()}}),o.push(e.getAxis(s,r))}),(e=>{const t=["VA Scale ","<select>","{{#options}}","<option>{{.}}</option>","{{/options}}","</select>"].join(""),o=document.createElement("div");o.className="oesplotly-options",o.innerHTML=Mustache.render(t,{options:e}),o.style.position="absolute",o.style.top="1px",o.style.left="50%",o.style.transform="translateX( -50% )",o.style.zIndex=1;const a=document.querySelector(".oes-v2");a.style.position="relative",a.appendChild(o);let r=o.querySelector("select");r.options[l].selected=!0,r.addEventListener("change",s,!1)})(y)},addTrace:(e,o)=>{t.has(e)?t.get(e).push(o):t.set(e,[o])},selectedTrace:e=>t.get(e)[l],selectedAxis:()=>o[l]}}})(oePlotly),(function(e){"use strict";const t=!0,o=new Map,a=(e,t,a)=>{const l=(()=>{let e=0;return()=>{let t=e++;return e>=a.length&&(e=0),a[t]}})();o.get(t).set("data",new Map);const s={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:l()})};o.get(t).get("data").set(e.VA.offScale.name,s);const r={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:l(),dashed:!0})};o.get(t).get("data").set(e.CRT.name,r);const n={x:e.VA.units.x,y:e.VA.units.y,name:e.VA.units.name,yaxis:"y3",hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:l()})};o.get(t).get("data").set("VA",n)},l=e=>{const a=oePlotly.getLayout({darkTheme:t,legend:{yanchor:"top",y:1},xaxis:e.x,yaxes:e.y,subplot:2}),l=oePlotly.buildDiv("Patient Popup","415px","415px","1020px");document.getElementById("patient-popup-oeplolty").appendChild(l),o.set("div",l),o.set("layout",a),(()=>{let e=[];["rightEye","leftEye"].forEach(t=>{if(o.has(t)){let a=o.get(t).get("data");e=e.concat(Array.from(a.values()))}}),Plotly.react(o.get("div"),e,o.get("layout"),{displayModeBar:!1,responsive:!0})})(),oePlotly.addClickEvent(l,"?"),oePlotly.addHoverEvent(l,"?"),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(l,a)})};e.extend("plotPatientPopup",(s=null)=>{if(null===s)return e.log("[oePlotly] - no JSON data provided for Plot.ly Patient Popup ??"),!1;e.log("[oePlotly] - building Plot.ly Patient Popup");const r=[[0,.15],[.2,1]];s.rightEye&&(o.set("rightEye",new Map),a(s.rightEye,"rightEye",oePlotly.getColorSeries("rightEyeSeries",t))),s.leftEye&&(o.set("leftEye",new Map),a(s.leftEye,"leftEye",oePlotly.getColorSeries("leftEyeSeries",t)));const n=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,noMirrorLines:!0},t),i=oePlotly.getAxis({type:"y",domain:r[0],useCategories:{showAll:!0,categoryarray:s.yaxis.offScale.reverse()},spikes:!0},t),y=oePlotly.getAxis({type:"y",domain:r[1],title:"CRT",range:[200,650],spikes:!0},t),d=oePlotly.getAxis({type:"y",domain:r[1],title:"VA",rightSide:"y2",useCategories:{showAll:!0,categoryarray:s.yaxis.unitRanges.snellenMetre.range.reverse()},spikes:!0},t);l({x:n,y:[i,y,d]})})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme();e.extend("plotBarChart",(o=null)=>{if(null===o)return e.log("[oePlotly] - no JSON data provided for Plot.ly Bar Chart ??"),!1;e.log("[oePlotly] - building Plot.ly Bar Chart");const a=(e=>{const t={y:e.data.y,name:e.data.name,type:"bar"};return e.data.x&&(t.x=e.data.x),e.data.hovertemplate&&(t.hovertemplate=e.data.hovertemplate),[t]})(o),l=oePlotly.getAxis({type:"x",numTicks:20},t),s=oePlotly.getAxis({type:"y",numTicks:20},t);o.title.xaxis&&(l.title=o.title.xaxis),o.title.yaxis&&(s.title=o.title.yaxis),console.log(o),(e=>{const o=oePlotly.getLayout({darkTheme:t,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes});o.barmode="stack",Plotly.react(e.div,e.data,o,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(o.dom),title:o.title.plot,data:a,xaxis:l,yaxes:[s]})})})(bluejay),(function(e){"use strict";const t="Bar Percent Complete",o=oePlotly.isDarkTheme();e.extend("plotBarPercentComplete",(a=null)=>{if(null===a)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const l=(e=>{let t=e.percentComplete.map(e=>100-e);return[{x:e.xAxis,y:e.percentComplete,name:"",hovertemplate:"Complete<br>%{y}%",type:"bar"},{x:e.xAxis,y:t,name:"",hovertemplate:"Incomplete<br>%{y}%",type:"bar"}]})(a),s=oePlotly.getAxis({type:"x",numTicks:20},o),r=oePlotly.getAxis({type:"y",range:[0,100],numTicks:20},o);(e=>{const t=oePlotly.getLayout({darkTheme:o,colors:"posNeg",xaxis:e.xaxis,yaxes:e.yaxes});t.barmode="stack",Plotly.react(e.div,e.data,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(a.dom),data:l,xaxis:s,yaxes:[r]})})})(bluejay),(function(e){"use strict";const t="Combined Medical Retina",o=oePlotly.isDarkTheme(),a=new Map,l=oePlotly.fullDateRange(),s=oePlotly.selectableUnits(),r=(e,t,o)=>{const r=(()=>{let e=0;return()=>{let t=e++;return e>=o.length&&(e=0),o[t]}})();a.get(t).set("data",new Map);const n={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:r()})};a.get(t).get("data").set(e.VA.offScale.name,n),l.add(e.VA.offScale.x);const i={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:r(),dashed:!0})};a.get(t).get("data").set(e.CRT.name,i),l.add(e.CRT.x);const y=r();Object.values(e.VA.units).forEach((e,o)=>{s.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y3",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dataLine({color:y})}),o||l.add(e.x)}),a.get(t).get("data").set("VA",s.selectedTrace(t))},n=()=>{let e=[];["rightEye","leftEye","BEO"].forEach(t=>{if(a.has(t)){let o=a.get(t).get("data");o.set("VA",s.selectedTrace(t)),e=e.concat(Array.from(o.values()))}}),a.get("layout").yaxis3=Object.assign({},s.selectedAxis()),Plotly.react(a.get("div"),e,a.get("layout"),{displayModeBar:!1,responsive:!0})};e.extend("plotCombinedMedRet",(i=null)=>{if(null===i)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const y=[[0,.15],[.2,1]];s.init({darkTheme:o,plotlyUpdate:n,axisDefaults:{type:"y",rightSide:"y2",domain:y[1],title:"VA",spikes:!0},unitRanges:Object.values(i.yaxis.unitRanges)}),i.rightEye&&(a.set("rightEye",new Map),r(i.rightEye,"rightEye",oePlotly.getColorSeries("rightEyeSeries",o))),i.leftEye&&(a.set("leftEye",new Map),r(i.leftEye,"leftEye",oePlotly.getColorSeries("leftEyeSeries",o))),i.BEO&&(a.set("BEO",new Map),r(i.BEO,"BEO",oePlotly.getColorSeries("BEOSeries",o)));(e=>{const s=oePlotly.getLayout({darkTheme:o,legend:{yanchor:"top",y:1},plotTitle:"Right, Left and BEO",xaxis:e.x,yaxes:e.y,subplot:2,rangeSlider:l.firstLast(),dateRangeButtons:!0}),r=oePlotly.buildDiv(""+t,"80vh","650px");document.querySelector(".oes-left-side").appendChild(r),a.set("div",r),a.set("layout",s),n(),oePlotly.addClickEvent(r,"?"),oePlotly.addHoverEvent(r,"?"),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(r,s)})})({x:oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,range:l.firstLast(),spikes:!0,noMirrorLines:!0},o),y:[oePlotly.getAxis({type:"y",domain:y[0],useCategories:{showAll:!0,categoryarray:i.yaxis.offScale.reverse()},spikes:!0},o),oePlotly.getAxis({type:"y",domain:y[1],title:"CRT",range:[200,650],spikes:!0},o),s.selectedAxis()]})})})(bluejay),(function(e){"use strict";const t="Combined Medical Retina",o=oePlotly.isDarkTheme(),a=new Map,l=(e,t,o)=>{const l=(()=>{let e=0;return()=>{let t=e++;return e>=o.length&&(e=0),o[t]}})();a.get(t).set("data",new Map);const s={x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",mode:"lines+markers",yaxis:"y2",line:oePlotly.dataLine({color:l()}),error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}};a.get(t).get("data").set("VA",s);const r={x:e.CRT.x,y:e.CRT.y,name:"CRT",hovertemplate:"Mean ± SD<br>CRT: %{y}<br>(N: %{x})",type:"scatter",line:oePlotly.dataLine({color:l(),dashed:!0}),error_y:{type:"data",array:e.CRT.error_y,visible:!0,thickness:.5}};a.get(t).get("data").set(e.CRT.name,r)};e.extend("plotCombinedOutcomesWithErrors",(s=null)=>{if(null===s)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);s.rightEye&&(a.set("rightEye",new Map),l(s.rightEye,"rightEye",oePlotly.getColorSeries("rightEyeSeries",o))),s.leftEye&&(a.set("leftEye",new Map),l(s.leftEye,"leftEye",oePlotly.getColorSeries("leftEyeSeries",o)));const r=oePlotly.getAxis({type:"x",numTicks:10,spikes:!0,noMirrorLines:!0},o),n=oePlotly.getAxis({type:"y",title:"CRT",range:s.yaxis.CRT,spikes:!0},o),i=oePlotly.getAxis({type:"y",title:"VA",range:s.yaxis.VA,rightSide:"y1",spikes:!0},o);(e=>{const t=oePlotly.getLayout({darkTheme:o,legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});let l=[];["rightEye","leftEye"].forEach(e=>{if(a.has(e)){let t=a.get(e).get("data");l=l.concat(Array.from(t.values()))}}),Plotly.react(e.div,l,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(s.dom),xaxis:r,yaxes:[n,i]})})})(bluejay),(function(e){"use strict";const t="Outcomes with Error bars",o=oePlotly.isDarkTheme();e.extend("plotOutcomesWithErrors",(a=null)=>{if(null===a)return e.log(`[oePlotly] - no JSON data provided for Plot.ly ${t} ??`),!1;e.log("[oePlotly] - building Plot.ly "+t);const l=(e=>[{x:e.VA.x,y:e.VA.y,name:"VA",hovertemplate:"Mean ± SD<br>VA: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y1",error_y:{type:"data",array:e.VA.error_y,visible:!0,thickness:.5}},{x:e.IOP.x,y:e.IOP.y,name:"IOP",hovertemplate:"Mean ± SD<br>IOP: %{y}<br>(N: %{x})",type:"scatter",yaxis:"y2",error_y:{type:"data",array:e.IOP.error_y,visible:!0,thickness:.5}}])(a),s=oePlotly.getAxis({type:"x",title:"Weeks",numTicks:20,range:[-20,220]},o),r=oePlotly.getAxis({type:"y",title:"VA (change) from baseline (LogMAR)",range:[70,110],numTicks:20},o),n=oePlotly.getAxis({type:"y",title:"IOP (mm Hg))",rightSide:"y1",numTicks:20},o);(e=>{const t=oePlotly.getLayout({darkTheme:o,colors:"varied",legend:!0,xaxis:e.xaxis,yaxes:e.yaxes,rangeSlider:!0});Plotly.react(e.div,e.data,t,{displayModeBar:!1,responsive:!0})})({div:document.querySelector(a.dom),data:l,xaxis:s,yaxes:[r,n]})})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme(),o=new Map,a=oePlotly.fullDateRange(),l=oePlotly.selectableUnits(),s=oePlotly.highlighPoint(o,t),r=(e,t)=>{o.get(t).set("data",new Map);const s={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers"};o.get(t).get("data").set(e.VA.offScale.name,s),a.add(e.VA.offScale.x);const r={x:e.VFI.x,y:e.VFI.y,name:e.VFI.name,yaxis:"y5",hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dashedLine()};o.get(t).get("data").set(e.VFI.name,r),a.add(e.VFI.x);const n={x:e.IOP.x,y:e.IOP.y,name:e.IOP.name,yaxis:"y3",hovertemplate:"IOP: %{y}<br>%{x}",type:"scatter",mode:"lines+markers"};o.get(t).get("data").set(e.IOP.name,n),a.add(e.IOP.x),Object.values(e.VA.units).forEach((e,o)=>{l.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y2",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers"}),o||a.add(e.x)}),o.get(t).get("data").set("VA",l.selectedTrace(t)),Object.values(e.events).forEach(e=>{let l=e.customdata?"%{y}<br>%{customdata}<br>%{x}":"%{y}<br>%{x}",s=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:l,type:"scatter",showlegend:!1},oePlotly.eventStyle(e.event));o.get(t).get("data").set(e.name,s),a.add(e.x)})},n=e=>{let t=o.get(e);t.get("data").set("VA",l.selectedTrace(e)),t.get("layout").yaxis2=Object.assign({},l.selectedAxis());const a=Array.from(t.get("data").values());Plotly.react(t.get("div"),a,t.get("layout"),{displayModeBar:!1,responsive:!0})},i=e=>{const l=e.eyeSide,s=oePlotly.getLayout({darkTheme:t,legend:{traceorder:"reversed",yanchor:"bottom",y:.82},colors:e.colors,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes,subplot:4,rangeSlider:a.firstLast(),dateRangeButtons:!0,vLineLabel:{x:Object.values(e.procedures),h:.82},hLineLabel:{y:Object.values(e.targetIOP),axis:"y3"}}),r=oePlotly.buildDiv("Glaucoma-"+l,"80vh","850px");document.querySelector(e.parentDOM).appendChild(r),o.get(l).set("div",r),o.get(l).set("layout",s),n(l),oePlotly.addClickEvent(r,l),oePlotly.addHoverEvent(r,l),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(r,s)})};e.extend("plotSummaryGlaucoma",(y=null)=>{if(null===y)return e.log("[oePlotly] - no JSON data provided for Plot.ly Glaucoma ??"),!1;e.log("[oePlotly] - building Plot.ly Glaucoma");const d=[[0,.08],[.1,.45],[.47,.82],[.88,1]];l.init({darkTheme:t,plotlyUpdate:n,axisDefaults:{type:"y",domain:d[1],title:"VA",spikes:!0},unitRanges:Object.values(y.yaxis.unitRanges)}),y.rightEye&&(o.set("rightEye",new Map),r(y.rightEye,"rightEye")),y.leftEye&&(o.set("leftEye",new Map),r(y.leftEye,"leftEye"));const c=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,spikes:!0,range:a.firstLast(),noMirrorLines:!0},t),u=oePlotly.getAxis({type:"y",domain:d[0],useCategories:{showAll:!0,categoryarray:y.yaxis.offScale.reverse()},spikes:!0},t),p=oePlotly.getAxis({type:"y",domain:d[2],title:"IOP",range:[0,75],spikes:!0},t),g=oePlotly.getAxis({type:"y",domain:d[3],useCategories:{showAll:!0,categoryarray:y.eventTypes.reverse()},spikes:!0},t),h=oePlotly.getAxis({type:"y",domain:d[1],title:"VFI",range:[-30,5],rightSide:"y2",spikes:!0},t),m=l.selectedAxis();return o.has("rightEye")&&i({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:c,yaxes:[u,m,p,g,h],procedures:y.rightEye.procedures,targetIOP:y.rightEye.targetIOP,parentDOM:y.rightEye.dom}),o.has("leftEye")&&i({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:c,yaxes:[u,m,p,g,h],procedures:y.leftEye.procedures,targetIOP:y.leftEye.targetIOP,parentDOM:y.leftEye.dom}),e.log("[oePlotly] - method: highlightPoint()"),{highlightPoint:s}})})(bluejay),(function(e){"use strict";const t=oePlotly.isDarkTheme(),o=new Map,a=oePlotly.fullDateRange(),l=oePlotly.selectableUnits(),s=(e,t)=>{o.get(t).set("data",new Map);const s={x:e.VA.offScale.x,y:e.VA.offScale.y,name:e.VA.offScale.name,hovertemplate:"%{y}<br>%{x}",type:"scatter",mode:"lines+markers"};o.get(t).get("data").set(e.VA.offScale.name,s),a.add(e.VA.offScale.x);const r={x:e.CRT.x,y:e.CRT.y,name:e.CRT.name,yaxis:"y2",hovertemplate:"CRT: %{y}<br>%{x}",type:"scatter",mode:"lines+markers",line:oePlotly.dashedLine()};o.get(t).get("data").set(e.CRT.name,r),a.add(e.CRT.x),Object.values(e.VA.units).forEach((e,o)=>{l.addTrace(t,{x:e.x,y:e.y,name:e.name,yaxis:"y3",hovertemplate:e.name+": %{y}<br>%{x}",type:"scatter",mode:"lines+markers"}),o||a.add(e.x)}),o.get(t).get("data").set("VA",l.selectedTrace(t)),Object.values(e.events).forEach(e=>{let l=e.customdata?"%{y}<br>%{customdata}<br>%{x}":"%{y}<br>%{x}",s=Object.assign({oeEventType:e.event,x:e.x,y:e.y,customdata:e.customdata,name:e.name,yaxis:"y4",hovertemplate:l,type:"scatter",showlegend:!1},oePlotly.eventStyle(e.event));o.get(t).get("data").set(e.name,s),a.add(e.x)})},r=e=>{let t=o.get(e);t.get("data").set("VA",l.selectedTrace(e)),t.get("layout").yaxis3=Object.assign({},l.selectedAxis());const a=Array.from(t.get("data").values());Plotly.react(t.get("div"),a,t.get("layout"),{displayModeBar:!1,responsive:!0})},n=e=>{const l=e.eyeSide,s=oePlotly.getLayout({darkTheme:t,legend:{yanchor:"bottom",y:.82},colors:e.colors,plotTitle:e.title,xaxis:e.xaxis,yaxes:e.yaxes,subplot:3,rangeSlider:a.firstLast(),dateRangeButtons:!0}),n=oePlotly.buildDiv("Medical Retina-"+l,"80vh","650px");document.querySelector(e.parentDOM).appendChild(n),o.get(l).set("div",n),o.get(l).set("layout",s),r(l),oePlotly.addClickEvent(n,e.eye),oePlotly.addHoverEvent(n,l),document.addEventListener("oesLayoutChange",()=>{Plotly.relayout(n,s)})};e.extend("plotSummaryMedicalRetina",(i=null)=>{if(null===i)return e.log("[oePlotly] - no JSON data provided for Plot.ly Medical Retina ??"),!1;e.log("[oePlotly] - building Plot.ly Medical Retina");const y=[[0,.15],[.2,.82],[.88,1]];l.init({darkTheme:t,plotlyUpdate:r,axisDefaults:{type:"y",rightSide:"y2",domain:y[1],title:"VA",spikes:!0},unitRanges:Object.values(i.yaxis.unitRanges)}),i.rightEye&&(o.set("rightEye",new Map),s(i.rightEye,"rightEye")),i.leftEye&&(o.set("leftEye",new Map),s(i.leftEye,"leftEye"));const d=oePlotly.getAxis({type:"x",numTicks:10,useDates:!0,range:a.firstLast(),spikes:!0,noMirrorLines:!0},t),c=oePlotly.getAxis({type:"y",domain:y[0],useCategories:{showAll:!0,categoryarray:i.yaxis.offScale.reverse()},spikes:!0},t),u=oePlotly.getAxis({type:"y",domain:y[1],title:"CRT",range:[200,650],spikes:!0},t),p=oePlotly.getAxis({type:"y",domain:y[2],useCategories:{showAll:!0,categoryarray:i.eventTypes.reverse()},spikes:!0},t),g=l.selectedAxis();o.has("rightEye")&&n({title:"Right Eye",eyeSide:"rightEye",colors:"rightEyeSeries",xaxis:d,yaxes:[c,u,g,p],parentDOM:".oes-left-side"}),o.has("leftEye")&&n({title:"Left Eye",eyeSide:"leftEye",colors:"leftEyeSeries",xaxis:d,yaxes:[c,u,g,p],parentDOM:".oes-right-side"})})})(bluejay),(function(e){"use strict";e.addModule("copyToClipboard");const t=".js-clipboard-copy";if(null===document.querySelector(t))return;e.nodeArray(document.querySelectorAll(t)).forEach(e=>{e.style.cursor="pointer"});const o=t=>{let o=t.getBoundingClientRect(),a=o.right-o.width/2,l=o.top-5;const s=document.createElement("div");s.className="oe-tooltip fade-out",s.innerHTML="Copied",s.style.width="80px",s.style.top=l-30+"px",s.style.left=a-40+"px",document.body.appendChild(s),setTimeout(()=>e.remove(s),2500)};e.userDown(t,t=>(t=>{if(navigator.clipboard)navigator.clipboard.writeText(t.textContent).then(()=>{e.log("[ASYNC] copied text to clipboard"),o(t)}).catch(t=>{e.log("failed to copy text to clipboard")});else{const a=document.createElement("input");a.value=t.textContent,a.style.position="absolute",a.style.top="-200px",document.body.appendChild(a),a.select(),document.execCommand("copy"),o(t),e.remove(a)}})(t.target))})(bluejay),(function(e){"use strict";e.addModule("oesLayoutOptions");const t=document.querySelector(".oes-hd-data-layout");if(null==t)return;const o=Object.assign({selector:{rootElem:".oes-hd-data-layout",btn:".oes-hd-data-layout .layout-select-btn",optionBtn:".oes-hd-data-layout .option-btn",options:".layout-options"},current:{eye:JSON.parse(t.dataset.oes).eyeIcons,layout:JSON.parse(t.dataset.oes).layout},get eye(){return this.current.eye},set eye(e){if(e===this.current.eye)return!1;this.current.eye=e,this.views.notify()},get layout(){return this.current.layout},set layout(e){if(this.current.layout===e)return!1;this.current.layout=e,this.views.notify()}},e.ModelViews()),a=((()=>{const a=["{{#sides}}",'<div class="option-btn" data-oes=\'{"opt":"eye.{{eyelat.r}}-{{eyelat.l}}"}\'><span class="oe-eye-lat-icons"><i class="oe-i laterality {{eyelat.r}} small"></i><i class="oe-i laterality {{eyelat.l}} small"></i></span></div>',"{{/sides}}","{{#layouts}}",'<div class="option-btn" data-oes=\'{"opt":"layout.{{.}}"}\'><i class="oes-layout-icon i-{{.}}"></i></div>',"{{/layouts}}"].join(""),l=document.createElement("div");l.className=o.selector.options.replace(".",""),l.innerHTML=Mustache.render(a,{sides:[{eyelat:{r:"R",l:"NA"}},{eyelat:{r:"R",l:"L"}},{eyelat:{r:"NA",l:"L"}}],layouts:["1-0","2-1","1-1","1-2","0-1"]}),e.hide(l),t.appendChild(l)})(),(()=>{const t="oes-layout-icon",a=document.querySelector(o.selector.btn),l=a.querySelector("."+t),s=a.querySelector(".oe-eye-lat-icons");o.views.add(()=>{l.className=t+"  i-"+o.layout;let a=o.eye.split("-");s.innerHTML=Mustache.render('{{#eyes}}<i class="oe-i laterality {{.}} small pad"></i>{{/eyes}}',{eyes:a}),e.customEvent("oesLayoutEyeSide",a)})})(),(()=>{let t=null;const a=document.querySelector(".oes-v2 .oes-right-side"),l=document.querySelector(".oes-v2 .oes-left-side"),s=()=>{if(o.layout!==t){switch(t=o.layout,t){case"1-0":l.style.width="",e.show(l),e.hide(a);break;case"0-1":a.style.width="",e.hide(l),e.show(a);break;case"2-1":l.style.width="66%",a.style.width="33%",e.show(l),e.show(a);break;case"1-2":l.style.width="33%",a.style.width="66%",e.show(l),e.show(a);break;case"1-1":l.style.width="50%",a.style.width="50%",e.show(l),e.show(a);break;default:throw new TypeError("[bluejay] [oesLayoutOptions] - unknown layout: "+t)}e.customEvent("oesLayoutChange",t)}};s(),o.views.add(s)})(),(()=>{let a=!1;const l=t.querySelector(o.selector.btn),s=t.querySelector(o.selector.options),r=t=>{a=!0,e.show(s),l.classList.add("active")},n=t=>{a=!1,e.hide(s),l.classList.remove("active")};return{show:r,hide:n,change:e=>{a?n():r()}}})());e.userDown(o.selector.btn,a.change),e.userEnter(o.selector.btn,a.show),e.userLeave(o.selector.rootElem,a.hide),e.userDown(o.selector.optionBtn,e=>(e=>{let t=JSON.parse(e).opt.split(".");"eye"==t[0]&&(o.eye=t[1]),"layout"==t[0]&&(o.layout=t[1])})(e.target.dataset.oes))})(bluejay),(function(e){"use strict";Object.preventExtensions(e),e.ready()})(bluejay);